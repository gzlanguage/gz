<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monetizelt</title>
    <link href="https://fonts.googleapis.com/css2?family=Billabong&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
        }
        header {
            background-color: #ffffff;
            padding: 9px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        h1 {
            margin: 0;
            font-size: 1.3em;
            font-family: 'Billabong', cursive;
            color: #007bff;
            border: 2px solid #007bff;
            padding: 5px;
            border-radius: 14px;
        }
        .icon-container {
            display: flex;
            align-items: center;
        }
        .icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            border: 1px solid #007bff; 
            border-radius: 8px;
            background-color: white;
            color: #007bff;
            margin-left: 10px;
            cursor: pointer;
            transition: background-color 0.3s;
            text-decoration: none;
        }
        .icon:hover {
            background-color: #e9f5ff; 
        }
        .divider {
            height: 1px;
            background-color: #007bff;
            width: 100%;
            margin: 0 0 8px 0;
        }
        .button-container {
            display: flex;
            justify-content: center;
            padding: 0;
            margin: 0 0 6px 0;
            overflow-x: auto;
            white-space: nowrap;
        }
        .button-container a {
            margin: 0 5px;
            display: flex;
            align-items: center;
            text-decoration: none;
        }
        .button-container a i {
            margin-right: 2px; 
        }
        .button {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 13px;
            padding: 8px 15px;
            font-size: 0.7em;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .button:hover {
            background-color: #0055aa;
        }
        .footer-button {
            margin-left: 10px;
        }
        .content-container {
            width: 330px;
            height: 220px;
            margin: 10px auto;
            position: relative;
            overflow: hidden;
            border-radius: 8px;
            background-color: #d3d3d3;
            border: 1px solid #007bff;
        }
        .slider {
            display: flex;
            width: 100%;
            height: 100%;
        }
        .slide {
            width: 100%;
            height: 100%;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        .cover-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
        .video-container {
            width: 100%;
            height: 100%;
            background-color: #000;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        video {
            max-width: 100%;
            max-height: 100%;
        }
        .swipe-indicator {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            z-index: 10;
        }
        .dot {
            width: 8px;
            height: 8px;
            border-radius: 60%;
            background-color: rgba(255, 255, 255, 0.5);
            margin: 0 4px;
        }
        .dot.active {
            background-color: #007bff;
        }
        .description {
            width: 310px;
            margin: 10px auto;
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 13px;
            border: 1px solid #007bff;
            text-align: left;
            margin-top: 0;
            max-height: 150px;
            overflow-y: auto;
        }
        .description p {
            margin: 0;
        }
        .download-button-container {
            display: flex;
            justify-content: center;
            margin: 10px auto;
        }
        .download-button {
            background-color: white;
            color: #007bff;
            border: 2px solid #007bff;
            border-radius: 30px;
            padding: 10px 30px;
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .download-button:hover {
            background-color: #e9f5ff;
        }
        @keyframes borderAnimation {
            0% { border-color: green; }
            25% { border-color: #007bff; }
            50% { border-color: green; }
            75% { border-color: #007bff; }
            100% { border-color: green; }
        }
        .download-button {
            animation: borderAnimation 2s infinite;
        }
        .copy-notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 123, 255, 0.9);
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 14px;
            z-index: 100;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .copy-notification.show {
            opacity: 1;
        }
        
        .product-info {
            width: 305px;
            margin: 10px auto;
            padding: 7px;
            background-color: #f0f8ff;
            border-radius: 13px;
            border: 1px solid #007bff;
            text-align: center;
        }
        
        .product-title {
            font-weight: bold;
            color: #007bff;
            margin-bottom: 5px;
        }
        
        .product-price {
            font-size: 1.2em;
            margin: 5px 0;
        }
        
        .purchase-terms {
            width: 310px;
            margin: 10px auto 20px;
            padding: 12px;
            background-color: #f0f8ff;
            border-radius: 13px;
            border: 1px solid #007bff;
            text-align: left;
            font-size: 0.9em;
            color: #555;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .purchase-terms h3 {
            color: #007bff;
            font-size: 1em;
            margin: 0 0 8px 0;
            text-align: center;
        }
        
        .purchase-terms p {
            margin: 5px 0;
            line-height: 1.4;
        }
        
        .vendor-info {
            font-weight: bold;
            color: #007bff;
        }
        
        .product-category {
            font-style: italic;
            color: #666;
        }
        
        .terms-checkbox-container {
            display: flex;
            align-items: center;
            margin-top: 10px;
            padding: 5px;
            background-color: #e9f5ff;
            border-radius: 8px;
        }
        
        .terms-checkbox {
            margin-right: 10px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .terms-checkbox-label {
            font-size: 0.9em;
            color: #333;
            font-weight: 500;
        }
        
        .download-button:disabled {
            animation: none;
            background-color: #e0e0e0;
            border-color: #cccccc;
            color: #999999;
            cursor: not-allowed;
        }
        
        .id-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 15px;
            border-radius: 30px;
            border: 2px solid #007bff;
            z-index: 1000;
            width: 250px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            text-align: center;
        }
        
        .id-modal h3 {
            color: #007bff;
            margin-top: 0;
            margin-bottom: 15px;
        }
        
        .id-input {
            width: 90%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #007bff;
            border-radius: 15px;
            font-size: 16px;
            text-align: center;
            letter-spacing: 2px;
        }
        
        .id-submit {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 15px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
            transition: background-color 0.3s;
        }
        
        .id-submit:hover {
            background-color: #0055aa;
        }
        
        .id-result {
            margin-top: 15px;
            font-weight: bold;
            display: none;
        }
        
        .success {
            color: green;
        }
        
        .error {
            color: red;
        }
        
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }
        
        .id-hint {
            font-size: 12px;
            color: #666;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>

<header>
    <h1 translate="no">Monetizelt</h1>
    <div class="icon-container">
        <a class="icon" id="copyButton">
            <i class="fas fa-copy" style="font-size: 23px;"></i>
        </a>
    </div>
</header>

<div class="divider"></div>

<div class="button-container">
    <a class="button" href="faq.html"><i class="fas fa-question-circle"></i> FAQ</a>
    <a class="button footer-button" href="conditions.html"><i class="fas fa-file-contract"></i> Terms</a>
    <a class="button footer-button" href="privacy.html"><i class="fas fa-file-contract"></i> Privacy</a>
</div>

<div class="divider"></div>

<div class="content-container">
    <div class="slider" id="contentSlider">
        <div class="slide" id="coverSlide">
            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='330' height='220' viewBox='0 0 330 220'%3E%3Crect width='330' height='220' fill='%23d3d3d3'/%3E%3Ctext x='165' y='110' font-family='Arial' font-size='16' text-anchor='middle' fill='%23555555'%3ECover Image%3C/text%3E%3C/svg%3E" alt="Cover" class="cover-image" id="cover-image">
        </div>
    </div>
    <div class="swipe-indicator">
        <div class="dot active" id="dot1"></div>
    </div>
</div>

<!-- Product information -->
<div class="product-info" id="product-info">
    <div class="product-title" id="product-title">Loading product...</div>
    <div class="product-price" id="product-price"></div>
</div>

<!-- Description section -->
<div class="description">
    <p id="product-description">Loading description...</p>
</div>

<!-- Download button -->
<div class="download-button-container">
    <button class="download-button" id="downloadButton" disabled>
        Get Access
    </button>
</div>

<!-- Purchase terms -->
<div class="purchase-terms">
    <h3>Purchase Terms</h3>
    <p>By downloading this product, the buyer acknowledges this is intellectual property and agrees to:</p>
    <p>• Monetizelt is solely a streaming platform</p>
    <p>• No refunds are provided as purchase confirms satisfaction with the product</p>
    <p>• Respect copyright and intellectual property rights</p>
    <p>Any violation may result in legal proceedings.</p>
    
    <!-- Terms checkbox -->
    <div class="terms-checkbox-container">
        <input type="checkbox" id="termsCheckbox" class="terms-checkbox">
        <label for="termsCheckbox" class="terms-checkbox-label">I accept the purchase terms above</label>
    </div>
</div>

<!-- ID Number Modal -->
<div class="modal-overlay" id="modalOverlay"></div>
<div class="id-modal" id="idModal">
    <h3>Link Your ID Number</h3>
    <p class="id-hint">Enter the ID Number from your account</p>
    <input type="text" class="id-input" id="idInput" maxlength="6" placeholder="Enter your ID">
    <div class="id-result" id="idResult"></div>
    <button class="id-submit" id="idSubmit">Verify</button>
</div>

<!-- Copy notification -->
<div class="copy-notification" id="copyNotification">URL copied to clipboard!</div>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<script>
    // Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyAF4I7E6-_z8y_8n8P35zyKbh9WOEtIzMQ",
        authDomain: "monetizelt-b235d.firebaseapp.com",
        projectId: "monetizelt-b235d",
        storageBucket: "monetizelt-b235d.firebasestorage.app",
        messagingSenderId: "1040211471009",
        appId: "1:1040211471009:web:321898c7bdca6258ce9ee0",
        measurementId: "G-5NWKR1E9VY"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const storage = firebase.storage();
    const db = firebase.firestore();

    document.addEventListener('DOMContentLoaded', function() {
        const slider = document.getElementById('contentSlider');
        const dot1 = document.getElementById('dot1');
        const copyButton = document.getElementById('copyButton');
        const copyNotification = document.getElementById('copyNotification');
        const downloadButton = document.getElementById('downloadButton');
        const coverImage = document.getElementById('cover-image');
        const productDescription = document.getElementById('product-description');
        const productTitle = document.getElementById('product-title');
        const productPrice = document.getElementById('product-price');
        const termsCheckbox = document.getElementById('termsCheckbox');
        const modalOverlay = document.getElementById('modalOverlay');
        const idModal = document.getElementById('idModal');
        const idInput = document.getElementById('idInput');
        const idSubmit = document.getElementById('idSubmit');
        const idResult = document.getElementById('idResult');
        
        // Enable/disable download button based on checkbox
        termsCheckbox.addEventListener('change', function() {
            downloadButton.disabled = !this.checked;
        });
        
        // Get product data from URL 
        function getProductDataFromURL() {
            // Get product ID from URL parameter
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id');
            
            if (productId) {
                // Retrieve product data from Firestore
                db.collection('products').doc(productId).get()
                    .then((doc) => {
                        if (doc.exists) {
                            const productData = doc.data();
                            
                            // Store data locally
                            localStorage.setItem('monetizelt_product', JSON.stringify(productData));
                            
                            // Initialize page with data
                            initProductPage(productData);
                        } else {
                            console.error("No product found with this ID");
                            productDescription.textContent = "Product not found.";
                            productTitle.textContent = "Error";
                        }
                    })
                    .catch((error) => {
                        console.error("Error retrieving product:", error);
                        productDescription.textContent = "Error loading product.";
                        productTitle.textContent = "Error";
                    });
            } else {
                // Try to get data from localStorage
                const savedProductData = JSON.parse(localStorage.getItem('monetizelt_product') || '{}');
                if (savedProductData && Object.keys(savedProductData).length > 0) {
                    initProductPage(savedProductData);
                } else {
                    productDescription.textContent = "No product specified.";
                    productTitle.textContent = "Error";
                }
            }
        }
        
        // Get product from URL or localStorage
        getProductDataFromURL();
        
        // Initialize interface with product data
        function initProductPage(productData) {
            if (productData && Object.keys(productData).length > 0) {
                // Update cover image
                if (productData.coverImage) {
                    coverImage.src = productData.coverImage;
                }
                
                // Update description
                if (productData.description) {
                    productDescription.textContent = productData.description;
                }
                
                // Update product info with vendor and category
                let categoryText = '';
                if (productData.category) {
                    categoryText = productData.category.charAt(0).toUpperCase() + productData.category.slice(1);
                }
                
                // Add vendor name
                const vendorName = productData.vendorName || 'Anonymous';
                productTitle.innerHTML = `<span class="vendor-info">${vendorName}</span> - Product: <span class="product-category">${categoryText}</span>`;
                
                if (productData.price) {
                    productPrice.textContent = `$${productData.price.toFixed(2)}`;
                }
            } else {
                // Fallback if no data found
                productDescription.textContent = "No information available for this product.";
                productTitle.textContent = "Unknown product";
            }
        }
        
        // Copy current URL function
        copyButton.addEventListener('click', function() {
            const currentUrl = window.location.href;
            
            // Copy URL to clipboard
            navigator.clipboard.writeText(currentUrl).then(function() {
                // Show notification
                copyNotification.classList.add('show');
                
                // Hide notification after 2 seconds
                setTimeout(function() {
                    copyNotification.classList.remove('show');
                }, 2000);
            }).catch(function(err) {
                console.error('Unable to copy: ', err);
                alert('Unable to copy URL. Error: ' + err);
            });
        });

        // Show ID Number modal
        downloadButton.addEventListener('click', function() {
            if (termsCheckbox.checked) {
                modalOverlay.style.display = 'block';
                idModal.style.display = 'block';
                idInput.value = '';
                idResult.style.display = 'none';
                idResult.className = 'id-result';
            }
        });
        
        // Close modal when clicking overlay
        modalOverlay.addEventListener('click', function() {
            modalOverlay.style.display = 'none';
            idModal.style.display = 'none';
        });
        
        // Format input to respect format
        idInput.addEventListener('input', function() {
            // Keep only letters and numbers
            this.value = this.value.replace(/[^a-zA-Z0-9]/g, '').toUpperCase();
            
            // Limit to 6 characters
            if (this.value.length > 6) {
                this.value = this.value.substring(0, 6);
            }
        });
        
        // ID Number verification
        idSubmit.addEventListener('click', function() {
            const idValue = idInput.value.trim();
            
            if (idValue.length !== 6) {
                idResult.textContent = "ID must be 6 characters";
                idResult.className = 'id-result error';
                idResult.style.display = 'block';
                return;
            }
            
            // Check ID in Firestore
            db.collection('userIDs').where('id', '==', idValue).get()
                .then((querySnapshot) => {
                    if (!querySnapshot.empty) {
                        // ID found
                        idResult.textContent = "Success! Access granted.";
                        idResult.className = 'id-result success';
                        idResult.style.display = 'block';
                        
                        // Close modal after 2 seconds
                        setTimeout(() => {
                            modalOverlay.style.display = 'none';
                            idModal.style.display = 'none';
                            
                            // Processing after successful verification
                            const productData = JSON.parse(localStorage.getItem('monetizelt_product') || '{}');
                            if (productData && productData.productFile) {
                                // Create download link
                                const link = document.createElement('a');
                                link.href = productData.productFile.data;
                                link.download = productData.productFile.name || 'download';
                                
                                // Add link to DOM and click it
                                document.body.appendChild(link);
                                link.click();
                                
                                // Clean up
                                setTimeout(() => {
                                    document.body.removeChild(link);
                                }, 100);
                                
                                // Record access in database
                                if (productData.id) {
                                    db.collection('accesses').add({
                                        productId: productData.id,
                                        userId: idValue,
                                        accessDate: new Date()
                                    }).then(() => {
                                        console.log("Access successfully recorded");
                                    }).catch((error) => {
                                        console.error("Error recording access:", error);
                                    });
                                }
                            }
                        }, 2000);
                    } else {
                        // ID not found
                        idResult.textContent = "ID not found";
                        idResult.className = 'id-result error';
                        idResult.style.display = 'block';
                    }
                })
                .catch((error) => {
                    console.error("Error verifying ID:", error);
                    idResult.textContent = "Verification error, please try again.";
                    idResult.className = 'id-result error';
                    idResult.style.display = 'block';
                });
        });
        
        // Allow submission by pressing Enter
        idInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                idSubmit.click();
            }
        });
    });
</script>

</body>
</html>
