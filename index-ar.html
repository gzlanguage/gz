
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>G-Z</title>
    <link rel="icon" href="https://firebasestorage.googleapis.com/v0/b/genz-abb36.firebasestorage.app/o/file_00000000182461f694cccea0b9e89e1f.png?alt=media&token=3fda1ca9-1d47-4b35-9b07-af86c3098c41">
    <link href="https://fonts.googleapis.com/css2?family=Billabong&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#000000">
    <link rel="apple-touch-icon" href="https://firebasestorage.googleapis.com/v0/b/genz-abb36.firebasestorage.app/o/file_00000000182461f694cccea0b9e89e1f.png?alt=media&token=3fda1ca9-1d47-4b35-9b07-af86c3098c41">
    <link rel="manifest" id="manifest-placeholder">
    <style>
        /* Style pour l'écran de chargement en noir */
        body {
            background-color: #000000;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }
        
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000000;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease-out;
        }
        
        .splash-icon {
            width: 100px;
            height: 100px;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(0.8); opacity: 0.7; }
            50% { transform: scale(1); opacity: 1; }
            100% { transform: scale(0.8); opacity: 0.7; }
        }
    </style>
</head>
<body>
    <!-- Écran de chargement -->
    <div class="splash-screen" id="splash-screen">
        <img src="https://firebasestorage.googleapis.com/v0/b/genz-abb36.firebasestorage.app/o/file_00000000182461f694cccea0b9e89e1f.png?alt=media&token=3fda1ca9-1d47-4b35-9b07-af86c3098c41" alt="Logo" class="splash-icon">
    </div>
    
    <!-- Contenu principal de la page (qui sera affiché après le chargement) -->
    <div id="main-content" style="display: none;">
        <!-- Votre contenu principal ici -->
    </div>
    
    <script>
        // Création dynamique du fichier manifest
        const manifestData = {
            "name": "Flower of life",
            "short_name": "Flower",
            "description": "G-Z Application",
            "start_url": "/",
            "display": "standalone",
            "background_color": "#000000",
            "theme_color": "#000000",
            "icons": [
                {
                    "src": "https://firebasestorage.googleapis.com/v0/b/genz-abb36.firebasestorage.app/o/file_00000000182461f694cccea0b9e89e1f.png?alt=media&token=3fda1ca9-1d47-4b35-9b07-af86c3098c41",
                    "sizes": "192x192",
                    "type": "image/png"
                },
                {
                    "src": "https://firebasestorage.googleapis.com/v0/b/genz-abb36.firebasestorage.app/o/file_00000000182461f694cccea0b9e89e1f.png?alt=media&token=3fda1ca9-1d47-4b35-9b07-af86c3098c41",
                    "sizes": "512x512",
                    "type": "image/png"
                }
            ]
        };
        
        const blob = new Blob([JSON.stringify(manifestData)], {type: 'application/json'});
        const manifestURL = URL.createObjectURL(blob);
        document.querySelector('#manifest-placeholder').setAttribute('href', manifestURL);
        
        // Simulation de chargement et affichage du contenu principal
        window.addEventListener('load', function() {
            // Simuler un temps de chargement (peut être ajusté ou remplacé par votre vrai logique)
            setTimeout(function() {
                // Masquer l'écran de chargement
                const splashScreen = document.getElementById('splash-screen');
                splashScreen.style.opacity = '0';
                
                // Afficher le contenu principal
                setTimeout(function() {
                    splashScreen.style.display = 'none';
                    document.getElementById('main-content').style.display = 'block';
                }, 500); // Attendre que l'animation de fondu soit terminée
            }, 2000); // 2 secondes de chargement simulé
        });
    </script>
</body>
</html>
    <style>
        input, textarea, select, button {
            font-size: 16px;
            touch-action: manipulation;
        }
        
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: white;
            position: relative;
            transition: background-color 0.3s ease;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            -webkit-text-size-adjust: 100%;
        }
        header {
            background-color: white;
            padding: 6px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: background-color 0.3s ease;
        }
        
        h1 {
            margin: 0;
            font-size: 1.4em;
            font-family: 'Billabong', cursive;
            color: #007bff;
            border: 2px solid #007bff;
            padding: 4px;
            border-radius: 12px;
            font-weight: bold;
            transition: color 0.3s ease, border-color 0.3s ease;
        }
        .divider {
            height: 0.6px;
            background-color: #007bff;
            width: 100%;
            margin-top: 5px;
            transition: background-color 0.3s ease;
        }
        .button-container {
            display: flex;
            justify-content: center;
            margin-top: 5px;
            padding: 5px 0;
            overflow-x: auto;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        .button-container::-webkit-scrollbar {
            display: none;
        }
        .button {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 5px 10px;
            margin: 0 3px;
            font-size: 0.8em;
            cursor: pointer;
            text-decoration: none;
            display: flex;
            align-items: center;
            flex-shrink: 0;
            transition: background-color 0.3s ease;
        }
        .button i {
            margin-right: 2px;
        }
        .notification {
            text-align: center;
            margin-top: 10px;
            font-size: 0.8em;
            color: #0056b3;
            font-weight: bold;
            transition: color 0.3s ease;
            padding: 3px 0;
            max-height: 30px;
            overflow: hidden;
        }
        .share-icon {
            color: #007bff;
            cursor: pointer;
            font-size: 1.3em;
            border: 1px solid #007bff;
            border-radius: 7px;
            padding: 4px;
            background-color: white;
            transition: color 0.3s ease, border-color 0.3s ease;
        }
        footer {
            background-color: white;
            color: black;
            padding: 10px 15px;
            margin-top: auto;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo-container {
            display: flex;
        }
        .logo {
            color: #007bff;
            font-size: 1.6em;
            margin-right: 10px;
            border: 1px solid #007bff;
            border-radius: 10px;
            padding: 5px;
            background-color: rgba(0, 119, 190, 0.1);
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
        }
        .logo:hover {
            background-color: #007bff;
            color: white;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .modal.show {
            opacity: 1;
        }
        .modal-content {
            background-color: white;
            margin: 50% auto;
            padding: 14px;
            border: 1px solid #007bff;
            border-radius: 60px;
            width: 280px;
            max-width: 70%;
            text-align: center;
            max-height: 60vh;
            overflow-y: auto;
            position: relative;
            transition: background-color 0.3s ease, border-color 0.3s ease, transform 0.3s ease;
            transform: scale(0.8);
        }
        .modal.show .modal-content {
            transform: scale(1);
        }
        .modal-header {
            font-size: 1.8em;
            font-family: 'Billabong', cursive;
            margin-bottom: 10px;
            font-weight: bold;
            color: #007bff;
            text-decoration: underline;
            transition: color 0.3s ease;
        }
        
        .modal-footer {
            margin-top: 15px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 6px;
        }
        .close-button {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 8px 10px;
            cursor: pointer;
            font-size: 0.9em;
            width: 120px;
            margin: 4px;
            transition: background-color 0.3s ease;
        }
        .close-button:hover {
            background-color: #0056b3;
        }
        
        @keyframes flowerRotate {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(15deg); }
            50% { transform: rotate(0deg); }
            75% { transform: rotate(-15deg); }
            100% { transform: rotate(0deg); }
        }
        
        .flower-icon {
            display: inline-block;
            animation: flowerRotate 2s infinite ease-in-out;
            color: #ff69b4;
        }
        
        .billabong-title {
            font-family: 'Billabong', cursive;
            font-size: 1.8em;
            margin-bottom: 8px;
            color: #007bff;
            transition: color 0.3s ease;
        }

        .monthly-motivation {
            margin: 15px 0;
            padding: 10px;
            border: 1px dashed #ff69b4;
            border-radius: 15px;
            background-color: white;
            font-style: italic;
            color: #333;
            font-size: 0.9em;
            line-height: 1.4;
            transition: border-color 0.3s ease, color 0.3s ease, background-color 0.3s ease;
            position: relative;
        }
        
        .flower-code {
            display: block;
            font-weight: bold;
            color: #ff69b4;
            font-size: 0.9em;
            margin-bottom: 8px;
            letter-spacing: 0.5px;
            background-color: #fff0f8;
            padding: 6px;
            border-radius: 8px;
            border: 1px solid #ff69b4;
            max-width: 220px;
            margin-left: auto;
            margin-right: auto;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            transition: color 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
        }
        
        .copy-icon {
            color: #007bff;
            cursor: pointer;
            margin-left: 10px;
            font-size: 1.2em;
            vertical-align: middle;
            transition: color 0.3s ease;
        }
        
        .header-controls {
            display: flex;
            align-items: center;
        }
        
        .celebrate-icon {
            font-size: 2em;
            color: gold;
            margin-bottom: 8px;
            animation: celebrate 2s infinite alternate;
        }
        
        @keyframes celebrate {
            0% { transform: scale(1); }
            50% { transform: scale(1.1) rotate(5deg); }
            100% { transform: scale(1) rotate(-5deg); }
        }
        
        .modal-close {
            position: absolute;
            top: 10px;
            right: 20px;
            color: #ff0000;
            font-size: 13px;
            cursor: pointer;
            background-color: transparent;
            border: none;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.2s;
        }
        
        .modal-close:hover {
            background-color: rgba(255, 0, 0, 0.1);
        }
        
        .share-flower-button {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 14px;
            padding: 8px 16px;
            font-size: 0.9em;
            margin: 290px auto;
            display: none;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
            max-width: 190px;
            position: relative;
            z-index: 1001;
            border: 1px solid #0056b3;
        }
        
        .share-flower-button:hover {
            background-color: #0056b3;
        }
        
        .share-flower-button i {
            margin-left: 8px;
        }
        
        #capturedFlower {
            position: fixed;
            z-index: 1003;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .captured-image-container {
            position: relative;
            max-width: 85%;
            max-height: 60vh;
            margin-bottom: 15px;
        }
        
        .captured-image {
            max-width: 100%;
            max-height: 60vh;
            border-radius: 15px;
            border: 2px solid white;
        }
        
        .share-message {
            background-color: white;
            color: #333;
            padding: 10px 15px;
            border-radius: 15px;
            font-size: 0.9em;
            margin: 10px auto;
            max-width: 90%;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        .share-message i {
            margin-left: 8px;
            color: #007bff;
            transition: color 0.3s ease;
        }
        
        .share-link {
            color: #007bff;
            font-weight: bold;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        .capture-controls {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }
        
        .capture-button {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 20px;
            padding: 8px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
            transition: background-color 0.3s ease;
        }
        
        .capture-button i {
            margin-right: 5px;
        }
        
        .close-capture {
            background-color: #f0f0f0;
            color: #333;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        #flowerCaptureContainer {
            position: fixed;
            z-index: -1;
            top: 0;
            left: -9999px;
            background-color: white;
            border: 2px solid #007bff;
            border-radius: 20px;
            padding: 15px;
            width: 300px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        
        .capture-flower-header {
            font-family: 'Billabong', cursive;
            color: #007bff;
            font-size: 1.8em;
            margin-bottom: 8px;
            text-align: center;
            font-weight: bold;
            text-shadow: 0px 1px 1px rgba(0, 123, 255, 0.2);
            transition: color 0.3s ease;
        }
        
        .capture-flower-code {
            font-weight: bold;
            color: #ff69b4;
            font-size: 0.8em;
            background-color: #fff0f8;
            padding: 6px;
            border-radius: 10px;
            border: 1px solid #ff69b4;
            margin: 6px auto;
            text-align: center;
            max-width: 80%;
            letter-spacing: 0.5px;
            transition: color 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
        }
        
        .capture-flower-motivation {
            font-style: italic;
            color: #333;
            font-size: 0.95em;
            line-height: 1.4;
            background-color: #f9f9f9;
            border: 1px dashed #ff69b4;
            border-radius: 12px;
            padding: 12px;
            margin: 12px 0;
            text-align: center;
            transition: color 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
            position: relative;
        }
        
        .capture-flower-icon {
            text-align: center;
            font-size: 2.5em;
            color: #ff69b4;
            margin: 10px 0;
            transition: color 0.3s ease;
        }
        
        .gz-logo {
            font-family: 'Billabong', cursive;
            color: #007bff;
            font-size: 1.4em;
            text-align: center;
            margin-top: 10px;
            border: 2px solid #007bff;
            border-radius: 12px;
            padding: 4px;
            width: 50px;
            margin-left: auto;
            margin-right: auto;
            font-weight: bold;
            transition: color 0.3s ease, border-color 0.3s ease;
        }
        
        .share-warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
            border-radius: 15px;
            padding: 10px 15px;
            font-size: 0.85em;
            margin: 5px auto 15px auto;
            max-width: 90%;
            text-align: center;
            display: none;
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }
        
        .capture-website-url {
            text-align: center;
            font-size: 0.85em;
            color: #007bff;
            font-weight: bold;
            margin-top: 8px;
            font-family: Arial, sans-serif;
            padding: 3px 0;
            border-top: 1px dashed #007bff;
            transition: color 0.3s ease, border-color 0.3s ease;
        }
        
        .terms-text {
            font-size: 0.8em;
            color: black;
            text-align: center;
            margin: 10px auto;
            width: 330px;
            transition: color 0.3s ease;
        }
        
        .billabong-title {
            margin-bottom: 3px;
        }

        .header-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            padding: 0 1px;
        }

        .header-icon {
            font-size: 1.4em;
            color: #007bff;
            border: 2px solid #007bff;
            padding: 4px;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            transition: color 0.3s ease, border-color 0.3s ease;
        }

        .app-logo {
            font-family: 'Billabong', cursive;
            color: #007bff;
            border: 2px solid #007bff;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 1.4em;
            font-weight: bold;
            transition: color 0.3s ease, border-color 0.3s ease;
        }

        .header-flex {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
        }
        
        .right-controls {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        #welcomeToast {
            position: fixed;
            top: 160px;
            left: 0;
            right: 0;
            background-color: rgba(0,0,0,0.7);
            color: white;
            padding: 10px;
            border-radius: 20px;
            width: 80%;
            max-width: 300px;
            margin: 0 auto;
            text-align: center;
            z-index: 2000;
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease;
            font-family: , cursive;
            font-size: 1.1em;
            border: 2px solid #4CAF50;
        }

        #welcomeModal {
            display: none;
            position: fixed;
            z-index: 10;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        #welcomeModal.show {
            opacity: 1;
        }

        #welcomeModal .modal-content {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            margin: 40% auto;
            padding: 15px 10px;
            border: 2px solid #4CAF50;
            border-radius: 25px;
            width: 85%;
            max-width: 290px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            text-align: center;
            transition: transform 0.3s ease;
            transform: scale(0.8);
        }
        #welcomeModal.show .modal-content {
            transform: scale(1);
        }

        #welcomeModal .close {
            color: red;
            font-size: 18px;
            font-weight: bold;
            display: block;
            text-align: center;
            margin-bottom: 3px;
            cursor: pointer;
        }

        #welcomeModal .welcome-header {
            color: #007bff;
            font-family: 'Billabong', cursive;
            font-size: 1.8em;
            margin-bottom: 8px;
            text-align: center;
            font-weight: bold;
        }

        #welcomeModal .welcome-text {
            margin: 10px 0 15px 0;
            font-size: 0.8em;
            color: #333;
            line-height: 1.4;
            transition: color 0.3s ease;
        }

        .dob-container {
            margin: 10px 0;
        }

        .dob-container label {
            display: block;
            font-size: 0.8em;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        .dob-input {
            width: 90%;
            padding: 8px;
            border-radius: 10px;
            border: 1px solid #ccc;
            font-size: 16px;
        }

        .profession-container {
            margin: 12px 0;
            position: relative;
        }

        .profession-container label {
            display: block;
            font-size: 0.8em;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        .profession-search {
            width: 90%;
            padding: 8px;
            border-radius: 10px;
            border: 1px solid #ccc;
            font-size: 16px;
        }

        .profession-dropdown {
            display: none;
            position: absolute;
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 10px;
            width: 90%;
            max-height: 150px;
            overflow-y: auto;
            left: 5%;
            z-index: 10;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .profession-option {
            padding: 8px 10px;
            font-size: 0.8em;
            cursor: pointer;
            transition: background-color 0.2s;
            background-color: white;
            color: #333;
        }

        .profession-option:hover {
            background-color: #f5f5f5;
        }

        .name-container {
            margin: 10px 0;
        }

        .name-container label {
            display: block;
            font-size: 0.8em;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        .name-input {
            width: 90%;
            padding: 8px;
            border-radius: 10px;
            border: 1px solid #ccc;
            font-size: 16px;
        }

        #createAccountButton {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 10px 25px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            margin: 10px auto 5px;
            display: block;
            width: 80%;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 123, 255, 0.3);
        }
        
        #createAccountButton:hover {
            background: linear-gradient(135deg, #0056b3 0%, #003d80 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 123, 255, 0.4);
        }
        
        #createAccountButton:active {
            transform: translateY(0);
            box-shadow: 0 1px 3px rgba(0, 123, 255, 0.3);
        }

        .loading-spinner {
            display: none;
            text-align: center;
            margin: 10px 0;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        .loading-dots::after {
            content: '...';
            animation: dots 1.5s infinite;
            display: inline-block;
            width: 20px;
            text-align: left;
        }

        #idModal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        #idModal.show {
            opacity: 1;
        }

        #idModal .modal-content {
            background-color: #fff;
            margin: 45% auto;
            padding: 15px;
            border: 1px solid #007BFF;
            border-radius: 25px;
            width: 65%;
            max-width: 250px;
            text-align: center;
            transition: transform 0.3s ease;
            transform: scale(0.8);
        }
        #idModal.show .modal-content {
            transform: scale(1);
        }

        .id-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }

        .id-title {
            font-size: 1em;
            color: #007bff;
            margin-bottom: 5px;
            transition: color 0.3s ease;
        }

        .id-display {
            font-weight: bold;
            font-size: 1.2em;
            color: #ff69b4;
            background-color: #fff0f8;
            padding: 6px;
            border-radius: 8px;
            border: 1px solid #ff69b4;
            margin: 5px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            max-width: 80%;
            transition: color 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
        }

        .delete-account {
            background-color: #ff4d4d;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 6px 10px;
            font-size: 0.7em;
            cursor: pointer;
            transition: background-color 0.3s;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .delete-account:hover {
            background-color: #e60000;
        }

        .copy-icon {
            margin-left: 6px;
        }

        .id-message {
            font-size: 0.7em;
            color: #333;
            margin: 5px 0;
            transition: color 0.3s ease;
        }

        #idModal .close-button {
            margin-top: 8px;
            width: auto;
            padding: 6px 15px;
            font-size: 0.7em;
            height: 28px;
        }

        .menu-link {
            text-decoration: none;
            color: #007bff;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.3s ease;
        }
        
        .style-selector {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: white;
            padding: 10px 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 100;
            transition: background-color 0.3s ease;
        }
        
        .style-selector h3 {
            text-align: center;
            margin: 0 0 10px 0;
            font-size: 1em;
            color: #333;
            transition: color 0.3s ease;
        }
        
        .style-options {
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 0 5px;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        .style-options::-webkit-scrollbar {
            display: none;
        }
        
        .style-option {
            width: 60px;
            height: 40px;
            border-radius: 10px;
            cursor: pointer;
            flex-shrink: 0;
            position: relative;
            border: 1px solid #ddd;
            overflow: hidden;
        }
        
        .style-option.selected {
            border: 2px solid white;
            box-shadow: 0 0 0 2px #007bff;
        }
        
        .style-option.red-black {
            background: linear-gradient(to right, #FF4500, #8B0000, #121212, #121212);
        }
        
        .style-option.green-blue {
            background: linear-gradient(to right, #3EB489, #14532D, #0A2239, #1A2E4D);
        }
        
        .style-option.orange-pink {
            background: linear-gradient(to right, #FF7F50, #FF6F91, #C71585, #4B0082);
        }
        
        .style-option.yellow-purple {
            background: linear-gradient(to right, #FFD700, #FFA500, #8A2BE2, #4B0082);
        }
        
        .style-option.default {
            background: linear-gradient(to right, #007bff, #0056b3);
        }
        
        .main-content {
            padding-bottom: 80px;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
        }
        
        body.theme-default {
            background-color: white;
            color: #333;
        }
        
        body.theme-default header, 
        body.theme-default footer,
        body.theme-default .style-selector {
            background-color: white;
        }
        
        body.theme-default .app-logo,
        body.theme-default .header-icon,
        body.theme-default .divider,
        body.theme-default .notification,
        body.theme-default .billabong-title,
        body.theme-default .gz-logo,
        body.theme-default .capture-website-url,
        body.theme-default .capture-flower-header,
        body.theme-default .id-title {
            color: #007bff;
            border-color: #007bff;
        }
        
        body.theme-default .notification .notification-text {
            color: #007bff;
        }
        
        body.theme-default .button {
            background-color: #007bff;
        }
        
        body.theme-default .share-flower-button {
            background-color: #007bff;
            color: white;
            border-color: #0056b3;
        }
        
        body.theme-default .flower-code,
        body.theme-default .id-display {
            color: #ff69b4;
            background-color: #fff0f8;
            border-color: #ff69b4;
        }
        
        body.theme-default .monthly-motivation,
        body.theme-default .capture-flower-motivation {
            border-color: #ff69b4;
            color: #333;
            background-color: white;
        }
        
        body.theme-default .modal-content {
            background-color: white;
            border-color: #007bff;
        }
        
        body.theme-red-black {
            background: black;
            color: #E5E5E5;
        }
        
        body.theme-red-black header, 
        body.theme-red-black footer,
        body.theme-red-black .style-selector {
            background-color: black;
        }
        
        body.theme-red-black .app-logo,
        body.theme-red-black .header-icon,
        body.theme-red-black .gz-logo,
        body.theme-red-black .capture-flower-header,
        body.theme-red-black .capture-website-url,
        body.theme-red-black .id-title,
        body.theme-red-black .billabong-title {
            color: #FF4500;
            border-color: #FF4500;
        }
        
        body.theme-red-black .divider {
            background-color: #FF4500;
        }
        
        body.theme-red-black .notification .notification-text {
            color: #FF4500;
        }
        
        body.theme-red-black .notification,
        body.theme-red-black .welcome-text,
        body.theme-red-black .id-message {
            color: #CCCCCC;
        }
        
        body.theme-red-black .button {
            background-color: #8B0000;
        }
        
        body.theme-red-black .share-flower-button {
            background-color: #8B0000;
            color: white;
            border-color: #FF4500;
        }
        
        body.theme-red-black .flower-code,
        body.theme-red-black .id-display {
            color: #FF4500;
            background-color: black;
            border-color: #FF4500;
        }
        
        body.theme-red-black .monthly-motivation,
        body.theme-red-black .capture-flower-motivation {
            border-color: #FF4500;
            color: #E5E5E5;
            background-color: black;
        }
        
        body.theme-red-black .modal-content,
        body.theme-red-black #flowerCaptureContainer {
            background-color: black;
            border-color: #8B0000;
        }
        
        body.theme-green-blue {
            background: #1A2E4D;
            color: #F5F5F5;
        }
        
        body.theme-green-blue header, 
        body.theme-green-blue footer,
        body.theme-green-blue .style-selector {
            background-color: #1A2E4D;
        }
        
        body.theme-green-blue .app-logo,
        body.theme-green-blue .header-icon,
        body.theme-green-blue .gz-logo,
        body.theme-green-blue .capture-flower-header,
        body.theme-green-blue .capture-website-url,
        body.theme-green-blue .id-title,
        body.theme-green-blue .billabong-title {
            color: #3EB489;
            border-color: #3EB489;
        }
        
        body.theme-green-blue .divider {
            background-color: #3EB489;
        }
        
        body.theme-green-blue .notification .notification-text {
            color: #3EB489;
        }
        
        body.theme-green-blue .notification,
        body.theme-green-blue .welcome-text,
        body.theme-green-blue .id-message {
            color: #A0A0A0;
        }
        
        body.theme-green-blue .button {
            background-color: #14532D;
        }
        
        body.theme-green-blue .share-flower-button {
            background-color: #14532D;
            color: white;
            border-color: #3EB489;
        }
        
        body.theme-green-blue .flower-code,
        body.theme-green-blue .id-display {
            color: #3EB489;
            background-color: #36454F;
            border-color: #3EB489;
        }
        
        body.theme-green-blue .monthly-motivation,
        body.theme-green-blue .capture-flower-motivation {
            border-color: #3EB489;
            color: #F5F5F5;
            background-color: #1A2E4D;
        }
        
        body.theme-green-blue .modal-content,
        body.theme-green-blue #flowerCaptureContainer {
            background-color: #1A2E4D;
            border-color: #3EB489;
        }
        
        body.theme-orange-pink {
            background: #4B0082;
            color: #FFFFFF;
        }
        
        body.theme-orange-pink header, 
        body.theme-orange-pink footer,
        body.theme-orange-pink .style-selector {
            background-color: #4B0082;
        }
        
        body.theme-orange-pink .app-logo,
        body.theme-orange-pink .header-icon,
        body.theme-orange-pink .gz-logo,
        body.theme-orange-pink .capture-flower-header,
        body.theme-orange-pink .capture-website-url,
        body.theme-orange-pink .id-title,
        body.theme-orange-pink .billabong-title {
            color: #FF7F50;
            border-color: #FF7F50;
        }
        
        body.theme-orange-pink .divider {
            background-color: #FF7F50;
        }
        
        body.theme-orange-pink .notification .notification-text {
            color: #FF7F50;
        }
        
        body.theme-orange-pink .notification,
        body.theme-orange-pink .welcome-text,
        body.theme-orange-pink .id-message {
            color: #D3D3D3;
        }
        
        body.theme-orange-pink .button {
            background-color: #C71585;
        }
        
        body.theme-orange-pink .share-flower-button {
            background-color: #C71585;
            color: white;
            border-color: #FF7F50;
        }
        
        body.theme-orange-pink .flower-code,
        body.theme-orange-pink .id-display {
            color: #FF7F50;
            background-color: #6A0DAD;
            border-color: #FF7F50;
        }
        
        body.theme-orange-pink .monthly-motivation,
        body.theme-orange-pink .capture-flower-motivation {
            border-color: #FF7F50;
            color: #FFFFFF;
            background-color: #4B0082;
        }
        
        body.theme-orange-pink .modal-content,
        body.theme-orange-pink #flowerCaptureContainer {
            background-color: #4B0082;
            border-color: #FF7F50;
        }

        body.theme-yellow-purple {
            background: #4B0082;
            color: #FFFFFF;
        }
        
        body.theme-yellow-purple header, 
        body.theme-yellow-purple footer,
        body.theme-yellow-purple .style-selector {
            background-color: #4B0082;
        }
        
        body.theme-yellow-purple .app-logo,
        body.theme-yellow-purple .header-icon,
        body.theme-yellow-purple .gz-logo,
        body.theme-yellow-purple .capture-flower-header,
        body.theme-yellow-purple .capture-website-url,
        body.theme-yellow-purple .id-title,
        body.theme-yellow-purple .billabong-title {
            color: #FFD700;
            border-color: #FFD700;
        }
        
        body.theme-yellow-purple .divider {
            background-color: #FFD700;
        }
        
        body.theme-yellow-purple .notification .notification-text {
            color: #FFD700;
        }
        
        body.theme-yellow-purple .notification,
        body.theme-yellow-purple .welcome-text,
        body.theme-yellow-purple .id-message {
            color: #D3D3D3;
        }
        
        body.theme-yellow-purple .button {
            background-color: #8A2BE2;
        }
        
        body.theme-yellow-purple .share-flower-button {
            background-color: #8A2BE2;
            color: white;
            border-color: #FFD700;
        }
        
        body.theme-yellow-purple .flower-code,
        body.theme-yellow-purple .id-display {
            color: #FFD700;
            background-color: #6A0DAD;
            border-color: #FFD700;
        }
        
        body.theme-yellow-purple .monthly-motivation,
        body.theme-yellow-purple .capture-flower-motivation {
            border-color: #FFD700;
            color: #FFFFFF;
            background-color: #4B0082;
        }
        
        body.theme-yellow-purple .modal-content,
        body.theme-yellow-purple #flowerCaptureContainer {
            background-color: #4B0082;
            border-color: #FFD700;
        }
        
        .refresh-motivation {
            position: absolute;
            right: 15px;
            top: 70px;
            color: #007bff;
            cursor: pointer;
            font-size: 1.2em;
            padding: 5px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transition: transform 0.3s ease, color 0.3s ease;
        }
        
        .refresh-motivation:hover {
            transform: rotate(180deg);
        }
        
        body.theme-red-black .refresh-motivation {
            color: #FF4500;
        }
        
        body.theme-green-blue .refresh-motivation {
            color: #3EB489;
        }
        
        body.theme-orange-pink .refresh-motivation {
            color: #FF7F50;
        }
        
        body.theme-yellow-purple .refresh-motivation {
            color: #FFD700;
        }
        
        .user-name {
            font-size: 0.75em;
            font-weight: bold;
        }

        .install-prompt {
            display: none;
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 0.9em;
            z-index: 1000;
            width: 80%;
            max-width: 300px;
            text-align: center;
        }
        
        .install-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .install-btn {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            font-size: 0.8em;
            cursor: pointer;
        }
        
        .dismiss-btn {
            background-color: transparent;
            color: #ccc;
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 5px 10px;
            font-size: 0.8em;
            cursor: pointer;
        }
    </style>
</head>
<body class="theme-green-blue">

  <header>
   
    <div class="header-container">
      <div class="app-logo">G-Z</div>
      
      <div class="right-controls">
        
   
        <div class="header-icon" id="showIdButton"><i class="fas fa-user"></i></div>
        
         <a href="https://g-z.online/translate.html" class="header-icon menu-link"><i class="fas fa-globe"></i></a>
        
        <a href="https://g-z.online/us.html" class="header-icon menu-link"><i class="fas fa-bars"></i></a>
      </div>
    </div>
  </header>

  <div class="divider"></div>

  <div class="main-content">
    <div class="button-container">
      <a class="button" href="#" id="flowerButton"><i class="fas fa-spa flower-icon"></i><span>زهرة الحياة</span></a>
      

    </div>

    <div class="divider"></div>
    <div class="notification">
      <span class="notification-text">💠 زهرة -- الرسالة التي كتبها الكون خصيصاً لك ¯\_(ツ)_/¯</span>
    </div>

    <div class="divider"></div>
  </div>

  <div class="style-selector">
    <h3>النمط</h3>
    <div class="style-options">
      <div class="style-option red-black" data-theme="red-black"></div>
      <div class="style-option green-blue selected" data-theme="green-blue"></div>
      <div class="style-option orange-pink" data-theme="orange-pink"></div>
      <div class="style-option yellow-purple" data-theme="yellow-purple"></div>
      <div class="style-option default" data-theme="default"></div>
    </div>
  </div>

  <div id="welcomeToast">
    
    انقر على إحدى 'زهرة الحياة'
  </div>

  <div id="welcomeModal" class="modal">
    <div class="modal-content">
      <div class="welcome-header">💠 مرحباً 💠</div>
      <div class="welcome-text">
        يتطلب إنشاء الحساب تاريخ ميلادك، مهنتك واسمك لإنشاء زهرتك الفريدة.
      </div>
      
      <div class="name-container">
        <label for="fullNameInput">اسمك الكامل:</label>
        <input type="text" id="fullNameInput" class="name-input" placeholder="أدخل اسمك الكامل...">
      </div>
      
      <div class="dob-container">
        <label for="dobInput">تاريخ الميلاد:</label>
        <input type="date" id="dobInput" class="dob-input" max="">
      </div>
      
      <div class="profession-container">
        <label for="professionInput">مهنتك:</label>
        <input type="text" id="professionInput" class="profession-search" placeholder="اكتب مهنتك...">
        <div id="professionDropdown" class="profession-dropdown"></div>
      </div>
      
      <div class="loading-spinner" id="loadingSpinner">
        <span>جاري إنشاء زهرتك الفريدة</span>
        <span class="loading-dots"></span>
      </div>
      
      <button id="createAccountButton">إنشاء حساب</button>
    </div>
  </div>

  <div id="idModal" class="modal">
    <div class="modal-content">
      <div class="id-title">معرّف المستخدم الخاص بك</div>
      <div class="id-display">
        <span id="userIdDisplay"></span>
        <i class="fas fa-copy copy-icon" id="copyIdButton"></i>
      </div>
      <div class="id-message">احتفظ بهذا المعرّف في مكان آمن!</div>
      <div class="id-actions">
        <button class="delete-account" id="deleteAccountButton">حذف الحساب</button>
        <button class="close-button" id="closeIdModal">إغلاق</button>
      </div>
    </div>
  </div>

  <div id="flowerModal" class="modal">
    <div class="modal-content">
      <button class="modal-close" id="closeFlowerModal"><i class="fas fa-times"></i></button>
      <div class="billabong-title"><strong id="flowerTypeTitle">زهرة الحياة</strong></div>
      
      <div id="flowerCodeDisplay" class="flower-code"></div>
      
      <i class="fas fa-sync-alt refresh-motivation" id="refreshMotivation" title="إنشاء تحفيز جديد"></i>
      
      <div class="monthly-motivation" id="monthlyMotivation">
      </div>
      
      <div style="margin: 10px auto; font-size: 3em; color: #ff69b4;" id="flowerIconContainer">
        <i class="fas fa-spa"></i>
      </div>
    </div>
  </div>
  
  <button class="share-flower-button" id="shareFlowerButton">
    <span>مشاركة زهرتي</span> <i class="fas fa-arrow-right send-icon"></i>
  </button>
  
  <div id="capturedFlower">
    <div class="captured-image-container">
      <img id="capturedImage" class="captured-image" src="" alt="زهرة ملتقطة">
    </div>

    <div class="share-warning" id="shareWarning">
      <i class="fas fa-exclamation-triangle" style="margin-right: 5px;"></i>
      <span>لا يمكنك مشاركة زهرتك إذا كان الرابط مفتوحًا في انستغرام. يجب أن تبحث عن www.g-z.online في جوجل/سفاري لتتمكن من مشاركة زهرتك.</span>
    </div>
    
    <div class="capture-controls">
      <button class="capture-button" id="shareCapture">
        <i class="fas fa-share"></i> <span>مشاركة</span>
      </button>
      
      <button class="capture-button close-capture" id="closeCapture">
        <i class="fas fa-download"></i> <span>حفظ</span>
      </button>
    </div>
  </div>
  
  <div id="flowerCaptureContainer">
    <div class="capture-flower-header" id="captureFlowerHeader">زهرة الحياة</div>
    
    <div id="captureFlowerCode" class="capture-flower-code"></div>
    
    <div id="captureFlowerMotivation" class="capture-flower-motivation">
    </div>
    
    <div class="capture-flower-icon" id="captureFlowerIcon">
      <i class="fas fa-spa"></i>
    </div>
    
    <div class="gz-logo">G-Z</div>
    
    <div class="capture-website-url">اكتشف زهرتك الخاصة على www.g-z.online</div>
  </div>

  <div class="install-prompt" id="installPrompt">
    <p>أضف G-Z إلى شاشة البداية للحصول على تجربة أفضل!</p>
    <div class="install-buttons">
      <button class="install-btn" id="installBtn">تثبيت</button>
      <button class="dismiss-btn" id="dismissBtn">لاحقًا</button>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCrPKQOqw4zciASa_5PbI_etfkvrBaDPDI",
      authDomain: "genz-abb36.firebaseapp.com",
      databaseURL: "https://genz-abb36-default-rtdb.firebaseio.com",
      projectId: "genz-abb36",
      storageBucket: "genz-abb36.firebasestorage.app",
      messagingSenderId: "405021535683",
      appId: "1:405021535683:web:ee5a28fde27f5558046176",
      measurementId: "G-XZNQND2J00"
    };

    firebase.initializeApp(firebaseConfig);
    
    const auth = firebase.auth();
    const database = firebase.database();
    const firestore = firebase.firestore();
    
    let userUid = null;
    let userFlowerCode = null;
    let currentMotivation = null;
    let currentCountry = null;
    let userCity = null;
    let userUniqueId = null;
    let isAuthenticated = false;
    let isInstalled = false;
    let currentTheme = "green-blue";
    let userDateOfBirth = null;
    let userProfession = null;
    let userFullName = null;
    let seenSubjects = [];
    let shareCount = 0;
    let deferredPrompt = null;

    const professions = [
      "موسيقي", "مغني راب", "لاعب كرة قدم", "لاعب كرة سلة", "ملاكم", 
      "طالب", "معلم", "طبيب", "ممرض", "مهندس", 
      "مطور برمجيات", "مصمم", "فنان", "كاتب", "صحفي", 
      "طباخ", "نادل/نادلة", "مدبر منزل", "صانع محتوى تيك توك", "يوتيوبر", 
      "مؤثر", "مصور فوتوغرافي", "مصور فيديو", "راقص", "ممثل/ممثلة", 
      "عارض أزياء", "مهندس معماري", "محامي", "محاسب", "مستشار مالي", 
      "مصرفي", "رائد أعمال", "صاحب عمل", "مدير", "تنفيذي", 
      "مندوب مبيعات", "مسوق", "مدير وسائل التواصل الاجتماعي", "سائق", "طيار", 
      "مضيف طيران", "ميكانيكي", "كهربائي", "سباك", "عامل بناء", 
      "مزارع", "بستاني", "طبيب بيطري", "مدرب شخصي", "مدرب لياقة", 
      "معلم يوغا", "معالج", "أخصائي نفسي", "مستشار", "قائد ديني",
      "عالم", "باحث", "أستاذ جامعي", "ضابط شرطة", "رجل إطفاء",
      "عسكري", "حارس أمن", "وكيل عقارات", "صيدلي", "طبيب أسنان",
      "طبيب عيون", "معالج فيزيائي", "معالج مهني", "معالج نطق", "أخصائي تغذية",
      "خبير تغذية", "مصفف شعر", "خبير مكياج", "أخصائي تجميل", "خياط",
      "مصمم أزياء", "عامل بالتجزئة", "أمين صندوق", "ممثل خدمة العملاء", "موظف مركز اتصال",
      "مترجم", "مترجم فوري", "مرشد سياحي", "وكيل سفر", "مدير فندق",
      "موظف استقبال", "سكرتير", "مساعد إداري", "أمين مكتبة", "مؤرشف",
      "مؤرخ", "عالم آثار", "عالم أنثروبولوجيا", "عالم اجتماع", "عالم سياسة",
      "اقتصادي", "إحصائي", "محلل بيانات", "عالم بيانات", "مصمم تجربة المستخدم",
      "مطور ألعاب", "مطور تطبيقات", "مطور ويب", "مدير شبكات", "أخصائي أمن سيبراني",
      "دعم تقني", "فني", "أخصائي إصلاح", "خباز", "جزار",
      "صياد", "عامل منجم", "حراج", "منسق حدائق", "مصمم داخلي",
      "منظم فعاليات", "منظم حفلات زفاف", "بائع زهور", "صائغ", "حرفي",
      "مبرمج", "مصمم ويب", "مسوق رقمي", "أخصائي تحسين محركات البحث", "منشئ محتوى",
      "مدير منتج", "مدير مشروع", "ضمان جودة", "محلل أعمال", "استشاري",
      "موظف توظيف", "مدير موارد بشرية", "مدرب مهني", "مدرب حياة", "متحدث تحفيزي",
      "متحدث عام", "مذيع راديو", "مقدم تلفزيوني", "مذيع", "مقدم بودكاست",
      "مؤلف", "كاتب سيناريو", "كاتب نصوص إعلانية", "كاتب تقني", "محرر",
      "ناشر", "وكيل أدبي", "صاحب مكتبة", "أمين مكتبة", "ناقد كتب",
      "مصمم جرافيك", "رسام توضيحي", "محرك رسوم", "فنان ثلاثي الأبعاد", "فنان مؤثرات بصرية",
      "مخرج أفلام", "منتج", "مشغل كاميرا", "مهندس صوت", "فني إضاءة",
      "محرر أفلام", "مساعد إنتاج", "مصمم ديكور", "مصمم أزياء", "فنان مكياج للأفلام",
      "فنان مؤثرات خاصة", "بديل خطير", "ممثل صوتي", "وكيل مواهب", "مدير اختيار ممثلين"
    ];

    const subjectDictionary = {
      "النجاح": "النجاح",
      "الإنجاز": "الإنجاز",
      "الانتصار": "الانتصار",
      "التفوق": "التفوق",
      "الإنجاز": "الإنجاز",
      
      "الثراء": "الثراء",
      "الازدهار": "الازدهار",
      "الوفرة": "الوفرة",
      "الثروة": "الثروة",
      "الثراء": "الثراء",
      
      "الفرح": "الفرح",
      "السعادة": "السعادة",
      "النعيم": "النعيم",
      "البهجة": "البهجة",
      "الرضا": "الرضا",
      
      "النمو": "النمو",
      "التقدم": "التقدم",
      "التطور": "التطور",
      "التنمية": "التنمية",
      "التحسين": "التحسين",
      
      "القوة": "القوة",
      "الصلابة": "الصلابة",
      "العزم": "العزم",
      "القدرة": "القدرة",
      "الطاقة": "الطاقة",
      
      "الحكمة": "الحكمة",
      "الذكاء": "الذكاء",
      "المعرفة": "المعرفة",
      "البصيرة": "البصيرة",
      "الفهم": "الفهم",
      
      "الإبداع": "الإبداع",
      "الابتكار": "الابتكار",
      "الخيال": "الخيال",
      "الاختراع": "الاختراع",
      "الأصالة": "الأصالة",
      
      "القيادة": "القيادة",
      "السلطة": "السلطة",
      "التأثير": "التأثير",
      "السيطرة": "السيطرة",
      "التوجيه": "التوجيه",
      
      "السلام": "السلام",
      "الانسجام": "الانسجام",
      "الهدوء": "الهدوء",
      "السكينة": "السكينة",
      "الاطمئنان": "الاطمئنان",
      
      "الحب": "الحب",
      "المودة": "المودة",
      "الإعجاب": "الإعجاب",
      "الولاء": "الولاء",
      "الشغف": "الشغف",
      
      "الشجاعة": "الشجاعة",
      "الجرأة": "الجرأة",
      "البطولة": "البطولة",
      "الإقدام": "الإقدام",
      "عدم الخوف": "عدم الخوف",
      
      "الصحة": "الصحة",
      "الحيوية": "الحيوية",
      "العافية": "العافية",
      "النشاط": "النشاط",
      "اللياقة": "اللياقة",
      
      "الحرية": "الحرية",
      "الاستقلالية": "الاستقلالية",
      "الاستقلال": "الاستقلال",
      "الحكم الذاتي": "الحكم الذاتي",
      "تقرير المصير": "تقرير المصير",
      
      "الهدف": "الهدف",
      "المعنى": "المعنى",
      "المهمة": "المهمة",
      "الدعوة": "الدعوة",
      "المصير": "المصير",
      
      "المرونة": "المرونة",
      "العزيمة": "العزيمة",
      "المثابرة": "المثابرة",
      "التحمل": "التحمل",
      "الصمود": "الصمود",
      
      "الأصالة": "الأصالة",
      "الصدق": "الصدق",
      "الصراحة": "الصراحة",
      "النزاهة": "النزاهة",
      "الإخلاص": "الإخلاص",
      
      "التحول": "التحول",
      "التغيير": "التغيير",
      "التطور": "التطور",
      "إعادة الولادة": "إعادة الولادة",
      "التحول الشامل": "التحول الشامل",
      
      "الاتصال": "الاتصال",
      "العلاقة": "العلاقة",
      "المجتمع": "المجتمع",
      "الانتماء": "الانتماء",
      "الوحدة": "الوحدة",
      
      "الامتنان": "الامتنان",
      "الشكر": "الشكر",
      "التقدير": "التقدير",
      "الاعتراف": "الاعتراف",
      "الإقرار": "الإقرار",
      
      "اليقظة": "اليقظة",
      "الحضور": "الحضور",
      "الوعي": "الوعي",
      "الإدراك": "الإدراك",
      "الانتباه": "الانتباه",
      
      "التعاطف": "التعاطف",
      "الرحمة": "الرحمة",
      "اللطف": "اللطف",
      "الكرم": "الكرم",
      "الإيثار": "الإيثار",
      
      "التوازن": "التوازن",
      "الاعتدال": "الاعتدال",
      "الانسجام": "الانسجام",
      "التناسب": "التناسب",
      "التماثل": "التماثل",
      
      "الإلهام": "الإلهام",
      "التحفيز": "التحفيز",
      "الحماس": "الحماس",
      "الإثارة": "الإثارة",
      "الشغف": "الشغف",
      
      "التركيز": "التركيز",
      "الانتباه": "الانتباه",
      "الانضباط": "الانضباط",
      "التفاني": "التفاني",
      "الالتزام": "الالتزام",
      
      "التواضع": "التواضع",
      "البساطة": "البساطة",
      "التبسط": "التبسط",
      "عدم التكلف": "عدم التكلف",
      "الأرضية": "الأرضية",
      
      "الصبر": "الصبر",
      "التسامح": "التسامح",
      "ضبط النفس": "ضبط النفس",
      "التحمل": "التحمل",
      "المثابرة": "المثابرة",
      
      "الفرح": "الفرح",
      "البهجة": "البهجة",
      "السرور": "السرور",
      "الابتهاج": "الابتهاج",
      "الاحتفال": "الاحتفال",
      
      "الثقة": "الثقة",
      "الإيمان": "الإيمان",
      "الاطمئنان": "الاطمئنان",
      "الاعتماد": "الاعتماد",
      "الموثوقية": "الموثوقية",
      
      "الثقة بالنفس": "الثقة بالنفس",
      "تقدير الذات": "تقدير الذات",
      "الإيمان بالنفس": "الإيمان بالنفس",
      "الاطمئنان الذاتي": "الاطمئنان الذاتي",
      "الثقة الذاتية": "الثقة الذاتية",
      
      "الحماس": "الحماس",
      "الحمية": "الحمية",
      "الشغف": "الشغف",
      "الشوق": "الشوق",
      "الغيرة": "الغيرة",
      
      "الوضوح": "الوضوح",
      "الصفاء": "الصفاء",
      "الشفافية": "الشفافية",
      "الدقة": "الدقة",
      "الحدة": "الحدة",
      
      "القدرة على التكيف": "القدرة على التكيف",
      "المرونة": "المرونة",
      "تعدد المهارات": "تعدد المهارات",
      "قابلية التعديل": "قابلية التعديل",
      "المرونة": "المرونة",
      
      "الاتصال": "الاتصال",
      "التعبير": "التعبير",
      "التوضيح": "التوضيح",
      "الحوار": "الحوار",
      "المحادثة": "المحادثة",
      
      "المهنة": "المهنة",
      "الوظيفة": "الوظيفة",
      "الحرفة": "الحرفة",
      "العمل": "العمل",
      "الدعوة": "الدعوة"
    };

    function formatUserName(fullName) {
      if (!fullName) return "";
      
      const nameParts = fullName.trim().split(' ');
      
      if (nameParts.length === 1) {
        return nameParts[0];
      }
      
      const firstName = nameParts[0];
      const lastNameInitial = nameParts[nameParts.length - 1].charAt(0).toUpperCase();
      
      return `👑 ${firstName} ${lastNameInitial}.`;
    }

    function generateUniqueId() {
      const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      const numbers = '0123456789';
      let id = '';
      
      for (let i = 0; i < 3; i++) {
        id += letters.charAt(Math.floor(Math.random() * letters.length));
      }
      
      for (let i = 0; i < 3; i++) {
        id += numbers.charAt(Math.floor(Math.random() * numbers.length));
      }
      
      return id;
    }

    async function detectUserLocation() {
      try {
        const response = await fetch('https://ipapi.co/json/');
        const data = await response.json();
        currentCountry = data.country_name;
        userCity = data.city;
        console.log("تم اكتشاف موقع المستخدم:", currentCountry, userCity);
        return { country: currentCountry, city: userCity };
      } catch (error) {
        console.error("خطأ في اكتشاف موقع المستخدم:", error);
        return { country: "غير معروف", city: "غير معروف" };
      }
    }

    function generatePersonalizedMotivation(flowerCode, profession, dob) {
      if (!flowerCode || flowerCode.length < 8) {
        return "هذا التحفيز الزهري موجود هنا لإلهامك وإرشادك.";
      }
      
      let month = 0;
      if (dob) {
        const dobDate = new Date(dob);
        month = dobDate.getMonth();
      }
      
      const lifeTraits = [
        "الإبداع يجلب أفكارًا جديدة لكل تحدٍ تواجهه.",
        "اللطف في قلبك يلهم الآخرين من حولك يوميًا.",
        "المثابرة تساعدك على التغلب على العقبات التي يجدها الآخرون مستحيلة.",
        "منظور فريد يسمح لك بحل المشكلات بطرق مبتكرة.",
        "الحضور المفعم بالطاقة ينير اليوم لكل من تقابله.",
        "الصبر يمكنك من رؤية الصورة الأكبر عندما لا يستطيع الآخرون ذلك.",
        "الشجاعة تسمح لك بمواجهة التحديات الجديدة بتصميم.",
        "الحكمة ترشدك خلال القرارات الصعبة بوضوح.",
        "التفاؤل يساعدك على إيجاد الفرص في أي موقف تواجهه.",
        "التركيز يدفعك لتحقيق الأهداف خطوة بخطوة بدقة.",
        "القدرة على التكيف تصبح أعظم قوة لك في الأوقات المتغيرة.",
        "الحدس يوجهك إلى المسار الصحيح عندما تبدو الخيارات غير واضحة.",
        "التعاطف يربطك بعمق مع الآخرين بطرق ذات معنى.",
        "المرونة تساعدك على النهوض أقوى من أي انتكاسة.",
        "الأصالة تجذب الناس إلى ذاتك الحقيقية دون تظاهر.",
        "الامتنان يضاعف الفرح في حياتك مع مرور كل يوم.",
        "الفضول يقود إلى اكتشافات جديدة قد يفوتها الآخرون.",
        "حس الفكاهة يخفف حتى أصعب اللحظات.",
        "الكرم يخلق موجات من اللطف في مجتمعك.",
        "التصميم يحول التحديات إلى إنجازات تستحق الاحتفال.",
        "التعاطف يشفي من حولك بطرق دقيقة ولكنها قوية.",
        "الوضوح يساعدك على اتخاذ خيارات حكيمة عندما يحيط بك الارتباك.",
        "الثقة تلهم ثقة الآخرين الذين يتبعون قيادتك.",
        "اليقظة تبقيك متوازنًا حتى وسط الفوضى وعدم اليقين.",
        "النزاهة تكسب الاحترام أينما ذهبت بين الأقران والقادة.",
        "الحماس يشعل الشغف في الآخرين الذين يشهدون طاقتك.",
        "الدفء يجعل الناس يشعرون بالترحيب الفوري في حضورك.",
        "الخيال يفتح أبوابًا لإمكانيات لا يستطيع الآخرون رؤيتها.",
        "التوازن يساعدك على التنقل في تعقيدات الحياة بأناقة.",
        "الرؤية تمكنك من الرؤية إلى ما وراء الأفق عندما يتوقف الآخرون.",
        "الكاريزما تجذب الناس نحو طاقتك المغناطيسية بشكل طبيعي.",
        "الانضباط يبني أساس النجاح في جميع المساعي.",
        "الطبيعة الحدسية تساعدك على فهم الحقائق الدقيقة التي يفتقدها الآخرون.",
        "روح المرح تحافظ على روحك شابة ونابضة بالحياة من خلال التحديات.",
        "العقل التحليلي يجد حلولاً يتجاهلها الآخرون تمامًا.",
        "الاهتمام يخلق روابط ذات معنى تدوم مدى الحياة.",
        "الحساسية تسمح لك بإدراك ما يحتاجه الآخرون دون سؤال.",
        "الحسم يدفع المشاريع إلى الأمام عندما يتردد الآخرون.",
        "الاتساق يبني الثقة مع مرور الوقت في جميع علاقاتك.",
        "التعبيرية تتواصل بجمال مع حقيقتك للعالم.",
        "البراعة تحول القيود إلى فرص للنمو.",
        "الاجتهاد يضمن الجودة في كل ما تلمسه أو تبدعه.",
        "المرونة تتكيف مع الظروف المتغيرة بنعمة ملحوظة.",
        "الواقعية تؤسس أفعالك في الواقع بينما تحلم بشكل كبير.",
        "البلاغة توضح الأفكار المعقدة بوضوح للآخرين لفهمها.",
        "البصيرة تساعدك على الاستعداد للتحديات المستقبلية قبل وصولها.",
        "اللطف يشفي الجروح دون ترك ندبات في القلوب الحساسة.",
        "الحزم يدافع عما هو صحيح دون تردد.",
        "الاستقلالية تعزز الاعتماد على الذات والقوة في المحن.",
        "الضمير ينتبه إلى التفاصيل المهمة التي يفتقدها الآخرون.",
        "المرونة العقلية تساعدك على التكيف مع المواقف الجديدة بسهولة.",
        "الوعي الذاتي ينير طريقك نحو النمو والإنجاز.",
        "القوة الداخلية تتألق بشكل أكثر إشراقًا خلال أوقات المحن الصعبة.",
        "الشخصية المغناطيسية تجذب الناس إلى مدارك دون جهد.",
        "الذكاء العاطفي يساعدك على التنقل في العلاقات المعقدة.",
        "سرعة التفكير تجد حلولاً عندما يرى الآخرون فقط المشاكل.",
        "الثقة الهادئة تتحدث بصوت عالٍ دون قول كلمة.",
        "القيادة الطبيعية تلهم الآخرين لاتباع غرائزهم الأفضل.",
        "الأخلاق الثابتة توجه قراراتك حتى في الظلام.",
        "الحساسية الفنية تجد الجمال في أماكن ولحظات غير متوقعة.",
        "العقل الاستراتيجي يتوقع التطورات المستقبلية بدقة.",
        "العفوية تجلب طاقة جديدة للمواقف الراكدة على الفور.",
        "الاهتمام الدقيق بالتفاصيل يمنع المضاعفات المستقبلية.",
        "الحضور السلمي يهدئ حتى البيئات الأكثر فوضوية.",
        "التفكير المبتكر يخترق القيود التقليدية.",
        "الدبلوماسية الطبيعية تحل النزاعات بأناقة وإنصاف.",
        "الجدارة بالثقة تجعلك مستشارًا لمن هم في حاجة.",
        "الحماس المعدي يرفع كل من حولك."
      ];
      
      const lifeEncouragements = [
        "استمر في مشاركة هذه المواهب مع العالم من حولك.",
        "ثق بهذه الغرائز - فهي نادرًا ما تقودك بعيدًا.",
        "هذه المواهب الطبيعية معدة للمشاركة على نطاق واسع.",
        "قد يكون الطريق أمامك فيه تحديات، لكنك مجهز تمامًا.",
        "الخطوات الصغيرة اليوم تؤدي إلى إنجازات كبيرة غدًا.",
        "تذكر أن تحتفل بالتقدم على طول الطريق إلى الأمام.",
        "هذه الرحلة الفريدة تستحق كل خطوة تخطوها.",
        "لا تنس أن تستمتع بالعملية، وليس فقط بالنتائج.",
        "أفضل الأيام لا تزال في المستقبل في هذه المغامرة.",
        "جهود اليوم تبني قصة نجاح الغد.",
        "ابق صادقًا مع نفسك في جميع المواقف والتحديات.",
        "احتضن التغيير كفرصة للنمو أقوى.",
        "استمع إلى الحكمة الداخلية أكثر - فهي تعرف الطريق.",
        "اسمح لنفسك بالراحة عند الحاجة دون شعور بالذنب.",
        "ابق مركزًا على ما يهم حقًا في الصورة الأكبر.",
        "وجودك هو هدية لأولئك المحظوظين بما يكفي لمعرفتك.",
        "غذِّ شغفك باستمرار رغم الجداول الزمنية المزدحمة.",
        "كن لطيفًا مع نفسك أثناء التحديات والانتكاسات.",
        "هذا المسار الفريد هو بالضبط المناسب للمكان الذي تحتاج إلى الذهاب إليه.",
        "ثق بتوقيت تكشف ألغاز الحياة.",
        "ابحث عن الفرح في اللحظات الصغيرة كل يوم بلا فشل.",
        "هذا المنظور قيّم - شاركه أكثر في كثير من الأحيان.",
        "آمن بالقدرة على خلق تغيير ذي معنى.",
        "تذكر لماذا بدأت هذه الرحلة في المقام الأول.",
        "كل يوم يقدم بداية جديدة للبدء من جديد.",
        "هذه المرونة تلهم الآخرين أكثر مما تدرك.",
        "خذ وقتًا للاحتفال بالانتصارات الصغيرة على طول الطريق.",
        "كل تحدٍ تواجهه يقوي شخصيتك بعمق.",
        "الكون يدعم هذا المسار الأصيل تمامًا.",
        "النور يشع بشكل أكثر إشراقًا عندما تقود الأصالة الطريق.",
        "العالم يحتاج إلى هذه المساهمة الفريدة التي يمكنك وحدك تقديمها.",
        "دع العمل الهادف يتحدث عن نفسه دون تفسير.",
        "الجهد المستمر يتراكم مع مرور الوقت إلى العظمة.",
        "ما يبدو مستحيلاً اليوم سيصبح حقيقة غدًا.",
        "القوة الداخلية تتجاوز أي تحدٍ في المستقبل بكثير.",
        "هذه الرحلة تلهم الآخرين أكثر مما ستعرف أبدًا.",
        "العقبات ليست سوى إعادة توجيه إلى مسار أفضل في المستقبل.",
        "عمق الشخصية يظهر بوضوح أكبر في اللحظات الصعبة.",
        "النمو يحدث خارج مناطق الراحة، وليس داخلها.",
        "حتى التقدم الصغير يستحق الاحتفال والتقدير.",
        "ابق مركزًا على 'لماذا' الشخصي خلال الأوقات الصعبة.",
        "الاختيارات اليومية تخلق إرثًا دائمًا يستحق التذكر.",
        "الدروس المستفادة الآن ستخدم إلى الأبد بطرق لا تحصى.",
        "لا تقلل أبدًا من تأثير اللطف على الآخرين.",
        "الصوت الأصيل يتردد صداه مع أولئك الذين يحتاجون إلى سماعه.",
        "التحديات التي تم التغلب عليها اليوم تبني القوة لاختبارات الغد.",
        "الماضي لا يحدد الإمكانات المستقبلية أو الاحتمالات.",
        "كل خطوة إلى الأمام، مهما كانت صغيرة، تخلق زخمًا.",
        "النهج الفريد يصبح الميزة التنافسية التي يفتقر إليها الآخرون.",
        "ثق بأن الموضع الحالي هو بالضبط حيث يحتاج النمو إلى الحدوث.",
        "أعظم الإنجازات غالبًا ما تتبع أكبر التحديات التي تم التغلب عليها.",
        "تستمر كتابة هذه القصة بفصول رائعة في المستقبل.",
        "الكون يتآمر لصالح الأحلام الأصيلة المتابعة.",
        "المورد الأكثر قوة لا يزال الإيمان الثابت بالنفس.",
        "التأثير على الآخرين يمتد إلى ما هو أبعد مما يمكن قياسه.",
        "القيود الحالية مؤقتة، بينما تظل الإمكانات غير محدودة.",
        "الموافقة الأكثر أهمية تأتي من الداخل، وليس من الخارج.",
        "الحدس يعمل كبوصلة داخلية تشير إلى الشمال الحقيقي.",
        "انضباط اليوم يخلق حرية الغد والفرصة.",
        "كل تجربة تضيف عمقًا للشخصية والحكمة.",
        "غرض الحياة يتكشف من خلال الفرح والصعوبة على حد سواء.",
        "كيفية التعامل مع المحن تكشف عن القوة الحقيقية للشخصية.",
        "التفرد يصبح أعظم ميزة تنافسية في الحياة.",
        "اسمح بالتطور الشخصي مع تطور الأحلام والأهداف بشكل طبيعي.",
        "الالتزام بالنمو يغير بالفعل النتائج المستقبلية بشكل إيجابي.",
        "لا تقلل أبدًا من مدى ما يمكن أن يأخذ الاتساق الأهداف الجديرة.",
        "التصميم يفوق أي انتكاسة مؤقتة تواجهها.",
        "المسار الصحيح ليس دائمًا الأسهل، لكنه يبقى الأكثر جدارة.",
        "الشجاعة للبدء تلهم الآخرين لبدء رحلتهم الخاصة.",
        "اختيار النمو على الراحة يوسع الإمكانات بشكل أسي.",
        "أعلى إمكانات تنتظر فقط خلف حافة منطقة الراحة.",
        "كل تحدٍ يعد لشيء أعظم في الأفق."
      ];
      
      const professionMotivations = {
        "موسيقي": [
          "الموهبة الموسيقية تجلب الانسجام لعالم فوضوي يبحث عن السلام.",
          "كل نغمة تعزف تتردد مع روح شخص ما في حاجة إلى الراحة.",
          "هذه الألحان لديها قوة لشفاء وتحويل الأرواح المكسورة.",
          "التعبير الفني ينقل حقائق عالمية لا تستطيع الكلمات نقلها.",
          "الموسيقى بداخلك تستحق أن تُسمع من قبل الجماهير المنتظرة."
        ],
        "مغني راب": [
          "الكلمات الشعرية ترسم قصصًا قوية تحتاج أن تُروى بجرأة.",
          "هذا التدفق والإيقاع يلتقط المشاعر التي لا تستطيع الكلمات وحدها التعبير عنها.",
          "هذه الأبيات تمنح صوتًا للتجارب التي يشعر بها الكثيرون لكن لا يستطيعون التعبير عنها.",
          "الصوت الأصيل يتردد مع الباحثين عن الحقيقة في كل مجتمع.",
          "البراعة اللفظية تفتح العقول والقلوب لوجهات نظر جديدة."
        ],
        "لاعب كرة قدم": [
          "التفاني في الملعب يلهم العمل الجماعي بما يتجاوز اللعبة نفسها.",
          "الانضباط الرياضي يترجم إلى جميع مجالات الحياة بسلاسة.",
          "التفكير الاستراتيجي في الملعب يظهر قدرات قيادية طبيعية.",
          "الشغف باللعبة الجميلة يرفع من شأن المشاهدين واللاعبين.",
          "الروح الرياضية تضع المعيار للآخرين ليتبعوه ويحترموه."
        ],
        "لاعب كرة سلة": [
          "رؤية الملعب تترجم إلى رؤية الفرص في جميع ألعاب الحياة.",
          "الأداء تحت الضغط يخدم جيدًا في كل تحدٍ تواجهه.",
          "عقلية الفريق أولاً تخلق النجاح في جميع العلاقات المتكونة.",
          "القفز العمودي يتطابق مع الطموح للوصول إلى ارتفاعات جديدة مثيرة للإعجاب.",
          "الاندفاع الدفاعي يظهر الالتزام بالتميز في كل الأشياء."
        ],
        "ملاكم": [
          "الصلابة العقلية تثير الإعجاب بقدر القوة البدنية المعروضة.",
          "انضباط التدريب يعكس الشخصية في جميع ظروف الحياة.",
          "تلقي الضربات والمضي قدمًا يصبح قوة خارقة في الحياة.",
          "حركة القدمين في الحلبة تعكس القدرة على التنقل في تحديات الحياة.",
          "روح القتال لا تتراجع أبدًا عن التحديات الجديرة المقدمة."
        ],
        "طالب": [
          "الفضول يفتح أبوابًا لاحتمالات واكتشافات لا حصر لها.",
          "الالتزام بالتعلم يخدم طوال فصول الحياة العديدة.",
          "المنظور الجديد يجلب رؤى جديدة لمشاكل قديمة تحتاج إلى حلول.",
          "الرحلة التعليمية تعد للفرص التي لم تكن مرئية بعد.",
          "الانضباط الأكاديمي يبني عادات تضمن نجاح الحياة."
        ],
        "معلم": [
          "التأثير يمتد إلى ما هو أبعد من جدران الفصول الدراسية إلى مستقبل غير مرئي.",
          "الصبر يغذي الإمكانات التي قد يفتقدها الآخرون أو يتجاهلونها.",
          "التوجيه يشكل المستقبل بطرق لا يتم تقديرها أو قياسها بشكل كامل.",
          "الحكمة تزرع بذورًا تتفتح لأجيال بعد دروس اليوم.",
          "التفاني للمعرفة يخلق موجات من التغيير الإيجابي في كل مكان."
        ],
        "صانع محتوى تيك توك": [
          "المحتوى الإبداعي يجلب الفرح والتواصل في مشهدنا الرقمي.",
          "الصوت الأصيل يصل إلى أولئك الذين يحتاجون بالضبط إلى هذه الرسالة الآن.",
          "التواصل بإيجاز يظهر إتقان المهارة النادرة والقيمة.",
          "التأثير الثقافي يوجه نحو التغيير الإيجابي للمشاهدين في جميع أنحاء العالم.",
          "الوجود الرقمي يحدث تأثيرًا في العالم الحقيقي يتجاوز حدود الشاشة."
        ],
        "رائد أعمال": [
          "التفكير الرؤيوي يخلق فرصًا حيث يرى الآخرون فقط العقبات.",
          "أخذ المخاطر المحسوبة يميز المبتكرين الحقيقيين عن المتابعين.",
          "الحلول المبتكرة تحل المشاكل عند سببها الجذري بفعالية.",
          "القيادة تلهم الآخرين للانضمام إلى مهام ذات معنى تستحق المتابعة.",
          "المثابرة خلال التحديات تحدد قصص نجاح ريادة الأعمال."
        ],
        "طبيب": [
          "أيادي الشفاء تجلب الراحة في الضيق عندما يحتاج المرضى إليها أكثر.",
          "الالتزام بالرعاية الصحية يغير الحياة يوميًا بطرق عميقة.",
          "المعرفة الطبية مع التعاطف تخلق لحظات شفاء حقيقية.",
          "التفاني في رعاية المرضى يمثل أعلى دعوة مهنية.",
          "المهارات التشخيصية تتطابق مع القلب الرحيم في توازن مثالي."
        ],
        "مهندس": [
          "قدرات حل المشكلات تخلق حلولًا تحسن حياة عدد لا يحصى.",
          "الخبرة التقنية تبني أسسًا للابتكارات المستقبلية.",
          "العقل التحليلي يرى أنماطًا يفتقدها الآخرون تمامًا في الأنظمة المعقدة.",
          "الدقة والاهتمام بالتفاصيل تضمن الجودة في كل إبداع.",
          "النهج المبتكرة للتحديات تدفع مجالات كاملة إلى الأمام."
        ],
        "مطور برمجيات": [
          "الكود يخلق إمكانيات لم تكن موجودة قبل التنفيذ.",
          "الحلول التقنية تحل مشاكل بشرية حقيقية تواجه المجتمع.",
          "التفكير المنطقي يتجمع بشكل جميل مع الابتكار الإبداعي.",
          "الإبداعات الرقمية تؤثر على عدد لا يحصى من المستخدمين يوميًا عبر المنصات.",
          "تعلم التقنيات الجديدة يحافظ على المركز المهني المتطور."
        ],
        "فنان": [
          "الرؤية الإبداعية تظهر للآخرين طرقًا جديدة لرؤية العوالم المألوفة.",
          "التعبير الفني يلمس المشاعر التي لا تستطيع الكلمات ببساطة الوصول إليها.",
          "المنظور الفريد يضيف جمالًا إلى التجارب اليومية للمشاهدين.",
          "العمل الإبداعي يشعل محادثات مهمة عبر الحدود.",
          "الشجاعة الفنية تلهم الآخرين للتعبير عن حقيقتهم بأصالة."
        ],
        "ممرض": [
          "الرعاية الرحيمة تشفي أكثر من العلل الجسدية وحدها.",
          "الانتباه يلاحظ ما قد يفتقده الآخرون في رعاية المرضى.",
          "الحضور الهادئ يوفر الراحة في لحظات الرعاية الصحية الصعبة.",
          "التفاني يحدث فرقًا في كل مناوبة لعدد لا يحصى من المرضى.",
          "توازن المهارة التقنية والدفء الإنساني يثبت أنه لا يقدر بثمن."
        ],
        "كاتب": [
          "الكلمات تخلق عوالم في أذهان القراء تنتظر استكشافها.",
          "سرد القصص يربط الناس عبر تجارب مختلفة تمامًا.",
          "البلاغة تمنح صوتًا لما يكافح الآخرون للتعبير عنه بوضوح.",
          "الرؤى المكتوبة تقدم وجهات نظر جديدة حول التحديات المألوفة.",
          "الحرفة الأدبية تحفظ حقائق مهمة للأجيال القادمة."
        ],
        "محامي": [
          "المناصرة تجلب العدالة لأولئك الذين يحتاجون إلى صوت في الأنظمة المعقدة.",
          "العقل التحليلي ينقل التحديات القانونية بدقة مثيرة للإعجاب.",
          "الالتزام بالمبادئ القانونية يقوي أسس المجتمع.",
          "الحجج المقنعة تغير النتائج للعملاء الساعين للعدالة.",
          "النهج الأخلاقي لممارسة القانون يضع المعايير للمهنة."
        ],
        "طباخ": [
          "الإبداعات الطهوية تجلب الفرح من خلال جميع الحواس للمتذوقين المقدرين.",
          "الطبخ يربط الناس عبر الطاولات وخلفيات ثقافية متنوعة.",
          "مزيج النكهات يظهر الحدس الفني والمهارة التقنية.",
          "التفاني للمكونات ذات الجودة يكرم التقاليد والابتكار.",
          "قيادة المطبخ تستخرج الأفضل في فرق الطهي بأكملها."
        ],
        "محاسب": [
          "الخبرة المالية توفر الأمن وراحة البال للعملاء.",
          "الاهتمام بالتفاصيل يلتقط ما قد يفتقده الآخرون بالتأكيد.",
          "المهارات التحليلية تجلب الوضوح للمواقف المالية المعقدة.",
          "النزاهة المهنية تضمن الثقة في جميع علاقات العمل.",
          "القدرات التنظيمية تخلق النظام من التعقيد المالي."
        ],
        "مصمم": [
          "الحلول البصرية تجمع بين الجمال والوظيفة العملية بسلاسة.",
          "تفكير التصميم يحول تجارب المستخدم بطرق ذات معنى.",
          "الحساسية الجمالية ترفع من مستوى الأشياء والتفاعلات اليومية.",
          "العملية الإبداعية توازن بين الابتكار وقابلية الاستخدام الأساسية.",
          "لغة التصميم تتواصل عبر الحواجز بفعالية."
        ],
        "ضابط شرطة": [
          "الالتزام بالسلامة العامة يجعل المجتمعات أقوى بشكل ملحوظ.",
          "الشجاعة في المواقف الصعبة تحمي المواطنين الضعفاء.",
          "اتخاذ القرار السريع تحت الضغط يظهر رباطة جأش رائعة.",
          "التفاني للعدالة يوجه السلوك المهني باستمرار.",
          "الحضور يجلب الأمن للمواقف المتوترة التي تتطلب التدخل."
        ],
        "رجل إطفاء": [
          "الشجاعة في المواقف الخطرة تنقذ الأرواح والممتلكات القيمة.",
          "التفكير السريع تحت الضغط الشديد يظهر مهارة استثنائية.",
          "الاستعداد البدني والعقلي يمكّن من الاستجابة للطوارئ البطولية.",
          "العمل الجماعي في مواقف الأزمات يمثل التعاون البشري.",
          "الالتزام بسلامة المجتمع يمتد إلى ما هو أبعد من حالات الطوارئ."
        ],
        "عسكري": [
          "الخدمة تظهر أعلى التزام بحماية الآخرين.",
          "الانضباط في ظروف صعبة يضع معايير استثنائية.",
          "التفكير الاستراتيجي يوازن بين أهداف المهمة وسلامة الفريق.",
          "القدرة على التكيف مع المواقف المتغيرة تضمن نجاح المهمة باستمرار.",
          "الولاء للوحدة يخلق روابط تتجاوز الصداقة العادية."
        ],
        "صحفي": [
          "السعي وراء الحقيقة يجلب الوضوح في أوقات مربكة ومعقدة.",
          "سرد القصص يساعد الجماهير على فهم القضايا المهمة المعقدة.",
          "المهارات الاستقصائية تكشف ما يحتاج بشدة إلى الظهور.",
          "الالتزام بالحقائق يوازن نظام المعلومات بمسؤولية.",
          "الصوت الصحفي يضيف وجهة نظر مهمة للخطاب العام."
        ],
        "أخصائي نفسي": [
          "الاستماع المتعاطف يخلق مساحة آمنة للشفاء الضروري.",
          "الرؤى تساعد العملاء على التنقل في مناظرهم الداخلية بفعالية.",
          "النهج العلاجي يوازن بين التعاطف والممارسة المستندة إلى الأدلة.",
          "التوجيه الصبور يسمح للآخرين باكتشاف حلولهم الخاصة.",
          "الحدود المهنية تمكّن من علاقات شفاء مستدامة."
        ],
        "معلم": [
          "التوجيه يشكل المستقبل بما يتجاوز ما يمكن رؤيته مباشرة.",
          "الصبر مع عمليات التعلم يسمح للنمو بالتكشف بشكل طبيعي.",
          "القدرة على شرح المفاهيم المعقدة يجعل المعرفة في متناول الجميع.",
          "إدارة الفصل تخلق مساحات آمنة للاستكشاف الفكري.",
          "التعرف على أساليب التعلم المختلفة يصل إلى كل طالب بشكل فريد."
        ],
        "مبرمج": [
          "مهارات البرمجة تحول الأفكار المجردة إلى واقع وظيفي.",
          "نهج حل المشكلات يقسم التحديات المعقدة إلى أجزاء قابلة للإدارة.",
          "الاهتمام بالتفاصيل يمنع المضاعفات المستقبلية في الكود المتطور.",
          "التعلم المستمر يبقي المهارات ذات صلة في مجال سريع التغير.",
          "الإبداع التقني يجد حلولًا أنيقة للمشاكل الصعبة."
        ]
      };
      
      const monthTraits = [
        "ميلاد يناير يمنح صفات قيادية طبيعية وتركيزًا محددًا.",
        "ميلاد فبراير يبارك بفهم حدسي ورؤية إنسانية.",
        "ميلاد مارس يوفر إبداعًا خياليًا ومرونة قابلة للتكيف.",
        "ميلاد أبريل يمنح إصرارًا محددًا ومبادرة شجاعة.",
        "ميلاد مايو يمنح مهارات اتصال مقنعة وحسًا عمليًا.",
        "ميلاد يونيو يقدم تنوعًا قابلًا للتكيف وذكاءً عاطفيًا.",
        "ميلاد يوليو يمنح تعاطفًا رحيمًا وغرائز رعاية وقائية.",
        "ميلاد أغسطس يبارك بكاريزما مغناطيسية وثقة كريمة.",
        "ميلاد سبتمبر يوفر دقة تحليلية وتنظيمًا منهجيًا.",
        "ميلاد أكتوبر يمنح منظورًا متوازنًا وانسجامًا دبلوماسيًا.",
        "ميلاد نوفمبر يمنح بصيرة نافذة وكثافة تحويلية.",
        "ميلاد ديسمبر يقدم تفاؤلًا رؤيويًا وحكمة فلسفية."
      ];
      
      let selectedTrait;
      
      if (profession && professionMotivations[profession] && Math.random() < 0.25) {
        const profMotivations = professionMotivations[profession];
        selectedTrait = profMotivations[Math.floor(Math.random() * profMotivations.length)];
      } 
      else if (dob && Math.random() < 0.2) {
        selectedTrait = monthTraits[month];
      }
      else {
        selectedTrait = lifeTraits[Math.floor(Math.random() * lifeTraits.length)];
      }
      
      const encourageIndex = Math.floor(Math.random() * lifeEncouragements.length);
      
      return selectedTrait + " " + lifeEncouragements[encourageIndex];
    }

    function generateFlowerCode() {
      const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      let code = '';
      for (let i = 0; i < 8; i++) {
        const randomIndex = Math.floor(Math.random() * characters.length);
        code += characters.charAt(randomIndex);
      }
      return code;
    }

    function getRandomSubject() {
      let availableSubjects = Object.keys(subjectDictionary).filter(subject => !seenSubjects.includes(subject));
      
      if (availableSubjects.length === 0) {
        seenSubjects = [];
        availableSubjects = Object.keys(subjectDictionary);
      }
      
      const randomIndex = Math.floor(Math.random() * availableSubjects.length);
      const selectedSubject = availableSubjects[randomIndex];
      
      seenSubjects.push(selectedSubject);
      
      return selectedSubject;
    }

    function updateFlowerDisplay() {
      const flowerCodeElement = document.getElementById('flowerCodeDisplay');
      const motivationElement = document.getElementById('monthlyMotivation');
      
      if (!flowerCodeElement || !motivationElement) {
        console.error("العناصر المطلوبة غير موجودة في DOM");
        return;
      }
      
      let subject = localStorage.getItem('flowerSubject');
      if (!subject) {
        subject = getRandomSubject();
        localStorage.setItem('flowerSubject', subject);
      }
      
      const formattedName = formatUserName(userFullName);
      
      if (formattedName) {
        flowerCodeElement.innerHTML = `زهرتي - ${subject} / ${formattedName}`;
      } else {
        flowerCodeElement.textContent = "زهرتي - " + subject;
      }
      
      if (!currentMotivation) {
        currentMotivation = generatePersonalizedMotivation(userFlowerCode, userProfession, userDateOfBirth);
      }
      
      motivationElement.textContent = currentMotivation;
      
      const captureCode = document.getElementById('captureFlowerCode');
      const captureMotivation = document.getElementById('captureFlowerMotivation');
      
      if (captureCode) {
        if (formattedName) {
          captureCode.innerHTML = `زهرتي - ${subject} / ${formattedName}`;
        } else {
          captureCode.textContent = "زهرتي - " + subject;
        }
      }
      
      if (captureMotivation) captureMotivation.textContent = currentMotivation;
      
      return currentMotivation;
    }

    function setCookie(name, value, days) {
      let expires = "";
      if (days) {
        const date = new Date();
        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
        expires = "; expires=" + date.toUTCString();
      }
      document.cookie = name + "=" + (value || "") + expires + "; path=/; SameSite=Lax";
    }

    function getCookie(name) {
      const nameEQ = name + "=";
      const ca = document.cookie.split(';');
      for (let i = 0; i < ca.length; i++) {
        let c = ca[i];
        while (c.charAt(0) === ' ') c = c.substring(1, c.length);
        if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
      }
      return null;
    }

    function removeCookie(name) {
      document.cookie = name + "=; Max-Age=-99999999; path=/";
    }

    function setTheme(theme) {
      document.body.classList.remove('theme-default', 'theme-red-black', 'theme-green-blue', 'theme-orange-pink', 'theme-yellow-purple');
      
      document.body.classList.add('theme-' + theme);
      
      currentTheme = theme;
      
      localStorage.setItem('preferredTheme', theme);
      setCookie('preferredTheme', theme, 365);
      
      const options = document.querySelectorAll('.style-option');
      options.forEach(option => {
        option.classList.remove('selected');
        if (option.dataset.theme === theme) {
          option.classList.add('selected');
        }
      });
      
      updateCaptureStyles(theme);
      
      let themeColor = '#1A2E4D';
      switch(theme) {
        case 'red-black':
          themeColor = '#000000';
          break;
        case 'green-blue':
          themeColor = '#1A2E4D';
          break;
        case 'orange-pink':
        case 'yellow-purple':
          themeColor = '#4B0082';
          break;
        case 'default':
          themeColor = '#FFFFFF';
          break;
      }
      
      document.querySelector('meta[name="theme-color"]').setAttribute('content', themeColor);
      document.querySelector('meta[name="apple-mobile-web-app-status-bar-style"]').setAttribute('content', theme === 'default' ? 'default' : 'black-translucent');
    }
    
    function updateCaptureStyles(theme) {
      const captureContainer = document.getElementById('flowerCaptureContainer');
      const captureCode = document.getElementById('captureFlowerCode');
      const captureHeader = document.getElementById('captureFlowerHeader');
      const captureWebsiteUrl = document.querySelector('.capture-website-url');
      const captureLogo = document.querySelector('.gz-logo');
      const captureMotivation = document.getElementById('captureFlowerMotivation');
      
      if (!captureContainer || !captureCode || !captureHeader || !captureWebsiteUrl || 
          !captureLogo || !captureMotivation) {
        console.error("واحد أو أكثر من عناصر الالتقاط غير موجودة");
        return;
      }
      
      captureContainer.style.borderColor = '';
      captureCode.style.borderColor = '';
      captureCode.style.color = '';
      captureCode.style.backgroundColor = '';
      captureHeader.style.color = '';
      captureWebsiteUrl.style.color = '';
      captureLogo.style.color = '';
      captureLogo.style.borderColor = '';
      captureMotivation.style.color = '';
      captureMotivation.style.backgroundColor = '';
      captureMotivation.style.borderColor = '';
      
      switch(theme) {
        case 'red-black':
          captureContainer.style.borderColor = '#8B0000';
          captureContainer.style.backgroundColor = 'black';
          captureCode.style.borderColor = '#FF4500';
          captureCode.style.color = '#FF4500';
          captureCode.style.backgroundColor = 'black';
          captureHeader.style.color = '#FF4500';
          captureWebsiteUrl.style.color = '#FF4500';
          captureLogo.style.color = '#FF4500';
          captureLogo.style.borderColor = '#FF4500';
          captureMotivation.style.color = '#E5E5E5';
          captureMotivation.style.backgroundColor = 'black';
          captureMotivation.style.borderColor = '#FF4500';
          break;
          
        case 'green-blue':
          captureContainer.style.borderColor = '#3EB489';
          captureContainer.style.backgroundColor = '#1A2E4D';
          captureCode.style.borderColor = '#3EB489';
          captureCode.style.color = '#3EB489';
          captureCode.style.backgroundColor = '#36454F';
          captureHeader.style.color = '#3EB489';
          captureWebsiteUrl.style.color = '#3EB489';
          captureLogo.style.color = '#3EB489';
          captureLogo.style.borderColor = '#3EB489';
          captureMotivation.style.color = '#F5F5F5';
          captureMotivation.style.backgroundColor = '#1A2E4D';
          captureMotivation.style.borderColor = '#3EB489';
          break;
          
        case 'orange-pink':
          captureContainer.style.borderColor = '#FF7F50';
          captureContainer.style.backgroundColor = '#4B0082';
          captureCode.style.borderColor = '#FF7F50';
          captureCode.style.color = '#FF7F50';
          captureCode.style.backgroundColor = '#6A0DAD';
          captureHeader.style.color = '#FF7F50';
          captureWebsiteUrl.style.color = '#FF7F50';
          captureLogo.style.color = '#FF7F50';
          captureLogo.style.borderColor = '#FF7F50';
          captureMotivation.style.color = '#FFFFFF';
          captureMotivation.style.backgroundColor = '#4B0082';
          captureMotivation.style.borderColor = '#FF7F50';
          break;
          
        case 'yellow-purple':
          captureContainer.style.borderColor = '#FFD700';
          captureContainer.style.backgroundColor = '#4B0082';
          captureCode.style.borderColor = '#FFD700';
          captureCode.style.color = '#FFD700';
          captureCode.style.backgroundColor = '#6A0DAD';
          captureHeader.style.color = '#FFD700';
          captureWebsiteUrl.style.color = '#FFD700';
          captureLogo.style.color = '#FFD700';
          captureLogo.style.borderColor = '#FFD700';
          captureMotivation.style.color = '#FFFFFF';
          captureMotivation.style.backgroundColor = '#4B0082';
          captureMotivation.style.borderColor = '#FFD700';
          break;
          
        default:
          captureContainer.style.borderColor = '#007bff';
          captureContainer.style.backgroundColor = 'white';
          captureCode.style.borderColor = '#ff69b4';
          captureCode.style.color = '#ff69b4';
          captureCode.style.backgroundColor = '#fff0f8';
          captureHeader.style.color = '#007bff';
          captureWebsiteUrl.style.color = '#007bff';
          captureLogo.style.color = '#007bff';
          captureLogo.style.borderColor = '#007bff';
          captureMotivation.style.color = '#333';
          captureMotivation.style.backgroundColor = 'white';
          captureMotivation.style.borderColor = '#ff69b4';
      }
    }

    function authenticateAnonymously() {
      return new Promise((resolve, reject) => {
        auth.signInAnonymously()
          .then((userCredential) => {
            console.log("تم مصادقة المستخدم بشكل مجهول:", userCredential.user.uid);
            userUid = userCredential.user.uid;
            isAuthenticated = true;
            resolve(userCredential.user);
          })
          .catch((error) => {
            console.error("خطأ في المصادقة:", error);
            reject(error);
          });
      });
    }

    auth.onAuthStateChanged((user) => {
      if (user) {
        userUid = user.uid;
        isAuthenticated = true;
        console.log("تغيير حالة المصادقة: المستخدم قام بتسجيل الدخول", user.uid);
      } else {
        isAuthenticated = false;
        console.log("تغيير حالة المصادقة: المستخدم قام بتسجيل الخروج");
      }
    });

    async function submitToFirebase() {
      try {
        if (!isAuthenticated) {
          console.log("المستخدم غير مصادق عليه، جاري المصادقة الآن...");
          await authenticateAnonymously();
        }
        
        const location = await detectUserLocation();
        
        const userData = {
          date: new Date().toISOString(),
          country: location.country || "غير معروف",
          city: location.city || "غير معروف",
          uid: userUid,
          uniqueId: userUniqueId,
          flowerCode: userFlowerCode,
          motivation: currentMotivation,
          dateOfBirth: userDateOfBirth,
          profession: userProfession,
          fullName: userFullName,
          formattedName: formatUserName(userFullName),
          timestamp: Date.now(),
          theme: currentTheme,
          subject: localStorage.getItem('flowerSubject') || getRandomSubject(),
          shareCount: shareCount
        };

        console.log("إرسال البيانات إلى Firebase:", userData);
        
        try {
          const newEntryRef = database.ref('birthdates').push(userData);
          console.log("تم إرسال البيانات إلى قاعدة البيانات في الوقت الفعلي:", newEntryRef.key);
        } catch (dbError) {
          console.error("خطأ في قاعدة البيانات في الوقت الفعلي:", dbError);
        }
        
        try {
          const docRef = await firestore.collection('flowers').add(userData);
          console.log("تمت كتابة المستند إلى Firestore برقم معرف: ", docRef.id);
        } catch (firestoreError) {
          console.error("خطأ في إضافة مستند إلى Firestore: ", firestoreError);
        }
        
        try {
          await firestore.collection('flowerCodes').doc(userUniqueId).set({
            ...userData,
            createdAt: new Date()
          });
          console.log("تمت إضافة رمز الزهرة إلى مجموعة محددة");
        } catch (codeError) {
          console.error("خطأ في إضافة رمز الزهرة إلى المجموعة: ", codeError);
        }
        
        localStorage.setItem('userFlowerData', JSON.stringify(userData));
        localStorage.setItem('isInstalled', 'true');
        setCookie('userUniqueId', userUniqueId, 365);
        setCookie('userFlowerCode', userFlowerCode, 365);
        setCookie('userDateOfBirth', userDateOfBirth, 365);
        setCookie('userProfession', userProfession, 365);
        setCookie('userFullName', userFullName, 365);
        setCookie('isInstalled', 'true', 365);
        isInstalled = true;
        
        return true;
      } catch (error) {
        console.error("خطأ في إرسال Firebase:", error);
        const userData = {
          date: new Date().toISOString(),
          uniqueId: userUniqueId,
          flowerCode: userFlowerCode,
          motivation: currentMotivation,
          dateOfBirth: userDateOfBirth,
          profession: userProfession,
          fullName: userFullName,
          formattedName: formatUserName(userFullName),
          timestamp: Date.now(),
          theme: currentTheme,
          subject: localStorage.getItem('flowerSubject') || getRandomSubject(),
          shareCount: 0
        };
        
        localStorage.setItem('userFlowerData', JSON.stringify(userData));
        localStorage.setItem('isInstalled', 'true');
        setCookie('userUniqueId', userUniqueId, 365);
        setCookie('userFlowerCode', userFlowerCode, 365);
        setCookie('userDateOfBirth', userDateOfBirth, 365);
        setCookie('userProfession', userProfession, 365);
        setCookie('userFullName', userFullName, 365);
        setCookie('isInstalled', 'true', 365);
        isInstalled = true;
        
        return true;
      }
    }

    async function updateShareCount() {
      if (!isAuthenticated || !userUniqueId) return;
      
      try {
        shareCount++;
        
        const savedData = localStorage.getItem('userFlowerData');
        if (savedData) {
          const userData = JSON.parse(savedData);
          userData.shareCount = shareCount;
          localStorage.setItem('userFlowerData', JSON.stringify(userData));
        }
        
        await firestore.collection('flowerCodes').doc(userUniqueId).set({
          shareCount: shareCount,
          lastShared: new Date().toISOString(),
          country: currentCountry || "غير معروف",
          city: userCity || "غير معروف",
          uid: userUid,
          uniqueId: userUniqueId
        }, { merge: true });
        
        console.log("تم تحديث عدد المشاركات:", shareCount);
      } catch (error) {
        console.error("خطأ في تحديث عدد المشاركات:", error);
      }
    }

    function checkSavedUserData() {
      const cookieUniqueId = getCookie('userUniqueId');
      const cookieFlowerCode = getCookie('userFlowerCode');
      const cookieInstalled = getCookie('isInstalled');
      const cookieDOB = getCookie('userDateOfBirth');
      const cookieProfession = getCookie('userProfession');
      const cookieFullName = getCookie('userFullName');
      
      if (cookieUniqueId && cookieFlowerCode) {
        userUniqueId = cookieUniqueId;
        userFlowerCode = cookieFlowerCode;
        userDateOfBirth = cookieDOB || null;
        userProfession = cookieProfession || null;
        userFullName = cookieFullName || null;
        isInstalled = cookieInstalled === 'true';
        
        currentMotivation = generatePersonalizedMotivation(userFlowerCode, userProfession, userDateOfBirth);
        
        console.log("تم العثور على بيانات المستخدم المحفوظة في ملفات تعريف الارتباط:", { userUniqueId, userFlowerCode, userDateOfBirth, userProfession, userFullName });
        return true;
      }
      
      const savedData = localStorage.getItem('userFlowerData');
      if (savedData) {
        try {
          const userData = JSON.parse(savedData);
          userUniqueId = userData.uniqueId;
          userFlowerCode = userData.flowerCode;
          userDateOfBirth = userData.dateOfBirth || null;
          userProfession = userData.profession || null;
          userFullName = userData.fullName || null;
          shareCount = userData.shareCount || 0;
          currentMotivation = userData.motivation || generatePersonalizedMotivation(userData.flowerCode, userData.profession, userData.dateOfBirth);
          userUid = userData.uid;
          isInstalled = localStorage.getItem('isInstalled') === 'true';
          
          setCookie('userUniqueId', userUniqueId, 365);
          setCookie('userFlowerCode', userFlowerCode, 365);
          setCookie('userDateOfBirth', userDateOfBirth, 365);
          setCookie('userProfession', userProfession, 365);
          setCookie('userFullName', userFullName, 365);
          setCookie('isInstalled', 'true', 365);
          
          console.log("تم العثور على بيانات المستخدم المحفوظة في التخزين المحلي:", userData);
          return true;
        } catch (e) {
          console.error("خطأ في تحليل بيانات المستخدم المحفوظة:", e);
          return false;
        }
      }
      return false;
    }

    async function deleteUserAccount() {
      if (!userUniqueId) return false;
      
      try {
        if (!confirm("هل أنت متأكد أنك تريد حذف جميع بياناتك؟ هذا الإجراء لا رجعة فيه.")) {
          return false;
        }
        
        console.log("Suppression du compte utilisateur:", userUniqueId);
        
        try {
          await firestore.collection('flowerCodes').doc(userUniqueId).delete();
          console.log("Données supprimées de la collection flowerCodes");
        } catch (error) {
          console.error("Erreur lors de la suppression de flowerCodes:", error);
        }
        
        try {
          const flowersQuery = await firestore.collection('flowers').where('uniqueId', '==', userUniqueId).get();
          
          const batch = firestore.batch();
          let count = 0;
          
          flowersQuery.forEach((doc) => {
            batch.delete(doc.ref);
            count++;
          });
          
          if (count > 0) {
            await batch.commit();
            console.log(`${count} documents supprimés de la collection flowers`);
          }
        } catch (error) {
          console.error("Erreur lors de la suppression de flowers:", error);
        }
        
        try {
          const birthdatesRef = database.ref('birthdates');
          const query = birthdatesRef.orderByChild('uniqueId').equalTo(userUniqueId);
          
          query.once('value', (snapshot) => {
            snapshot.forEach((childSnapshot) => {
              birthdatesRef.child(childSnapshot.key).remove();
            });
          });
          
          console.log("Données supprimées de la base de données en temps réel");
        } catch (error) {
          console.error("Erreur lors de la suppression de la base de données en temps réel:", error);
        }
        
        localStorage.removeItem('userFlowerData');
        localStorage.removeItem('isInstalled');
        localStorage.removeItem('flowerSubject');
        localStorage.removeItem('preferredTheme');
        
        removeCookie('userUniqueId');
        removeCookie('userFlowerCode');
        removeCookie('isInstalled');
        removeCookie('userDateOfBirth');
        removeCookie('userProfession');
        removeCookie('userFullName');
        removeCookie('preferredTheme');
        
        userUniqueId = null;
        userFlowerCode = null;
        currentMotivation = null;
        userDateOfBirth = null;
        userProfession = null;
        userFullName = null;
        isInstalled = false;
        seenSubjects = [];
        shareCount = 0;
        
        try {
          if (auth.currentUser) {
            await auth.currentUser.delete();
            console.log("Utilisateur Firebase supprimé");
          }
        } catch (authError) {
          console.error("Erreur lors de la suppression de l'authentification:", authError);
        }
        
        console.log("Compte utilisateur complètement supprimé");
        return true;
      } catch (error) {
        console.error("Erreur lors de la suppression du compte:", error);
        return false;
      }
    }
    
    function createWebAppManifest() {
      const manifestData = {
        name: "زهرة G-Z",
        short_name: "G-Z",
        description: "اكتشف زهرة الحياة الفريدة الخاصة بك",
        start_url: window.location.href,
        display: "standalone",
        background_color: "#1A2E4D",
        theme_color: "#1A2E4D",
        icons: [
          {
            src: "https://firebasestorage.googleapis.com/v0/b/genz-abb36.firebasestorage.app/o/IMG_20250723_083736_652.webp?alt=media&token=0919c124-8818-4376-854c-7e95719e6e76",
            sizes: "192x192",
            type: "image/webp"
          },
          {
            src: "https://firebasestorage.googleapis.com/v0/b/genz-abb36.firebasestorage.app/o/IMG_20250723_083736_652.webp?alt=media&token=0919c124-8818-4376-854c-7e95719e6e76",
            sizes: "512x512",
            type: "image/webp"
          }
        ]
      };
      
      const manifestStr = JSON.stringify(manifestData);
      const manifestBlob = new Blob([manifestStr], {type: 'application/json'});
      const manifestURL = URL.createObjectURL(manifestBlob);
      
      const manifestLink = document.getElementById('manifest-placeholder');
      manifestLink.setAttribute('href', manifestURL);
      manifestLink.setAttribute('rel', 'manifest');
    }
    
    function setupInstallPrompt() {
      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        
        const isInstallPromptShownBefore = localStorage.getItem('installPromptShown');
        if (!isInstallPromptShownBefore) {
          setTimeout(() => {
            document.getElementById('installPrompt').style.display = 'block';
          }, 3000);
        }
      });
      
      document.getElementById('installBtn').addEventListener('click', async () => {
        if (!deferredPrompt) {
          window.location.href = "https://g-z.online/install.html";
          return;
        }
        
        deferredPrompt.prompt();
        const choiceResult = await deferredPrompt.userChoice;
        
        if (choiceResult.outcome === 'accepted') {
          console.log('قبل المستخدم طلب التثبيت');
        } else {
          console.log('رفض المستخدم طلب التثبيت');
        }
        
        deferredPrompt = null;
        document.getElementById('installPrompt').style.display = 'none';
        localStorage.setItem('installPromptShown', 'true');
      });
      
      document.getElementById('dismissBtn').addEventListener('click', () => {
        document.getElementById('installPrompt').style.display = 'none';
        localStorage.setItem('installPromptShown', 'true');
      });
      
      window.addEventListener('appinstalled', (evt) => {
        console.log('تم تثبيت التطبيق');
        document.getElementById('installPrompt').style.display = 'none';
      });
    }

    window.addEventListener('load', async () => {
      createWebAppManifest();
      setupInstallPrompt();
      
      const today = new Date();
      const twoYearsAgo = new Date(today.getFullYear() - 5, today.getMonth(), today.getDate());
      document.getElementById('dobInput').max = twoYearsAgo.toISOString().split('T')[0];
      
      const savedTheme = localStorage.getItem('preferredTheme') || getCookie('preferredTheme');
      if (savedTheme) {
        setTheme(savedTheme);
      } else {
        setTheme('green-blue');
      }
      
      if (checkSavedUserData()) {
        console.log("المستخدم لديه بالفعل بيانات، إخفاء نافذة الترحيب");
        const welcomeToast = document.getElementById('welcomeToast');
        welcomeToast.style.display = 'block';
        setTimeout(() => {
          welcomeToast.style.opacity = '1';
        }, 100);
        setTimeout(() => {
          welcomeToast.style.opacity = '0';
          setTimeout(() => {
            welcomeToast.style.display = 'none';
          }, 500);
        }, 6500);
        
        if (!isAuthenticated) {
          try {
            await authenticateAnonymously();
          } catch (error) {
            console.error("خطأ أثناء المصادقة:", error);
          }
        }
      } else {
        console.log("لم يتم العثور على بيانات مستخدم محفوظة، عرض نافذة الترحيب");
        const welcomeModal = document.getElementById('welcomeModal');
        welcomeModal.style.display = 'block';
        setTimeout(() => {
          welcomeModal.classList.add('show');
        }, 100);
      }
      
      setupProfessionDropdown();
    });

    function setupProfessionDropdown() {
      const professionInput = document.getElementById('professionInput');
      const professionDropdown = document.getElementById('professionDropdown');
      
      if (!professionInput || !professionDropdown) {
        console.error("عناصر القائمة المنسدلة للمهنة غير موجودة");
        return;
      }
      
      function filterProfessions(input) {
        if (!input) return [];
        
        input = input.toLowerCase();
        return professions.filter(profession => 
          profession.toLowerCase().includes(input)
        );
      }
      
      function renderDropdownOptions(filteredProfessions) {
        professionDropdown.innerHTML = '';
        
        if (filteredProfessions.length === 0) {
          const option = document.createElement('div');
          option.className = 'profession-option';
          option.textContent = 'لا توجد نتائج مطابقة';
          professionDropdown.appendChild(option);
        } else {
          filteredProfessions.forEach(profession => {
            const option = document.createElement('div');
            option.className = 'profession-option';
            option.textContent = profession;
            option.addEventListener('click', () => {
              professionInput.value = profession;
              professionDropdown.style.display = 'none';
            });
            professionDropdown.appendChild(option);
          });
        }
      }
      
      professionInput.addEventListener('input', () => {
        const filtered = filterProfessions(professionInput.value);
        renderDropdownOptions(filtered);
        
        if (filtered.length > 0) {
          professionDropdown.style.display = 'block';
        } else {
          professionDropdown.style.display = 'none';
        }
      });
      
      professionInput.addEventListener('focus', () => {
        if (professionInput.value) {
          const filtered = filterProfessions(professionInput.value);
          renderDropdownOptions(filtered);
          professionDropdown.style.display = 'block';
        }
      });
      
      document.addEventListener('click', (e) => {
        if (!professionInput.contains(e.target) && !professionDropdown.contains(e.target)) {
          professionDropdown.style.display = 'none';
        }
      });
    }

    document.getElementById('flowerButton').addEventListener('click', function() {
      if (!userUniqueId) {
        alert("الرجاء إنشاء حساب زهرتك أولاً.");
        return;
      }
      
      updateFlowerDisplay();
      const flowerModal = document.getElementById('flowerModal');
      flowerModal.style.display = 'block';
      setTimeout(() => {
        flowerModal.classList.add('show');
      }, 10);
      document.getElementById('shareFlowerButton').style.display = 'flex';
    });

    document.getElementById('shareFlowerButton').addEventListener('click', function() {
      captureFlower();
    });
    
    document.getElementById('showIdButton').addEventListener('click', function() {
      if (userUniqueId) {
        document.getElementById('userIdDisplay').textContent = userUniqueId;
        const idModal = document.getElementById('idModal');
        idModal.style.display = 'block';
        setTimeout(() => {
          idModal.classList.add('show');
        }, 10);
      } else {
        alert("الرجاء إنشاء حساب زهرتك أولاً للحصول على المعرف الفريد الخاص بك.");
      }
    });
    
    document.getElementById('copyIdButton').addEventListener('click', function() {
      const idText = document.getElementById('userIdDisplay').textContent;
      navigator.clipboard.writeText(idText).then(function() {
        alert('تم نسخ المعرف إلى الحافظة!');
      }).catch(function() {
        alert('تعذر نسخ المعرف. الرجاء التحديد والنسخ يدويًا.');
      });
    });
    
    document.getElementById('closeIdModal').addEventListener('click', function() {
      const idModal = document.getElementById('idModal');
      idModal.classList.remove('show');
      setTimeout(() => {
        idModal.style.display = 'none';
      }, 300);
    });
    
    document.getElementById('deleteAccountButton').addEventListener('click', function() {
      deleteUserAccount().then(success => {
        if (success) {
          alert("تم حذف الحساب بنجاح. ستحتاج إلى إنشاء حساب جديد لاستخدام هذا التطبيق.");
          const idModal = document.getElementById('idModal');
          idModal.classList.remove('show');
          setTimeout(() => {
            idModal.style.display = 'none';
            const welcomeModal = document.getElementById('welcomeModal');
            welcomeModal.style.display = 'block';
            setTimeout(() => {
              welcomeModal.classList.add('show');
            }, 100);
          }, 300);
        } else {
          alert("خطأ، حاول لاحقًا");
        }
      });
    });
    
    document.getElementById('refreshMotivation').addEventListener('click', function() {
      const newMotivation = generatePersonalizedMotivation(userFlowerCode, userProfession, userDateOfBirth);
      currentMotivation = newMotivation;
      
      const newSubject = getRandomSubject();
      localStorage.setItem('flowerSubject', newSubject);
      
      const formattedName = formatUserName(userFullName);
      
      const flowerCodeElement = document.getElementById('flowerCodeDisplay');
      if (formattedName) {
        flowerCodeElement.innerHTML = `زهرتي - ${newSubject} / ${formattedName}`;
      } else {
        flowerCodeElement.textContent = "زهرتي - " + newSubject;
      }
      
      document.getElementById('monthlyMotivation').textContent = newMotivation;
      
      const captureCode = document.getElementById('captureFlowerCode');
      const captureMotivation = document.getElementById('captureFlowerMotivation');
      
      if (captureCode) {
        if (formattedName) {
          captureCode.innerHTML = `زهرتي - ${newSubject} / ${formattedName}`;
        } else {
          captureCode.textContent = "زهرتي - " + newSubject;
        }
      }
      
      if (captureMotivation) captureMotivation.textContent = newMotivation;
      
      this.style.transition = 'transform 0.5s ease';
      this.style.transform = 'rotate(360deg)';
      
      setTimeout(() => {
        this.style.transition = 'none';
        this.style.transform = 'rotate(0deg)';
      }, 500);
    });
    
    document.getElementById('createAccountButton').addEventListener('click', async function() {
      const dobInput = document.getElementById('dobInput');
      const professionInput = document.getElementById('professionInput');
      const fullNameInput = document.getElementById('fullNameInput');
      
      if (!fullNameInput.value) {
        alert("الرجاء إدخال اسمك الكامل.");
        return;
      }
      
      if (!dobInput.value) {
        alert("الرجاء إدخال تاريخ ميلادك.");
        return;
      }
      
      if (!professionInput.value) {
        alert("الرجاء إدخال مهنتك.");
        return;
      }
      
      document.getElementById('loadingSpinner').style.display = 'block';
      document.getElementById('createAccountButton').disabled = true;
      
      try {
        await authenticateAnonymously();
        
        userFullName = fullNameInput.value;
        userDateOfBirth = dobInput.value;
        userProfession = professionInput.value;
        
        userUniqueId = generateUniqueId();
        console.log("تم إنشاء معرف فريد:", userUniqueId);
        
        userFlowerCode = generateFlowerCode();
        
        const subject = getRandomSubject();
        localStorage.setItem('flowerSubject', subject);
        
        currentMotivation = generatePersonalizedMotivation(userFlowerCode, userProfession, userDateOfBirth);
        
        const createButton = document.getElementById('createAccountButton');
        createButton.innerHTML = '<i class="fas fa-check"></i> تم';
        createButton.style.backgroundColor = '#4CAF50';
        
        const userData = {
          date: new Date().toISOString(),
          uid: userUid,
          uniqueId: userUniqueId,
          flowerCode: userFlowerCode,
          motivation: currentMotivation,
          dateOfBirth: userDateOfBirth,
          profession: userProfession,
          fullName: userFullName,
          formattedName: formatUserName(userFullName),
          timestamp: Date.now(),
          theme: currentTheme,
          subject: subject,
          shareCount: 0
        };
        
        localStorage.setItem('userFlowerData', JSON.stringify(userData));
        localStorage.setItem('isInstalled', 'true');
        setCookie('userUniqueId', userUniqueId, 365);
        setCookie('userFlowerCode', userFlowerCode, 365);
        setCookie('userDateOfBirth', userDateOfBirth, 365);
        setCookie('userProfession', userProfession, 365);
        setCookie('userFullName', userFullName, 365);
        setCookie('isInstalled', 'true', 365);
        isInstalled = true;
        
        setTimeout(() => {
          const welcomeModal = document.getElementById('welcomeModal');
          welcomeModal.classList.remove('show');
          
          setTimeout(() => {
            welcomeModal.style.display = 'none';
            document.getElementById('loadingSpinner').style.display = 'none';
            createButton.innerHTML = 'إنشاء حساب';
            createButton.style.backgroundColor = '';
            createButton.disabled = false;
            
            submitToFirebase().then(submitted => {
              console.log("نتيجة إرسال Firebase:", submitted);
              
              const welcomeToast = document.getElementById('welcomeToast');
              welcomeToast.style.display = 'block';
              setTimeout(() => {
                welcomeToast.style.opacity = '1';
              }, 100);
              setTimeout(() => {
                welcomeToast.style.opacity = '0';
                setTimeout(() => {
                  welcomeToast.style.display = 'none';
                }, 500);
              }, 2000);
              
              updateFlowerDisplay();
              const flowerModal = document.getElementById('flowerModal');
              flowerModal.style.display = 'block';
              setTimeout(() => {
                flowerModal.classList.add('show');
              }, 10);
              document.getElementById('shareFlowerButton').style.display = 'flex';
            });
          }, 300);
        }, 2000);
        
        console.log("اكتمل الإعداد وتم تخزين البيانات محليًا وفي ملفات تعريف الارتباط");
      } catch (error) {
        console.error("خطأ أثناء الإعداد:", error);
        document.getElementById('loadingSpinner').style.display = 'none';
        document.getElementById('createAccountButton').disabled = false;
        alert("حدثت مشكلة في إعداد زهرتك. الرجاء المحاولة مرة أخرى.");
      }
    });
    
    async function captureFlower() {
      try {
        const captureContainer = document.getElementById('flowerCaptureContainer');
        
        updateCaptureStyles(currentTheme);
        
        if (typeof html2canvas !== 'function') {
          console.error("html2canvas غير محمل أو غير متاح كدالة");
          alert("لا يمكن التقاط الزهرة. مكتبة الالتقاط غير محملة.");
          return;
        }
        
        let bgColor = 'white';
        if (currentTheme === 'red-black') bgColor = 'black';
        else if (currentTheme === 'green-blue') bgColor = '#1A2E4D';
        else if (currentTheme === 'orange-pink' || currentTheme === 'yellow-purple') bgColor = '#4B0082';
        
        const canvas = await html2canvas(captureContainer, {
          backgroundColor: bgColor,
          scale: 7,
          logging: true,
          useCORS: true,
          allowTaint: true,
          letterRendering: true
        });
        
        const imageUrl = canvas.toDataURL('image/png');
        
        const capturedImage = document.getElementById('capturedImage');
        if (capturedImage) {
          capturedImage.src = imageUrl;
          document.getElementById('capturedFlower').style.display = 'flex';
          document.getElementById('shareWarning').style.display = 'block';
          
          updateShareCount();
        } else {
          console.error("عنصر capturedImage غير موجود");
        }
      } catch (error) {
        console.error('خطأ في التقاط الزهرة:', error);
        alert('تعذر التقاط زهرتك. الرجاء المحاولة مرة أخرى.');
      }
    }
    
    document.getElementById('shareCapture').addEventListener('click', function() {
      const imageUrl = document.getElementById('capturedImage').src;
if (navigator.share) {
        fetch(imageUrl)
          .then(res => res.blob())
          .then(blob => {
            const file = new File([blob], 'my-gz-flower.png', { type: 'image/png' });
            navigator.share({
              title: 'زهرة G-Z الخاصة بي',
              text: 'اكتشف زهرتك على g-z.online',
              files: [file]
            }).catch(err => {
              console.log('خطأ في المشاركة:', err);
              fallbackShare();
            });
          })
          .catch(err => {
            console.log('خطأ في تحضير الصورة:', err);
            fallbackShare();
          });
      } else {
        fallbackShare();
      }
    });
    
    function fallbackShare() {
      try {
        const shareText = `
تحقق من زهرة الحياة الخاصة بي من G-Z: ${userUniqueId}. اكتشف زهرتك على g-z.online`;
        
        navigator.clipboard.writeText(shareText).then(function() {
          alert('تم نسخ نص المشاركة إلى الحافظة!');
        }).catch(function() {
          alert('تعذر نسخ نص المشاركة.');
        });
      } catch (error) {
        console.error('خطأ في مشاركة احتياطية:', error);
        alert('حدث خطأ.');
      }
    }
    
    document.getElementById('closeCapture').addEventListener('click', function() {
      const imageUrl = document.getElementById('capturedImage').src;
      
      // Create a temporary link element
      const downloadLink = document.createElement('a');
      downloadLink.href = imageUrl;
      downloadLink.download = 'my-gz-flower.png';
      
      // Add to document, click it, and then remove it
      document.body.appendChild(downloadLink);
      downloadLink.click();
      document.body.removeChild(downloadLink);
    });
    
    document.getElementById('closeFlowerModal').addEventListener('click', function() {
      const flowerModal = document.getElementById('flowerModal');
      flowerModal.classList.remove('show');
      setTimeout(() => {
        flowerModal.style.display = 'none';
        document.getElementById('shareFlowerButton').style.display = 'none';
      }, 300);
    });

    window.onclick = function(event) {
      const flowerModal = document.getElementById('flowerModal');
      const capturedFlower = document.getElementById('capturedFlower');
      const idModal = document.getElementById('idModal');
      const welcomeModal = document.getElementById('welcomeModal');
      
      if (event.target == flowerModal) {
        flowerModal.classList.remove('show');
        setTimeout(() => {
          flowerModal.style.display = "none";
          document.getElementById('shareFlowerButton').style.display = 'none';
        }, 300);
      }
      
      if (event.target == capturedFlower) {
        capturedFlower.style.display = "none";
      }
      
      if (event.target == idModal) {
        idModal.classList.remove('show');
        setTimeout(() => {
          idModal.style.display = "none";
        }, 300);
      }
      
      if (event.target == welcomeModal && isInstalled) {
        welcomeModal.classList.remove('show');
        setTimeout(() => {
          welcomeModal.style.display = "none";
        }, 300);
      }
    };
    
    document.getElementById('shareFlowerButton').style.display = 'none';
    document.getElementById('shareWarning').style.display = 'none';
    
    document.querySelectorAll('.style-option').forEach(option => {
      option.addEventListener('click', function() {
        const theme = this.dataset.theme;
        setTheme(theme);
      });
    });
  </script>
</body>
