
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>G-Z</title>
    <link rel="icon" href="https://firebasestorage.googleapis.com/v0/b/genz-abb36.firebasestorage.app/o/file_00000000182461f694cccea0b9e89e1f.png?alt=media&token=3fda1ca9-1d47-4b35-9b07-af86c3098c41">
    <link href="https://fonts.googleapis.com/css2?family=Billabong&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#000000">
    <link rel="apple-touch-icon" href="https://firebasestorage.googleapis.com/v0/b/genz-abb36.firebasestorage.app/o/file_00000000182461f694cccea0b9e89e1f.png?alt=media&token=3fda1ca9-1d47-4b35-9b07-af86c3098c41">
    <link rel="manifest" id="manifest-placeholder">
    <style>
        /* Style pour l'écran de chargement en noir */
        body {
            background-color: #000000;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }
        
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000000;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease-out;
        }
        
        .splash-icon {
            width: 100px;
            height: 100px;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(0.8); opacity: 0.7; }
            50% { transform: scale(1); opacity: 1; }
            100% { transform: scale(0.8); opacity: 0.7; }
        }
    </style>
</head>
<body>
    <!-- Écran de chargement -->
    <div class="splash-screen" id="splash-screen">
        <img src="https://firebasestorage.googleapis.com/v0/b/genz-abb36.firebasestorage.app/o/file_00000000182461f694cccea0b9e89e1f.png?alt=media&token=3fda1ca9-1d47-4b35-9b07-af86c3098c41" alt="Logo" class="splash-icon">
    </div>
    
    <!-- Contenu principal de la page (qui sera affiché après le chargement) -->
    <div id="main-content" style="display: none;">
        <!-- Votre contenu principal ici -->
    </div>
    
    <script>
        // Création dynamique du fichier manifest
        const manifestData = {
            "name": "Flower of life",
            "short_name": "Flower",
            "description": "G-Z Application",
            "start_url": "/",
            "display": "standalone",
            "background_color": "#000000",
            "theme_color": "#000000",
            "icons": [
                {
                    "src": "https://firebasestorage.googleapis.com/v0/b/genz-abb36.firebasestorage.app/o/file_00000000182461f694cccea0b9e89e1f.png?alt=media&token=3fda1ca9-1d47-4b35-9b07-af86c3098c41",
                    "sizes": "192x192",
                    "type": "image/png"
                },
                {
                    "src": "https://firebasestorage.googleapis.com/v0/b/genz-abb36.firebasestorage.app/o/file_00000000182461f694cccea0b9e89e1f.png?alt=media&token=3fda1ca9-1d47-4b35-9b07-af86c3098c41",
                    "sizes": "512x512",
                    "type": "image/png"
                }
            ]
        };
        
        const blob = new Blob([JSON.stringify(manifestData)], {type: 'application/json'});
        const manifestURL = URL.createObjectURL(blob);
        document.querySelector('#manifest-placeholder').setAttribute('href', manifestURL);
        
        // Simulation de chargement et affichage du contenu principal
        window.addEventListener('load', function() {
            // Simuler un temps de chargement (peut être ajusté ou remplacé par votre vrai logique)
            setTimeout(function() {
                // Masquer l'écran de chargement
                const splashScreen = document.getElementById('splash-screen');
                splashScreen.style.opacity = '0';
                
                // Afficher le contenu principal
                setTimeout(function() {
                    splashScreen.style.display = 'none';
                    document.getElementById('main-content').style.display = 'block';
                }, 500); // Attendre que l'animation de fondu soit terminée
            }, 1500); // 2 secondes de chargement simulé
        });
    </script>
</body>
</html>
    <style>
        input, textarea, select, button {
            font-size: 16px;
            touch-action: manipulation;
        }
        
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: white;
            position: relative;
            transition: background-color 0.3s ease;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            -webkit-text-size-adjust: 100%;
        }
        header {
            background-color: white;
            padding: 6px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: background-color 0.3s ease;
        }
        
        h1 {
            margin: 0;
            font-size: 1.4em;
            font-family: 'Billabong', cursive;
            color: #007bff;
            border: 2px solid #007bff;
            padding: 4px;
            border-radius: 12px;
            font-weight: bold;
            transition: color 0.3s ease, border-color 0.3s ease;
        }
        .divider {
            height: 0.6px;
            background-color: #007bff;
            width: 100%;
            margin-top: 5px;
            transition: background-color 0.3s ease;
        }
        .button-container {
            display: flex;
            justify-content: center;
            margin-top: 5px;
            padding: 5px 0;
            overflow-x: auto;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        .button-container::-webkit-scrollbar {
            display: none;
        }
        .button {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 5px 10px;
            margin: 0 3px;
            font-size: 0.8em;
            cursor: pointer;
            text-decoration: none;
            display: flex;
            align-items: center;
            flex-shrink: 0;
            transition: background-color 0.3s ease;
        }
        .button i {
            margin-right: 2px;
        }
        .notification {
            text-align: center;
            margin-top: 10px;
            font-size: 0.8em;
            color: #0056b3;
            font-weight: bold;
            transition: color 0.3s ease;
            padding: 3px 0;
            max-height: 30px;
            overflow: hidden;
        }
        .share-icon {
            color: #007bff;
            cursor: pointer;
            font-size: 1.3em;
            border: 1px solid #007bff;
            border-radius: 7px;
            padding: 4px;
            background-color: white;
            transition: color 0.3s ease, border-color 0.3s ease;
        }
        footer {
            background-color: white;
            color: black;
            padding: 10px 15px;
            margin-top: auto;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo-container {
            display: flex;
        }
        .logo {
            color: #007bff;
            font-size: 1.6em;
            margin-right: 10px;
            border: 1px solid #007bff;
            border-radius: 10px;
            padding: 5px;
            background-color: rgba(0, 119, 190, 0.1);
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
        }
        .logo:hover {
            background-color: #007bff;
            color: white;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .modal.show {
            opacity: 1;
        }
        .modal-content {
            background-color: white;
            margin: 50% auto;
            padding: 14px;
            border: 1px solid #007bff;
            border-radius: 60px;
            width: 280px;
            max-width: 70%;
            text-align: center;
            max-height: 60vh;
            overflow-y: auto;
            position: relative;
            transition: background-color 0.3s ease, border-color 0.3s ease, transform 0.3s ease;
            transform: scale(0.8);
        }
        .modal.show .modal-content {
            transform: scale(1);
        }
        .modal-header {
            font-size: 1.8em;
            font-family: 'Billabong', cursive;
            margin-bottom: 10px;
            font-weight: bold;
            color: #007bff;
            text-decoration: underline;
            transition: color 0.3s ease;
        }
        
        .modal-footer {
            margin-top: 15px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 6px;
        }
        .close-button {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 8px 10px;
            cursor: pointer;
            font-size: 0.9em;
            width: 120px;
            margin: 4px;
            transition: background-color 0.3s ease;
        }
        .close-button:hover {
            background-color: #0056b3;
        }
        
        @keyframes flowerRotate {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(15deg); }
            50% { transform: rotate(0deg); }
            75% { transform: rotate(-15deg); }
            100% { transform: rotate(0deg); }
        }
        
        .flower-icon {
            display: inline-block;
            animation: flowerRotate 2s infinite ease-in-out;
            color: #ff69b4;
        }
        
        .billabong-title {
            font-family: 'Billabong', cursive;
            font-size: 1.8em;
            margin-bottom: 8px;
            color: #007bff;
            transition: color 0.3s ease;
        }

        .monthly-motivation {
            margin: 15px 0;
            padding: 10px;
            border: 1px dashed #ff69b4;
            border-radius: 15px;
            background-color: white;
            font-style: italic;
            color: #333;
            font-size: 0.9em;
            line-height: 1.4;
            transition: border-color 0.3s ease, color 0.3s ease, background-color 0.3s ease;
            position: relative;
        }
        
        .flower-code {
            display: block;
            font-weight: bold;
            color: #ff69b4;
            font-size: 0.9em;
            margin-bottom: 8px;
            letter-spacing: 0.5px;
            background-color: #fff0f8;
            padding: 6px;
            border-radius: 8px;
            border: 1px solid #ff69b4;
            max-width: 220px;
            margin-left: auto;
            margin-right: auto;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            transition: color 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
        }
        
        .copy-icon {
            color: #007bff;
            cursor: pointer;
            margin-left: 10px;
            font-size: 1.2em;
            vertical-align: middle;
            transition: color 0.3s ease;
        }
        
        .header-controls {
            display: flex;
            align-items: center;
        }
        
        .celebrate-icon {
            font-size: 2em;
            color: gold;
            margin-bottom: 8px;
            animation: celebrate 2s infinite alternate;
        }
        
        @keyframes celebrate {
            0% { transform: scale(1); }
            50% { transform: scale(1.1) rotate(5deg); }
            100% { transform: scale(1) rotate(-5deg); }
        }
        
        .modal-close {
            position: absolute;
            top: 10px;
            right: 20px;
            color: #ff0000;
            font-size: 13px;
            cursor: pointer;
            background-color: transparent;
            border: none;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.2s;
        }
        
        .modal-close:hover {
            background-color: rgba(255, 0, 0, 0.1);
        }
        
        .share-flower-button {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 14px;
            padding: 8px 16px;
            font-size: 0.9em;
            margin: 290px auto;
            display: none;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
            max-width: 190px;
            position: relative;
            z-index: 1001;
            border: 1px solid #0056b3;
        }
        
        .share-flower-button:hover {
            background-color: #0056b3;
        }
        
        .share-flower-button i {
            margin-left: 8px;
        }
        
        #capturedFlower {
            position: fixed;
            z-index: 1003;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .captured-image-container {
            position: relative;
            max-width: 85%;
            max-height: 60vh;
            margin-bottom: 15px;
        }
        
        .captured-image {
            max-width: 100%;
            max-height: 60vh;
            border-radius: 15px;
            border: 2px solid white;
        }
        
        .share-message {
            background-color: white;
            color: #333;
            padding: 10px 15px;
            border-radius: 15px;
            font-size: 0.9em;
            margin: 10px auto;
            max-width: 90%;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        .share-message i {
            margin-left: 8px;
            color: #007bff;
            transition: color 0.3s ease;
        }
        
        .share-link {
            color: #007bff;
            font-weight: bold;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        .capture-controls {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }
        
        .capture-button {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 20px;
            padding: 8px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
            transition: background-color 0.3s ease;
        }
        
        .capture-button i {
            margin-right: 5px;
        }
        
        .close-capture {
            background-color: #f0f0f0;
            color: #333;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        #flowerCaptureContainer {
            position: fixed;
            z-index: -1;
            top: 0;
            left: -9999px;
            background-color: white;
            border: 2px solid #007bff;
            border-radius: 20px;
            padding: 15px;
            width: 300px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        
        .capture-flower-header {
            font-family: 'Billabong', cursive;
            color: #007bff;
            font-size: 1.8em;
            margin-bottom: 8px;
            text-align: center;
            font-weight: bold;
            text-shadow: 0px 1px 1px rgba(0, 123, 255, 0.2);
            transition: color 0.3s ease;
        }
        
        .capture-flower-code {
            font-weight: bold;
            color: #ff69b4;
            font-size: 0.8em;
            background-color: #fff0f8;
            padding: 6px;
            border-radius: 10px;
            border: 1px solid #ff69b4;
            margin: 6px auto;
            text-align: center;
            max-width: 80%;
            letter-spacing: 0.5px;
            transition: color 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
        }
        
        .capture-flower-motivation {
            font-style: italic;
            color: #333;
            font-size: 0.95em;
            line-height: 1.4;
            background-color: #f9f9f9;
            border: 1px dashed #ff69b4;
            border-radius: 12px;
            padding: 12px;
            margin: 12px 0;
            text-align: center;
            transition: color 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
            position: relative;
        }
        
        .capture-flower-icon {
            text-align: center;
            font-size: 2.5em;
            color: #ff69b4;
            margin: 10px 0;
            transition: color 0.3s ease;
        }
        
        .gz-logo {
            font-family: 'Billabong', cursive;
            color: #007bff;
            font-size: 1.4em;
            text-align: center;
            margin-top: 10px;
            border: 2px solid #007bff;
            border-radius: 12px;
            padding: 4px;
            width: 50px;
            margin-left: auto;
            margin-right: auto;
            font-weight: bold;
            transition: color 0.3s ease, border-color 0.3s ease;
        }
        
        .share-warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
            border-radius: 15px;
            padding: 10px 15px;
            font-size: 0.85em;
            margin: 5px auto 15px auto;
            max-width: 90%;
            text-align: center;
            display: none;
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }
        
        .capture-website-url {
            text-align: center;
            font-size: 0.85em;
            color: #007bff;
            font-weight: bold;
            margin-top: 8px;
            font-family: Arial, sans-serif;
            padding: 3px 0;
            border-top: 1px dashed #007bff;
            transition: color 0.3s ease, border-color 0.3s ease;
        }
        
        .terms-text {
            font-size: 0.8em;
            color: black;
            text-align: center;
            margin: 10px auto;
            width: 330px;
            transition: color 0.3s ease;
        }
        
        .billabong-title {
            margin-bottom: 3px;
        }

        .header-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            padding: 0 1px;
        }

        .header-icon {
            font-size: 1.4em;
            color: #007bff;
            border: 2px solid #007bff;
            padding: 4px;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            transition: color 0.3s ease, border-color 0.3s ease;
        }

        .app-logo {
            font-family: 'Billabong', cursive;
            color: #007bff;
            border: 2px solid #007bff;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 1.4em;
            font-weight: bold;
            transition: color 0.3s ease, border-color 0.3s ease;
        }

        .header-flex {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
        }
        
        .right-controls {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        #welcomeToast {
            position: fixed;
            top: 160px;
            left: 0;
            right: 0;
            background-color: rgba(0,0,0,0.7);
            color: white;
            padding: 10px;
            border-radius: 20px;
            width: 80%;
            max-width: 300px;
            margin: 0 auto;
            text-align: center;
            z-index: 2000;
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease;
            font-family: , cursive;
            font-size: 1.1em;
            border: 2px solid #4CAF50;
        }

        #welcomeModal {
            display: none;
            position: fixed;
            z-index: 10;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        #welcomeModal.show {
            opacity: 1;
        }

        #welcomeModal .modal-content {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            margin: 40% auto;
            padding: 15px 10px;
            border: 2px solid #4CAF50;
            border-radius: 25px;
            width: 85%;
            max-width: 290px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            text-align: center;
            transition: transform 0.3s ease;
            transform: scale(0.8);
        }
        #welcomeModal.show .modal-content {
            transform: scale(1);
        }

        #welcomeModal .close {
            color: red;
            font-size: 18px;
            font-weight: bold;
            display: block;
            text-align: center;
            margin-bottom: 3px;
            cursor: pointer;
        }

        #welcomeModal .welcome-header {
            color: #007bff;
            font-family: 'Billabong', cursive;
            font-size: 1.8em;
            margin-bottom: 8px;
            text-align: center;
            font-weight: bold;
        }

        #welcomeModal .welcome-text {
            margin: 10px 0 15px 0;
            font-size: 0.8em;
            color: #333;
            line-height: 1.4;
            transition: color 0.3s ease;
        }

        .dob-container {
            margin: 10px 0;
        }

        .dob-container label {
            display: block;
            font-size: 0.8em;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        .dob-input {
            width: 90%;
            padding: 8px;
            border-radius: 10px;
            border: 1px solid #ccc;
            font-size: 16px;
        }

        .profession-container {
            margin: 12px 0;
            position: relative;
        }

        .profession-container label {
            display: block;
            font-size: 0.8em;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        .profession-search {
            width: 90%;
            padding: 8px;
            border-radius: 10px;
            border: 1px solid #ccc;
            font-size: 16px;
        }

        .profession-dropdown {
            display: none;
            position: absolute;
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 10px;
            width: 90%;
            max-height: 150px;
            overflow-y: auto;
            left: 5%;
            z-index: 10;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .profession-option {
            padding: 8px 10px;
            font-size: 0.8em;
            cursor: pointer;
            transition: background-color 0.2s;
            background-color: white;
            color: #333;
        }

        .profession-option:hover {
            background-color: #f5f5f5;
        }

        .name-container {
            margin: 10px 0;
        }

        .name-container label {
            display: block;
            font-size: 0.8em;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        .name-input {
            width: 90%;
            padding: 8px;
            border-radius: 10px;
            border: 1px solid #ccc;
            font-size: 16px;
        }

        #createAccountButton {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 10px 25px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            margin: 10px auto 5px;
            display: block;
            width: 80%;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 123, 255, 0.3);
        }
        
        #createAccountButton:hover {
            background: linear-gradient(135deg, #0056b3 0%, #003d80 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 123, 255, 0.4);
        }
        
        #createAccountButton:active {
            transform: translateY(0);
            box-shadow: 0 1px 3px rgba(0, 123, 255, 0.3);
        }

        .loading-spinner {
            display: none;
            text-align: center;
            margin: 10px 0;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        .loading-dots::after {
            content: '...';
            animation: dots 1.5s infinite;
            display: inline-block;
            width: 20px;
            text-align: left;
        }

        #idModal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        #idModal.show {
            opacity: 1;
        }

        #idModal .modal-content {
            background-color: #fff;
            margin: 45% auto;
            padding: 15px;
            border: 1px solid #007BFF;
            border-radius: 25px;
            width: 65%;
            max-width: 250px;
            text-align: center;
            transition: transform 0.3s ease;
            transform: scale(0.8);
        }
        #idModal.show .modal-content {
            transform: scale(1);
        }

        .id-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }

        .id-title {
            font-size: 1em;
            color: #007bff;
            margin-bottom: 5px;
            transition: color 0.3s ease;
        }

        .id-display {
            font-weight: bold;
            font-size: 1.2em;
            color: #ff69b4;
            background-color: #fff0f8;
            padding: 6px;
            border-radius: 8px;
            border: 1px solid #ff69b4;
            margin: 5px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            max-width: 80%;
            transition: color 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
        }

        .delete-account {
            background-color: #ff4d4d;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 6px 10px;
            font-size: 0.7em;
            cursor: pointer;
            transition: background-color 0.3s;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .delete-account:hover {
            background-color: #e60000;
        }

        .copy-icon {
            margin-left: 6px;
        }

        .id-message {
            font-size: 0.7em;
            color: #333;
            margin: 5px 0;
            transition: color 0.3s ease;
        }

        #idModal .close-button {
            margin-top: 8px;
            width: auto;
            padding: 6px 15px;
            font-size: 0.7em;
            height: 28px;
        }

        .menu-link {
            text-decoration: none;
            color: #007bff;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.3s ease;
        }
        
        .style-selector {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: white;
            padding: 10px 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 100;
            transition: background-color 0.3s ease;
        }
        
        .style-selector h3 {
            text-align: center;
            margin: 0 0 10px 0;
            font-size: 1em;
            color: #333;
            transition: color 0.3s ease;
        }
        
        .style-options {
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 0 5px;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        .style-options::-webkit-scrollbar {
            display: none;
        }
        
        .style-option {
            width: 60px;
            height: 40px;
            border-radius: 10px;
            cursor: pointer;
            flex-shrink: 0;
            position: relative;
            border: 1px solid #ddd;
            overflow: hidden;
        }
        
        .style-option.selected {
            border: 2px solid white;
            box-shadow: 0 0 0 2px #007bff;
        }
        
        .style-option.red-black {
            background: linear-gradient(to right, #FF4500, #8B0000, #121212, #121212);
        }
        
        .style-option.green-blue {
            background: linear-gradient(to right, #3EB489, #14532D, #0A2239, #1A2E4D);
        }
        
        .style-option.orange-pink {
            background: linear-gradient(to right, #FF7F50, #FF6F91, #C71585, #4B0082);
        }
        
        .style-option.yellow-purple {
            background: linear-gradient(to right, #FFD700, #FFA500, #8A2BE2, #4B0082);
        }
        
        .style-option.default {
            background: linear-gradient(to right, #007bff, #0056b3);
        }
        
        .main-content {
            padding-bottom: 80px;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
        }
        
        body.theme-default {
            background-color: white;
            color: #333;
        }
        
        body.theme-default header, 
        body.theme-default footer,
        body.theme-default .style-selector {
            background-color: white;
        }
        
        body.theme-default .app-logo,
        body.theme-default .header-icon,
        body.theme-default .divider,
        body.theme-default .notification,
        body.theme-default .billabong-title,
        body.theme-default .gz-logo,
        body.theme-default .capture-website-url,
        body.theme-default .capture-flower-header,
        body.theme-default .id-title {
            color: #007bff;
            border-color: #007bff;
        }
        
        body.theme-default .notification .notification-text {
            color: #007bff;
        }
        
        body.theme-default .button {
            background-color: #007bff;
        }
        
        body.theme-default .share-flower-button {
            background-color: #007bff;
            color: white;
            border-color: #0056b3;
        }
        
        body.theme-default .flower-code,
        body.theme-default .id-display {
            color: #ff69b4;
            background-color: #fff0f8;
            border-color: #ff69b4;
        }
        
        body.theme-default .monthly-motivation,
        body.theme-default .capture-flower-motivation {
            border-color: #ff69b4;
            color: #333;
            background-color: white;
        }
        
        body.theme-default .modal-content {
            background-color: white;
            border-color: #007bff;
        }
        
        body.theme-red-black {
            background: black;
            color: #E5E5E5;
        }
        
        body.theme-red-black header, 
        body.theme-red-black footer,
        body.theme-red-black .style-selector {
            background-color: black;
        }
        
        body.theme-red-black .app-logo,
        body.theme-red-black .header-icon,
        body.theme-red-black .gz-logo,
        body.theme-red-black .capture-flower-header,
        body.theme-red-black .capture-website-url,
        body.theme-red-black .id-title,
        body.theme-red-black .billabong-title {
            color: #FF4500;
            border-color: #FF4500;
        }
        
        body.theme-red-black .divider {
            background-color: #FF4500;
        }
        
        body.theme-red-black .notification .notification-text {
            color: #FF4500;
        }
        
        body.theme-red-black .notification,
        body.theme-red-black .welcome-text,
        body.theme-red-black .id-message {
            color: #CCCCCC;
        }
        
        body.theme-red-black .button {
            background-color: #8B0000;
        }
        
        body.theme-red-black .share-flower-button {
            background-color: #8B0000;
            color: white;
            border-color: #FF4500;
        }
        
        body.theme-red-black .flower-code,
        body.theme-red-black .id-display {
            color: #FF4500;
            background-color: black;
            border-color: #FF4500;
        }
        
        body.theme-red-black .monthly-motivation,
        body.theme-red-black .capture-flower-motivation {
            border-color: #FF4500;
            color: #E5E5E5;
            background-color: black;
        }
        
        body.theme-red-black .modal-content,
        body.theme-red-black #flowerCaptureContainer {
            background-color: black;
            border-color: #8B0000;
        }
        
        body.theme-green-blue {
            background: #1A2E4D;
            color: #F5F5F5;
        }
        
        body.theme-green-blue header, 
        body.theme-green-blue footer,
        body.theme-green-blue .style-selector {
            background-color: #1A2E4D;
        }
        
        body.theme-green-blue .app-logo,
        body.theme-green-blue .header-icon,
        body.theme-green-blue .gz-logo,
        body.theme-green-blue .capture-flower-header,
        body.theme-green-blue .capture-website-url,
        body.theme-green-blue .id-title,
        body.theme-green-blue .billabong-title {
            color: #3EB489;
            border-color: #3EB489;
        }
        
        body.theme-green-blue .divider {
            background-color: #3EB489;
        }
        
        body.theme-green-blue .notification .notification-text {
            color: #3EB489;
        }
        
        body.theme-green-blue .notification,
        body.theme-green-blue .welcome-text,
        body.theme-green-blue .id-message {
            color: #A0A0A0;
        }
        
        body.theme-green-blue .button {
            background-color: #14532D;
        }
        
        body.theme-green-blue .share-flower-button {
            background-color: #14532D;
            color: white;
            border-color: #3EB489;
        }
        
        body.theme-green-blue .flower-code,
        body.theme-green-blue .id-display {
            color: #3EB489;
            background-color: #36454F;
            border-color: #3EB489;
        }
        
        body.theme-green-blue .monthly-motivation,
        body.theme-green-blue .capture-flower-motivation {
            border-color: #3EB489;
            color: #F5F5F5;
            background-color: #1A2E4D;
        }
        
        body.theme-green-blue .modal-content,
        body.theme-green-blue #flowerCaptureContainer {
            background-color: #1A2E4D;
            border-color: #3EB489;
        }
        
        body.theme-orange-pink {
            background: #4B0082;
            color: #FFFFFF;
        }
        
        body.theme-orange-pink header, 
        body.theme-orange-pink footer,
        body.theme-orange-pink .style-selector {
            background-color: #4B0082;
        }
        
        body.theme-orange-pink .app-logo,
        body.theme-orange-pink .header-icon,
        body.theme-orange-pink .gz-logo,
        body.theme-orange-pink .capture-flower-header,
        body.theme-orange-pink .capture-website-url,
        body.theme-orange-pink .id-title,
        body.theme-orange-pink .billabong-title {
            color: #FF7F50;
            border-color: #FF7F50;
        }
        
        body.theme-orange-pink .divider {
            background-color: #FF7F50;
        }
        
        body.theme-orange-pink .notification .notification-text {
            color: #FF7F50;
        }
        
        body.theme-orange-pink .notification,
        body.theme-orange-pink .welcome-text,
        body.theme-orange-pink .id-message {
            color: #D3D3D3;
        }
        
        body.theme-orange-pink .button {
            background-color: #C71585;
        }
        
        body.theme-orange-pink .share-flower-button {
            background-color: #C71585;
            color: white;
            border-color: #FF7F50;
        }
        
        body.theme-orange-pink .flower-code,
        body.theme-orange-pink .id-display {
            color: #FF7F50;
            background-color: #6A0DAD;
            border-color: #FF7F50;
        }
        
        body.theme-orange-pink .monthly-motivation,
        body.theme-orange-pink .capture-flower-motivation {
            border-color: #FF7F50;
            color: #FFFFFF;
            background-color: #4B0082;
        }
        
        body.theme-orange-pink .modal-content,
        body.theme-orange-pink #flowerCaptureContainer {
            background-color: #4B0082;
            border-color: #FF7F50;
        }

        body.theme-yellow-purple {
            background: #4B0082;
            color: #FFFFFF;
        }
        
        body.theme-yellow-purple header, 
        body.theme-yellow-purple footer,
        body.theme-yellow-purple .style-selector {
            background-color: #4B0082;
        }
        
        body.theme-yellow-purple .app-logo,
        body.theme-yellow-purple .header-icon,
        body.theme-yellow-purple .gz-logo,
        body.theme-yellow-purple .capture-flower-header,
        body.theme-yellow-purple .capture-website-url,
        body.theme-yellow-purple .id-title,
        body.theme-yellow-purple .billabong-title {
            color: #FFD700;
            border-color: #FFD700;
        }
        
        body.theme-yellow-purple .divider {
            background-color: #FFD700;
        }
        
        body.theme-yellow-purple .notification .notification-text {
            color: #FFD700;
        }
        
        body.theme-yellow-purple .notification,
        body.theme-yellow-purple .welcome-text,
        body.theme-yellow-purple .id-message {
            color: #D3D3D3;
        }
        
        body.theme-yellow-purple .button {
            background-color: #8A2BE2;
        }
        
        body.theme-yellow-purple .share-flower-button {
            background-color: #8A2BE2;
            color: white;
            border-color: #FFD700;
        }
        
        body.theme-yellow-purple .flower-code,
        body.theme-yellow-purple .id-display {
            color: #FFD700;
            background-color: #6A0DAD;
            border-color: #FFD700;
        }
        
        body.theme-yellow-purple .monthly-motivation,
        body.theme-yellow-purple .capture-flower-motivation {
            border-color: #FFD700;
            color: #FFFFFF;
            background-color: #4B0082;
        }
        
        body.theme-yellow-purple .modal-content,
        body.theme-yellow-purple #flowerCaptureContainer {
            background-color: #4B0082;
            border-color: #FFD700;
        }
        
        .refresh-motivation {
            position: absolute;
            right: 15px;
            top: 70px;
            color: #007bff;
            cursor: pointer;
            font-size: 1.2em;
            padding: 5px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transition: transform 0.3s ease, color 0.3s ease;
        }
        
        .refresh-motivation:hover {
            transform: rotate(180deg);
        }
        
        body.theme-red-black .refresh-motivation {
            color: #FF4500;
        }
        
        body.theme-green-blue .refresh-motivation {
            color: #3EB489;
        }
        
        body.theme-orange-pink .refresh-motivation {
            color: #FF7F50;
        }
        
        body.theme-yellow-purple .refresh-motivation {
            color: #FFD700;
        }
        
        .user-name {
            font-size: 0.75em;
            font-weight: bold;
        }

        .install-prompt {
            display: none;
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 0.9em;
            z-index: 1000;
            width: 80%;
            max-width: 300px;
            text-align: center;
        }
        
        .install-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .install-btn {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            font-size: 0.8em;
            cursor: pointer;
        }
        
        .dismiss-btn {
            background-color: transparent;
            color: #ccc;
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 5px 10px;
            font-size: 0.8em;
            cursor: pointer;
        }
    </style>
</head>
<body class="theme-green-blue">

  <header>
   
    <div class="header-container">
      <div class="app-logo">G-Z</div>
      
      <div class="right-controls">
        
   
        <div class="header-icon" id="showIdButton"><i class="fas fa-user"></i></div>
        
         <a href="https://g-z.online/translate.html" class="header-icon menu-link"><i class="fas fa-globe"></i></a>
        
        <a href="https://g-z.online/us.html" class="header-icon menu-link"><i class="fas fa-bars"></i></a>
      </div>
    </div>
  </header>

  <div class="divider"></div>

  <div class="main-content">
    <div class="button-container">
      <a class="button" href="#" id="flowerButton"><i class="fas fa-spa flower-icon"></i><span>생명의 꽃</span></a>
      
    

    </div>

    <div class="divider"></div>
    <div class="notification">
      <span class="notification-text">💠 꽃 -- 우주가 당신에게 쓴 메시지 ¯\_(ツ)_/¯</span>
    </div>

    <div class="divider"></div>
  </div>

  <div class="style-selector">
    <h3>스타일</h3>
    <div class="style-options">
      <div class="style-option red-black" data-theme="red-black"></div>
      <div class="style-option green-blue selected" data-theme="green-blue"></div>
      <div class="style-option orange-pink" data-theme="orange-pink"></div>
      <div class="style-option yellow-purple" data-theme="yellow-purple"></div>
      <div class="style-option default" data-theme="default"></div>
    </div>
  </div>

  <div id="welcomeToast">
    
    다시 오신 것을 환영합니다    ¯\_(ツ)_/¯
  </div>

  <div id="welcomeModal" class="modal">
    <div class="modal-content">
      <div class="welcome-header">💠 환영합니다 💠</div>
      <div class="welcome-text">
        계정을 만들려면 귀하의 생년월일, 직업, 이름이 필요합니다.
      </div>
      
      <div class="name-container">
        <label for="fullNameInput">전체 이름:</label>
        <input type="text" id="fullNameInput" class="name-input" placeholder="전체 이름을 입력하세요...">
      </div>
      
      <div class="dob-container">
        <label for="dobInput">생년월일:</label>
        <input type="date" id="dobInput" class="dob-input" max="">
      </div>
      
      <div class="profession-container">
        <label for="professionInput">직업:</label>
        <input type="text" id="professionInput" class="profession-search" placeholder="직업을 입력하세요...">
        <div id="professionDropdown" class="profession-dropdown"></div>
      </div>
      
      <div class="loading-spinner" id="loadingSpinner">
        <span>고유한 꽃을 만드는 중</span>
        <span class="loading-dots"></span>
      </div>
      
      <button id="createAccountButton">계정 만들기</button>
    </div>
  </div>

  <div id="idModal" class="modal">
    <div class="modal-content">
      <div class="id-title">사용자 ID</div>
      <div class="id-display">
        <span id="userIdDisplay"></span>
        <i class="fas fa-copy copy-icon" id="copyIdButton"></i>
      </div>
      <div class="id-message">이 ID를 잘 보관하세요!</div>
      <div class="id-actions">
        <button class="delete-account" id="deleteAccountButton">계정 삭제</button>
        <button class="close-button" id="closeIdModal">닫기</button>
      </div>
    </div>
  </div>

  <div id="flowerModal" class="modal">
    <div class="modal-content">
      <button class="modal-close" id="closeFlowerModal"><i class="fas fa-times"></i></button>
      <div class="billabong-title"><strong id="flowerTypeTitle">생명의 꽃</strong></div>
      
      <div id="flowerCodeDisplay" class="flower-code"></div>
      
      <i class="fas fa-sync-alt refresh-motivation" id="refreshMotivation" title="새로운 동기부여 문구 생성"></i>
      
      <div class="monthly-motivation" id="monthlyMotivation">
      </div>
      
      <div style="margin: 10px auto; font-size: 3em; color: #ff69b4;" id="flowerIconContainer">
        <i class="fas fa-spa"></i>
      </div>
    </div>
  </div>
  
  <button class="share-flower-button" id="shareFlowerButton">
    <span>내 꽃 공유하기</span> <i class="fas fa-arrow-right send-icon"></i>
  </button>
  
  <div id="capturedFlower">
    <div class="captured-image-container">
      <img id="capturedImage" class="captured-image" src="" alt="캡처된 꽃">
    </div>

    <div class="share-warning" id="shareWarning">
      <i class="fas fa-exclamation-triangle" style="margin-right: 5px;"></i>
      <span>Google/Safari에서 최상의 공유 결과를 얻을 수 있습니다.</span>
    </div>
    
    <div class="capture-controls">
      <button class="capture-button" id="shareCapture">
        <i class="fas fa-share"></i> <span>공유</span>
      </button>
      
      <button class="capture-button close-capture" id="closeCapture">
        <i class="fas fa-times"></i> <span>닫기</span>
      </button>
    </div>
  </div>
  
  <div id="flowerCaptureContainer">
    <div class="capture-flower-header" id="captureFlowerHeader">생명의 꽃</div>
    
    <div id="captureFlowerCode" class="capture-flower-code"></div>
    
    <div id="captureFlowerMotivation" class="capture-flower-motivation">
    </div>
    
    <div class="capture-flower-icon" id="captureFlowerIcon">
      <i class="fas fa-spa"></i>
    </div>
    
    <div class="gz-logo">G-Z</div>
    
    <div class="capture-website-url">www.g-z.online에서 당신만의 꽃을 발견하세요</div>
  </div>

  <div class="install-prompt" id="installPrompt">
    <p>G-Z를 홈 화면에 추가하여 더 나은 경험을 얻으세요!</p>
    <div class="install-buttons">
      <button class="install-btn" id="installBtn">설치</button>
      <button class="dismiss-btn" id="dismissBtn">나중에</button>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCrPKQOqw4zciASa_5PbI_etfkvrBaDPDI",
      authDomain: "genz-abb36.firebaseapp.com",
      databaseURL: "https://genz-abb36-default-rtdb.firebaseio.com",
      projectId: "genz-abb36",
      storageBucket: "genz-abb36.firebasestorage.app",
      messagingSenderId: "405021535683",
      appId: "1:405021535683:web:ee5a28fde27f5558046176",
      measurementId: "G-XZNQND2J00"
    };

    firebase.initializeApp(firebaseConfig);
    
    const auth = firebase.auth();
    const database = firebase.database();
    const firestore = firebase.firestore();
    
    let userUid = null;
    let userFlowerCode = null;
    let currentMotivation = null;
    let currentCountry = null;
    let userCity = null;
    let userUniqueId = null;
    let isAuthenticated = false;
    let isInstalled = false;
    let currentTheme = "green-blue";
    let userDateOfBirth = null;
    let userProfession = null;
    let userFullName = null;
    let seenSubjects = [];
    let shareCount = 0;
    let deferredPrompt = null;

    const professions = [
      "음악가", "래퍼", "축구선수", "농구선수", "복서", 
      "학생", "교사", "의사", "간호사", "엔지니어", 
      "소프트웨어 개발자", "디자이너", "예술가", "작가", "기자", 
      "요리사", "웨이터", "가사도우미", "틱톡 크리에이터", "유튜버", 
      "인플루언서", "사진작가", "비디오 제작자", "댄서", "배우", 
      "모델", "건축가", "변호사", "회계사", "재무상담사", 
      "은행원", "기업가", "사업주", "매니저", "임원", 
      "영업사원", "마케터", "소셜미디어 매니저", "운전기사", "파일럿", 
      "항공승무원", "정비사", "전기기사", "배관공", "건설노동자", 
      "농부", "정원사", "수의사", "개인 트레이너", "피트니스 코치", 
      "요가 강사", "치료사", "심리학자", "컨설턴트", "성직자/종교지도자",
      "과학자", "연구원", "교수", "경찰", "소방관",
      "군인", "경비원", "부동산 중개인", "약사", "치과의사",
      "검안사", "물리치료사", "직업치료사", "언어치료사", "영양사",
      "영양학자", "헤어스타일리스트", "메이크업 아티스트", "미용사", "재단사",
      "패션 디자이너", "소매업 종사자", "계산원", "고객서비스 담당자", "콜센터 상담원",
      "번역가", "통역사", "관광 가이드", "여행사 직원", "호텔 매니저",
      "리셉셔니스트", "비서", "행정보조", "사서", "기록보관사",
      "역사학자", "고고학자", "인류학자", "사회학자", "정치학자",
      "경제학자", "통계학자", "데이터 분석가", "데이터 과학자", "UX 디자이너",
      "게임 개발자", "앱 개발자", "웹 개발자", "네트워크 관리자", "사이버보안 전문가",
      "IT 지원", "기술자", "수리 전문가", "제빵사", "정육점",
      "어부", "광부", "삼림관리인", "조경 디자이너", "인테리어 디자이너",
      "이벤트 기획자", "웨딩 플래너", "플로리스트", "보석상", "공예가",
      "프로그래머", "웹 디자이너", "디지털 마케터", "SEO 전문가", "콘텐츠 크리에이터",
      "제품 매니저", "프로젝트 매니저", "품질보증 담당자", "비즈니스 분석가", "컨설턴트",
      "리크루터", "인사 매니저", "경력 코치", "라이프 코치", "동기부여 연설가",
      "대중 연설가", "라디오 진행자", "TV 진행자", "방송인", "팟캐스트 진행자",
      "작가", "각본가", "카피라이터", "기술 작가", "편집자",
      "출판업자", "문학 에이전트", "서점 주인", "사서", "서평가",
      "그래픽 디자이너", "일러스트레이터", "애니메이터", "3D 아티스트", "시각효과 아티스트",
      "영화 감독", "프로듀서", "촬영감독", "음향 엔지니어", "조명 기술자",
      "영화 편집자", "제작 보조", "무대 디자이너", "의상 디자이너", "영화 메이크업 아티스트",
      "특수효과 아티스트", "스턴트맨", "성우", "캐스팅 디렉터", "캐스팅 디렉터"
    ];

    const subjectDictionary = {
      "성공": "성공",
      "성취": "성취",
      "승리": "승리",
      "정복": "정복",
      "업적": "업적",
      
      "부": "부",
      "번영": "번영",
      "풍요": "풍요",
      "재산": "재산",
      "풍족": "풍족",
      
      "기쁨": "기쁨",
      "행복": "행복",
      "환희": "환희",
      "즐거움": "즐거움",
      "만족": "만족",
      
      "성장": "성장",
      "진보": "진보",
      "전진": "전진",
      "발전": "발전",
      "개선": "개선",
      
      "힘": "힘",
      "강함": "강함",
      "강력함": "강력함",
      "능력": "능력",
      "에너지": "에너지",
      
      "지혜": "지혜",
      "지능": "지능",
      "지식": "지식",
      "통찰력": "통찰력",
      "이해력": "이해력",
      
      "창의성": "창의성",
      "혁신": "혁신",
      "상상력": "상상력",
      "발명": "발명",
      "독창성": "독창성",
      
      "리더십": "리더십",
      "권위": "권위",
      "영향력": "영향력",
      "지휘": "지휘",
      "방향성": "방향성",
      
      "평화": "평화",
      "조화": "조화",
      "고요함": "고요함",
      "평온": "평온",
      "평안": "평안",
      
      "사랑": "사랑",
      "애정": "애정",
      "숭배": "숭배",
      "헌신": "헌신",
      "열정": "열정",
      
      "용기": "용기",
      "용맹": "용맹",
      "대담함": "대담함",
      "영웅적": "영웅적",
      "두려움없음": "두려움없음",
      
      "건강": "건강",
      "활력": "활력",
      "건강함": "건강함",
      "활기": "활기",
      "건강관리": "건강관리",
      
      "자유": "자유",
      "해방": "해방",
      "독립": "독립",
      "자율성": "자율성",
      "자기결정": "자기결정",
      
      "목적": "목적",
      "의미": "의미",
      "사명": "사명",
      "소명": "소명",
      "운명": "운명",
      
      "회복력": "회복력",
      "강인함": "강인함",
      "인내": "인내",
      "지구력": "지구력",
      "끈기": "끈기",
      
      "진정성": "진정성",
      "진실함": "진실함",
      "정직": "정직",
      "성실": "성실",
      "진심": "진심",
      
      "변화": "변화",
      "변형": "변형",
      "진화": "진화",
      "재탄생": "재탄생",
      "변모": "변모",
      
      "연결": "연결",
      "관계": "관계",
      "커뮤니티": "커뮤니티",
      "소속감": "소속감",
      "단결": "단결",
      
      "감사": "감사",
      "고마움": "고마움",
      "감상": "감상",
      "인정": "인정",
      "승인": "승인",
      
      "마음챙김": "마음챙김",
      "현존감": "현존감",
      "의식": "의식",
      "인식": "인식",
      "집중": "집중",
      
      "연민": "연민",
      "공감": "공감",
      "친절": "친절",
      "관대함": "관대함",
      "이타주의": "이타주의",
      
      "균형": "균형",
      "안정": "안정",
      "조화": "조화",
      "비율": "비율",
      "대칭": "대칭",
      
      "영감": "영감",
      "동기부여": "동기부여",
      "열의": "열의",
      "흥분": "흥분",
      "열정": "열정",
      
      "집중": "집중",
      "집중력": "집중력",
      "주의력": "주의력",
      "규율": "규율",
      "헌신": "헌신",
      
      "겸손": "겸손",
      "겸허": "겸허",
      "소박함": "소박함",
      "비장식적": "비장식적",
      "실질적": "실질적",
      
      "인내": "인내",
      "관용": "관용",
      "인내심": "인내심",
      "지속성": "지속성",
      "끈기": "끈기",
      
      "기쁨": "기쁨",
      "즐거움": "즐거움",
      "환희": "환희",
      "환호": "환호",
      "축하": "축하",
      
      "신뢰": "신뢰",
      "믿음": "믿음",
      "자신감": "자신감",
      "의존": "의존",
      "신뢰성": "신뢰성",
      
      "자신감": "자신감",
      "자존감": "자존감",
      "자신감": "자신감",
      "자기확신": "자기확신",
      "자기신뢰": "자기신뢰",
      
      "열의": "열의",
      "열망": "열망",
      "갈망": "갈망",
      "열정": "열정",
      "열의": "열의",
      
      "명료함": "명료함",
      "명확성": "명확성",
      "투명성": "투명성",
      "정확성": "정확성",
      "예리함": "예리함",
      
      "적응성": "적응성",
      "유연성": "유연성",
      "다재다능": "다재다능",
      "적응력": "적응력",
      "융통성": "융통성",
      
      "소통": "소통",
      "표현": "표현",
      "발언": "발언",
      "대화": "대화",
      "담화": "담화",
      
      "직업": "직업",
      "전문": "전문",
      "천직": "천직",
      "일": "일",
      "소명": "소명"
    };

    function formatUserName(fullName) {
      if (!fullName) return "";
      
      const nameParts = fullName.trim().split(' ');
      
      if (nameParts.length === 1) {
        return nameParts[0];
      }
      
      const firstName = nameParts[0];
      const lastNameInitial = nameParts[nameParts.length - 1].charAt(0).toUpperCase();
      
      return `👑 ${firstName} ${lastNameInitial}.`;
    }

    function generateUniqueId() {
      const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      const numbers = '0123456789';
      let id = '';
      
      for (let i = 0; i < 3; i++) {
        id += letters.charAt(Math.floor(Math.random() * letters.length));
      }
      
      for (let i = 0; i < 3; i++) {
        id += numbers.charAt(Math.floor(Math.random() * numbers.length));
      }
      
      return id;
    }

    async function detectUserLocation() {
      try {
        const response = await fetch('https://ipapi.co/json/');
        const data = await response.json();
        currentCountry = data.country_name;
        userCity = data.city;
        console.log("사용자 위치 감지:", currentCountry, userCity);
        return { country: currentCountry, city: userCity };
      } catch (error) {
        console.error("사용자 위치 감지 오류:", error);
        return { country: "알 수 없음", city: "알 수 없음" };
      }
    }

    function generatePersonalizedMotivation(flowerCode, profession, dob) {
      if (!flowerCode || flowerCode.length < 8) {
        return "이 꽃의 영감은 당신을 격려하고 안내할 것입니다.";
      }
      
      let month = 0;
      if (dob) {
        const dobDate = new Date(dob);
        month = dobDate.getMonth();
      }
      
      const lifeTraits = [
        "창의성은 당신이 직면하는 모든 도전에 새로운 아이디어를 가져옵니다.",
        "마음의 친절함이 매일 주변 사람들에게 영감을 줍니다.",
        "인내심은 다른 사람들이 불가능하다고 생각하는 장애물을 극복하는 데 도움이 됩니다.",
        "독특한 관점은 혁신적인 방식으로 문제를 해결하게 합니다.",
        "활기찬 존재감이 만나는 모든 사람의 하루를 밝게 만듭니다.",
        "인내심은 다른 사람들이 볼 수 없을 때 더 큰 그림을 볼 수 있게 합니다.",
        "용기는 결단력으로 새로운 도전에 맞서게 합니다.",
        "지혜는 어려운 결정을 명확한 생각으로 내릴 수 있게 안내합니다.",
        "낙관주의는 만나는 모든 상황에서 기회를 찾는 데 도움이 됩니다.",
        "집중력은 목표를 향해 한 단계씩 정확하게 나아가게 합니다.",
        "적응력은 변화하는 시대에 가장 큰 장점이 됩니다.",
        "직관은 선택이 명확하지 않을 때 올바른 방향으로 인도합니다.",
        "공감은 다른 사람들과 의미 있는 깊은 연결을 만들게 합니다.",
        "회복력은 어떤 좌절에서도 더 강하게 반등하는 데 도움이 됩니다.",
        "진정성은 가면 없이도 있는 그대로의 당신을 받아들이는 사람들을 끌어들입니다.",
        "감사함은 매일 삶의 행복을 두 배로 만듭니다.",
        "호기심은 다른 사람들이 놓칠 수 있는 새로운 발견으로 이끕니다.",
        "유머 감각은 가장 어려운 순간을 완화시킵니다.",
        "관대함은 당신의 커뮤니티에 선한 파문을 만듭니다.",
        "결단력은 도전을 축하할 가치가 있는 성취로 변화시킵니다.",
        "연민은 미묘하지만 강력한 방식으로 주변 사람들을 치유합니다.",
        "명료함은 혼돈 속에서도 현명한 선택을 하는 데 도움이 됩니다.",
        "자신감은 당신의 리더십을 따르는 사람들에게 신뢰를 불어넣습니다.",
        "마음챙김은 혼란과 불확실성 속에서도 집중력을 유지하게 합니다.",
        "성실함은 동료와 리더들 사이에서 존경을 얻습니다.",
        "열정은 당신의 에너지를 목격하는 다른 사람들의 열정에 불을 붙입니다.",
        "따뜻함은 사람들이 당신의 존재 속에서 즉시 환영받는 느낌을 갖게 합니다.",
        "상상력은 다른 사람들이 보지 못하는 가능성의 문을 엽니다.",
        "균형은 삶의 복잡성을 우아하게 항해하는 데 도움이 됩니다.",
        "비전은 다른 사람들이 멈출 때 지평선 너머를 볼 수 있게 합니다.",
        "카리스마는 자연스럽게 사람들을 당신의 자기장 같은 에너지로 끌어들입니다.",
        "규율은 모든 노력에 성공의 기반을 닦습니다.",
        "직관적인 본성은 다른 사람들이 놓치는 미묘한 진실을 이해하는 데 도움이 됩니다.",
        "유희적 정신은 도전 속에서도 당신의 정신을 젊고 활기차게 유지합니다.",
        "분석적 사고는 다른 사람들이 완전히 간과하는 해결책을 찾아냅니다.",
        "사려 깊음은 평생 지속되는 의미 있는 연결을 만듭니다.",
        "민감성은 묻지 않고도 다른 사람들의 필요를 감지하게 합니다.",
        "결단력은 다른 사람들이 망설일 때 프로젝트를 전진시킵니다.",
        "일관성은 모든 관계에서 시간이 지남에 따라 신뢰를 구축합니다.",
        "표현력은 당신의 진실을 세상에 아름답게 전달합니다.",
        "기지는 제약을 성장의 기회로 바꿉니다.",
        "성실함은 당신이 접하거나 만드는 모든 것에 품질을 보장합니다.",
        "유연성은 끊임없이 변화하는 환경에 비범한 우아함으로 적응합니다.",
        "실용성은 큰 꿈을 꾸면서도 당신의 행동을 현실에 근거하게 합니다.",
        "웅변은 복잡한 아이디어를 다른 사람들이 이해할 수 있도록 명확하게 표현합니다.",
        "선견지명은 도전이 오기 전에 준비할 수 있게 도와줍니다.",
        "온화함은 부드러운 마음에 흉터를 남기지 않고 상처를 치유합니다.",
        "단호함은 옳은 일을 위해 주저 없이 일어서게 합니다.",
        "독립성은 역경 속에서 자급자족과 힘을 키웁니다.",
        "세심함은 다른 사람들이 놓치는 중요한 세부 사항에 주의를 기울입니다.",
        "민첩한 정신은 새로운 상황에 쉽게 적응하는 데 도움이 됩니다.",
        "자아 인식은 성장과 성취로 가는 길을 밝혀줍니다.",
        "내면의 힘은 어려운 시험의 시간에 가장 빛납니다.",
        "자기 자신의 매력적인 성격은 사람들을 당신의 궤도로 쉽게 끌어들입니다.",
        "감성 지능은 복잡한 인간관계를 탐색하는 데 도움이 됩니다.",
        "빠른 사고는 다른 사람들이 문제만 볼 때 해결책을 찾아냅니다.",
        "침착한 자신감은 말하지 않아도 자체적으로 말합니다.",
        "타고난 리더십은 다른 사람들이 자신의 최고의 본능을 따르도록 영감을 줍니다.",
        "확고한 도덕은 어둠 속에서도 당신의 결정을 인도합니다.",
        "예술적 감성은 예상치 못한 장소와 순간에 아름다움을 발견합니다.",
        "전략적 사고는 미래 발전을 정확하게 예측합니다.",
        "자발성은 낡은 상황에 새로운 에너지를 가져옵니다.",
        "세심한 주의는 미래의 복잡한 상황을 예방합니다.",
        "평온한 존재는 가장 혼란스러운 환경도 진정시킵니다.",
        "혁신적인 사고는 전통적인 제약을 깨뜨립니다.",
        "타고난 외교적 기술은 우아함과 공정함으로 갈등을 해결합니다.",
        "신뢰성은 도움이 필요한 사람들의 비밀 유지자가 되게 합니다.",
        "전염성 있는 열정은 주변의 모든 사람을 고양시킵니다."
      ];
      
      const lifeEncouragements = [
        "이러한 선물을 주변 세계와 계속 공유하세요.",
        "이러한 본능을 믿으세요 - 그것들은 당신을 거의 잘못 인도하지 않습니다.",
        "이러한 재능은 널리 공유하기 위해 존재합니다.",
        "앞으로의 길에는 도전이 있을 수 있지만, 당신은 완전히 준비되어 있습니다.",
        "오늘의 작은 걸음은 내일의 큰 성취로 이어집니다.",
        "전진하면서 진전을 축하하는 것을 기억하세요.",
        "이 독특한 여정은 당신이 걷는 모든 걸음이 가치가 있습니다.",
        "결과뿐만 아니라 과정을 즐기는 것을 잊지 마세요.",
        "최고의 날들은 아직 이 모험 앞에 있습니다.",
        "오늘의 노력이 내일의 성공 이야기를 만들고 있습니다.",
        "모든 상황과 도전 속에서 진정한 자신을 유지하세요.",
        "변화를 더 강해지기 위한 기회로 보세요.",
        "내면의 지혜에 더 자주 귀를 기울이세요 - 그것은 방향을 알고 있습니다.",
        "필요할 때 죄책감 없이 휴식을 취하세요.",
        "더 큰 그림에서 진정으로 중요한 것에 집중하세요.",
        "당신의 존재는 당신을 알게 된 사람들에게 선물입니다.",
        "바쁜 일정에도 불구하고 열정을 키우는 것을 계속하세요.",
        "도전과 좌절의 시간에 자신에게 친절하세요.",
        "이 독특한 경로는 당신이 가야 할 곳입니다.",
        "삶이 펼쳐지는 신비의 타이밍을 신뢰하세요.",
        "작은 순간에서 매일 기쁨을 찾으세요.",
        "이 관점은 가치가 있습니다 - 더 자주 공유하세요.",
        "의미 있는 변화를 만들 수 있는 능력을 믿으세요.",
        "이 여정을 처음 시작한 이유를 기억하세요.",
        "매일은 완전히 새로운 시작을 제공합니다.",
        "이 회복력은 당신이 깨닫는 것보다 다른 사람들에게 더 영감을 줍니다.",
        "가는 길에 작은 승리를 축하하는 시간을 가지세요.",
        "마주하는 모든 도전은 깊이 성격을 강화합니다.",
        "우주는 이 진정한 경로를 완전히 지원합니다.",
        "진정성이 이끌 때, 빛은 가장 밝게 빛납니다.",
        "세상은 당신만이 줄 수 있는 독특한 기여가 필요합니다.",
        "의미 있는 작업이 스스로 말하게 하세요, 설명이 필요 없습니다.",
        "지속적인 노력은 시간이 지남에 따라 위대함으로 변합니다.",
        "오늘 불가능해 보이는 것이 내일은 현실이 될 것입니다.",
        "내면의 힘은 앞으로의 어떤 도전보다 훨씬 더 큽니다.",
        "이 여정은 당신이 알고 있는 것보다 더 많은 사람들에게 영감을 줍니다.",
        "장애물은 단지 더 나은 길로의 방향 전환일 뿐입니다.",
        "성격의 깊이는 어려운 시간에 가장 명백합니다.",
        "성장은 편안한 구역 내에서가 아니라 그 밖에서 발생합니다.",
        "작은 진전조차도 축하하고 인정할 가치가 있습니다.",
        "어려운 시간에 개인적인 '이유'에 집중하세요.",
        "일상적인 선택이 기억될만한 지속적인 유산을 만듭니다.",
        "지금 배우는 교훈은 수많은 방법으로 영원히 당신을 섬길 것입니다.",
        "타인에 대한 친절의 영향을 과소평가하지 마세요.",
        "진정한 목소리는 그것을 들어야 할 사람들에게 울립니다.",
        "오늘 극복한 도전은 내일의 시험을 위한 힘을 구축합니다.",
        "과거는 미래의 잠재력이나 가능성을 정의하지 않습니다.",
        "아무리 작더라도, 모든 전진 단계는 모멘텀을 만듭니다.",
        "독특한 접근 방식은 다른 사람들이 부족한 경쟁 우위가 됩니다.",
        "현재 위치가 성장이 일어나야 하는 정확한 장소임을 믿으세요.",
        "가장 큰 성취는 종종 가장 큰 도전을 극복한 후에 따라옵니다.",
        "이 이야기는 앞으로 더 훌륭한 장을 계속 쓰고 있습니다.",
        "우주는 진정으로 추구하는 꿈을 지원합니다.",
        "가장 강력한 자원은 여전히 흔들리지 않는 자신감입니다.",
        "타인에 대한 영향은 측정 가능한 범위를 훨씬 넘어섭니다.",
        "현재의 제한은 일시적이며, 잠재력은 여전히 무한합니다.",
        "가장 중요한 인정은 외부가 아닌 내부에서 옵니다.",
        "직관은 진북을 가리키는 내부 나침반입니다.",
        "오늘의 규율은 내일의 자유와 기회를 만듭니다.",
        "모든 경험은 성격과 지혜에 깊이를 더합니다.",
        "삶의 목적은 기쁨과 어려움을 통해 동등하게 펼쳐집니다.",
        "역경을 처리하는 방법은 진정한 성격의 강점을 보여줍니다.",
        "독특함은 삶에서 가장 큰 경쟁 우위가 됩니다.",
        "꿈과 목표가 자연스럽게 발전함에 따라 개인적 성장을 허용하세요.",
        "성장에 대한 헌신은 이미 미래의 결과를 적극적으로 변화시켰습니다.",
        "일관성이 가치 있는 목표를 얼마나 멀리 이끌 수 있는지 과소평가하지 마세요.",
        "결단력은 일시적인 좌절을 초월합니다.",
        "올바른 길이 항상 가장 쉬운 것은 아니지만, 여전히 가장 가치 있습니다.",
        "시작할 용기는 다른 사람들이 자신의 여정을 시작하도록 영감을 줍니다.",
        "편안함보다 성장을 선택하면 잠재력이 배가됩니다.",
        "최고의 잠재력은 편안한 구역 바로 바깥에서 기다리고 있습니다.",
        "모든 도전은 지평선 위에 더 큰 것을 준비합니다."
      ];
      
      const professionMotivations = {
        "음악가": [
          "음악적 재능은 평화를 찾는 혼란스러운 세계에 조화를 가져옵니다.",
          "연주하는 모든 음표는 위로가 필요한 영혼에 울립니다.",
          "이 선율들은 부서진 마음을 치유하고 변화시키는 힘이 있습니다.",
          "예술적 표현은 말로 표현할 수 없는 보편적 진실을 전달합니다.",
          "내면의 음악은 기다리는 청중에게 들려질 가치가 있습니다."
        ],
        "래퍼": [
          "시적인 말은 담대하게 말해야 할 강력한 이야기를 그립니다.",
          "이 흐름과 리듬은 단순한 단어가 포착할 수 없는 감정을 포착합니다.",
          "이 시들은 많은 사람들이 느끼지만 표현할 수 없는 경험에 목소리를 줍니다.",
          "진정한 목소리는 모든 커뮤니티에서 진실을 찾는 사람들에게 울립니다.",
          "단어의 솜씨는 새로운 관점을 수용하기 위해 마음과 생각을 엽니다."
        ],
        "축구선수": [
          "필드에서의 헌신은 게임 자체를 넘어서는 팀워크를 영감을 줍니다.",
          "스포츠 규율은 원활하게 삶의 모든 영역으로 변환됩니다.",
          "필드에서의 전략적 사고는 타고난 리더십을 보여줍니다.",
          "이 아름다운 게임에 대한 열정은 보고 참여하는 사람들을 고양시킵니다.",
          "스포츠맨십은 다른 사람들이 따르고 존중할 기준을 설정합니다."
        ],
        "농구선수": [
          "코트에서의 시야는 삶의 모든 게임에서 기회를 보는 능력으로 변환됩니다.",
          "압박 속에서의 성과는 직면하는 모든 도전에서 유용합니다.",
          "팀 우선 마인드셋은 형성되는 모든 관계에서 성공을 만듭니다.",
          "수직 점프는 인상적인 새로운 높이에 도달하려는 야망과 일치합니다.",
          "수비 허슬은 모든 것에 대한 탁월함에 대한 헌신을 보여줍니다."
        ],
        "복서": [
          "정신적 회복력은 보여지는 물리적 힘만큼 인상적입니다.",
          "훈련 규율은 모든 삶의 환경에서 성격을 반영합니다.",
          "타격을 받고 앞으로 나아가는 것은 삶의 초능력이 됩니다.",
          "링에서의 발놀림은 삶의 도전을 항해하는 능력을 반영합니다.",
          "투쟁 정신은 직면하는 가치 있는 도전에서 절대 물러서지 않습니다."
        ],
        "학생": [
          "호기심은 끝없는 가능성과 발견의 문을 엽니다.",
          "학습에 대한 헌신은 삶의 많은 장을 통해 계속됩니다.",
          "신선한 관점은 해결이 필요한 오래된 문제에 새로운 통찰력을 가져옵니다.",
          "교육 여정은 아직 보이지 않는 기회를 준비합니다.",
          "학업 규율은 평생 성공을 보장하는 습관을 기릅니다."
        ],
        "교사": [
          "영향력은 교실 벽을 넘어 보이지 않는 미래로 확장됩니다.",
          "인내심은 다른 사람들이 놓치거나 무시할 수 있는 잠재력을 육성합니다.",
          "안내는 미래를 형성하는 방식을 결코 충분히 감사하거나 측정할 수 없습니다.",
          "지혜의 씨앗은 오늘의 수업 후 수 세대에 걸쳐 꽃을 피웁니다.",
          "지식에 대한 헌신은 모든 곳에서 긍정적인 변화의 파문을 만듭니다."
        ],
        "틱톡 크리에이터": [
          "창의적인 콘텐츠는 우리의 디지털 풍경에 기쁨과 연결을 가져옵니다.",
          "진정한 목소리는 지금 그 메시지가 필요한 사람들에게 도달합니다.",
          "간결한 커뮤니케이션은 희귀하고 가치 있는 기술 마스터리를 보여줍니다.",
          "문화적 영향력은 글로벌 시청자를 긍정적인 변화로 안내합니다.",
          "디지털 존재감은 화면 제한을 넘어 실제 세계에 영향을 미칩니다."
        ],
        "기업가": [
          "미래를 내다보는 사고는 다른 사람들이 장애물만 보는 곳에 기회를 만듭니다.",
          "계산된 위험을 감수하는 것은 진정한 혁신가를 추종자와 구별합니다.",
          "혁신적인 솔루션은 문제의 근본 원인을 효과적으로 해결합니다.",
          "리더십은 다른 사람들이 가치 있는 의미 있는 임무에 참여하도록 영감을 줍니다.",
          "도전에 직면했을 때의 인내는 기업가적 성공 이야기를 정의합니다."
        ],
        "의사": [
          "치유의 손길은 환자가 가장 필요할 때 위안을 가져옵니다.",
          "의료에 대한 헌신은 매일 깊은 방식으로 삶을 변화시킵니다.",
          "의학 지식과 공감이 결합되어 진정한 치유의 순간을 만듭니다.",
          "환자 관리에 대한 헌신은 가장 높은 직업적 소명을 구현합니다.",
          "진단 기술은 자비로운 마음과 완벽하게 균형을 이룹니다."
        ],
        "엔지니어": [
          "문제 해결 능력은 무수한 생명을 개선하는 솔루션을 만듭니다.",
          "기술적 전문 지식은 미래 혁신의 기초를 마련합니다.",
          "분석적 사고는 복잡한 시스템에서 다른 사람들이 완전히 놓치는 패턴을 봅니다.",
          "정밀함과 세부 사항에 대한 관심은 만들어지는 모든 것의 품질을 보장합니다.",
          "혁신적인 접근 방식은 전체 분야를 앞으로 밀어붙입니다."
        ],
        "소프트웨어 개발자": [
          "코드는 구현되기 전에는 존재하지 않았던 가능성을 만듭니다.",
          "기술 솔루션은 사회가 직면한 실제 인간 문제를 해결합니다.",
          "논리적 사고와 창의적 혁신이 완벽하게 결합됩니다.",
          "디지털 창작물은 매일 모든 플랫폼에서 수많은 사용자에게 영향을 미칩니다.",
          "새로운 기술을 배우는 것은 최첨단 전문성을 유지합니다."
        ],
        "예술가": [
          "창의적인 비전은 다른 사람들에게 친숙한 세계를 새로운 방식으로 보여줍니다.",
          "예술적 표현은 언어가 닿지 못하는 감정을 건드립니다.",
          "독특한 관점은 관객의 일상 경험에 아름다움을 더합니다.",
          "창의적인 작품은 경계를 넘어 중요한 대화를 촉발합니다.",
          "예술적 용기는 다른 사람들이 자신의 진실을 진정으로 표현하도록 영감을 줍니다."
        ],
        "간호사": [
          "자비로운 돌봄은 단순한 신체적 질병 이상을 치유합니다.",
          "집중된 주의는 환자 관리에서 다른 사람들이 놓칠 수 있는 세부 사항을 알아차립니다.",
          "차분한 존재감은 어려운 의료 순간에 위안을 제공합니다.",
          "헌신은 매 근무 시간마다 수많은 환자에게 차이를 만듭니다.",
          "기술적 능력과 인간적 따뜻함의 균형은 무가치로 증명됩니다."
        ],
        "작가": [
          "단어는 독자의 마음속에 탐험을 기다리는 세계를 만듭니다.",
          "이야기 말하기는 매우 다른 경험을 가진 사람들을 연결합니다.",
          "웅변은 다른 사람들이 명확하게 표현하기 어려운 목소리를 줍니다.",
          "서면 통찰력은 친숙한 도전에 새로운 시각을 제공합니다.",
          "문학적 기교는 미래 세대를 위해 중요한 진실을 보존합니다."
        ],
        "변호사": [
          "옹호는 복잡한 시스템에서 목소리가 필요한 사람들에게 정의를 가져옵니다.",
          "분석적 사고는 인상적인 정확도로 법적 도전을 항해합니다.",
          "법적 원칙에 대한 헌신은 사회의 기초를 강화합니다.",
          "설득력 있는 주장은 정의를 추구하는 고객을 위해 결과를 변경합니다.",
          "법률 실무에 대한 윤리적 접근 방식은 전문성에 대한 기준을 설정합니다."
        ],
        "요리사": [
          "요리 창작물은 모든 감각을 통해 감사하는 식사객에게 기쁨을 가져옵니다.",
          "요리는 서로 다른 식탁과 다양한 문화적 배경의 사람들을 연결합니다.",
          "맛의 조합은 예술적 직관과 기술적 능력을 보여줍니다.",
          "품질 있는 재료에 대한 헌신은 전통과 혁신을 존중합니다.",
          "주방 리더십은 전체 요리 팀에서 최고의 성과를 이끌어냅니다."
        ],
        "회계사": [
          "금융 전문 지식은 클라이언트에게 안전과 마음의 평화를 제공합니다.",
          "세부 사항에 대한 주의는 다른 사람들이 확실히 놓칠 것을 포착합니다.",
          "분석 기술은 복잡한 재정 상황에 명확성을 가져옵니다.",
          "직업적 청렴성은 모든 비즈니스 관계에서 신뢰를 보장합니다.",
          "조직 능력은 금융 복잡성에서 질서를 만듭니다."
        ],
        "디자이너": [
          "시각적 솔루션은 미학과 실용적 기능을 원활하게 결합합니다.",
          "디자인 사고는 의미 있는 방식으로 사용자 경험을 변형합니다.",
          "미적 감각은 일상적인 물건과 상호 작용을 향상시킵니다.",
          "창의적 과정은 혁신과 근본적인 사용성 사이의 균형을 맞춥니다.",
          "디자인 언어는 장벽을 넘어 효과적으로 소통합니다."
        ],
        "경찰": [
          "공공 안전에 대한 헌신은 커뮤니티를 눈에 띄게 강화합니다.",
          "도전적인 상황에서의 용기는 취약한 시민을 보호합니다.",
          "압박 상황에서의 빠른 결정은 비범한 침착함을 보여줍니다.",
          "정의에 대한 헌신은 일관되게 직업적 행동을 안내합니다.",
          "존재감은 개입이 필요한 긴장된 상황에 안전감을 가져옵니다."
        ],
        "소방관": [
          "위험한 상황에서의 용기는 생명과 귀중한 재산을 구합니다.",
          "극도의 압박 하에서의 빠른 사고는 비범한 기술을 보여줍니다.",
          "신체적, 정신적 준비는 영웅적인 비상 대응을 가능하게 합니다.",
          "위기 상황에서의 팀워크는 인간 협력의 정수를 구현합니다.",
          "커뮤니티 안전에 대한 헌신은 비상 상황을 넘어 확장됩니다."
        ],
        "군인": [
          "봉사는 다른 사람들을 보호하기 위한 최고의 헌신을 보여줍니다.",
          "도전적인 조건에서의 규율은 탁월함의 표준을 설정합니다.",
          "전략적 사고는 임무 목표와 팀 안전 사이의 균형을 맞춥니다.",
          "변화하는 상황에 대한 적응력은 임무 성공을 보장합니다.",
          "부대에 대한 충성심은 일반적인 우정을 넘어서는 유대를 만듭니다."
        ],
        "기자": [
          "진실 추구는 혼란스럽고 복잡한 시대에 명확성을 가져옵니다.",
          "이야기 말하기는 청중이 중요한 복잡한 문제를 이해하는 데 도움이 됩니다.",
          "조사 기술은 절실히 가시성이 필요한 것을 드러냅니다.",
          "사실에 대한 헌신은 정보 생태계의 균형을 책임감 있게 맞춥니다.",
          "저널리스트의 목소리는 공적 담론에 중요한 관점을 더합니다."
        ],
        "심리학자": [
          "공감적 경청은 필요한 치유를 위한 안전한 공간을 만듭니다.",
          "통찰력은 고객이 내면의 풍경을 효과적으로 탐색하는 데 도움이 됩니다.",
          "치료적 접근은 동정심과 증거 기반 실천 사이의 균형을 맞춥니다.",
          "인내심 있는 안내는 다른 사람들이 자신의 해결책을 발견할 수 있게 합니다.",
          "전문적인 경계는 지속적인 치유 관계를 가능하게 합니다."
        ],
        "교사": [
          "안내는 즉시 볼 수 있는 것을 넘어서는 미래를 형성합니다.",
          "학습 과정에 대한 인내심은 성장이 자연스럽게 펼쳐지게 합니다.",
          "복잡한 개념을 설명하는 능력은 지식을 접근 가능하게 만듭니다.",
          "교실 관리는 지적 탐구를 위한 안전한 공간을 만듭니다.",
          "다양한 학습 스타일에 대한 인식은 각 학생에게 독특하게 접근합니다."
        ],
        "프로그래머": [
          "코딩 기술은 추상적인 아이디어를 기능적 현실로 변환합니다.",
          "문제 해결 접근법은 복잡한 도전을 관리 가능한 부분으로 분해합니다.",
          "세부 사항에 대한 관심은 복잡한 코드에서 미래의 합병증을 방지합니다.",
          "지속적인 학습은 빠르게 변화하는 분야에서 기술의 관련성을 유지합니다.",
          "기술적 창의성은 어려운 문제에 대한 우아한 해결책을 찾습니다."
        ]
      };
      
      const monthTraits = [
        "1월에 태어나면 타고난 리더십 자질과 집중된 결의를 부여받습니다.",
        "2월에 태어나면 직관적인 이해와 인도주의적 비전을 선사받습니다.",
        "3월에 태어나면 상상력이 풍부한 창의성과 적응력 있는 회복력을 제공받습니다.",
        "4월에 태어나면 확고한 결의와 용감한 주도성을 부여받습니다.",
        "5월에 태어나면 설득력 있는 소통 기술과 실용적인 감성을 선사받습니다.",
        "6월에 태어나면 적응력 있는 다재다능함과 감성 지능을 제공받습니다.",
        "7월에 태어나면 연민 어린 공감과 보호적인 양육 본능을 부여받습니다.",
        "8월에 태어나면 자기 자신의 매력과 관대한 자신감을 선사받습니다.",
        "9월에 태어나면 분석적 정확성과 체계적인 조직 능력을 제공받습니다.",
        "10월에 태어나면 균형 잡힌 관점과 외교적 조화를 부여받습니다.",
        "11월에 태어나면 통찰력과 변혁적인 강도를 선사받습니다.",
        "12월에 태어나면 미래를 내다보는 낙관주의와 철학적 지혜를 제공받습니다."
      ];
      
      let selectedTrait;
      
      if (profession && professionMotivations[profession] && Math.random() < 0.25) {
        const profMotivations = professionMotivations[profession];
        selectedTrait = profMotivations[Math.floor(Math.random() * profMotivations.length)];
      } 
      else if (dob && Math.random() < 0.2) {
        selectedTrait = monthTraits[month];
      }
      else {
        selectedTrait = lifeTraits[Math.floor(Math.random() * lifeTraits.length)];
      }
      
      const encourageIndex = Math.floor(Math.random() * lifeEncouragements.length);
      
      return selectedTrait + " " + lifeEncouragements[encourageIndex];
    }

    function generateFlowerCode() {
      const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      let code = '';
      for (let i = 0; i < 8; i++) {
        const randomIndex = Math.floor(Math.random() * characters.length);
        code += characters.charAt(randomIndex);
      }
      return code;
    }

    function getRandomSubject() {
      let availableSubjects = Object.keys(subjectDictionary).filter(subject => !seenSubjects.includes(subject));
      
      if (availableSubjects.length === 0) {
        seenSubjects = [];
        availableSubjects = Object.keys(subjectDictionary);
      }
      
      const randomIndex = Math.floor(Math.random() * availableSubjects.length);
      const selectedSubject = availableSubjects[randomIndex];
      
      seenSubjects.push(selectedSubject);
      
      return selectedSubject;
    }

    function updateFlowerDisplay() {
      const flowerCodeElement = document.getElementById('flowerCodeDisplay');
      const motivationElement = document.getElementById('monthlyMotivation');
      
      if (!flowerCodeElement || !motivationElement) {
        console.error("DOM에서 필요한 요소를 찾을 수 없습니다");
        return;
      }
      
      let subject = localStorage.getItem('flowerSubject');
      if (!subject) {
        subject = getRandomSubject();
        localStorage.setItem('flowerSubject', subject);
      }
      
      const formattedName = formatUserName(userFullName);
      
      if (formattedName) {
        flowerCodeElement.innerHTML = `내 꽃 - ${subject} / ${formattedName}`;
      } else {
        flowerCodeElement.textContent = "내 꽃 - " + subject;
      }
      
      if (!currentMotivation) {
        currentMotivation = generatePersonalizedMotivation(userFlowerCode, userProfession, userDateOfBirth);
      }
      
      motivationElement.textContent = currentMotivation;
      
      const captureCode = document.getElementById('captureFlowerCode');
      const captureMotivation = document.getElementById('captureFlowerMotivation');
      
      if (captureCode) {
        if (formattedName) {
          captureCode.innerHTML = `내 꽃 - ${subject} / ${formattedName}`;
        } else {
          captureCode.textContent = "내 꽃 - " + subject;
        }
      }
      
      if (captureMotivation) captureMotivation.textContent = currentMotivation;
      
      return currentMotivation;
    }

    function setCookie(name, value, days) {
      let expires = "";
      if (days) {
        const date = new Date();
        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
        expires = "; expires=" + date.toUTCString();
      }
      document.cookie = name + "=" + (value || "") + expires + "; path=/; SameSite=Lax";
    }

    function getCookie(name) {
      const nameEQ = name + "=";
      const ca = document.cookie.split(';');
      for (let i = 0; i < ca.length; i++) {
        let c = ca[i];
        while (c.charAt(0) === ' ') c = c.substring(1, c.length);
        if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
      }
      return null;
    }

    function removeCookie(name) {
      document.cookie = name + "=; Max-Age=-99999999; path=/";
    }

    function setTheme(theme) {
      document.body.classList.remove('theme-default', 'theme-red-black', 'theme-green-blue', 'theme-orange-pink', 'theme-yellow-purple');
      
      document.body.classList.add('theme-' + theme);
      
      currentTheme = theme;
      
      localStorage.setItem('preferredTheme', theme);
      setCookie('preferredTheme', theme, 365);
      
      const options = document.querySelectorAll('.style-option');
      options.forEach(option => {
        option.classList.remove('selected');
        if (option.dataset.theme === theme) {
          option.classList.add('selected');
        }
      });
      
      updateCaptureStyles(theme);
      
      let themeColor = '#1A2E4D';
      switch(theme) {
        case 'red-black':
          themeColor = '#000000';
          break;
        case 'green-blue':
          themeColor = '#1A2E4D';
          break;
        case 'orange-pink':
        case 'yellow-purple':
          themeColor = '#4B0082';
          break;
        case 'default':
          themeColor = '#FFFFFF';
          break;
      }
      
      document.querySelector('meta[name="theme-color"]').setAttribute('content', themeColor);
      document.querySelector('meta[name="apple-mobile-web-app-status-bar-style"]').setAttribute('content', theme === 'default' ? 'default' : 'black-translucent');
    }
    
    function updateCaptureStyles(theme) {
      const captureContainer = document.getElementById('flowerCaptureContainer');
      const captureCode = document.getElementById('captureFlowerCode');
      const captureHeader = document.getElementById('captureFlowerHeader');
      const captureWebsiteUrl = document.querySelector('.capture-website-url');
      const captureLogo = document.querySelector('.gz-logo');
      const captureMotivation = document.getElementById('captureFlowerMotivation');
      
      if (!captureContainer || !captureCode || !captureHeader || !captureWebsiteUrl || 
          !captureLogo || !captureMotivation) {
        console.error("하나 이상의 캡처 요소를 찾을 수 없습니다");
        return;
      }
      
      captureContainer.style.borderColor = '';
      captureCode.style.borderColor = '';
      captureCode.style.color = '';
      captureCode.style.backgroundColor = '';
      captureHeader.style.color = '';
      captureWebsiteUrl.style.color = '';
      captureLogo.style.color = '';
      captureLogo.style.borderColor = '';
      captureMotivation.style.color = '';
      captureMotivation.style.backgroundColor = '';
      captureMotivation.style.borderColor = '';
      
      switch(theme) {
        case 'red-black':
          captureContainer.style.borderColor = '#8B0000';
          captureContainer.style.backgroundColor = 'black';
          captureCode.style.borderColor = '#FF4500';
          captureCode.style.color = '#FF4500';
          captureCode.style.backgroundColor = 'black';
          captureHeader.style.color = '#FF4500';
          captureWebsiteUrl.style.color = '#FF4500';
          captureLogo.style.color = '#FF4500';
          captureLogo.style.borderColor = '#FF4500';
          captureMotivation.style.color = '#E5E5E5';
          captureMotivation.style.backgroundColor = 'black';
          captureMotivation.style.borderColor = '#FF4500';
          break;
          
        case 'green-blue':
          captureContainer.style.borderColor = '#3EB489';
          captureContainer.style.backgroundColor = '#1A2E4D';
          captureCode.style.borderColor = '#3EB489';
          captureCode.style.color = '#3EB489';
          captureCode.style.backgroundColor = '#36454F';
          captureHeader.style.color = '#3EB489';
          captureWebsiteUrl.style.color = '#3EB489';
          captureLogo.style.color = '#3EB489';
          captureLogo.style.borderColor = '#3EB489';
          captureMotivation.style.color = '#F5F5F5';
          captureMotivation.style.backgroundColor = '#1A2E4D';
          captureMotivation.style.borderColor = '#3EB489';
          break;
          
        case 'orange-pink':
          captureContainer.style.borderColor = '#FF7F50';
          captureContainer.style.backgroundColor = '#4B0082';
          captureCode.style.borderColor = '#FF7F50';
          captureCode.style.color = '#FF7F50';
          captureCode.style.backgroundColor = '#6A0DAD';
          captureHeader.style.color = '#FF7F50';
          captureWebsiteUrl.style.color = '#FF7F50';
          captureLogo.style.color = '#FF7F50';
          captureLogo.style.borderColor = '#FF7F50';
          captureMotivation.style.color = '#FFFFFF';
          captureMotivation.style.backgroundColor = '#4B0082';
          captureMotivation.style.borderColor = '#FF7F50';
          break;
          
        case 'yellow-purple':
          captureContainer.style.borderColor = '#FFD700';
          captureContainer.style.backgroundColor = '#4B0082';
          captureCode.style.borderColor = '#FFD700';
          captureCode.style.color = '#FFD700';
          captureCode.style.backgroundColor = '#6A0DAD';
          captureHeader.style.color = '#FFD700';
          captureWebsiteUrl.style.color = '#FFD700';
          captureLogo.style.color = '#FFD700';
          captureLogo.style.borderColor = '#FFD700';
          captureMotivation.style.color = '#FFFFFF';
          captureMotivation.style.backgroundColor = '#4B0082';
          captureMotivation.style.borderColor = '#FFD700';
          break;
          
        default:
          captureContainer.style.borderColor = '#007bff';
          captureContainer.style.backgroundColor = 'white';
          captureCode.style.borderColor = '#ff69b4';
          captureCode.style.color = '#ff69b4';
          captureCode.style.backgroundColor = '#fff0f8';
          captureHeader.style.color = '#007bff';
          captureWebsiteUrl.style.color = '#007bff';
          captureLogo.style.color = '#007bff';
          captureLogo.style.borderColor = '#007bff';
          captureMotivation.style.color = '#333';
          captureMotivation.style.backgroundColor = 'white';
          captureMotivation.style.borderColor = '#ff69b4';
      }
    }

    function authenticateAnonymously() {
      return new Promise((resolve, reject) => {
        auth.signInAnonymously()
          .then((userCredential) => {
            console.log("사용자 익명 인증:", userCredential.user.uid);
            userUid = userCredential.user.uid;
            isAuthenticated = true;
            resolve(userCredential.user);
          })
          .catch((error) => {
            console.error("인증 오류:", error);
            reject(error);
          });
      });
    }

    auth.onAuthStateChanged((user) => {
      if (user) {
        userUid = user.uid;
        isAuthenticated = true;
        console.log("인증 상태가 변경됨: 사용자가 로그인됨", user.uid);
      } else {
        isAuthenticated = false;
        console.log("인증 상태가 변경됨: 사용자가 로그아웃됨");
      }
    });

    async function submitToFirebase() {
      try {
        if (!isAuthenticated) {
          console.log("사용자가 인증되지 않음, 지금 인증 중...");
          await authenticateAnonymously();
        }
        
        const location = await detectUserLocation();
        
        const userData = {
          date: new Date().toISOString(),
          country: location.country || "알 수 없음",
          city: location.city || "알 수 없음",
          uid: userUid,
          uniqueId: userUniqueId,
          flowerCode: userFlowerCode,
          motivation: currentMotivation,
          dateOfBirth: userDateOfBirth,
          profession: userProfession,
          fullName: userFullName,
          formattedName: formatUserName(userFullName),
          timestamp: Date.now(),
          theme: currentTheme,
          subject: localStorage.getItem('flowerSubject') || getRandomSubject(),
          shareCount: shareCount
        };

        console.log("Firebase에 데이터 제출:", userData);
        
        try {
          const newEntryRef = database.ref('birthdates').push(userData);
          console.log("실시간 데이터베이스에 데이터 제출됨:", newEntryRef.key);
        } catch (dbError) {
          console.error("실시간 데이터베이스 오류:", dbError);
        }
        
        try {
          const docRef = await firestore.collection('flowers').add(userData);
          console.log("Firestore에 문서 작성됨, ID: ", docRef.id);
        } catch (firestoreError) {
          console.error("Firestore에 문서 추가 오류: ", firestoreError);
        }
        
        try {
          await firestore.collection('flowerCodes').doc(userUniqueId).set({
            ...userData,
            createdAt: new Date()
          });
          console.log("꽃 코드가 특정 컬렉션에 추가됨");
        } catch (codeError) {
          console.error("컬렉션에 꽃 코드 추가 오류: ", codeError);
        }
        
        localStorage.setItem('userFlowerData', JSON.stringify(userData));
        localStorage.setItem('isInstalled', 'true');
        setCookie('userUniqueId', userUniqueId, 365);
        setCookie('userFlowerCode', userFlowerCode, 365);
        setCookie('userDateOfBirth', userDateOfBirth, 365);
        setCookie('userProfession', userProfession, 365);
        setCookie('userFullName', userFullName, 365);
        setCookie('isInstalled', 'true', 365);
        isInstalled = true;
        
        return true;
      } catch (error) {
        console.error("Firebase 제출 오류:", error);
        const userData = {
          date: new Date().toISOString(),
          uniqueId: userUniqueId,
          flowerCode: userFlowerCode,
          motivation: currentMotivation,
          dateOfBirth: userDateOfBirth,
          profession: userProfession,
          fullName: userFullName,
          formattedName: formatUserName(userFullName),
          timestamp: Date.now(),
          theme: currentTheme,
          subject: localStorage.getItem('flowerSubject') || getRandomSubject(),
          shareCount: 0
        };
        
        localStorage.setItem('userFlowerData', JSON.stringify(userData));
        localStorage.setItem('isInstalled', 'true');
        setCookie('userUniqueId', userUniqueId, 365);
        setCookie('userFlowerCode', userFlowerCode, 365);
        setCookie('userDateOfBirth', userDateOfBirth, 365);
        setCookie('userProfession', userProfession, 365);
        setCookie('userFullName', userFullName, 365);
        setCookie('isInstalled', 'true', 365);
        isInstalled = true;
        
        return true;
      }
    }

    async function updateShareCount() {
      if (!isAuthenticated || !userUniqueId) return;
      
      try {
        shareCount++;
        
        const savedData = localStorage.getItem('userFlowerData');
        if (savedData) {
          const userData = JSON.parse(savedData);
          userData.shareCount = shareCount;
          localStorage.setItem('userFlowerData', JSON.stringify(userData));
        }
        
        await firestore.collection('flowerCodes').doc(userUniqueId).set({
          shareCount: shareCount,
          lastShared: new Date().toISOString(),
          country: currentCountry || "알 수 없음",
          city: userCity || "알 수 없음",
          uid: userUid,
          uniqueId: userUniqueId
        }, { merge: true });
        
        console.log("공유 횟수가 업데이트됨:", shareCount);
      } catch (error) {
        console.error("공유 횟수 업데이트 오류:", error);
      }
    }

    function checkSavedUserData() {
      const cookieUniqueId = getCookie('userUniqueId');
      const cookieFlowerCode = getCookie('userFlowerCode');
      const cookieInstalled = getCookie('isInstalled');
      const cookieDOB = getCookie('userDateOfBirth');
      const cookieProfession = getCookie('userProfession');
      const cookieFullName = getCookie('userFullName');
      
      if (cookieUniqueId && cookieFlowerCode) {
        userUniqueId = cookieUniqueId;
        userFlowerCode = cookieFlowerCode;
        userDateOfBirth = cookieDOB || null;
        userProfession = cookieProfession || null;
        userFullName = cookieFullName || null;
        isInstalled = cookieInstalled === 'true';
        
        currentMotivation = generatePersonalizedMotivation(userFlowerCode, userProfession, userDateOfBirth);
        
        console.log("쿠키에서 저장된 사용자 데이터 발견:", { userUniqueId, userFlowerCode, userDateOfBirth, userProfession, userFullName });
        return true;
      }
      
      const savedData = localStorage.getItem('userFlowerData');
      if (savedData) {
        try {
          const userData = JSON.parse(savedData);
          userUniqueId = userData.uniqueId;
          userFlowerCode = userData.flowerCode;
          userDateOfBirth = userData.dateOfBirth || null;
          userProfession = userData.profession || null;
          userFullName = userData.fullName || null;
          shareCount = userData.shareCount || 0;
          currentMotivation = userData.motivation || generatePersonalizedMotivation(userData.flowerCode, userData.profession, userData.dateOfBirth);
          userUid = userData.uid;
          isInstalled = localStorage.getItem('isInstalled') === 'true';
          
          setCookie('userUniqueId', userUniqueId, 365);
          setCookie('userFlowerCode', userFlowerCode, 365);
          setCookie('userDateOfBirth', userDateOfBirth, 365);
          setCookie('userProfession', userProfession, 365);
          setCookie('userFullName', userFullName, 365);
          setCookie('isInstalled', 'true', 365);
          
          console.log("localStorage에서 저장된 사용자 데이터 발견:", userData);
          return true;
        } catch (e) {
          console.error("저장된 사용자 데이터 파싱 오류:", e);
          return false;
        }
      }
      return false;
    }

    async function deleteUserAccount() {
      if (!userUniqueId) return false;
      
      try {
        if (!confirm("모든 데이터를 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다.")) {
          return false;
        }
        
        console.log("사용자 계정 삭제:", userUniqueId);
        
        try {
          await firestore.collection('flowerCodes').doc(userUniqueId).delete();
          console.log("flowerCodes 컬렉션에서 데이터 삭제됨");
        } catch (error) {
          console.error("flowerCodes 삭제 중 오류:", error);
        }
        
        try {
          const flowersQuery = await firestore.collection('flowers').where('uniqueId', '==', userUniqueId).get();
          
          const batch = firestore.batch();
          let count = 0;
          
          flowersQuery.forEach((doc) => {
            batch.delete(doc.ref);
            count++;
          });
          
          if (count > 0) {
            await batch.commit();
            console.log(`flowers 컬렉션에서 ${count}개 문서 삭제됨`);
          }
        } catch (error) {
          console.error("flowers 삭제 중 오류:", error);
        }
        
        try {
          const birthdatesRef = database.ref('birthdates');
          const query = birthdatesRef.orderByChild('uniqueId').equalTo(userUniqueId);
          
          query.once('value', (snapshot) => {
            snapshot.forEach((childSnapshot) => {
              birthdatesRef.child(childSnapshot.key).remove();
            });
          });
          
          console.log("실시간 데이터베이스에서 데이터 삭제됨");
        } catch (error) {
          console.error("실시간 데이터베이스에서 삭제 중 오류:", error);
        }
        
        localStorage.removeItem('userFlowerData');
        localStorage.removeItem('isInstalled');
        localStorage.removeItem('flowerSubject');
        localStorage.removeItem('preferredTheme');
        
        removeCookie('userUniqueId');
        removeCookie('userFlowerCode');
        removeCookie('isInstalled');
        removeCookie('userDateOfBirth');
        removeCookie('userProfession');
        removeCookie('userFullName');
        removeCookie('preferredTheme');
        
        userUniqueId = null;
        userFlowerCode = null;
        currentMotivation = null;
        userDateOfBirth = null;
        userProfession = null;
        userFullName = null;
        isInstalled = false;
        seenSubjects = [];
        shareCount = 0;
        
        try {
          if (auth.currentUser) {
            await auth.currentUser.delete();
            console.log("Firebase 사용자 삭제됨");
          }
        } catch (authError) {
          console.error("인증 삭제 중 오류:", authError);
        }
        
        console.log("사용자 계정이 완전히 삭제됨");
        return true;
      } catch (error) {
        console.error("계정 삭제 중 오류:", error);
        return false;
      }
    }
    
    function createWebAppManifest() {
      const manifestData = {
        name: "G-Z 꽃",
        short_name: "G-Z",
        description: "당신만의 생명의 꽃을 발견하세요",
        start_url: window.location.href,
        display: "standalone",
        background_color: "#1A2E4D",
        theme_color: "#1A2E4D",
        icons: [
          {
            src: "https://firebasestorage.googleapis.com/v0/b/genz-abb36.firebasestorage.app/o/IMG_20250723_083736_652.webp?alt=media&token=0919c124-8818-4376-854c-7e95719e6e76",
            sizes: "192x192",
            type: "image/webp"
          },
          {
            src: "https://firebasestorage.googleapis.com/v0/b/genz-abb36.firebasestorage.app/o/IMG_20250723_083736_652.webp?alt=media&token=0919c124-8818-4376-854c-7e95719e6e76",
            sizes: "512x512",
            type: "image/webp"
          }
        ]
      };
      
      const manifestStr = JSON.stringify(manifestData);
      const manifestBlob = new Blob([manifestStr], {type: 'application/json'});
      const manifestURL = URL.createObjectURL(manifestBlob);
      
      const manifestLink = document.getElementById('manifest-placeholder');
      if (manifestLink) {
        manifestLink.setAttribute('href', manifestURL);
        manifestLink.setAttribute('rel', 'manifest');
      } else {
        const link = document.createElement('link');
        link.id = 'manifest-placeholder';
        link.rel = 'manifest';
        link.href = manifestURL;
        document.head.appendChild(link);
      }
    }
    
    function setupInstallPrompt() {
      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        
        const isInstallPromptShownBefore = localStorage.getItem('installPromptShown');
        if (!isInstallPromptShownBefore) {
          setTimeout(() => {
            document.getElementById('installPrompt').style.display = 'block';
          }, 3000);
        }
      });
      
      document.getElementById('installBtn').addEventListener('click', async () => {
        if (!deferredPrompt) {
          window.location.href = "https://g-z.online/install.html";
          return;
        }
        
        deferredPrompt.prompt();
        const choiceResult = await deferredPrompt.userChoice;
        
        if (choiceResult.outcome === 'accepted') {
          console.log('사용자가 설치 프롬프트를 수락함');
        } else {
          console.log('사용자가 설치 프롬프트를 거부함');
        }
        
        deferredPrompt = null;
        document.getElementById('installPrompt').style.display = 'none';
        localStorage.setItem('installPromptShown', 'true');
      });
      
      document.getElementById('dismissBtn').addEventListener('click', () => {
        document.getElementById('installPrompt').style.display = 'none';
        localStorage.setItem('installPromptShown', 'true');
      });
      
      window.addEventListener('appinstalled', (evt) => {
        console.log('앱이 설치됨');
        document.getElementById('installPrompt').style.display = 'none';
      });
    }

    window.addEventListener('load', async () => {
      createWebAppManifest();
      setupInstallPrompt();
      
      const today = new Date();
      const twoYearsAgo = new Date(today.getFullYear() - 5, today.getMonth(), today.getDate());
      document.getElementById('dobInput').max = twoYearsAgo.toISOString().split('T')[0];
      
      const savedTheme = localStorage.getItem('preferredTheme') || getCookie('preferredTheme');
      if (savedTheme) {
        setTheme(savedTheme);
      } else {
        setTheme('green-blue');
      }
      
      if (checkSavedUserData()) {
        console.log("사용자가 이미 데이터를 가지고 있음, 환영 모달 숨김");
        const welcomeToast = document.getElementById('welcomeToast');
        welcomeToast.style.display = 'block';
        setTimeout(() => {
          welcomeToast.style.opacity = '1';
        }, 100);
        setTimeout(() => {
          welcomeToast.style.opacity = '0';
          setTimeout(() => {
            welcomeToast.style.display = 'none';
          }, 500);
        }, 6500);
        
        if (!isAuthenticated) {
          try {
            await authenticateAnonymously();
          } catch (error) {
            console.error("인증 중 오류:", error);
          }
        }
      } else {
        console.log("저장된 사용자 데이터를 찾을 수 없음, 환영 모달 표시");
        const welcomeModal = document.getElementById('welcomeModal');
        welcomeModal.style.display = 'block';
        setTimeout(() => {
          welcomeModal.classList.add('show');
        }, 100);
      }
      
      setupProfessionDropdown();
    });

    function setupProfessionDropdown() {
      const professionInput = document.getElementById('professionInput');
      const professionDropdown = document.getElementById('professionDropdown');
      
      if (!professionInput || !professionDropdown) {
        console.error("직업 드롭다운 요소를 찾을 수 없음");
        return;
      }
      
      function filterProfessions(input) {
        if (!input) return [];
        
        input = input.toLowerCase();
        return professions.filter(profession => 
          profession.toLowerCase().includes(input)
        );
      }
      
      function renderDropdownOptions(filteredProfessions) {
        professionDropdown.innerHTML = '';
        
        if (filteredProfessions.length === 0) {
          const option = document.createElement('div');
          option.className = 'profession-option';
          option.textContent = '일치하는 항목 없음';
          professionDropdown.appendChild(option);
        } else {
          filteredProfessions.forEach(profession => {
            const option = document.createElement('div');
            option.className = 'profession-option';
            option.textContent = profession;
            option.addEventListener('click', () => {
              professionInput.value = profession;
              professionDropdown.style.display = 'none';
            });
            professionDropdown.appendChild(option);
          });
        }
      }
      
      professionInput.addEventListener('input', () => {
        const filtered = filterProfessions(professionInput.value);
        renderDropdownOptions(filtered);
        
        if (filtered.length > 0) {
          professionDropdown.style.display = 'block';
        } else {
          professionDropdown.style.display = 'none';
        }
      });
      
      professionInput.addEventListener('focus', () => {
        if (professionInput.value) {
          const filtered = filterProfessions(professionInput.value);
          renderDropdownOptions(filtered);
          professionDropdown.style.display = 'block';
        }
      });
      
      document.addEventListener('click', (e) => {
        if (!professionInput.contains(e.target) && !professionDropdown.contains(e.target)) {
          professionDropdown.style.display = 'none';
        }
      });
    }

    document.getElementById('flowerButton').addEventListener('click', function() {
      if (!userUniqueId) {
        // 이 부분이 중요합니다 - 계정 생성 모달을 표시합니다
        const welcomeModal = document.getElementById('welcomeModal');
        welcomeModal.style.display = 'block';
        setTimeout(() => {
          welcomeModal.classList.add('show');
        }, 100);
        return;
      }
      
      updateFlowerDisplay();
      const flowerModal = document.getElementById('flowerModal');
      flowerModal.style.display = 'block';
      setTimeout(() => {
        flowerModal.classList.add('show');
      }, 10);
      document.getElementById('shareFlowerButton').style.display = 'flex';
    });

    document.getElementById('shareFlowerButton').addEventListener('click', function() {
      captureFlower();
    });
    
    document.getElementById('showIdButton').addEventListener('click', function() {
      if (userUniqueId) {
        document.getElementById('userIdDisplay').textContent = userUniqueId;
        const idModal = document.getElementById('idModal');
        idModal.style.display = 'block';
        setTimeout(() => {
          idModal.classList.add('show');
        }, 10);
      } else {
        alert("고유 ID를 얻으려면 먼저 꽃 계정을 만드세요.");
      }
    });
    
    document.getElementById('copyIdButton').addEventListener('click', function() {
      const idText = document.getElementById('userIdDisplay').textContent;
      navigator.clipboard.writeText(idText).then(function() {
        alert('ID가 클립보드에 복사되었습니다!');
      }).catch(function() {
        alert('ID를 복사할 수 없습니다. 수동으로 선택하여 복사하세요.');
      });
    });
    
    document.getElementById('closeIdModal').addEventListener('click', function() {
      const idModal = document.getElementById('idModal');
      idModal.classList.remove('show');
      setTimeout(() => {
        idModal.style.display = 'none';
      }, 300);
    });
    
    document.getElementById('deleteAccountButton').addEventListener('click', function() {
      deleteUserAccount().then(success => {
        if (success) {
          alert("계정이 성공적으로 삭제되었습니다. 이 앱을 사용하려면 새 계정을 만들어야 합니다.");
          const idModal = document.getElementById('idModal');
          idModal.classList.remove('show');
          setTimeout(() => {
            idModal.style.display = 'none';
            const welcomeModal = document.getElementById('welcomeModal');
            welcomeModal.style.display = 'block';
            setTimeout(() => {
              welcomeModal.classList.add('show');
            }, 100);
          }, 300);
        } else {
          alert("오류가 발생했습니다. 나중에 다시 시도하세요");
        }
      });
    });
    
    document.getElementById('refreshMotivation').addEventListener('click', function() {
      const newMotivation = generatePersonalizedMotivation(userFlowerCode, userProfession, userDateOfBirth);
      currentMotivation = newMotivation;
      
      const newSubject = getRandomSubject();
      localStorage.setItem('flowerSubject', newSubject);
      
      const formattedName = formatUserName(userFullName);
      
      const flowerCodeElement = document.getElementById('flowerCodeDisplay');
      if (formattedName) {
        flowerCodeElement.innerHTML = `내 꽃 - ${newSubject} / ${formattedName}`;
      } else {
        flowerCodeElement.textContent = "내 꽃 - " + newSubject;
      }
      
      document.getElementById('monthlyMotivation').textContent = newMotivation;
      
      const captureCode = document.getElementById('captureFlowerCode');
      const captureMotivation = document.getElementById('captureFlowerMotivation');
      
      if (captureCode) {
        if (formattedName) {
          captureCode.innerHTML = `내 꽃 - ${newSubject} / ${formattedName}`;
        } else {
          captureCode.textContent = "내 꽃 - " + newSubject;
        }
      }
      
      if (captureMotivation) captureMotivation.textContent = newMotivation;
      
      this.style.transition = 'transform 0.5s ease';
      this.style.transform = 'rotate(360deg)';
      
      setTimeout(() => {
        this.style.transition = 'none';
        this.style.transform = 'rotate(0deg)';
      }, 500);
    });
    
    document.getElementById('createAccountButton').addEventListener('click', async function() {
      const dobInput = document.getElementById('dobInput');
      const professionInput = document.getElementById('professionInput');
      const fullNameInput = document.getElementById('fullNameInput');
      
      if (!fullNameInput.value) {
        alert("전체 이름을 입력하세요.");
        return;
      }
      
      if (!dobInput.value) {
        alert("생년월일을 입력하세요.");
        return;
      }
      
      if (!professionInput.value) {
        alert("직업을 입력하세요.");
        return;
      }
      
      document.getElementById('loadingSpinner').style.display = 'block';
      document.getElementById('createAccountButton').disabled = true;
      
      try {
        await authenticateAnonymously();
        
        userFullName = fullNameInput.value;
        userDateOfBirth = dobInput.value;
        userProfession = professionInput.value;
        
        userUniqueId = generateUniqueId();
        console.log("고유 ID 생성됨:", userUniqueId);
        
        userFlowerCode = generateFlowerCode();
        
        const subject = getRandomSubject();
        localStorage.setItem('flowerSubject', subject);
        
        currentMotivation = generatePersonalizedMotivation(userFlowerCode, userProfession, userDateOfBirth);
        
        const createButton = document.getElementById('createAccountButton');
        createButton.innerHTML = '<i class="fas fa-check"></i> 완료';
        createButton.style.backgroundColor = '#4CAF50';
        
        const userData = {
          date: new Date().toISOString(),
          uid: userUid,
          uniqueId: userUniqueId,
          flowerCode: userFlowerCode,
          motivation: currentMotivation,
          dateOfBirth: userDateOfBirth,
          profession: userProfession,
          fullName: userFullName,
          formattedName: formatUserName(userFullName),
          timestamp: Date.now(),
          theme: currentTheme,
          subject: subject,
          shareCount: 0
        };
        
        localStorage.setItem('userFlowerData', JSON.stringify(userData));
        localStorage.setItem('isInstalled', 'true');
        setCookie('userUniqueId', userUniqueId, 365);
        setCookie('userFlowerCode', userFlowerCode, 365);
        setCookie('userDateOfBirth', userDateOfBirth, 365);
        setCookie('userProfession', userProfession, 365);
        setCookie('userFullName', userFullName, 365);
        setCookie('isInstalled', 'true', 365);
        isInstalled = true;
        
        setTimeout(() => {
          const welcomeModal = document.getElementById('welcomeModal');
          welcomeModal.classList.remove('show');
          
          setTimeout(() => {
            welcomeModal.style.display = 'none';
            document.getElementById('loadingSpinner').style.display = 'none';
            createButton.innerHTML = '계정 만들기';
            createButton.style.backgroundColor = '';
            createButton.disabled = false;
            
            submitToFirebase().then(submitted => {
              console.log("Firebase 제출 결과:", submitted);
              
              const welcomeToast = document.getElementById('welcomeToast');
              welcomeToast.style.display = 'block';
              setTimeout(() => {
                welcomeToast.style.opacity = '1';
              }, 100);
              setTimeout(() => {
                welcomeToast.style.opacity = '0';
                setTimeout(() => {
                  welcomeToast.style.display = 'none';
                }, 500);
              }, 2000);
              
              updateFlowerDisplay();
              const flowerModal = document.getElementById('flowerModal');
              flowerModal.style.display = 'block';
              setTimeout(() => {
                flowerModal.classList.add('show');
              }, 10);
              document.getElementById('shareFlowerButton').style.display = 'flex';
            });
          }, 300);
        }, 2000);
        
        console.log("설정 완료, 데이터가 로컬에 저장되고 쿠키에 저장됨");
      } catch (error) {
        console.error("설정 중 오류:", error);
        document.getElementById('loadingSpinner').style.display = 'none';
        document.getElementById('createAccountButton').disabled = false;
        alert("꽃을 설정하는 중 문제가 발생했습니다. 다시 시도하세요.");
      }
    });
    
    async function captureFlower() {
      try {
        const captureContainer = document.getElementById('flowerCaptureContainer');
        
        updateCaptureStyles(currentTheme);
        
        if (typeof html2canvas !== 'function') {
          console.error("html2canvas가 로드되지 않았거나 함수로 사용할 수 없습니다");
          alert("꽃을 캡처할 수 없습니다. 캡처 라이브러리가 로드되지 않았습니다.");
          return;
        }
        
        let bgColor = 'white';
        if (currentTheme === 'red-black') bgColor = 'black';
        else if (currentTheme === 'green-blue') bgColor = '#1A2E4D';
        else if (currentTheme === 'orange-pink' || currentTheme === 'yellow-purple') bgColor = '#4B0082';
        
        const canvas = await html2canvas(captureContainer, {
          backgroundColor: bgColor,
          scale: 7,
          logging: true,
          useCORS: true,
          allowTaint: true,
          letterRendering: true
        });
        
        const imageUrl = canvas.toDataURL('image/png');
        
        const capturedImage = document.getElementById('capturedImage');
        if (capturedImage) {
          capturedImage.src = imageUrl;
          document.getElementById('capturedFlower').style.display = 'flex';
          document.getElementById('shareWarning').style.display = 'block';
          
          updateShareCount();
        } else {
          console.error("capturedImage 요소를 찾을 수 없습니다");
        }
      } catch (error) {
        console.error('꽃 캡처 중 오류:', error);
        alert('꽃을 캡처할 수 없습니다. 다시 시도하세요.');
      }
    }
    
    document.getElementById('shareCapture').addEventListener('click', function() {
      const imageUrl = document.getElementById('capturedImage').src;
      if (navigator.share) {
        fetch(imageUrl)
          .then(res => res.blob())
          .then(blob => {
            const file = new File([blob], 'my-gz-flower.png', { type: 'image/png' });
            navigator.share({
              title: '내 G-Z 꽃',
              text: 'g-z.online에서 당신만의 꽃을 발견하세요',
              files: [file]
            }).catch(err => {
              console.log('공유 오류:', err);
              fallbackShare();
            });
          })
          .catch(err => {
            console.log('이미지 준비 중 오류:', err);
            fallbackShare();
          });
      } else {
        fallbackShare();
      }
    });
    
    function fallbackShare() {
      try {
        const shareText = `
G-Z에서 내 생명의 꽃을 확인하세요: ${userUniqueId}. g-z.online에서 당신만의 꽃을 발견하세요`;
        
        navigator.clipboard.writeText(shareText).then(function() {
          alert('공유 텍스트가 클립보드에 복사되었습니다!');
        }).catch(function() {
          alert('공유 텍스트를 복사할 수 없습니다.');
        });
      } catch (error) {
        console.error('폴백 공유 오류:', error);
        alert('오류가 발생했습니다.');
      }
    }
    
    document.getElementById('closeCapture').addEventListener('click', function() {
      document.getElementById('capturedFlower').style.display = 'none';
    });
    
    document.getElementById('closeFlowerModal').addEventListener('click', function() {
      const flowerModal = document.getElementById('flowerModal');
      flowerModal.classList.remove('show');
      setTimeout(() => {
        flowerModal.style.display = 'none';
        document.getElementById('shareFlowerButton').style.display = 'none';
      }, 300);
    });

    window.onclick = function(event) {
      const flowerModal = document.getElementById('flowerModal');
      const capturedFlower = document.getElementById('capturedFlower');
      const idModal = document.getElementById('idModal');
      const welcomeModal = document.getElementById('welcomeModal');
      
      if (event.target == flowerModal) {
        flowerModal.classList.remove('show');
        setTimeout(() => {
          flowerModal.style.display = "none";
          document.getElementById('shareFlowerButton').style.display = 'none';
        }, 300);
      }
      
      if (event.target == capturedFlower) {
        capturedFlower.style.display = "none";
      }
      
      if (event.target == idModal) {
        idModal.classList.remove('show');
        setTimeout(() => {
          idModal.style.display = "none";
        }, 300);
      }
      
      if (event.target == welcomeModal && isInstalled) {
        welcomeModal.classList.remove('show');
        setTimeout(() => {
          welcomeModal.style.display = "none";
        }, 300);
      }
    };
    
    document.getElementById('shareFlowerButton').style.display = 'none';
    document.getElementById('shareWarning').style.display = 'none';
    
    document.querySelectorAll('.style-option').forEach(option => {
      option.addEventListener('click', function() {
        const theme = this.dataset.theme;
        setTheme(theme);
      });
    });
  </script>
</body>
