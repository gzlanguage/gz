<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G-Z</title>
    <link rel="icon" href="https://firebasestorage.googleapis.com/v0/b/genz-abb36.firebasestorage.app/o/photo_2025-03-09_13-00-43.jpg?alt=media&token=e3d3c543-164c-4c79-8cd1-0a9c710fb002">
    <link href="https://fonts.googleapis.com/css2?family=Billabong&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: white;
            position: relative;
        }
        header {
            background-color: white;
            padding: 6px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        h1 {
            margin: 0;
            font-size: 1.4em;
            font-family: 'Billabong', cursive;
            color: #007bff;
            border: 2px solid #007bff;
            padding: 4px;
            border-radius: 12px;
        }
        .divider {
            height: 1px;
            background-color: #007bff;
            width: 100%;
            margin-top: 5px;
        }
        .button-container {
            display: flex;
            justify-content: flex-start;
            margin-top: 5px;
            padding: 5px 0;
            overflow-x: auto;
            white-space: nowrap;
        }
        .button {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 5px 10px;
            margin: 0 3px;
            font-size: 0.8em;
            cursor: pointer;
            text-decoration: none;
            display: flex;
            align-items: center;
        }
        .button i {
            margin-right: 2px;
        }
        .button#statisticsButton {
            border-bottom: 1px solid lawngreen;
        }
        .notification {
            text-align: center;
            margin-top: 10px;
            font-size: 0.8em;
            color: #0056b3;
            font-weight: bold;
        }
        .footer-title {
            text-align: center;
            color: black;
            margin-top: 40px;
            font-size: 1.1em;
        }
        .date-input, .country-select, .submit-button {
            display: block;
            width: 330px;
            margin: 19px auto;
            padding: 5px;
            border: 1px solid #007bff;
            border-radius: 11px;
            background-color: white;
            color: black;
            font-size: 1em;
        }
        .submit-button {
            padding: 7px;
            cursor: pointer;
            transition: background-color 0.3s;
            background-color: gray;
            color: white;
        }
        .reset-icon {
            color: #007bff;
            cursor: pointer;
            font-size: 1.0em;
            display: none;
            margin: 10px auto;
            text-align: center;
        }
        .rectangle {
            width: 330px;
            min-height: 30px;
            background-color: #e7f3ff;
            margin: 10px auto;
            border-radius: 40px;
            border: 1px solid #007bff;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 5px;
            text-align: center;
        }
        .text-line {
            font-size: 0.8em;
            color: #0056b3;
            margin: 5px 0;
        }
        .text-line.bold {
            font-weight: bold;
            text-decoration: underline;
        }
        .link {
            color: white;
            text-decoration: none;
            background-color: #007bff;
            border-radius: 5px;
            padding: 8px 12px;
            transition: background-color 0.3s;
        }
        .link:hover {
            background-color: #0056b3;
        }
        .share-icon {
            color: #007bff;
            cursor: pointer;
            font-size: 1.3em;
            border: 1px solid #007bff;
            border-radius: 7px;
            padding: 4px;
            background-color: white;
        }
        footer {
            background-color: white;
            color: black;
            padding: 10px 15px;
        }
        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo-container {
            display: flex;
        }
        .logo {
            color: #007bff;
            font-size: 1.6em;
            margin-right: 10px;
            border: 1px solid #007bff;
            border-radius: 10px;
            padding: 5px;
            background-color: rgba(0, 119, 190, 0.1);
            transition: background-color 0.3s;
        }
        .logo:hover {
            background-color: #007bff;
            color: white;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
        }
        .modal-content {
            background-color: white;
            margin: 29% auto;
            padding: 14px;
            border: 1px solid #007bff;
            border-radius: 60px;
            width: 280px;
            max-width: 70%;
            text-align: center;
            max-height: 60vh;
            overflow-y: auto;
            position: relative;
        }
        .modal-header {
            font-size: 1.8em;
            font-family: 'Billabong', cursive;
            margin-bottom: 10px;
            font-weight: bold;
            color: #007bff;
            text-decoration: underline;
        }
        
        .modal-footer {
            margin-top: 15px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 6px;
        }
        .close-button {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 8px 10px;
            cursor: pointer;
            font-size: 0.9em;
            width: 120px;
            margin: 4px;
        }
        .close-button:hover {
            background-color: #0056b3;
        }
        .gender-category {
            font-weight: bold;
            color: #007bff;
            margin-top: 12px;
            margin-bottom: 5px;
            text-align: center;
            width: 100%;
            font-size: 1em;
        }

        .disabled-field {
            opacity: 0.7;
            pointer-events: none;
        }
        
        @keyframes flowerRotate {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(15deg); }
            50% { transform: rotate(0deg); }
            75% { transform: rotate(-15deg); }
            100% { transform: rotate(0deg); }
        }
        
        .flower-icon {
            display: inline-block;
            animation: flowerRotate 2s infinite ease-in-out;
            color: #ff69b4;
        }
        
        .billabong-title {
            font-family: 'Billabong', cursive;
            font-size: 1.8em;
            margin-bottom: 8px;
            color: #007bff;
        }

        .monthly-motivation {
            margin: 15px 0;
            padding: 10px;
            border: 1px dashed #ff69b4;
            border-radius: 15px;
            background-color: white;
            font-style: italic;
            color: #333;
            font-size: 0.9em;
            line-height: 1.4;
        }
        
        .month-name {
            display: block;
            font-weight: bold;
            color: #ff69b4;
            font-size: 1.1em;
            margin-bottom: 5px;
            text-transform: uppercase;
        }

        .access-code {
            font-size: 1.5em;
            font-weight: bold;
            color: #007bff;
            letter-spacing: 2px;
            margin: 15px 0;
            padding: 10px;
            background-color: #f0f7ff;
            border-radius: 10px;
            border: 1px dashed #007bff;
            display: inline-block;
        }
        
        .copy-icon {
            color: #007bff;
            cursor: pointer;
            margin-left: 10px;
            font-size: 1.2em;
            vertical-align: middle;
        }
        
        .code-message {
            margin: 12px 0;
            font-size: 0.9em;
            color: #333;
            line-height: 1.4;
        }
        
        .copy-confirmation {
            color: green;
            font-size: 0.8em;
            visibility: hidden;
            margin-top: 5px;
        }
        
        .blink {
            animation: blink-animation 1s steps(5, start) infinite;
        }
        
        @keyframes blink-animation {
            to {
                visibility: hidden;
            }
        }
        
        .access-code-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f0f7ff;
            border: 1px solid #007bff;
            border-radius: 12px;
            padding: 4px 8px;
            position: relative;
            cursor: pointer;
        }
        
        .access-code-title {
            font-family: 'Billabong', cursive;
            color: #007bff;
            font-size: 1.0em;
            margin: 0;
        }
        
        .access-code-value {
            font-weight: bold;
            color: #007bff;
            font-size: 0.9em;
            letter-spacing: 1px;
        }
        
        .access-code-indicator {
            color: #777;
            font-size: 0.8em;
            font-style: italic;
        }
        
        .header-controls {
            display: flex;
            align-items: center;
        }
        
        .celebrate-icon {
            font-size: 2em;
            color: gold;
            margin-bottom: 8px;
            animation: celebrate 2s infinite alternate;
        }
        
        @keyframes celebrate {
            0% { transform: scale(1); }
            50% { transform: scale(1.1) rotate(5deg); }
            100% { transform: scale(1) rotate(-5deg); }
        }
        
        .stats-highlight {
            font-weight: bold;
            color: #ff69b4;
            font-size: 1.2em;
        }
        
        .achievement {
            margin: 12px 0;
            padding: 8px;
            border: 1px dashed gold;
            border-radius: 15px;
            background-color: white;
            color: #333;
            font-size: 0.9em;
            line-height: 1.4;
        }
        
        .later-button {
            background-color: #4CAF50;
            color: white;
            border: 1px solid #388E3C;
            border-radius: 12px;
            padding: 8px 10px;
            cursor: pointer;
            font-size: 0.9em;
            margin: 5px auto;
            width: 180px;
        }
        
        .later-button:hover {
            background-color: #388E3C;
        }

        .join-description {
            margin: 10px 0;
            padding: 8px;
            font-size: 0.9em;
            line-height: 1.4;
            color: #333;
            text-align: left;
        }

        .join-highlight {
            color: #007bff;
            font-weight: bold;
        }

        .join-section {
            margin: 5px 0;
            padding: 6px;
            border: 1px dashed #007bff;
            border-radius: 15px;
            background-color: #f0f7ff;
        }

        .join-section-title {
            color: #007bff;
            font-weight: bold;
            font-size: 1em;
            margin-bottom: 2px;
            text-align: center;
        }

        .discord-button {
            display: inline-block;
            background-color: #5865F2;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 10px 15px;
            margin: 3px auto;
            font-size: 1em;
            cursor: pointer;
            text-decoration: none;
            transition: background-color 0.3s;
        }

        .discord-button:hover {
            background-color: #4752C4;
        }

        .discord-icon {
            margin-right: 8px;
        }

        .group-image {
            width: 100%;
            max-width: 200px;
            margin: 10px auto;
            border-radius: 10px;
            border: 1px solid #007bff;
        }
        
        /* Modification pour le modal flower */
        #flowerModal .modal-content {
            margin: 40% auto; /* Descend le modal plus bas */
            padding: 10px; /* Réduit l'espace à l'intérieur */
            max-width: 85%; /* Augmente légèrement la largeur */
        }
        
        #flowerModal .monthly-motivation {
            margin: 10px 0; /* Réduit les marges */
        }
        
        /* Style pour les croix de fermeture des modals */
        .modal-close {
            position: absolute;
            top: 10px;
            right: 20px;
            color: #ff0000;
            font-size: 18px;
            cursor: pointer;
            background-color: transparent;
            border: none;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.2s;
        }
        
        .modal-close:hover {
            background-color: rgba(255, 0, 0, 0.1);
        }
    </style>
</head>
<body>

  <header>
    <h1 translate="no">G-Z</h1>
    <div class="header-controls">
      <div class="access-code-container" id="accessCodeContainer">
        <div class="access-code-title">Access Code</div>
        <div class="access-code-indicator" id="accessCodeIndicator">Submit - to get your code.</div>
        <div class="access-code-value" id="headerAccessCode" style="display: none;"></div>
      </div>
    </div>
  </header>

  <div class="divider"></div>

  <div class="button-container">
    <a class="button" href="Faq.html" translate="yes"><i class="fas fa-question-circle"></i>FAQ</a>
    <a class="button" href="Statistiques.html" id="statisticsButton">
      <i class="fas fa-chart-bar"></i> Discovery</a>
    <a class="button" href="#" id="joinButton"><i class="fab fa-discord"></i>Join</a>
    <a class="button" href="#" id="flowerButton"><i class="fas fa-spa flower-icon"></i>Flower</a>
    <a class="button" href="Contact.html"><i class="fas fa-envelope"></i>Contact</a>
    <a class="button" href="Terms.html"><i class="fas fa-file-contract"></i>Terms</a>
    <a class="button" href="Confidentialité.html"><i class="fas fa-file-contract"></i>Privacy</a>
  </div>
  <script>
    const button = document.getElementById('statisticsButton');
    let colors = ['lawngreen', 'white'];
    let index = 0;
    setInterval(() => {
      button.style.borderBottom = `4px solid ${colors[index]}`;
      index = (index + 1) % colors.length;
    }, 400);
  </script>
  <div class="divider"></div>
  <div class="notification">
    <span class="notification-text">You were not born alone - Discover Your Birthday Twins!
</span>
    <div class="new-message-badge"></div>
  </div>

  <div class="divider"></div>

  <div class="footer-title">
    Join us and uncover the secrets of past, present, and future generations in just a few clicks.

  </div>

  <input type="date" class="date-input" id="birthdate" placeholder="Select your date of birth" min="1900-01-01" max="" />
  <select class="country-select" id="countrySelect">
    <option value="" disabled selected>Select your country of birth</option>
  </select>
  <p style="text-align: center; color: black; font-size: 0.7em; margin-top: 5px; text-decoration: underline; text-decoration-color: rgb(0, 123, 191);">
    By submitting, you accept our terms of use.
  </p>
  <button class="submit-button" type="submit">Submit</button>

  <i class="fas fa-redo reset-icon" id="resetButton" title="Reset"></i>

  <div class="divider"></div>

  <div class="rectangle">
    <div class="text-line bold" style="font-size: 1em; color: #0056b3;">How does it work?</div>
    <div class="text-line"> Two selectors are available to you: the first is a calendar to choose your date of birth, and the second is a selector for your country of birth. Once your selections are made, click on "Submit". After that, you will be asked to specify your gender; click on this option to become a contributor. Finally, click on the "Discovery" button, which flashes green. You will then discover two new selectors: navigate according to your preferences to explore the statistics. </div>
  </div>

  <div class="text-line" style="text-align: center; color: black;">
    <span style="color: #007bff;">_____</span> Don't miss anything <span style="color: #007bff;">_____</span>
  </div>

  <footer>
    <div class="footer-content">
      <div class="logo-container">
        <a href="https://www.facebook.com/share/15nGTcCb4i/.html" target="_blank" class="logo">
          <i class="fab fa-facebook-f"></i>
        </a>
        <a href="https://x.com/GZWRD?t=g7yvHCDW2-xPLaTTgea-YA&s=09.html" target="_blank" class="logo">
          <i class="fab fa-twitter"></i>
        </a>
        <a href="https://www.instagram.com/gzw0orld?igsh=a3M3aWpob21qcmFn.html" target="_blank" class="logo">
          <i class="fab fa-instagram"></i>
        </a>
        <a href="https://discord.gg/GzReBm48XK" target="_blank" class="logo">
          <i class="fab fa-discord"></i>
        </a>
      </div>
      <div class="copyright">
        ©️ 2025 G-Z
      </div>
    </div>
  </footer>

  <div id="genderModal" class="modal">
    <div class="modal-content">
      <button class="modal-close" id="closeGenderModal"><i class="fas fa-times"></i></button>
      <div class="billabong-title"><strong>Your gender?</strong></div>
      
      <div class="gender-category">Binary genders</div>
      <div class="modal-footer">
        <button class="close-button gender-option" value="Man">Man</button>
        <button class="close-button gender-option" value="Woman">Woman</button>
      </div>
      
      <div class="gender-category">Non-binary genders</div>
      <div class="modal-footer">
        <button class="close-button gender-option" value="Non-binary">Non-binary</button>
        <button class="close-button gender-option" value="Genderqueer">Genderqueer</button>
        <button class="close-button gender-option" value="Genderfluid">Genderfluid</button>
        <button class="close-button gender-option" value="Agender">Agender</button>
      </div>
      
      <div class="gender-category">Other gender identities</div>
      <div class="modal-footer">
        <button class="close-button gender-option" value="Transgender">Transgender</button>
        <button class="close-button gender-option" value="Two-Spirit">Two-Spirit</button>
        <button class="close-button gender-option" value="Bigender">Bigender</button>
        <button class="close-button gender-option" value="Androgyne">Androgyne</button>
      </div>
    </div>
  </div>

  <div id="flowerModal" class="modal">
    <div class="modal-content">
      <button class="modal-close" id="closeFlowerModal"><i class="fas fa-times"></i></button>
      <div class="billabong-title"><strong>Flower of Life</strong></div>
      
      <div class="monthly-motivation" id="monthlyMotivation"></div>
      
      <div style="margin: 10px auto; font-size: 3em; color: #ff69b4;">
        <i class="fas fa-spa"></i>
      </div>
    </div>
  </div>
  
  <div id="joinModal" class="modal">
    <div class="modal-content">
      <button class="modal-close" id="closeJoinModal"><i class="fas fa-times"></i></button>
      <div class="billabong-title"><strong>G-Z Community</strong></div>
      
      <div class="join-description">
        <div class="join-section">
          <div class="join-section-title">Birthday Connections</div>
          <p style="margin: 2px 0;">Discover people born on the same day as you. A space where you'll meet your birthday twins and form unique connections based on shared birth dates.</p>
        </div>
        
        <div class="join-section">
          <div class="join-section-title">Team Spirit</div>
          <p style="margin: 2px 0;">Each birth date represents a group in our community. You'll join forces with your birthday twins to compete in exciting team challenges against other birth date groups.</p>
        </div>
        
        <div class="join-section">
          <div class="join-section-title">More Than Fun</div>
          <p style="margin: 2px 0;">Beyond entertainment, G-Z offers educational content, community events, and the chance to win prizes in our group competitions.</p>
        </div>
      </div>
      
      <div style="margin: 5px auto; text-align: center;">
        <a href="https://discord.gg/GzReBm48XK" target="_blank" class="discord-button">
          <i class="fab fa-discord discord-icon"></i>Join G-Z on Discord
        </a>
      </div>
    </div>
  </div>
  
  <div id="accessCodeModal" class="modal">
    <div class="modal-content">
      <button class="modal-close" id="closeAccessCodeModal"><i class="fas fa-times"></i></button>
      <div class="billabong-title"><strong>Congratulations!</strong></div>
      
      <div class="celebrate-icon">
        <i class="fas fa-trophy"></i>
      </div>
      
      <div class="achievement" id="birthdayStats">
        <p>Your birthday already has <span class="stats-highlight" id="birthdayMembersCount">0</span> members!</p>
        <p>You are currently the <span class="stats-highlight" id="birthdayRanking">0th</span> person born on <span id="birthdayDate">your day</span> to join our community! This ranking may change as more people join.</p>
      </div>
      
      <div class="achievement" id="countryStats">
        <p>You join <span class="stats-highlight" id="countryMembersCount">0</span> other members from <span id="countryName">your country</span>!</p>
      </div>
      
      <div class="code-message">
        Your unique access code has been saved in the header. Click on it anytime to copy.
      </div>
      
      <button class="later-button" id="laterButton">
        Continue to Discovery
      </button>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
    import { getDatabase, ref, push, remove, get, set, onValue, update, query, orderByChild, equalTo } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js";
    import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCrPKQOqw4zciASa_5PbI_etfkvrBaDPDI",
      authDomain: "genz-abb36.firebaseapp.com",
      databaseURL: "https://genz-abb36-default-rtdb.firebaseio.com",
      projectId: "genz-abb36",
      storageBucket: "genz-abb36.firebasestorage.app",
      messagingSenderId: "405021535683",
      appId: "1:405021535683:web:ee5a28fde27f5558046176",
      measurementId: "G-XZNQND2J00"
    };
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
    const auth = getAuth(app);
    
    let userBirthdate = null;
    let userCountry = null;
    let userGender = null;
    let dataSubmitted = false;
    let userBirthdayDay = null;
    let userBirthdayMonth = null;
    let lastSubmittedId = null;
    let userUid = null;
    let userAccessCode = null;
    let userBirthdayStats = {
      totalMembers: 0,
      userRank: 0,
      formattedDate: ""
    };
    let userCountryStats = {
      totalMembers: 0
    };

    // Motivations spécifiques pour chaque mois
    const monthlyMotivations = {
      1: { // Janvier
        name: "JANUARY",
        ranges: [
          { range: [1, 5], message: "Early January births bring remarkable determination. Your discipline helps you pursue goals when others give up. This year, channel your natural structure-building skills to create something lasting." },
          { range: [6, 10], message: "Mid-early January child, you blend ambition with practicality. Your ability to see long-term consequences guides your decisions wisely. Trust your instincts when planning your next big move." },
          { range: [11, 15], message: "Mid-January births carry innate leadership energy. People naturally look to you in challenging times. Your composed strength becomes a lighthouse for those feeling lost." },
          { range: [16, 20], message: "Your mid-late January birth gives you rare perseverance. What others see as obstacles, you view as character-building stepping stones. This resilience is your superpower." },
          { range: [21, 25], message: "Late January births bring innovative thinking with practical application. You see possibilities others miss while knowing how to bring them into reality. Time to create something new." },
          { range: [26, 31], message: "Born in January's final days, you possess both independence and community spirit. Your ability to stand apart while still connecting deeply with others creates unique bridges between worlds." }
        ]
      },
      2: { // Février
        name: "FEBRUARY",
        ranges: [
          { range: [1, 5], message: "Early February children embody visionary thinking. You naturally see future possibilities that remain invisible to others. Trust those intuitive flashes of insight coming to you now." },
          { range: [6, 10], message: "Mid-early February births carry a humanitarian spirit. Your natural empathy extends beyond personal connections to larger social concerns. Your compassion creates genuine change." },
          { range: [11, 15], message: "Mid-February births blend idealism with practicality beautifully. You dream big while building solid foundations. This rare combination helps manifest your visions in tangible ways." },
          { range: [16, 20], message: "Your mid-late February birth gives you emotional intelligence and intuitive wisdom. You understand nuances of human behavior that others miss completely. This gift serves as your compass." },
          { range: [21, 25], message: "Late February births bring progressive thinking and avant-garde perspectives. You're comfortable challenging outdated systems and proposing fresh alternatives. Your innovative spirit is needed now." },
          { range: [26, 29], message: "Born in February's rarest days, you possess uncommon perception and adaptability. Like the leap year that sometimes contains your birth date, you bring extra magic to ordinary situations." }
        ]
      },
      3: { // Mars
        name: "MARCH",
        ranges: [
          { range: [1, 5], message: "Early March births carry pioneering energy and courage. You naturally lead the way into uncharted territory, inspiring others to follow. This boldness serves you especially well during times of uncertainty." },
          { range: [6, 10], message: "Mid-early March children blend intuition with action. You sense the right path forward and move decisively. Trust your inner knowing - it rarely steers you wrong." },
          { range: [11, 15], message: "Mid-March births bring compassionate leadership. You inspire others not through force but through genuine understanding and connection. Your gentle strength moves mountains." },
          { range: [16, 20], message: "Your mid-late March birth gives you creative problem-solving abilities. Where others see dead ends, you find hidden doorways. This imaginative thinking is your special gift to the world." },
          { range: [21, 25], message: "Late March births carry powerful initiating energy. You excel at starting projects and inspiring fresh beginnings. Your enthusiasm ignites passion in those around you." },
          { range: [26, 31], message: "Born in March's final days, you possess dynamic energy paired with thoughtful strategy. This combination allows you to make bold moves without recklessness - a rare and valuable balance." }
        ]
      },
      4: { // Avril
        name: "APRIL",
        ranges: [
          { range: [1, 5], message: "Early April births bring determined energy and natural leadership. You possess the rare ability to take charge without dominating. People follow your lead because they sense your authentic strength." },
          { range: [6, 10], message: "Mid-early April children blend passion with practicality. Your fiery enthusiasm is grounded in real-world wisdom, making your ideas both exciting and achievable. This balance is your superpower." },
          { range: [11, 15], message: "Mid-April births carry strategic brilliance. You see several moves ahead in life's complex game, anticipating obstacles before they arise. Trust your forward-thinking mind." },
          { range: [16, 20], message: "Your mid-late April birth gives you tenacious energy wrapped in charm. You persist through challenges with a grace that inspires others. This resilient optimism carries you through any storm." },
          { range: [21, 25], message: "Late April births bring steady determination with flashes of inspiration. Like the spring season itself, you blend dependable growth with surprising bursts of beauty. Your path unfolds with perfect timing." },
          { range: [26, 30], message: "Born in April's final days, you possess both strength and sensitivity in equal measure. This rare combination allows you to pursue goals forcefully while remaining attuned to others' needs." }
        ]
      },
      5: { // Mai
        name: "MAY",
        ranges: [
          { range: [1, 5], message: "Early May births bring grounded determination and practical magic. You transform abstract ideas into tangible realities through patient, consistent effort. Your persistence creates lasting beauty." },
          { range: [6, 10], message: "Mid-early May children blend sensory awareness with intellectual clarity. You notice subtle details others miss while seeing the bigger picture. This rare combination gives you unique creative vision." },
          { range: [11, 15], message: "Mid-May births carry natural diplomatic skills. You find common ground between opposing viewpoints with remarkable ease. Your harmonizing presence heals divisions in any group." },
          { range: [16, 20], message: "Your mid-late May birth gives you steady determination with flashes of brilliant insight. Like a lightning bolt illuminating solid earth, you combine stability with inspiration uniquely." },
          { range: [21, 25], message: "Late May births bring adaptable intelligence and quick understanding. You process new information rapidly and adjust your course accordingly. This mental agility is your special advantage." },
          { range: [26, 31], message: "Born in May's final days, you possess both practical wisdom and visionary thinking. You build solid foundations while keeping your eyes on distant horizons - a powerful combination for creating lasting change." }
        ]
      },
      6: { // Juin
        name: "JUNE",
        ranges: [
          { range: [1, 5], message: "Early June births bring remarkable communication skills and mental flexibility. Your thoughts move like quicksilver, connecting ideas others see as unrelated. This versatile thinking creates innovative solutions." },
          { range: [6, 10], message: "Mid-early June children blend curiosity with empathy. You seek understanding while genuinely caring about others' experiences. This combination makes you both a brilliant learner and compassionate friend." },
          { range: [11, 15], message: "Mid-June births carry natural diplomatic abilities. You express difficult truths with such grace that others can actually hear them. Your words build bridges rather than walls." },
          { range: [16, 20], message: "Your mid-late June birth gives you analytical precision with intuitive flashes. You gather detailed information methodically, then suddenly see the perfect pattern. Trust these moments of clarity." },
          { range: [21, 25], message: "Late June births bring emotional intelligence with practical application. You understand complex feelings while knowing how to navigate them productively. This wisdom creates harmony in challenging situations." },
          { range: [26, 30], message: "Born in June's final days, you possess both nurturing energy and protective strength. Like the summer that begins with your birth, you bring warmth that helps others flourish and grow." }
        ]
      },
      7: { // Juillet
        name: "JULY",
        ranges: [
          { range: [1, 5], message: "Early July births bring intuitive understanding and protective instincts. You create safe harbors for those you care about during turbulent times. Your nurturing strength is a precious gift." },
          { range: [6, 10], message: "Mid-early July children blend emotional depth with creative expression. Your feelings run deep, and you transform them into art, words, or actions that touch others profoundly." },
          { range: [11, 15], message: "Mid-July births carry tenacious loyalty and surprising strength. Your gentle exterior conceals an unshakable core that stands firm when everything else seems unstable." },
          { range: [16, 20], message: "Your mid-late July birth gives you nurturing wisdom with clear boundaries. You care deeply while maintaining healthy limits - a powerful combination that creates genuine support without depletion." },
          { range: [21, 25], message: "Late July births bring charismatic leadership with emotional authenticity. You inspire others not by hiding vulnerabilities but by integrating them into your strength. This wholeness draws people to you." },
          { range: [26, 31], message: "Born in July's final days, you possess both fiery passion and tender care. Like the summer heat that nurtures growing things, your intensity creates beauty and abundance around you." }
        ]
      },
      8: { // Août
        name: "AUGUST",
        ranges: [
          { range: [1, 5], message: "Early August births bring natural leadership and radiant confidence. Like the summer sun at its peak, your presence illuminates rooms and inspires others to shine their own light more brightly." },
          { range: [6, 10], message: "Mid-early August children blend generosity with discernment. You give freely while wisely recognizing where your gifts will create the most positive impact. This balanced approach multiplies your influence." },
          { range: [11, 15], message: "Mid-August births carry organizational genius with creative flair. You bring order to chaos without sacrificing the spontaneity that makes life vibrant. This rare combination produces magnificent results." },
          { range: [16, 20], message: "Your mid-late August birth gives you dramatic presence with authentic emotion. You express yourself powerfully while remaining genuinely connected to your truth. This integrity magnifies your impact." },
          { range: [21, 25], message: "Late August births bring analytical precision with warm encouragement. You see exactly what needs improvement while providing the supportive environment necessary for growth." },
          { range: [26, 31], message: "Born in August's final days, you possess both practical wisdom and charismatic expression. Your advice resonates because it combines solid sense with compelling delivery - a powerful gift for inspiring change." }
        ]
      },
      9: { // Septembre
        name: "SEPTEMBER",
        ranges: [
          { range: [1, 5], message: "Early September births bring methodical excellence and attention to detail. You create systems that function beautifully while noticing nuances others miss completely. This precision is your unique strength." },
          { range: [6, 10], message: "Mid-early September children blend analytical thinking with aesthetic sensitivity. You appreciate fine distinctions in both logical structures and sensory experiences. This combination creates discerning wisdom." },
          { range: [11, 15], message: "Mid-September births carry problem-solving abilities that seem almost magical. You break complex challenges into manageable pieces, finding elegant solutions that others overlook." },
          { range: [16, 20], message: "Your mid-late September birth gives you balanced judgment with practical application. You weigh options thoroughly, then implement your decisions with efficient skill. This process creates reliable results." },
          { range: [21, 25], message: "Late September births bring harmonizing energy and diplomatic skill. You find the balanced center between opposing forces, creating cooperation where conflict seemed inevitable." },
          { range: [26, 30], message: "Born in September's final days, you possess both critical thinking and empathetic understanding. This rare combination allows you to improve situations while honoring the people involved - true wisdom in action." }
        ]
      },
      10: { // Octobre
        name: "OCTOBER",
        ranges: [
          { range: [1, 5], message: "Early October births bring diplomatic skill with unwavering principles. You navigate social complexities gracefully while maintaining your inner compass. This integrity wrapped in charm creates trustworthy leadership." },
          { range: [6, 10], message: "Mid-early October children blend justice-seeking with aesthetic appreciation. You strive for fairness while creating beauty in your environment. This combination elevates both your surroundings and relationships." },
          { range: [11, 15], message: "Mid-October births carry strategic vision with emotional intelligence. You plan several moves ahead while remaining attuned to the human element. This balanced approach creates sustainable success." },
          { range: [16, 20], message: "Your mid-late October birth gives you transformative power and regenerative abilities. You thrive through changes that overwhelm others, emerging stronger after challenges. This resilience is your superpower." },
          { range: [21, 25], message: "Late October births bring penetrating insight with compassionate understanding. You see beneath surface appearances to hidden truths, yet hold this knowledge with kindness rather than judgment." },
          { range: [26, 31], message: "Born in October's final days, you possess both mysterious depth and practical resourcefulness. Like the autumn season itself, you combine harvest wisdom with preparation for deeper transformations ahead." }
        ]
      },
      11: { // Novembre
        name: "NOVEMBER",
        ranges: [
          { range: [1, 5], message: "Early November births bring penetrating insight with transformative power. You see through surface illusions to core truths, using this clarity to create profound positive change in yourself and others." },
          { range: [6, 10], message: "Mid-early November children blend passionate intensity with emotional courage. You dive into life's depths where others merely wade in the shallows. This bravery reveals treasures others never discover." },
          { range: [11, 15], message: "Mid-November births carry regenerative abilities and phoenix energy. You transform difficulties into opportunities, repeatedly rising from challenges with greater wisdom and strength." },
          { range: [16, 20], message: "Your mid-late November birth gives you investigative intelligence with intuitive flashes. You gather information methodically, then suddenly perceive the hidden pattern. Trust these moments of revelation." },
          { range: [21, 25], message: "Late November births bring expansive vision with practical application. You see possibilities beyond conventional horizons while knowing how to manifest them in the real world." },
          { range: [26, 30], message: "Born in November's final days, you possess both philosophical depth and playful spirit. This rare combination allows you to explore life's profound questions without becoming heavy or overly serious." }
        ]
      },
      12: { // Décembre
        name: "DECEMBER",
        ranges: [
          { range: [1, 5], message: "Early December births bring adventurous spirit with philosophical wisdom. You explore new territories physically and intellectually, finding meaning in diverse experiences. Your open-minded approach reveals hidden connections." },
          { range: [6, 10], message: "Mid-early December children blend optimistic vision with honest assessment. You see magnificent possibilities while remaining grounded in reality. This balanced perspective creates achievable dreams." },
          { range: [11, 15], message: "Mid-December births carry inspirational energy that lifts others' spirits. Your natural enthusiasm ignites hope in those feeling discouraged. This gift of positive motivation is especially valuable during challenging times." },
          { range: [16, 20], message: "Your mid-late December birth gives you focused determination with strategic thinking. You set ambitious goals and systematically accomplish them through persistent, intelligent effort. This disciplined approach brings impressive results." },
          { range: [21, 25], message: "Late December births bring visionary thinking with practical action. You transform abstract concepts into tangible realities through methodical implementation. Your ideas actually materialize in the world." },
          { range: [26, 31], message: "Born in December's final days, you possess both reflective wisdom and forward vision. Standing at the year's threshold, you naturally understand endings and beginnings, helping others navigate transitions with grace." }
        ]
      }
    };

    const monthNames = [
      "January", "February", "March", "April", "May", "June",
      "July", "August", "September", "October", "November", "December"
    ];

    function generateAccessCode() {
      const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
      let code = '';
      for (let i = 0; i < 6; i++) {
        const randomIndex = Math.floor(Math.random() * characters.length);
        code += characters.charAt(randomIndex);
      }
      return code;
    }

    function updateMotivationByBirthMonth() {
      if (!userBirthdayMonth || !userBirthdayDay) return;
      
      const motivationElement = document.getElementById('monthlyMotivation');
      const monthData = monthlyMotivations[userBirthdayMonth];
      
      if (monthData) {
        // Trouver la bonne tranche de jours
        let message = "Your birth month holds special power. Embrace your unique path.";
        
        for (const rangeData of monthData.ranges) {
          const [min, max] = rangeData.range;
          if (userBirthdayDay >= min && userBirthdayDay <= max) {
            message = rangeData.message;
            break;
          }
        }
        
        motivationElement.innerHTML = `
          <span class="month-name">${monthData.name} (${userBirthdayDay})</span>
          ${message}
        `;
      } else {
        motivationElement.innerHTML = `
          <span class="month-name">YOUR JOURNEY</span>
          Submit your date of birth to see your personalized motivation.
        `;
      }
    }

    function setCookie(name, value, days) {
      let expires = "";
      if (days) {
        const date = new Date();
        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
        expires = "; expires=" + date.toUTCString();
      }
      document.cookie = name + "=" + (value || "") + expires + "; path=/";
    }

    function getCookie(name) {
      const nameEQ = name + "=";
      const ca = document.cookie.split(';');
      for (let i = 0; i < ca.length; i++) {
        let c = ca[i];
        while (c.charAt(0) === ' ') c = c.substring(1, c.length);
        if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
      }
      return null;
    }

    function eraseCookie(name) {
      document.cookie = name + '=; Max-Age=-99999999; path=/';
    }

    function checkCookieConsent() {
      const cookiesAccepted = getCookie('cookiesAccepted');
      if (!cookiesAccepted) {
        setCookie('cookiesAccepted', 'true', 365);
      }
    }

    signInAnonymously(auth)
      .then((userCredential) => {
        const user = userCredential.user;
        userUid = user.uid;
        console.log("User connected: ", userUid);
      })
      .catch((error) => {
        console.error("Error during anonymous connection: ", error);
        
        userUid = "local_" + Date.now().toString(36) + Math.random().toString(36).substring(2);
      });

    // Définir la date maximale comme aujourd'hui
    const today = new Date();
    const todayString = today.toISOString().split("T")[0];
    document.getElementById("birthdate").setAttribute('max', todayString);

    // Fonction pour vérifier si la date est dans le futur
    function isFutureDate(dateString) {
      const selectedDate = new Date(dateString);
      selectedDate.setHours(0, 0, 0, 0); // Réinitialiser les heures pour comparer uniquement les dates
      
      const currentDate = new Date();
      currentDate.setHours(0, 0, 0, 0);
      
      return selectedDate > currentDate;
    }

    // Ajouter un événement pour vérifier la date à chaque changement
    document.getElementById("birthdate").addEventListener('change', function(e) {
      if (isFutureDate(this.value)) {
        alert("You cannot select a future date for your date of birth");
        this.value = ""; // Réinitialiser la valeur
      }
    });

    // Ajouter un événement pour vérifier la date avant la soumission
    document.querySelector('.submit-button').addEventListener('click', function(e) {
      const birthdate = document.getElementById('birthdate').value;
      if (isFutureDate(birthdate)) {
        e.preventDefault();
        alert("You cannot select a future date for your date of birth");
        document.getElementById('birthdate').value = "";
        return false;
      }
    });

    // Utiliser l'API pour charger les pays
    fetch('https://restcountries.com/v3.1/all')
      .then(response => {
        if (!response.ok) {
          throw new Error('Network error: ' + response.status);
        }
        return response.json();
      })
      .then(data => {
        // Trier les pays par ordre alphabétique
        data.sort((a, b) => a.name.common.localeCompare(b.name.common));
        
        const countrySelect = document.getElementById('countrySelect');
        countrySelect.innerHTML = '<option value="" disabled selected>Select your country of birth</option>';
        
        // Ajouter tous les pays de l'API au sélecteur
        data.forEach(country => {
          const option = document.createElement('option');
          option.value = country.name.common;
          option.textContent = country.name.common;
          countrySelect.appendChild(option);
        });
        
        loadUserDataFromCookie();
      })
      .catch(error => {
        console.error('Error loading countries from API:', error);
        
        // En cas d'échec de l'API, utiliser une liste de secours
        const fallbackCountries = [
          "Afghanistan", "Albania", "Algeria", "Andorra", "Angola", "Antigua and Barbuda", "Argentina", "Armenia", "Australia", "Austria", 
          "Azerbaijan", "Bahamas", "Bahrain", "Bangladesh", "Barbados", "Belarus", "Belgium", "Belize", "Benin", "Bhutan", 
          "Bolivia", "Bosnia and Herzegovina", "Botswana", "Brazil", "Brunei", "Bulgaria", "Burkina Faso", "Burundi", "Cabo Verde", "Cambodia", 
          "Cameroon", "Canada", "Central African Republic", "Chad", "Chile", "China", "Colombia", "Comoros", "Congo", "Costa Rica", 
          "Croatia", "Cuba", "Cyprus", "Czech Republic", "Denmark", "Djibouti", "Dominica", "Dominican Republic", "Ecuador", "Egypt", 
          "El Salvador", "Equatorial Guinea", "Eritrea", "Estonia", "Eswatini", "Ethiopia", "Fiji", "Finland", "France", "Gabon", 
          "Gambia", "Georgia", "Germany", "Ghana", "Greece", "Grenada", "Guatemala", "Guinea", "Guinea-Bissau", "Guyana", 
          "Haiti", "Honduras", "Hungary", "Iceland", "India", "Indonesia", "Iran", "Iraq", "Ireland", "Israel", 
          "Italy", "Jamaica", "Japan", "Jordan", "Kazakhstan", "Kenya", "Kiribati", "Korea, North", "Korea, South", "Kosovo", 
          "Kuwait", "Kyrgyzstan", "Laos", "Latvia", "Lebanon", "Lesotho", "Liberia", "Libya", "Liechtenstein", "Lithuania", 
          "Luxembourg", "Madagascar", "Malawi", "Malaysia", "Maldives", "Mali", "Malta", "Marshall Islands", "Mauritania", "Mauritius", 
          "Mexico", "Micronesia", "Moldova", "Monaco", "Mongolia", "Montenegro", "Morocco", "Mozambique", "Myanmar", "Namibia", 
          "Nauru", "Nepal", "Netherlands", "New Zealand", "Nicaragua", "Niger", "Nigeria", "North Macedonia", "Norway", "Oman", 
          "Pakistan", "Palau", "Palestine", "Panama", "Papua New Guinea", "Paraguay", "Peru", "Philippines", "Poland", "Portugal", 
          "Qatar", "Romania", "Russia", "Rwanda", "Saint Kitts and Nevis", "Saint Lucia", "Saint Vincent and the Grenadines", "Samoa", "San Marino", "Sao Tome and Principe", 
          "Saudi Arabia", "Senegal", "Serbia", "Seychelles", "Sierra Leone", "Singapore", "Slovakia", "Slovenia", "Solomon Islands", "Somalia", 
          "South Africa", "South Sudan", "Spain", "Sri Lanka", "Sudan", "Suriname", "Sweden", "Switzerland", "Syria", "Taiwan", 
          "Tajikistan", "Tanzania", "Thailand", "Timor-Leste", "Togo", "Tonga", "Trinidad and Tobago", "Tunisia", "Turkey", "Turkmenistan", 
          "Tuvalu", "Uganda", "Ukraine", "United Arab Emirates", "United Kingdom", "United States", "Uruguay", "Uzbekistan", "Vanuatu", "Vatican City", 
          "Venezuela", "Vietnam", "Yemen", "Zambia", "Zimbabwe"
        ].sort();
        
        const countrySelect = document.getElementById('countrySelect');
        countrySelect.innerHTML = '<option value="" disabled selected>Select your country of birth</option>';
        
        fallbackCountries.forEach(country => {
          const option = document.createElement('option');
          option.value = country;
          option.textContent = country;
          countrySelect.appendChild(option);
        });
        
        loadUserDataFromCookie();
      });

    function saveUserDataToCookie() {
      if (userBirthdate && userCountry && userGender) {
        const userData = {
          birthdate: userBirthdate,
          country: userCountry,
          gender: userGender,
          birthdayDay: userBirthdayDay,
          birthdayMonth: userBirthdayMonth,
          dataSubmitted: true,
          lastSubmittedId: lastSubmittedId,
          accessCode: userAccessCode,
          birthdayStats: userBirthdayStats,
          countryStats: userCountryStats
        };
        setCookie('userData', JSON.stringify(userData), 365);
      }
    }

    function updateHeaderAccessCode() {
      if (userAccessCode) {
        document.getElementById('accessCodeIndicator').style.display = 'none';
        document.getElementById('headerAccessCode').style.display = 'block';
        document.getElementById('headerAccessCode').textContent = userAccessCode;
      } else {
        document.getElementById('accessCodeIndicator').style.display = 'block';
        document.getElementById('headerAccessCode').style.display = 'none';
      }
    }

    function loadUserDataFromCookie() {
      const userDataCookie = getCookie('userData');
      if (userDataCookie) {
        try {
          const userData = JSON.parse(userDataCookie);
          userBirthdate = userData.birthdate;
          userCountry = userData.country;
          userGender = userData.gender;
          userBirthdayDay = userData.birthdayDay;
          userBirthdayMonth = userData.birthdayMonth;
          dataSubmitted = userData.dataSubmitted;
          lastSubmittedId = userData.lastSubmittedId;
          userAccessCode = userData.accessCode;
          
          if (userData.birthdayStats) {
            userBirthdayStats = userData.birthdayStats;
          }
          
          if (userData.countryStats) {
            userCountryStats = userData.countryStats;
          }
          
          if (dataSubmitted) {
            document.getElementById('birthdate').value = userBirthdate;
            document.getElementById('countrySelect').value = userCountry;
            
            const submitButton = document.querySelector('.submit-button');
            submitButton.textContent = "Submitted";
            submitButton.style.backgroundColor = 'green';
            submitButton.disabled = true;
            
            document.getElementById('resetButton').style.display = "block";
            
            document.getElementById('birthdate').classList.add('disabled-field');
            document.getElementById('countrySelect').classList.add('disabled-field');
            
            updateHeaderAccessCode();
          }
        } catch (error) {
          console.error("Error parsing user data from cookie:", error);
        }
      }
    }

    document.querySelector('.submit-button').addEventListener('click', function() {
      const birthdate = document.getElementById('birthdate').value;
      const country = document.getElementById('countrySelect').value;

      if (birthdate && country) {
        // Vérification supplémentaire pour les dates futures
        if (isFutureDate(birthdate)) {
          alert("You cannot select a future date for your date of birth");
          document.getElementById('birthdate').value = "";
          return;
        }
        
        userBirthdate = birthdate;
        userCountry = country;
        
        const birthdateParts = birthdate.split('-');
        userBirthdayDay = parseInt(birthdateParts[2]);
        userBirthdayMonth = parseInt(birthdateParts[1]);
        
        const submitButton = document.querySelector('.submit-button');
        submitButton.textContent = "Please wait...";
        submitButton.style.backgroundColor = 'orange';

        document.getElementById('birthdate').classList.add('disabled-field');
        document.getElementById('countrySelect').classList.add('disabled-field');

        document.getElementById('genderModal').style.display = 'block';
      } else {
        alert("Please enter a date of birth and select a country!");
      }
    });

    document.querySelectorAll('.gender-option').forEach(button => {
      button.addEventListener('click', function() {
        userGender = this.value;
        
        userAccessCode = generateAccessCode();
        
        submitData(this.value);
      });
    });

    async function fetchBirthdayStatistics() {
      try {
        // Format month and day for querying
        const monthStr = userBirthdayMonth.toString().padStart(2, '0');
        const dayStr = userBirthdayDay.toString().padStart(2, '0');
        const birthdayPattern = `-${monthStr}-${dayStr}`;
        
        // Query the database for entries with the same birth day and month
        const birthdatesRef = ref(database, 'birthdates');
        const birthdatesSnapshot = await get(birthdatesRef);
        
        let sameBirthdayCount = 0;
        let userRank = 0;
        let earlierSubmissions = 0;
        let isCurrentUserCounted = false;
        
        if (birthdatesSnapshot.exists()) {
          const data = birthdatesSnapshot.val();
          
          // Convert the object to an array and sort by timestamp
          const entries = Object.entries(data)
            .map(([key, value]) => ({ key, ...value }))
            .filter(entry => entry.date && entry.date.includes(birthdayPattern))
            .sort((a, b) => a.timestamp - b.timestamp);
          
          sameBirthdayCount = entries.length;
          
          // Find user's rank
          for (let i = 0; i < entries.length; i++) {
            if (entries[i].key === lastSubmittedId || (entries[i].uid === userUid && !isCurrentUserCounted)) {
              userRank = i + 1;
              isCurrentUserCounted = true;
            }
          }
        }
        
        // If we couldn't find the user in the sorted list, default to last+1
        if (userRank === 0) {
          userRank = sameBirthdayCount;
        }
        
        // Format the date for display
        const date = new Date(userBirthdate);
        const formattedDate = `${monthNames[userBirthdayMonth-1]} ${userBirthdayDay}`;
        
        return {
          totalMembers: sameBirthdayCount,
          userRank: userRank,
          formattedDate: formattedDate
        };
      } catch (error) {
        console.error("Error fetching birthday statistics:", error);
        return {
          totalMembers: Math.floor(Math.random() * 50) + 5, // Fallback to random number between 5-55
          userRank: Math.floor(Math.random() * 10) + 1,
          formattedDate: `${monthNames[userBirthdayMonth-1]} ${userBirthdayDay}`
        };
      }
    }

    async function fetchCountryStatistics() {
      try {
        // Query the database for entries with the same country
        const birthdatesRef = ref(database, 'birthdates');
        const birthdatesSnapshot = await get(birthdatesRef);
        
        let sameCountryCount = 0;
        
        if (birthdatesSnapshot.exists()) {
          const data = birthdatesSnapshot.val();
          
          // Count entries with the same country
          sameCountryCount = Object.values(data).filter(entry => 
            entry.country && entry.country === userCountry
          ).length;
        }
        
        return {
          totalMembers: sameCountryCount
        };
      } catch (error) {
        console.error("Error fetching country statistics:", error);
        return {
          totalMembers: Math.floor(Math.random() * 30) + 3 // Fallback to random number between 3-33
        };
      }
    }

    async function submitData(gender) {
      const birthdate = userBirthdate;
      const country = userCountry;
      const submitButton = document.querySelector('.submit-button');

      const localSuccess = submitToLocalStorage(gender);
      
      // Fetch statistics for the user's birthday and country
      try {
        userBirthdayStats = await fetchBirthdayStatistics();
        userCountryStats = await fetchCountryStatistics();
      } catch (error) {
        console.error("Error fetching statistics:", error);
        // Use fallback values
        userBirthdayStats = {
          totalMembers: Math.floor(Math.random() * 50) + 5,
          userRank: Math.floor(Math.random() * 10) + 1,
          formattedDate: `${monthNames[userBirthdayMonth-1]} ${userBirthdayDay}`
        };
        userCountryStats = {
          totalMembers: Math.floor(Math.random() * 30) + 3
        };
      }
      
      if (localSuccess) {
        try {
          push(ref(database, 'birthdates'), {
            date: birthdate,
            country: country,
            gender: gender,
            birthdayDay: userBirthdayDay,
            birthdayMonth: userBirthdayMonth,
            uid: userUid,
            accessCode: userAccessCode,
            timestamp: Date.now()
          }).then((newEntryRef) => {
            lastSubmittedId = newEntryRef.key;
            console.log("Data successfully submitted to Firebase:", lastSubmittedId);
          }).catch((error) => {
            console.warn("Firebase submission error:", error);
          });
        } catch (error) {
          console.warn("Firebase submission exception:", error);
        }
        
        finishSubmission(true);
      } else {
        finishSubmission(false);
      }
    }

    function submitToLocalStorage(gender) {
      try {
        const randomId = Date.now().toString(36) + Math.random().toString(36).substring(2);
        
        const data = {
          date: userBirthdate,
          country: userCountry,
          gender: gender,
          birthdayDay: userBirthdayDay,
          birthdayMonth: userBirthdayMonth,
          uid: userUid || randomId,
          accessCode: userAccessCode,
          timestamp: Date.now()
        };
        
        const submissions = JSON.parse(localStorage.getItem('submissions') || '[]');
        submissions.push(data);
        localStorage.setItem('submissions', JSON.stringify(submissions));
        
        lastSubmittedId = lastSubmittedId || "local_" + randomId;
        
        return true;
      } catch (error) {
        console.error("localStorage submission error:", error);
        return false;
      }
    }

    function finishSubmission(success) {
      const submitButton = document.querySelector('.submit-button');
      
      if (success) {
        document.getElementById('genderModal').style.display = 'none';
        
        // Update stats display in the modal
        document.getElementById('birthdayMembersCount').textContent = userBirthdayStats.totalMembers;
        document.getElementById('birthdayRanking').textContent = getOrdinal(userBirthdayStats.userRank);
        document.getElementById('birthdayDate').textContent = userBirthdayStats.formattedDate;
        document.getElementById('countryMembersCount').textContent = userCountryStats.totalMembers;
        document.getElementById('countryName').textContent = userCountry;
        
        // Show the achievement modal
        document.getElementById('accessCodeModal').style.display = 'block';
        
        updateHeaderAccessCode();
        
        submitButton.style.backgroundColor = 'green';
        submitButton.textContent = "Submitted";
        submitButton.disabled = true;
        document.getElementById('resetButton').style.display = "block";
        dataSubmitted = true;
        
        saveUserDataToCookie();
      } else {
        submitButton.style.backgroundColor = 'red';
        submitButton.textContent = "Error";
        console.error("Error during submission");
        
        document.getElementById('birthdate').classList.remove('disabled-field');
        document.getElementById('countrySelect').classList.remove('disabled-field');
      }
    }

    function getOrdinal(n) {
      const s = ["th", "st", "nd", "rd"];
      const v = n % 100;
      return n + (s[(v - 20) % 10] || s[v] || s[0]);
    }

    document.getElementById('resetButton').addEventListener('click', function() {
      // Afficher une confirmation avant de supprimer
      if (confirm("Are you sure you want to reset your data? This will delete your information from our database.")) {
        resetLocalStorageData();
        
        // Fonction pour vérifier et supprimer les données de la base de données Firebase
        deleteFromFirebase().then(() => {
          finishReset();
        }).catch(error => {
          console.error("Error during reset process:", error);
          alert("There was a problem resetting your data. Please try again later.");
        });
      }
    });
    
    // Nouvelle fonction pour supprimer les données de Firebase
    async function deleteFromFirebase() {
      if (!lastSubmittedId) {
        // Si nous n'avons pas d'ID stocké, essayons de trouver les entrées par UID
        try {
          if (userUid) {
            const birthdatesRef = ref(database, 'birthdates');
            const birthdatesSnapshot = await get(birthdatesRef);
            
            if (birthdatesSnapshot.exists()) {
              const data = birthdatesSnapshot.val();
              
              // Rechercher toutes les entrées avec le même UID
              for (const [key, value] of Object.entries(data)) {
                if (value.uid === userUid) {
                  console.log(`Found entry with matching UID: ${key}`);
                  
                  // Supprimer cette entrée
                  await remove(ref(database, `birthdates/${key}`));
                  console.log(`Deleted entry: ${key}`);
                }
              }
            }
          }
        } catch (error) {
          console.error("Error searching for user data in Firebase:", error);
          throw error;
        }
      } else if (!lastSubmittedId.startsWith('local_')) {
        // Si nous avons un ID Firebase valide, supprimer directement l'entrée
        try {
          await remove(ref(database, `birthdates/${lastSubmittedId}`));
          console.log("Firebase data successfully deleted:", lastSubmittedId);
        } catch (error) {
          console.error("Error deleting from Firebase:", error);
          throw error;
        }
      }
      
      return true;
    }
    
    function resetLocalStorageData() {
      try {
        const submissions = JSON.parse(localStorage.getItem('submissions') || '[]');
        const filteredSubmissions = submissions.filter(sub => 
          !sub.uid || sub.uid !== userUid
        );
        localStorage.setItem('submissions', JSON.stringify(filteredSubmissions));
        return true;
      } catch (error) {
        console.error("Error resetting localStorage data:", error);
        return false;
      }
    }
    
    function finishReset() {
      document.getElementById('birthdate').value = '';
      document.getElementById('countrySelect').value = '';
      const submitButton = document.querySelector('.submit-button');
      submitButton.textContent = "Submit";
      submitButton.style.backgroundColor = 'gray';
      submitButton.disabled = false;
      document.getElementById('resetButton').style.display = "none";
      
      document.getElementById('accessCodeIndicator').style.display = 'block';
      document.getElementById('headerAccessCode').style.display = 'none';
      
      dataSubmitted = false;
      userBirthdate = null;
      userCountry = null;
      userGender = null;
      userBirthdayDay = null;
      userBirthdayMonth = null;
      lastSubmittedId = null;
      userAccessCode = null;
      userBirthdayStats = {
        totalMembers: 0,
        userRank: 0,
        formattedDate: ""
      };
      userCountryStats = {
        totalMembers: 0
      };
      
      document.getElementById('birthdate').classList.remove('disabled-field');
      document.getElementById('countrySelect').classList.remove('disabled-field');
      
      eraseCookie('userData');
      
      alert("Your data has been successfully reset.");
    }

    document.getElementById('flowerButton').addEventListener('click', function() {
      if (userBirthdayMonth && userBirthdayDay) {
        updateMotivationByBirthMonth();
      } else {
        const motivationElement = document.getElementById('monthlyMotivation');
        motivationElement.innerHTML = `
          <span class="month-name">DISCOVER YOUR FLOWER</span>
          Submit your date of birth to see your personalized motivation.
        `;
      }
      
      const flowerModal = document.getElementById('flowerModal');
      flowerModal.style.display = 'block';
    });

    document.getElementById('joinButton').addEventListener('click', function(e) {
      e.preventDefault();
      document.getElementById('joinModal').style.display = 'block';
    });

    document.getElementById('laterButton').addEventListener('click', function() {
      document.getElementById('accessCodeModal').style.display = 'none';
    });

    // Header access code container click to copy
    document.getElementById('accessCodeContainer').addEventListener('click', function() {
      if (userAccessCode) {
        navigator.clipboard.writeText(userAccessCode).then(function() {
          // Flash effect for feedback
          const container = document.getElementById('accessCodeContainer');
          container.style.backgroundColor = '#e0f0ff';
          setTimeout(() => {
            container.style.backgroundColor = '#f0f7ff';
          }, 300);
        }).catch(function(err) {
          console.error('Could not copy access code: ', err);
        });
      }
    });
    
    // Gestion des boutons de fermeture pour chaque modal
    document.getElementById('closeGenderModal').addEventListener('click', function() {
      document.getElementById('genderModal').style.display = 'none';
      
      // Réinitialiser l'état du formulaire si l'utilisateur ferme le modal sans choisir
      const submitButton = document.querySelector('.submit-button');
      submitButton.style.backgroundColor = 'gray';
      submitButton.textContent = "Submit";
      
      document.getElementById('birthdate').classList.remove('disabled-field');
      document.getElementById('countrySelect').classList.remove('disabled-field');
    });
    
    document.getElementById('closeFlowerModal').addEventListener('click', function() {
      document.getElementById('flowerModal').style.display = 'none';
    });
    
    document.getElementById('closeJoinModal').addEventListener('click', function() {
      document.getElementById('joinModal').style.display = 'none';
    });
    
    document.getElementById('closeAccessCodeModal').addEventListener('click', function() {
      document.getElementById('accessCodeModal').style.display = 'none';
    });

    window.onclick = function(event) {
      const genderModal = document.getElementById('genderModal');
      const flowerModal = document.getElementById('flowerModal');
      const accessCodeModal = document.getElementById('accessCodeModal');
      const joinModal = document.getElementById('joinModal');
      
      if (event.target == genderModal) {
        genderModal.style.display = "none";
        const submitButton = document.querySelector('.submit-button');
        submitButton.style.backgroundColor = 'red';
        submitButton.textContent = "Error";
        
        document.getElementById('birthdate').classList.remove('disabled-field');
        document.getElementById('countrySelect').classList.remove('disabled-field');
      }
      
      if (event.target == flowerModal) {
        flowerModal.style.display = "none";
      }
      
      if (event.target == accessCodeModal) {
        accessCodeModal.style.display = "none";
      }
      
      if (event.target == joinModal) {
        joinModal.style.display = "none";
      }
    };

    checkCookieConsent();
  </script>
</body>
</html>
