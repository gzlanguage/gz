<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="page.title">G-Z</title>
    <link rel="icon" href="https://firebasestorage.googleapis.com/v0/b/genz-abb36.firebasestorage.app/o/photo_2025-03-09_13-00-43.jpg?alt=media&token=e3d3c543-164c-4c79-8cd1-0a9c710fb002">
    <link href="https://fonts.googleapis.com/css2?family=Billabong&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/i18next/22.4.9/i18next.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/i18next-http-backend/2.2.1/i18nextHttpBackend.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/i18next-browser-languagedetector/7.0.1/i18nextBrowserLanguageDetector.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-i18next/1.2.1/jquery-i18next.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: white;
            position: relative;
            transition: background-color 0.3s ease;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        header {
            background-color: white;
            padding: 6px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: background-color 0.3s ease;
        }
        
        h1 {
            margin: 0;
            font-size: 1.4em;
            font-family: 'Billabong', cursive;
            color: #007bff;
            border: 2px solid #007bff;
            padding: 4px;
            border-radius: 12px;
            font-weight: bold;
            transition: color 0.3s ease, border-color 0.3s ease;
        }
        .divider {
            height: 0.6px;
            background-color: #007bff;
            width: 100%;
            margin-top: 5px;
            transition: background-color 0.3s ease;
        }
        .button-container {
            display: flex;
            justify-content: center; /* Centre le bouton */
            margin-top: 5px;
            padding: 5px 0;
            overflow-x: auto;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        .button-container::-webkit-scrollbar {
            display: none;
        }
        .button {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 5px 10px;
            margin: 0 3px;
            font-size: 0.8em;
            cursor: pointer;
            text-decoration: none;
            display: flex;
            align-items: center;
            flex-shrink: 0;
            transition: background-color 0.3s ease;
        }
        .button i {
            margin-right: 2px;
        }
        .notification {
            text-align: center;
            margin-top: 10px;
            font-size: 0.8em;
            color: #0056b3;
            font-weight: bold;
            transition: color 0.3s ease;
        }
        .share-icon {
            color: #007bff;
            cursor: pointer;
            font-size: 1.3em;
            border: 1px solid #007bff;
            border-radius: 7px;
            padding: 4px;
            background-color: white;
            transition: color 0.3s ease, border-color 0.3s ease;
        }
        footer {
            background-color: white;
            color: black;
            padding: 10px 15px;
            margin-top: auto;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo-container {
            display: flex;
        }
        .logo {
            color: #007bff;
            font-size: 1.6em;
            margin-right: 10px;
            border: 1px solid #007bff;
            border-radius: 10px;
            padding: 5px;
            background-color: rgba(0, 119, 190, 0.1);
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
        }
        .logo:hover {
            background-color: #007bff;
            color: white;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
        }
        .modal-content {
            background-color: white;
            /* Position du modal √† 37% de hauteur au lieu de 29% */
            margin: 40% auto;
            padding: 14px;
            border: 1px solid #007bff;
            border-radius: 60px;
            width: 280px;
            max-width: 70%;
            text-align: center;
            max-height: 60vh;
            overflow-y: auto;
            position: relative;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        .modal-header {
            font-size: 1.8em;
            font-family: 'Billabong', cursive;
            margin-bottom: 10px;
            font-weight: bold;
            color: #007bff;
            text-decoration: underline;
            transition: color 0.3s ease;
        }
        
        .modal-footer {
            margin-top: 15px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 6px;
        }
        .close-button {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 8px 10px;
            cursor: pointer;
            font-size: 0.9em;
            width: 120px;
            margin: 4px;
            transition: background-color 0.3s ease;
        }
        .close-button:hover {
            background-color: #0056b3;
        }
        
        @keyframes flowerRotate {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(15deg); }
            50% { transform: rotate(0deg); }
            75% { transform: rotate(-15deg); }
            100% { transform: rotate(0deg); }
        }
        
        .flower-icon {
            display: inline-block;
            animation: flowerRotate 2s infinite ease-in-out;
            color: #ff69b4;
        }
        
        .billabong-title {
            font-family: 'Billabong', cursive;
            font-size: 1.8em;
            margin-bottom: 8px;
            color: #007bff;
            transition: color 0.3s ease;
        }

        .monthly-motivation {
            margin: 15px 0;
            padding: 10px;
            border: 1px dashed #ff69b4;
            border-radius: 15px;
            background-color: white;
            font-style: italic;
            color: #333;
            font-size: 0.9em;
            line-height: 1.4;
            transition: border-color 0.3s ease, color 0.3s ease, background-color 0.3s ease;
        }
        
        .flower-code {
            display: block;
            font-weight: bold;
            color: #ff69b4;
            font-size: 0.9em;
            margin-bottom: 8px;
            letter-spacing: 0.5px;
            background-color: #fff0f8;
            padding: 6px;
            border-radius: 8px;
            border: 1px solid #ff69b4;
            max-width: 220px;
            margin-left: auto;
            margin-right: auto;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            transition: color 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
        }
        
        .copy-icon {
            color: #007bff;
            cursor: pointer;
            margin-left: 10px;
            font-size: 1.2em;
            vertical-align: middle;
            transition: color 0.3s ease;
        }
        
        .header-controls {
            display: flex;
            align-items: center;
        }
        
        .celebrate-icon {
            font-size: 2em;
            color: gold;
            margin-bottom: 8px;
            animation: celebrate 2s infinite alternate;
        }
        
        @keyframes celebrate {
            0% { transform: scale(1); }
            50% { transform: scale(1.1) rotate(5deg); }
            100% { transform: scale(1) rotate(-5deg); }
        }
        
        .modal-close {
            position: absolute;
            top: 10px;
            right: 20px;
            color: #ff0000;
            font-size: 13px;
            cursor: pointer;
            background-color: transparent;
            border: none;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.2s;
        }
        
        .modal-close:hover {
            background-color: rgba(255, 0, 0, 0.1);
        }
        
        .share-flower-button {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 14px;
            padding: 8px 16px;
            font-size: 0.9em;
            margin: 290px auto;
            display: none;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
            max-width: 190px;
            position: relative;
            z-index: 1001;
            border: 1px solid #0056b3;
        }
        
        .share-flower-button:hover {
            background-color: #0056b3;
        }
        
        .share-flower-button i {
            margin-left: 8px;
        }
        
        #capturedFlower {
            position: fixed;
            z-index: 1003;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .captured-image-container {
            position: relative;
            max-width: 85%;
            max-height: 60vh;
            margin-bottom: 15px;
        }
        
        .captured-image {
            max-width: 100%;
            max-height: 60vh;
            border-radius: 15px;
            border: 2px solid white;
        }
        
        .share-message {
            background-color: white;
            color: #333;
            padding: 10px 15px;
            border-radius: 15px;
            font-size: 0.9em;
            margin: 10px auto;
            max-width: 90%;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        .share-message i {
            margin-left: 8px;
            color: #007bff;
            transition: color 0.3s ease;
        }
        
        .share-link {
            color: #007bff;
            font-weight: bold;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        .capture-controls {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }
        
        .capture-button {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 20px;
            padding: 8px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
            transition: background-color 0.3s ease;
        }
        
        .capture-button i {
            margin-right: 5px;
        }
        
        .close-capture {
            background-color: #f0f0f0;
            color: #333;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        #flowerCaptureContainer {
            position: fixed;
            z-index: -1;
            top: 0;
            left: -9999px;
            background-color: white;
            border: 2px solid #007bff;
            border-radius: 20px;
            padding: 15px;
            width: 300px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        
        .capture-flower-header {
            font-family: 'Billabong', cursive;
            color: #007bff;
            font-size: 1.8em;
            margin-bottom: 8px;
            text-align: center;
            font-weight: bold;
            text-shadow: 0px 1px 1px rgba(0, 123, 255, 0.2);
            transition: color 0.3s ease;
        }
        
        .capture-flower-code {
            font-weight: bold;
            color: #ff69b4;
            font-size: 0.8em; /* Taille r√©duite pour My Flower - ID */
            background-color: #fff0f8;
            padding: 6px;
            border-radius: 10px;
            border: 1px solid #ff69b4;
            margin: 6px auto;
            text-align: center;
            max-width: 80%; /* R√©duction de la largeur */
            letter-spacing: 0.5px;
            transition: color 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
        }
        
        .capture-flower-motivation {
            font-style: italic;
            color: #333;
            font-size: 0.95em;
            line-height: 1.4;
            background-color: #f9f9f9;
            border: 1px dashed #ff69b4;
            border-radius: 12px;
            padding: 12px;
            margin: 12px 0;
            text-align: center;
            transition: color 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
        }
        
        .capture-flower-icon {
            text-align: center;
            font-size: 2.5em;
            color: #ff69b4;
            margin: 10px 0;
            transition: color 0.3s ease;
        }
        
        .gz-logo {
            font-family: 'Billabong', cursive;
            color: #007bff;
            font-size: 1.4em;
            text-align: center;
            margin-top: 10px;
            border: 2px solid #007bff;
            border-radius: 12px;
            padding: 4px;
            width: 50px;
            margin-left: auto;
            margin-right: auto;
            font-weight: bold;
            transition: color 0.3s ease, border-color 0.3s ease;
        }
        
        .share-warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
            border-radius: 15px;
            padding: 10px 15px;
            font-size: 0.85em;
            margin: 5px auto 15px auto;
            max-width: 90%;
            text-align: center;
            display: none;
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }
        
        .capture-website-url {
            text-align: center;
            font-size: 0.85em;
            color: #007bff;
            font-weight: bold;
            margin-top: 8px;
            font-family: Arial, sans-serif;
            padding: 3px 0;
            border-top: 1px dashed #007bff;
            transition: color 0.3s ease, border-color 0.3s ease;
        }
        
        .terms-text {
            font-size: 0.8em;
            color: black;
            text-align: center;
            margin: 10px auto;
            width: 330px;
            transition: color 0.3s ease;
        }
        
        .billabong-title {
            margin-bottom: 3px;
        }

        /* Styles pour l'en-t√™te */
        .header-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            padding: 0 1px;
        }

        .header-icon {
            font-size: 1.4em;
            color: #007bff;
            border: 2px solid #007bff;
            padding: 4px;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            transition: color 0.3s ease, border-color 0.3s ease;
        }

        .app-logo {
            font-family: 'Billabong', cursive;
            color: #007bff;
            border: 2px solid #007bff;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 1.4em;
            font-weight: bold;
            transition: color 0.3s ease, border-color 0.3s ease;
        }

        .header-flex {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
        }
        
        /* Nouvelle structure pour l'en-t√™te */
        .right-controls {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        /* Style pour le modal initial */
        #welcomeModal {
            display: none;
            position: fixed;
            z-index: 10;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }

        /* R√©duction de la taille du modal de bienvenue */
        #welcomeModal .modal-content {
            background-color: #fff;
            margin: 45% auto;
            padding: 15px;
            border: 1px solid #007BFF;
            border-radius: 35px;
            width: 75%;
            max-width: 250px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            text-align: center;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        #welcomeModal .close {
            color: red;
            font-size: 18px;
            font-weight: bold;
            display: block;
            text-align: center;
            margin-bottom: 3px;
            cursor: pointer;
        }

        #welcomeModal .welcome-text {
            margin: 10px 0 15px 0;
            font-size: 0.9em;
            color: #333;
            line-height: 1.4;
            transition: color 0.3s ease;
        }

        #welcomeModal .agree-button {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 15px;
            padding: 10px 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            margin: 10px auto 5px;
            display: block;
            width: 70%;
            transition: background-color 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 123, 255, 0.3);
        }
        
        #welcomeModal .agree-button:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 123, 255, 0.4);
        }
        
        #welcomeModal .agree-button:active {
            transform: translateY(0);
            box-shadow: 0 1px 3px rgba(0, 123, 255, 0.3);
        }

        /* Style pour le modal d'ID */
        #idModal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }

        #idModal .modal-content {
            background-color: #fff;
            margin: 45% auto;
            padding: 8px;
            border: 1px solid #007BFF;
            border-radius: 35px;
            width: 65%;
            max-width: 220px;
            text-align: center;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        #idModal .id-title {
            font-size: 1em;
            color: #007bff;
            margin-bottom: 5px;
            transition: color 0.3s ease;
        }

        #idModal .id-display {
            font-weight: bold;
            font-size: 1.2em;
            color: #ff69b4;
            background-color: #fff0f8;
            padding: 6px;
            border-radius: 8px;
            border: 1px solid #ff69b4;
            margin: 5px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            max-width: 80%;
            transition: color 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
        }

        #idModal .copy-icon {
            margin-left: 6px;
        }

        #idModal .id-message {
            font-size: 0.7em;
            color: #333;
            margin: 5px 0;
            transition: color 0.3s ease;
        }

        #idModal .close-button {
            margin-top: 8px;
            width: auto;
            padding: 6px 15px;
            font-size: 0.7em;
        }

        /* Style pour le lien sans soulignement */
        .menu-link {
            text-decoration: none;
            color: #007bff;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.3s ease;
        }
        
        /* S√©lecteur de style (th√®mes) */
        .style-selector {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: white;
            padding: 10px 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 100;
            transition: background-color 0.3s ease;
        }
        
        .style-selector h3 {
            text-align: center;
            margin: 0 0 10px 0;
            font-size: 1em;
            color: #333;
            transition: color 0.3s ease;
        }
        
        .style-options {
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 0 5px;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        .style-options::-webkit-scrollbar {
            display: none;
        }
        
        .style-option {
            width: 60px;
            height: 40px;
            border-radius: 10px;
            cursor: pointer;
            flex-shrink: 0;
            position: relative;
            border: 1px solid #ddd;
            overflow: hidden;
        }
        
        .style-option.selected {
            border: 2px solid white;
            box-shadow: 0 0 0 2px #007bff;
        }
        
        /* Styles des th√®mes */
        .style-option.red-black {
            background: linear-gradient(to right, #FF4500, #8B0000, #121212, #1F1F1F);
        }
        
        .style-option.blue-purple {
            background: linear-gradient(to right, #5865F2, #764BA2, #4B0082, #2C2C54);
        }
        
        .style-option.green-blue {
            background: linear-gradient(to right, #3EB489, #14532D, #0A2239, #1A2E4D);
        }
        
        .style-option.orange-pink {
            background: linear-gradient(to right, #FF7F50, #FF6F91, #C71585, #4B0082);
        }
        
        .style-option.default {
            background: linear-gradient(to right, #007bff, #0056b3);
        }
        
        /* Contenu principal avec padding pour √©viter le chevauchement avec le s√©lecteur de style */
        .main-content {
            padding-bottom: 80px; /* Pour √©viter que le contenu soit cach√© derri√®re le s√©lecteur de style */
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
        }
        
        /* Th√®me par d√©faut (bleu) */
        body.theme-default {
            background-color: white;
            color: #333;
        }
        
        body.theme-default header, 
        body.theme-default footer,
        body.theme-default .style-selector {
            background-color: white;
        }
        
        body.theme-default .app-logo,
        body.theme-default .header-icon,
        body.theme-default .divider,
        body.theme-default .notification,
        body.theme-default .billabong-title,
        body.theme-default .gz-logo,
        body.theme-default .capture-website-url,
        body.theme-default .capture-flower-header,
        body.theme-default .id-title {
            color: #007bff;
            border-color: #007bff;
        }
        
        body.theme-default .notification .notification-text {
            color: #007bff;
        }
        
        body.theme-default .button {
            background-color: #007bff;
        }
        
        body.theme-default .share-flower-button {
            background-color: #007bff;
            color: white;
            border-color: #0056b3;
        }
        
        body.theme-default .flower-code,
        body.theme-default .id-display {
            color: #ff69b4;
            background-color: #fff0f8;
            border-color: #ff69b4;
        }
        
        body.theme-default .monthly-motivation,
        body.theme-default .capture-flower-motivation {
            border-color: #ff69b4;
            color: #333;
            background-color: white;
        }
        
        body.theme-default .modal-content {
            background-color: white;
            border-color: #007bff;
        }
        
        /* Th√®me Rouge-Noir */
        body.theme-red-black {
            background: black;
            color: #E5E5E5;
        }
        
        body.theme-red-black header, 
        body.theme-red-black footer,
        body.theme-red-black .style-selector {
            background-color: black;
        }
        
        body.theme-red-black .app-logo,
        body.theme-red-black .header-icon,
        body.theme-red-black .gz-logo,
        body.theme-red-black .capture-flower-header,
        body.theme-red-black .capture-website-url,
        body.theme-red-black .id-title,
        body.theme-red-black .billabong-title {
            color: #FF4500;
            border-color: #FF4500;
        }
        
        body.theme-red-black .divider {
            background-color: #FF4500;
        }
        
        body.theme-red-black .notification .notification-text {
            color: #FF4500;
        }
        
        body.theme-red-black .notification,
        body.theme-red-black .welcome-text,
        body.theme-red-black .id-message {
            color: #CCCCCC;
        }
        
        body.theme-red-black .button {
            background-color: #8B0000;
        }
        
        body.theme-red-black .share-flower-button {
            background-color: #8B0000;
            color: white;
            border-color: #FF4500;
        }
        
        body.theme-red-black .flower-code,
        body.theme-red-black .id-display {
            color: #FF4500;
            background-color: #2C2C2C;
            border-color: #FF4500;
        }
        
        body.theme-red-black .monthly-motivation,
        body.theme-red-black .capture-flower-motivation {
            border-color: #FF4500;
            color: #E5E5E5;
            background-color: #1F1F1F;
        }
        
        body.theme-red-black .modal-content,
        body.theme-red-black #flowerCaptureContainer {
            background-color: #1F1F1F;
            border-color: #8B0000;
        }
        
        /* Th√®me Bleu-Violet */
        body.theme-blue-purple {
            background: #2C2C54;
            color: #FFFFFF;
        }
        
        body.theme-blue-purple header, 
        body.theme-blue-purple footer,
        body.theme-blue-purple .style-selector {
            background-color: #2C2C54;
        }
        
        body.theme-blue-purple .app-logo,
        body.theme-blue-purple .header-icon,
        body.theme-blue-purple .gz-logo,
        body.theme-blue-purple .capture-flower-header,
        body.theme-blue-purple .capture-website-url,
        body.theme-blue-purple .id-title,
        body.theme-blue-purple .billabong-title {
            color: #5865F2;
            border-color: #5865F2;
        }
        
        body.theme-blue-purple .divider {
            background-color: #5865F2;
        }
        
        body.theme-blue-purple .notification .notification-text {
            color: #5865F2;
        }
        
        body.theme-blue-purple .notification,
        body.theme-blue-purple .welcome-text,
        body.theme-blue-purple .id-message {
            color: #B0B0B0;
        }
        
        body.theme-blue-purple .button {
            background-color: #764BA2;
        }
        
        body.theme-blue-purple .share-flower-button {
            background-color: #764BA2;
            color: white;
            border-color: #5865F2;
        }
        
        body.theme-blue-purple .flower-code,
        body.theme-blue-purple .id-display {
            color: #5865F2;
            background-color: #3A3A8C;
            border-color: #5865F2;
        }
        
        body.theme-blue-purple .monthly-motivation,
        body.theme-blue-purple .capture-flower-motivation {
            border-color: #5865F2;
            color: #FFFFFF;
            background-color: #2C2C54;
        }
        
        body.theme-blue-purple .modal-content,
        body.theme-blue-purple #flowerCaptureContainer {
            background-color: #2C2C54;
            border-color: #5865F2;
        }
        
        /* Th√®me Vert-Bleu */
        body.theme-green-blue {
            background: #1A2E4D;
            color: #F5F5F5;
        }
        
        body.theme-green-blue header, 
        body.theme-green-blue footer,
        body.theme-green-blue .style-selector {
            background-color: #1A2E4D;
        }
        
        body.theme-green-blue .app-logo,
        body.theme-green-blue .header-icon,
        body.theme-green-blue .gz-logo,
        body.theme-green-blue .capture-flower-header,
        body.theme-green-blue .capture-website-url,
        body.theme-green-blue .id-title,
        body.theme-green-blue .billabong-title {
            color: #3EB489;
            border-color: #3EB489;
        }
        
        body.theme-green-blue .divider {
            background-color: #3EB489;
        }
        
        body.theme-green-blue .notification .notification-text {
            color: #3EB489;
        }
        
        body.theme-green-blue .notification,
        body.theme-green-blue .welcome-text,
        body.theme-green-blue .id-message {
            color: #A0A0A0;
        }
        
        body.theme-green-blue .button {
            background-color: #14532D;
        }
        
        body.theme-green-blue .share-flower-button {
            background-color: #14532D;
            color: white;
            border-color: #3EB489;
        }
        
        body.theme-green-blue .flower-code,
        body.theme-green-blue .id-display {
            color: #3EB489;
            background-color: #36454F;
            border-color: #3EB489;
        }
        
        body.theme-green-blue .monthly-motivation,
        body.theme-green-blue .capture-flower-motivation {
            border-color: #3EB489;
            color: #F5F5F5;
            background-color: #1A2E4D;
        }
        
        body.theme-green-blue .modal-content,
        body.theme-green-blue #flowerCaptureContainer {
            background-color: #1A2E4D;
            border-color: #3EB489;
        }
        
        /* Th√®me Orange-Rose */
        body.theme-orange-pink {
            background: #4B0082;
            color: #FFFFFF;
        }
        
        body.theme-orange-pink header, 
        body.theme-orange-pink footer,
        body.theme-orange-pink .style-selector {
            background-color: #4B0082;
        }
        
        body.theme-orange-pink .app-logo,
        body.theme-orange-pink .header-icon,
        body.theme-orange-pink .gz-logo,
        body.theme-orange-pink .capture-flower-header,
        body.theme-orange-pink .capture-website-url,
        body.theme-orange-pink .id-title,
        body.theme-orange-pink .billabong-title {
            color: #FF7F50;
            border-color: #FF7F50;
        }
        
        body.theme-orange-pink .divider {
            background-color: #FF7F50;
        }
        
        body.theme-orange-pink .notification .notification-text {
            color: #FF7F50;
        }
        
        body.theme-orange-pink .notification,
        body.theme-orange-pink .welcome-text,
        body.theme-orange-pink .id-message {
            color: #D3D3D3;
        }
        
        body.theme-orange-pink .button {
            background-color: #C71585;
        }
        
        body.theme-orange-pink .share-flower-button {
            background-color: #C71585;
            color: white;
            border-color: #FF7F50;
        }
        
        body.theme-orange-pink .flower-code,
        body.theme-orange-pink .id-display {
            color: #FF7F50;
            background-color: #6A0DAD;
            border-color: #FF7F50;
        }
        
        body.theme-orange-pink .monthly-motivation,
        body.theme-orange-pink .capture-flower-motivation {
            border-color: #FF7F50;
            color: #FFFFFF;
            background-color: #4B0082;
        }
        
        body.theme-orange-pink .modal-content,
        body.theme-orange-pink #flowerCaptureContainer {
            background-color: #4B0082;
            border-color: #FF7F50;
        }
        
        /* Ic√¥ne de rafra√Æchissement pour la motivation */
        .refresh-motivation {
            position: absolute;
            right: 15px;
            top: 70px;
            color: #007bff;
            cursor: pointer;
            font-size: 1.2em;
            padding: 5px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transition: transform 0.3s ease, color 0.3s ease;
        }
        
        .refresh-motivation:hover {
            transform: rotate(180deg);
        }
        
        body.theme-red-black .refresh-motivation {
            color: #FF4500;
        }
        
        body.theme-blue-purple .refresh-motivation {
            color: #5865F2;
        }
        
        body.theme-green-blue .refresh-motivation {
            color: #3EB489;
        }
        
        body.theme-orange-pink .refresh-motivation {
            color: #FF7F50;
        }
    </style>
</head>
<body class="theme-green-blue">

  <header>
   
    <div class="header-container">
      <!-- Logo G-Z √† gauche -->
      <div class="app-logo" data-i18n="header.logo">G-Z</div>
      
      <!-- √âl√©ments regroup√©s √† droite avec nouvel ordre -->
      <div class="right-controls">
        <!-- Ic√¥ne ID -->
        <div class="header-icon" id="showIdButton"><i class="fas fa-id-card"></i></div>
        
        <!-- Lien barres - m√™me couleur que les autres ic√¥nes -->
        <a href="g-z.online/us.html" class="header-icon menu-link"><i class="fas fa-bars"></i></a>
      </div>
    </div>
  </header>

  <div class="divider"></div>

  <div class="main-content">
    <div class="button-container">
      <!-- Un seul bouton flower of life centr√© -->
      <a class="button" href="#" id="flowerButton"><i class="fas fa-spa flower-icon"></i><span data-i18n="button.flowerOfLife">Flower of life</span></a>
    </div>

    <div class="divider"></div>
    <div class="notification">
      <span class="notification-text" data-i18n="notification.message">üí† Flower -- The message the universe wrote just for you ¬Ø\\_(„ÉÑ)_/¬Øüí†</span>
    </div>

    <div class="divider"></div>
  </div>

  <!-- Style selector au bas de l'√©cran -->
  <div class="style-selector">
    <h3 data-i18n="styleSelector.title">Style</h3>
    <div class="style-options">
      <div class="style-option red-black" data-theme="red-black"></div>
      <div class="style-option blue-purple" data-theme="blue-purple"></div>
      <div class="style-option green-blue selected" data-theme="green-blue"></div>
      <div class="style-option orange-pink" data-theme="orange-pink"></div>
      <div class="style-option default" data-theme="default"></div>
    </div>
  </div>

  <!-- Modal initial pour l'accueil - am√©lior√© -->
  <div id="welcomeModal" class="modal">
    <div class="modal-content">
      <div class="welcome-text">
        <strong data-i18n="welcome.title">Welcome to G-Z Flower!</strong><br>
        <span data-i18n="welcome.message">Click OK to access your unique flower. This ID will represent and define you in G-Z. Keep it safe as it's your unique identifier.</span>
      </div>
      <button class="agree-button" id="agreeButton" data-i18n="welcome.button">OK</button>
    </div>
  </div>

  <!-- Modal pour afficher l'ID unique -->
  <div id="idModal" class="modal">
    <div class="modal-content">
      <div class="id-title" data-i18n="id.title">Your User ID</div>
      <div class="id-display">
        <span id="userIdDisplay"></span>
        <i class="fas fa-copy copy-icon" id="copyIdButton"></i>
      </div>
      <div class="id-message" data-i18n="id.message">Keep this ID safe!</div>
      <button class="close-button" id="closeIdModal" data-i18n="id.closeButton">Close</button>
    </div>
  </div>

  <div id="flowerModal" class="modal">
    <div class="modal-content">
      <button class="modal-close" id="closeFlowerModal"><i class="fas fa-times"></i></button>
      <div class="billabong-title"><strong id="flowerTypeTitle" data-i18n="flower.title">Flower of Life</strong></div>
      
      <div id="flowerCodeDisplay" class="flower-code"></div>
      
      <!-- Ajout d'une ic√¥ne pour rafra√Æchir la motivation -->
      <i class="fas fa-sync-alt refresh-motivation" id="refreshMotivation" title="Generate new motivation"></i>
      
      <div class="monthly-motivation" id="monthlyMotivation"></div>
      
      <div style="margin: 10px auto; font-size: 3em; color: #ff69b4;" id="flowerIconContainer">
        <i class="fas fa-spa"></i>
      </div>
    </div>
  </div>
  
  <button class="share-flower-button" id="shareFlowerButton">
    <span data-i18n="share.button">Share my Flower</span> <i class="fas fa-paper-plane"></i>
  </button>
  
  <div id="capturedFlower">
    <div class="captured-image-container">
      <img id="capturedImage" class="captured-image" src="" alt="Captured Flower">
    </div>

    <div class="share-warning" id="shareWarning">
      <i class="fas fa-exclamation-triangle" style="margin-right: 5px;"></i>
      <span data-i18n="share.warning">Perfect for sharing, just adjust.</span>
    </div>
    
    <div class="capture-controls">
      <button class="capture-button" id="shareCapture">
        <i class="fas fa-paper-plane"></i> <span data-i18n="share.shareButton">Share</span>
      </button>
      
      <button class="capture-button close-capture" id="closeCapture">
        <i class="fas fa-times"></i> <span data-i18n="share.closeButton">Close</span>
      </button>
    </div>
  </div>
  
  <div id="flowerCaptureContainer">
    <div class="capture-flower-header" id="captureFlowerHeader" data-i18n="capture.header">Flower of Life</div>
    
    <div id="captureFlowerCode" class="capture-flower-code"></div>
    
    <div id="captureFlowerMotivation" class="capture-flower-motivation"></div>
    
    <div class="capture-flower-icon" id="captureFlowerIcon">
      <i class="fas fa-spa"></i>
    </div>
    
    <div class="gz-logo" data-i18n="capture.logo">G-Z</div>
    
    <div class="capture-website-url" data-i18n="capture.website">Discover yours at www.g-z.online</div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
    import { getDatabase, ref, push, remove, get, set, onValue, update, query, orderByChild, equalTo } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js";
    import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js";
    import { getFirestore, collection, addDoc, doc, setDoc } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCrPKQOqw4zciASa_5PbI_etfkvrBaDPDI",
      authDomain: "genz-abb36.firebaseapp.com",
      databaseURL: "https://genz-abb36-default-rtdb.firebaseio.com",
      projectId: "genz-abb36",
      storageBucket: "genz-abb36.firebasestorage.app",
      messagingSenderId: "405021535683",
      appId: "1:405021535683:web:ee5a28fde27f5558046176",
      measurementId: "G-XZNQND2J00"
    };
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
    const firestore = getFirestore(app);
    const auth = getAuth(app);
    
    let userUid = null;
    let userFlowerCode = null;
    let currentMotivation = null;
    let currentCountry = null;
    let userCity = null;
    let userUniqueId = null; // ID unique pour l'utilisateur
    let isAuthenticated = false; // Pour suivre l'√©tat d'authentification
    let isInstalled = false; // Indicateur d'installation
    let currentTheme = "green-blue"; // Th√®me par d√©faut modifi√© √† vert-bleu

    // Configuration i18next pour la traduction
    i18next
      .use(i18nextHttpBackend)
      .use(i18nextBrowserLanguageDetector)
      .init({
        fallbackLng: 'en',
        debug: false,
        load: 'languageOnly',
        detection: {
          order: ['querystring', 'cookie', 'navigator'],
          lookupQuerystring: 'lng',
          lookupCookie: 'i18next',
          caches: ['cookie']
        },
        backend: {
          loadPath: 'locales/{{lng}}.json',
        }
      }, function(err, t) {
        jqueryI18next.init(i18next, $, {
          useOptionsAttr: true
        });
        
        // Appliquer les traductions au chargement
        $('body').localize();
        
        // V√©rifier si l'URL contient un param√®tre de langue
        const urlParams = new URLSearchParams(window.location.search);
        const lang = urlParams.get('lng');
        
        // Si l'URL contient un param√®tre de langue, l'utiliser
        if (lang) {
          i18next.changeLanguage(lang);
        } 
        // Sinon d√©tecter automatiquement si l'utilisateur est en France
        else {
          detectUserLocation().then(location => {
            if (location.country === 'France') {
              i18next.changeLanguage('fr');
            }
          });
        }
      });
    
    // Fonction pour mettre √† jour les traductions lorsque la langue change
    i18next.on('languageChanged', () => {
      $('body').localize();
      
      // Mettre √† jour l'URL avec la langue actuelle
      const url = new URL(window.location);
      url.searchParams.set('lng', i18next.language);
      window.history.pushState({}, '', url);
      
      // Mettre √† jour √©galement les textes dynamiques qui ne sont pas directement li√©s aux attributs data-i18n
      if (currentMotivation) {
        updateFlowerDisplay();
      }
    });

    // Dictionnaire pour mapper les ID aux sujets
    const subjectDictionary = {
      // Success related
      "Success": "Success",
      "Achievement": "Achievement",
      "Victory": "Victory",
      "Triumph": "Triumph",
      "Accomplishment": "Accomplishment",
      
      // Wealth related
      "Richest": "Wealth",
      "Prosperity": "Prosperity",
      "Abundance": "Abundance",
      "Fortune": "Fortune",
      "Affluence": "Affluence",
      
      // Happiness related
      "Joy": "Joy",
      "Happiness": "Happiness",
      "Bliss": "Bliss",
      "Delight": "Delight",
      "Contentment": "Contentment",
      
      // Growth related
      "Growth": "Growth",
      "Progress": "Progress",
      "Advancement": "Advancement",
      "Development": "Development",
      "Improvement": "Improvement",
      
      // Strength related
      "Power": "Power",
      "Strength": "Strength",
      "Might": "Might",
      "Force": "Force",
      "Energy": "Energy",
      
      // Wisdom related
      "Wisdom": "Wisdom",
      "Intelligence": "Intelligence",
      "Knowledge": "Knowledge",
      "Insight": "Insight",
      "Understanding": "Understanding",
      
      // Creativity related
      "Creativity": "Creativity",
      "Innovation": "Innovation",
      "Imagination": "Imagination",
      "Invention": "Invention",
      "Originality": "Originality",
      
      // Leadership related
      "Leadership": "Leadership",
      "Authority": "Authority",
      "Influence": "Influence",
      "Command": "Command",
      "Direction": "Direction",
      
      // Peace related
      "Peace": "Peace",
      "Harmony": "Harmony",
      "Tranquility": "Tranquility",
      "Serenity": "Serenity",
      "Calm": "Calm",
      
      // Love related
      "Love": "Love",
      "Affection": "Affection",
      "Adoration": "Adoration",
      "Devotion": "Devotion",
      "Passion": "Passion",
      
      // Courage related
      "Courage": "Courage",
      "Bravery": "Bravery",
      "Valor": "Valor",
      "Heroism": "Heroism",
      "Fearlessness": "Fearlessness",
      
      // Health related
      "Health": "Health",
      "Vitality": "Vitality",
      "Wellness": "Wellness",
      "Vigor": "Vigor",
      "Fitness": "Fitness",
      
      // Freedom related
      "Freedom": "Freedom",
      "Liberty": "Liberty",
      "Independence": "Independence",
      "Autonomy": "Autonomy",
      "Self-determination": "Self-determination"
    };

    // Fonction pour g√©n√©rer un ID unique (3 lettres + 3 chiffres)
    function generateUniqueId() {
      const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      const numbers = '0123456789';
      let id = '';
      
      // G√©n√©rer 3 lettres al√©atoires
      for (let i = 0; i < 3; i++) {
        id += letters.charAt(Math.floor(Math.random() * letters.length));
      }
      
      // G√©n√©rer 3 chiffres al√©atoires
      for (let i = 0; i < 3; i++) {
        id += numbers.charAt(Math.floor(Math.random() * numbers.length));
      }
      
      return id;
    }

    // Fonction pour d√©tecter le pays et la ville de l'utilisateur
    async function detectUserLocation() {
      try {
        const response = await fetch('https://ipapi.co/json/');
        const data = await response.json();
        currentCountry = data.country_name;
        userCity = data.city;
        console.log("Detected user location:", currentCountry, userCity);
        return { country: currentCountry, city: userCity };
      } catch (error) {
        console.error("Error detecting user location:", error);
        return { country: "Unknown", city: "Unknown" };
      }
    }

    // Fonction pour g√©n√©rer des messages personnalis√©s - ENRICHIE avec plus de phrases
    function generatePersonalizedMotivation(flowerCode) {
      if (!flowerCode || flowerCode.length < 8) {
        return i18next.t('motivations.default', "Your flower motivation is here to inspire and guide you.");
      }
      
      // Collection √©largie de traits positifs
      const lifeTraits = [
        i18next.t('motivations.traits.creativity', "Your creativity brings fresh ideas to every challenge."),
        i18next.t('motivations.traits.kindness', "Your kindness inspires others around you."),
        i18next.t('motivations.traits.persistence', "Your persistence helps you overcome obstacles."),
        i18next.t('motivations.traits.perspective', "Your unique perspective solves problems in new ways."),
        i18next.t('motivations.traits.energy', "Your energy brightens the day for everyone you meet."),
        i18next.t('motivations.traits.patience', "Your patience helps you see the bigger picture."),
        i18next.t('motivations.traits.courage', "Your courage allows you to face new challenges."),
        i18next.t('motivations.traits.wisdom', "Your wisdom guides you through difficult decisions."),
        i18next.t('motivations.traits.optimism', "Your optimism helps you find opportunity in any situation."),
        i18next.t('motivations.traits.focus', "Your focus helps you achieve your goals step by step."),
        i18next.t('motivations.traits.adaptability', "Your adaptability is your greatest strength."),
        i18next.t('motivations.traits.intuition', "Your intuition guides you to the right path."),
        i18next.t('motivations.traits.empathy', "Your empathy connects you deeply with others."),
        i18next.t('motivations.traits.resilience', "Your resilience helps you bounce back stronger."),
        i18next.t('motivations.traits.authenticity', "Your authenticity draws people to your true self."),
        i18next.t('motivations.traits.gratitude', "Your gratitude multiplies the joy in your life."),
        i18next.t('motivations.traits.curiosity', "Your curiosity leads to new discoveries."),
        i18next.t('motivations.traits.humor', "Your sense of humor lightens even difficult moments."),
        i18next.t('motivations.traits.generosity', "Your generosity creates ripples of kindness."),
        i18next.t('motivations.traits.determination', "Your determination turns challenges into achievements."),
        i18next.t('motivations.traits.compassion', "Your compassion heals those around you."),
        i18next.t('motivations.traits.clarity', "Your clarity helps you make wise choices."),
        i18next.t('motivations.traits.confidence', "Your confidence inspires trust in others."),
        i18next.t('motivations.traits.mindfulness', "Your mindfulness keeps you centered in chaos."),
        i18next.t('motivations.traits.integrity', "Your integrity earns respect wherever you go."),
        i18next.t('motivations.traits.enthusiasm', "Your enthusiasm ignites passion in others."),
        i18next.t('motivations.traits.warmth', "Your warmth makes people feel instantly welcome."),
        i18next.t('motivations.traits.imagination', "Your imagination opens doors to possibilities."),
        i18next.t('motivations.traits.balance', "Your balance helps you navigate life's complexities.")
      ];
      
      // Collection √©largie d'encouragements
      const lifeEncouragements = [
        i18next.t('motivations.encouragements.share', "Keep sharing your gifts with the world."),
        i18next.t('motivations.encouragements.trust', "Trust your instincts - they rarely lead you astray."),
        i18next.t('motivations.encouragements.talents', "Your natural talents are meant to be shared."),
        i18next.t('motivations.encouragements.challenges', "The path ahead may have challenges, but you're ready for them."),
        i18next.t('motivations.encouragements.steps', "Small steps today lead to big achievements tomorrow."),
        i18next.t('motivations.encouragements.celebrate', "Remember to celebrate your progress along the way."),
        i18next.t('motivations.encouragements.journey', "Your unique journey is worth every step."),
        i18next.t('motivations.encouragements.process', "Don't forget to enjoy the process, not just the results."),
        i18next.t('motivations.encouragements.bestDays', "Your best days are still ahead of you."),
        i18next.t('motivations.encouragements.efforts', "Your efforts today are building your tomorrow."),
        i18next.t('motivations.encouragements.stayTrue', "Stay true to yourself in all situations."),
        i18next.t('motivations.encouragements.change', "Embrace change as an opportunity to grow."),
        i18next.t('motivations.encouragements.wisdom', "Listen to your inner wisdom more often."),
        i18next.t('motivations.encouragements.rest', "Allow yourself to rest when needed."),
        i18next.t('motivations.encouragements.focus', "Keep your focus on what truly matters."),
        i18next.t('motivations.encouragements.gift', "Your presence is a gift to those around you."),
        i18next.t('motivations.encouragements.passions', "Nurture your passions consistently."),
        i18next.t('motivations.encouragements.gentle', "Be gentle with yourself during challenges."),
        i18next.t('motivations.encouragements.path', "Your unique path is exactly right for you."),
        i18next.t('motivations.encouragements.timing', "Trust the timing of your life's unfolding."),
        i18next.t('motivations.encouragements.joy', "Find joy in the small moments each day."),
        i18next.t('motivations.encouragements.perspective', "Your perspective is valuable - share it."),
        i18next.t('motivations.encouragements.believe', "Believe in your ability to create change."),
        i18next.t('motivations.encouragements.remember', "Remember why you started this journey."),
        i18next.t('motivations.encouragements.fresh', "Each day offers a fresh beginning."),
        i18next.t('motivations.encouragements.resilience', "Your resilience is inspiring to others."),
        i18next.t('motivations.encouragements.victories', "Take time to celebrate small victories."),
        i18next.t('motivations.encouragements.strength', "Every challenge you face strengthens you."),
        i18next.t('motivations.encouragements.support', "The universe supports your authentic path."),
        i18next.t('motivations.encouragements.shine', "Your light shines brightest when you're being you.")
      ];
      
      // Pour g√©n√©rer une nouvelle motivation √† chaque fois, utilisons une approche al√©atoire
      const traitIndex = Math.floor(Math.random() * lifeTraits.length);
      const encourageIndex = Math.floor(Math.random() * lifeEncouragements.length);
      
      return lifeTraits[traitIndex] + " " + lifeEncouragements[encourageIndex];
    }

    function generateFlowerCode() {
      const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      let code = '';
      for (let i = 0; i < 8; i++) {
        const randomIndex = Math.floor(Math.random() * characters.length);
        code += characters.charAt(randomIndex);
      }
      return code;
    }

    // Fonction pour obtenir un sujet al√©atoire du dictionnaire
    function getRandomSubject() {
      const subjects = Object.keys(subjectDictionary);
      const randomIndex = Math.floor(Math.random() * subjects.length);
      return subjects[randomIndex];
    }

    // Mise √† jour de l'affichage du flower avec un sujet appropri√©
    function updateFlowerDisplay() {
      const flowerCodeElement = document.getElementById('flowerCodeDisplay');
      const motivationElement = document.getElementById('monthlyMotivation');
      
      // G√©n√©rer un sujet al√©atoire pour le flower si on n'en a pas d√©j√† un
      let subject = localStorage.getItem('flowerSubject');
      if (!subject) {
        subject = getRandomSubject();
        localStorage.setItem('flowerSubject', subject);
      }
      
      // Mettre √† jour l'affichage du code avec le sujet
      flowerCodeElement.textContent = i18next.t('flower.codePrefix', "My Flower") + " - " + i18next.t(`subjects.${subject}`, subject);
      
      // V√©rifier si on a d√©j√† une motivation (pour garder la m√™me motivation dans tous les th√®mes)
      if (!currentMotivation) {
        currentMotivation = generatePersonalizedMotivation(userFlowerCode);
      }
      
      // Utiliser la motivation actuelle
      motivationElement.textContent = currentMotivation;
      
      // Mettre √† jour les √©l√©ments de capture avec la m√™me motivation
      document.getElementById('captureFlowerCode').textContent = i18next.t('flower.codePrefix', "My Flower") + " - " + i18next.t(`subjects.${subject}`, subject);
      document.getElementById('captureFlowerMotivation').textContent = currentMotivation;
      
      return currentMotivation;
    }

    // Fonction pour d√©finir un cookie avec expiration et path sp√©cifique
    function setCookie(name, value, days) {
      let expires = "";
      if (days) {
        const date = new Date();
        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
        expires = "; expires=" + date.toUTCString();
      }
      document.cookie = name + "=" + (value || "") + expires + "; path=/; SameSite=Lax";
    }

    // Fonction pour r√©cup√©rer un cookie
    function getCookie(name) {
      const nameEQ = name + "=";
      const ca = document.cookie.split(';');
      for (let i = 0; i < ca.length; i++) {
        let c = ca[i];
        while (c.charAt(0) === ' ') c = c.substring(1, c.length);
        if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
      }
      return null;
    }

    // Fonction pour d√©finir le th√®me
    function setTheme(theme) {
      // Enlever toutes les classes de th√®me
      document.body.classList.remove('theme-default', 'theme-red-black', 'theme-blue-purple', 'theme-green-blue', 'theme-orange-pink');
      
      // Ajouter la classe du th√®me s√©lectionn√©
      document.body.classList.add('theme-' + theme);
      
      // Mettre √† jour le th√®me actuel
      currentTheme = theme;
      
      // Sauvegarder la pr√©f√©rence dans localStorage et cookie
      localStorage.setItem('preferredTheme', theme);
      setCookie('preferredTheme', theme, 365); // Cookie valide pendant un an
      
      // Mettre √† jour la s√©lection visuelle
      const options = document.querySelectorAll('.style-option');
      options.forEach(option => {
        option.classList.remove('selected');
        if (option.dataset.theme === theme) {
          option.classList.add('selected');
        }
      });
      
      // Mettre √† jour la couleur du cadre et du texte dans la capture en fonction du th√®me
      updateCaptureStyles(theme);
    }
    
    // Fonction pour mettre √† jour les styles de capture en fonction du th√®me
    function updateCaptureStyles(theme) {
      const captureContainer = document.getElementById('flowerCaptureContainer');
      const captureCode = document.getElementById('captureFlowerCode');
      const captureHeader = document.getElementById('captureFlowerHeader');
      const captureWebsiteUrl = document.querySelector('.capture-website-url');
      const captureLogo = document.querySelector('.gz-logo');
      
      // R√©initialiser les styles
      captureContainer.style.borderColor = '';
      captureCode.style.borderColor = '';
      captureCode.style.color = '';
      captureCode.style.backgroundColor = '';
      captureHeader.style.color = '';
      captureWebsiteUrl.style.color = '';
      captureLogo.style.color = '';
      captureLogo.style.borderColor = '';
      
      // Appliquer les styles en fonction du th√®me
      switch(theme) {
        case 'red-black':
          captureContainer.style.borderColor = '#8B0000';
          captureContainer.style.backgroundColor = '#1F1F1F';
          captureCode.style.borderColor = '#FF4500';
          captureCode.style.color = '#FF4500';
          captureCode.style.backgroundColor = '#2C2C2C';
          captureHeader.style.color = '#FF4500';
          captureWebsiteUrl.style.color = '#FF4500';
          captureLogo.style.color = '#FF4500';
          captureLogo.style.borderColor = '#FF4500';
          break;
          
        case 'blue-purple':
          captureContainer.style.borderColor = '#5865F2';
          captureContainer.style.backgroundColor = '#2C2C54';
          captureCode.style.borderColor = '#5865F2';
          captureCode.style.color = '#5865F2';
          captureCode.style.backgroundColor = '#3A3A8C';
          captureHeader.style.color = '#5865F2';
          captureWebsiteUrl.style.color = '#5865F2';
          captureLogo.style.color = '#5865F2';
          captureLogo.style.borderColor = '#5865F2';
          break;
          
        case 'green-blue':
          captureContainer.style.borderColor = '#3EB489';
          captureContainer.style.backgroundColor = '#1A2E4D';
          captureCode.style.borderColor = '#3EB489';
          captureCode.style.color = '#3EB489';
          captureCode.style.backgroundColor = '#36454F';
          captureHeader.style.color = '#3EB489';
          captureWebsiteUrl.style.color = '#3EB489';
          captureLogo.style.color = '#3EB489';
          captureLogo.style.borderColor = '#3EB489';
          break;
          
        case 'orange-pink':
          captureContainer.style.borderColor = '#FF7F50';
          captureContainer.style.backgroundColor = '#4B0082';
          captureCode.style.borderColor = '#FF7F50';
          captureCode.style.color = '#FF7F50';
          captureCode.style.backgroundColor = '#6A0DAD';
          captureHeader.style.color = '#FF7F50';
          captureWebsiteUrl.style.color = '#FF7F50';
          captureLogo.style.color = '#FF7F50';
          captureLogo.style.borderColor = '#FF7F50';
          break;
          
        default: // theme-default
          captureContainer.style.borderColor = '#007bff';
          captureContainer.style.backgroundColor = 'white';
          captureCode.style.borderColor = '#ff69b4';
          captureCode.style.color = '#ff69b4';
          captureCode.style.backgroundColor = '#fff0f8';
          captureHeader.style.color = '#007bff';
          captureWebsiteUrl.style.color = '#007bff';
          captureLogo.style.color = '#007bff';
          captureLogo.style.borderColor = '#007bff';
      }
    }

    // S'authentifier √† Firebase
    function authenticateAnonymously() {
      return new Promise((resolve, reject) => {
        signInAnonymously(auth)
          .then((userCredential) => {
            console.log("User authenticated anonymously:", userCredential.user.uid);
            userUid = userCredential.user.uid;
            isAuthenticated = true;
            resolve(userCredential.user);
          })
          .catch((error) => {
            console.error("Authentication error:", error);
            reject(error);
          });
      });
    }

    // √âcouter les changements d'√©tat d'authentification
    onAuthStateChanged(auth, (user) => {
      if (user) {
        // L'utilisateur est connect√©
        userUid = user.uid;
        isAuthenticated = true;
        console.log("Auth state changed: user is signed in", user.uid);
      } else {
        // L'utilisateur est d√©connect√©
        isAuthenticated = false;
        console.log("Auth state changed: user is signed out");
      }
    });

    // Soumettre √† Firebase (version simplifi√©e avec uniquement les donn√©es demand√©es)
    async function submitToFirebase() {
      try {
        // S'assurer que l'utilisateur est authentifi√© avant de soumettre
        if (!isAuthenticated) {
          console.log("User not authenticated, authenticating now...");
          await authenticateAnonymously();
        }
        
        // Obtenir la localisation de l'utilisateur
        const location = await detectUserLocation();
        
        // Pr√©parer les donn√©es utilisateur (uniquement celles demand√©es)
        const userData = {
          date: new Date().toISOString(), // Date et heure actuelles
          country: location.country || "Unknown",
          city: location.city || "Unknown",
          uid: userUid,
          uniqueId: userUniqueId,
          flowerCode: userFlowerCode,
          motivation: currentMotivation, // Sauvegarder la motivation avec les donn√©es
          timestamp: Date.now(),
          theme: currentTheme, // Sauvegarder le th√®me pr√©f√©r√©
          subject: localStorage.getItem('flowerSubject') || getRandomSubject() // Sauvegarder le sujet du flower
        };

        console.log("Submitting data to Firebase:", userData);
        
        // Soumettre √† Realtime Database
        const newEntryRef = await push(ref(database, 'birthdates'), userData);
        console.log("Data submitted to Realtime Database:", newEntryRef.key);
        
        // Soumettre √† Firestore √©galement
        try {
          const docRef = await addDoc(collection(firestore, 'flowers'), userData);
          console.log("Document written to Firestore with ID: ", docRef.id);
        } catch (firestoreError) {
          console.error("Error adding document to Firestore: ", firestoreError);
        }
        
        // Ajouter dans une collection sp√©cifique pour les codes
        try {
          await setDoc(doc(firestore, 'flowerCodes', userUniqueId), {
            ...userData,
            createdAt: new Date()
          });
          console.log("Flower code added to specific collection");
        } catch (codeError) {
          console.error("Error adding flower code to collection: ", codeError);
        }
        
        // Sauvegarder dans localStorage et cookies pour l'installation
        localStorage.setItem('userFlowerData', JSON.stringify(userData));
        localStorage.setItem('isInstalled', 'true');
        setCookie('userUniqueId', userUniqueId, 365);
        setCookie('userFlowerCode', userFlowerCode, 365);
        setCookie('isInstalled', 'true', 365);
        isInstalled = true;
        
        return true;
      } catch (error) {
        console.error("Firebase submission error:", error);
        return false;
      }
    }

    // V√©rifier si l'utilisateur a d√©j√† des donn√©es sauvegard√©es
    function checkSavedUserData() {
      // V√©rifier d'abord dans les cookies
      const cookieUniqueId = getCookie('userUniqueId');
      const cookieFlowerCode = getCookie('userFlowerCode');
      const cookieInstalled = getCookie('isInstalled');
      
      if (cookieUniqueId && cookieFlowerCode) {
        userUniqueId = cookieUniqueId;
        userFlowerCode = cookieFlowerCode;
        isInstalled = cookieInstalled === 'true';
        
        // G√©n√©rer une motivation bas√©e sur le code sauvegard√©
        currentMotivation = generatePersonalizedMotivation(userFlowerCode);
        
        console.log("Found saved user data in cookies:", { userUniqueId, userFlowerCode });
        return true;
      }
      
      // Si pas dans les cookies, essayer localStorage
      const savedData = localStorage.getItem('userFlowerData');
      if (savedData) {
        try {
          const userData = JSON.parse(savedData);
          userUniqueId = userData.uniqueId;
          userFlowerCode = userData.flowerCode;
          currentMotivation = userData.motivation || generatePersonalizedMotivation(userData.flowerCode);
          userUid = userData.uid;
          isInstalled = localStorage.getItem('isInstalled') === 'true';
          
          // Sauvegarder dans les cookies pour une persistance accrue
          setCookie('userUniqueId', userUniqueId, 365);
          setCookie('userFlowerCode', userFlowerCode, 365);
          setCookie('isInstalled', 'true', 365);
          
          console.log("Found saved user data in localStorage:", userData);
          return true;
        } catch (e) {
          console.error("Error parsing saved user data:", e);
          return false;
        }
      }
      return false;
    }

    // Initialiser l'application au chargement
    window.addEventListener('load', async () => {
      // V√©rifier le th√®me pr√©f√©r√©
      const savedTheme = localStorage.getItem('preferredTheme') || getCookie('preferredTheme');
      if (savedTheme) {
        setTheme(savedTheme);
      } else {
        // D√©finir le th√®me par d√©faut √† vert-bleu s'il n'y a pas de th√®me sauvegard√©
        setTheme('green-blue');
      }
      
      // V√©rifier si l'utilisateur a d√©j√† des donn√©es
      if (checkSavedUserData()) {
        console.log("User already has data, hiding welcome modal");
        document.getElementById('welcomeModal').style.display = 'none';
        
        // Authentifier l'utilisateur si n√©cessaire
        if (!isAuthenticated) {
          try {
            await authenticateAnonymously();
          } catch (error) {
            console.error("Error during authentication:", error);
          }
        }
      } else {
        console.log("No saved user data found, showing welcome modal");
        document.getElementById('welcomeModal').style.display = 'block';
      }
    });

    // Gestion du bouton flower
    document.getElementById('flowerButton').addEventListener('click', function() {
      if (!userUniqueId) {
        alert(i18next.t('alerts.generateFirst', "Please generate your flower first by clicking OK on the welcome screen."));
        return;
      }
      
      // Utiliser la m√™me motivation pour tous les th√®mes
      updateFlowerDisplay();
      document.getElementById('flowerModal').style.display = 'block';
      document.getElementById('shareFlowerButton').style.display = 'flex';
    });

    document.getElementById('shareFlowerButton').addEventListener('click', function() {
      captureFlower();
    });
    
    // Afficher le modal d'ID unique quand on clique sur l'ic√¥ne ID
    document.getElementById('showIdButton').addEventListener('click', function() {
      if (userUniqueId) {
        document.getElementById('userIdDisplay').textContent = userUniqueId;
        document.getElementById('idModal').style.display = 'block';
      } else {
        alert(i18next.t('alerts.idFirst', "Please generate your flower first to get your unique ID."));
      }
    });
    
    // Copier l'ID quand on clique sur l'ic√¥ne de copie
    document.getElementById('copyIdButton').addEventListener('click', function() {
      const idText = document.getElementById('userIdDisplay').textContent;
      navigator.clipboard.writeText(idText).then(function() {
        alert(i18next.t('alerts.idCopied', 'ID copied to clipboard!'));
      }).catch(function() {
        alert(i18next.t('alerts.copyFailed', 'Could not copy ID. Please select and copy manually.'));
      });
    });
    
    // Fermer le modal d'ID
    document.getElementById('closeIdModal').addEventListener('click', function() {
      document.getElementById('idModal').style.display = 'none';
    });
    
    // Gestionnaire pour le bouton de rafra√Æchissement de la motivation
    document.getElementById('refreshMotivation').addEventListener('click', function() {
      // G√©n√©rer une nouvelle motivation
      const newMotivation = generatePersonalizedMotivation(userFlowerCode);
      currentMotivation = newMotivation;
      
      // G√©n√©rer un nouveau sujet
      const newSubject = getRandomSubject();
      localStorage.setItem('flowerSubject', newSubject);
      
      // Mettre √† jour l'affichage
      document.getElementById('flowerCodeDisplay').textContent = i18next.t('flower.codePrefix', "My Flower") + " - " + i18next.t(`subjects.${newSubject}`, newSubject);
      document.getElementById('monthlyMotivation').textContent = newMotivation;
      document.getElementById('captureFlowerCode').textContent = i18next.t('flower.codePrefix', "My Flower") + " - " + i18next.t(`subjects.${newSubject}`, newSubject);
      document.getElementById('captureFlowerMotivation').textContent = newMotivation;
      
      // Animation de rotation pour l'ic√¥ne
      this.style.transition = 'transform 0.5s ease';
      this.style.transform = 'rotate(360deg)';
      
      // R√©initialiser l'animation apr√®s une rotation compl√®te
      setTimeout(() => {
        this.style.transition = 'none';
        this.style.transform = 'rotate(0deg)';
      }, 500);
    });
    
    // Gestionnaire d'√©v√©nement pour le bouton OK du modal d'accueil
    document.getElementById('agreeButton').addEventListener('click', async function() {
      try {
        // Authentifier l'utilisateur d'abord
        await authenticateAnonymously();
        
        // G√©n√©rer un ID unique
        userUniqueId = generateUniqueId();
        console.log("Generated unique ID:", userUniqueId);
        
        // G√©n√©rer un code flower
        userFlowerCode = generateFlowerCode();
        
        // G√©n√©rer un sujet pour le flower
        const subject = getRandomSubject();
        localStorage.setItem('flowerSubject', subject);
        
        // G√©n√©rer une motivation
        currentMotivation = generatePersonalizedMotivation(userFlowerCode);
        document.getElementById('welcomeModal').style.display = 'none';
        
        // Soumettre √† Firebase si pas encore install√©
        if (!isInstalled) {
          const submitted = await submitToFirebase();
          if (!submitted) {
            console.log("Firebase submission failed, but continuing with local installation");
          }
        }
        const userData = {
          date: new Date().toISOString(),
          uid: userUid,
          uniqueId: userUniqueId,
          flowerCode: userFlowerCode,
          motivation: currentMotivation,
          timestamp: Date.now(),
          theme: currentTheme,
          subject: subject
        };
        
        localStorage.setItem('userFlowerData', JSON.stringify(userData));
        localStorage.setItem('isInstalled', 'true');
        setCookie('userUniqueId', userUniqueId, 365);
        setCookie('userFlowerCode', userFlowerCode, 365);
        setCookie('isInstalled', 'true', 365);
        isInstalled = true;
        
        // Afficher le flower automatiquement apr√®s la g√©n√©ration
        updateFlowerDisplay();
        document.getElementById('flowerModal').style.display = 'block';
        document.getElementById('shareFlowerButton').style.display = 'flex';
        
        console.log("Setup complete and data stored locally and in cookies");
      } catch (error) {
        console.error("Error during setup:", error);
        alert(i18next.t('alerts.setupError', "There was a problem setting up your flower. Please try again."));
      }
    });
    
    async function captureFlower() {
      try {
        const captureContainer = document.getElementById('flowerCaptureContainer');
        
        // Mettre √† jour les styles de capture en fonction du th√®me actuel
        updateCaptureStyles(currentTheme);
        
        if (typeof html2canvas === 'undefined') {
          await loadHTML2Canvas();
        }
        
        const canvas = await html2canvas(captureContainer, {
          backgroundColor: 'white',
          scale: 7,
          logging: false,
          useCORS: true,
          allowTaint: false,
          letterRendering: true,
          imageTimeout: 0
        });
        
        const imageUrl = canvas.toDataURL('image/png', 1.0);
        
        document.getElementById('capturedImage').src = imageUrl;
        document.getElementById('capturedFlower').style.display = 'flex';
        
        document.getElementById('shareWarning').style.display = 'block';
      } catch (error) {
        console.error('Error capturing flower:', error);
        alert(i18next.t('alerts.captureError', 'Could not capture your flower. Please try again.'));
      }
    }
    
    function loadHTML2Canvas() {
      return new Promise((resolve, reject) => {
        const script = document.createElement('script');
        script.src = 'https://html2canvas.hertzen.com/dist/html2canvas.min.js';
        script.onload = resolve;
        script.onerror = reject;
        document.head.appendChild(script);
      });
    }
    
    document.getElementById('shareCapture').addEventListener('click', function() {
      const imageUrl = document.getElementById('capturedImage').src;
      
      if (navigator.share) {
        fetch(imageUrl)
          .then(res => res.blob())
          .then(blob => {
            const file = new File([blob], 'my-gz-flower.png', { type: 'image/png' });
            navigator.share({
              title: i18next.t('share.title', 'My G-Z Flower'),
              text: i18next.t('share.text', 'Discover yours at g-z.online'),
              files: [file]
            }).catch(err => {
              console.log('Error sharing:', err);
              fallbackShare();
            });
          })
          .catch(err => {
            console.log('Error preparing image:', err);
            fallbackShare();
          });
      } else {
        fallbackShare();
      }
    });
    
    function fallbackShare() {
      try {
        const shareText = i18next.t('share.fallbackText', `Check out my Flower of Life from G-Z: ${userUniqueId}. Discover yours at g-z.online`);
        
        navigator.clipboard.writeText(shareText).then(function() {
          alert(i18next.t('alerts.shareCopied', 'Share text copied to clipboard!'));
        }).catch(function() {
          alert(i18next.t('alerts.shareError', 'Could not copy share text.'));
        });
      } catch (error) {
        console.error('Fallback share error:', error);
        alert(i18next.t('alerts.generalError', 'An error occurred.'));
      }
    }
    
    document.getElementById('closeCapture').addEventListener('click', function() {
      document.getElementById('capturedFlower').style.display = 'none';
    });
    
    document.getElementById('closeFlowerModal').addEventListener('click', function() {
      document.getElementById('flowerModal').style.display = 'none';
      document.getElementById('shareFlowerButton').style.display = 'none';
    });

    window.onclick = function(event) {
      const flowerModal = document.getElementById('flowerModal');
      const capturedFlower = document.getElementById('capturedFlower');
      const idModal = document.getElementById('idModal');
      
      if (event.target == flowerModal) {
        flowerModal.style.display = "none";
        document.getElementById('shareFlowerButton').style.display = 'none';
      }
      
      if (event.target == capturedFlower) {
        capturedFlower.style.display = "none";
      }
      
      if (event.target == idModal) {
        idModal.style.display = "none";
      }
    };
    
    // Initialiser les √©l√©ments d'interface
    document.getElementById('shareFlowerButton').style.display = 'none';
    document.getElementById('shareWarning').style.display = 'none';
    
    // Gestionnaires pour le s√©lecteur de th√®me
    document.querySelectorAll('.style-option').forEach(option => {
      option.addEventListener('click', function() {
        const theme = this.dataset.theme;
        setTheme(theme);
      });
    });
    
    loadHTML2Canvas().catch(err => console.log('Non-critical preload error:', err));
  </script>
  
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
</body>
</html>
