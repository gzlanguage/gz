<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>G-Z</title>
    <link rel="icon" href="https://firebasestorage.googleapis.com/v0/b/genz-abb36.appspot.com/o/photo_2025-03-09_13-00-43.jpg?alt=media&token=e3d3c543-164c-4c79-8cd1-0a9c710fb002">
    <link href="https://fonts.googleapis.com/css2?family=Billabong&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <style>
        /* Empêcher le zoom sur iOS */
        input, textarea, select, button {
            font-size: 16px; /* Police minimum de 16px pour éviter le zoom automatique sur iOS */
            touch-action: manipulation; /* Désactive la manipulation tactile spécifique */
        }
        
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: white;
            position: relative;
            transition: background-color 0.3s ease;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            -webkit-text-size-adjust: 100%; /* Empêche l'ajustement automatique de la taille du texte */
            overflow-x: hidden; /* Empêche le défilement horizontal */
        }
        header {
            background-color: white;
            padding: 6px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: background-color 0.3s ease;
            position: sticky; /* Garder l'en-tête visible */
            top: 0;
            z-index: 100;
            width: 100%;
            box-sizing: border-box;
        }
        
        h1 {
            margin: 0;
            font-size: 1.4em;
            font-family: 'Billabong', cursive;
            color: #007bff;
            border: 2px solid #007bff;
            padding: 4px;
            border-radius: 12px;
            font-weight: bold;
            transition: color 0.3s ease, border-color 0.3s ease;
        }
        .divider {
            height: 0.6px;
            background-color: #007bff;
            width: 100%;
            margin-top: 5px;
            transition: background-color 0.3s ease;
        }
        .button-container {
            display: flex;
            justify-content: center;
            margin-top: 5px;
            padding: 5px 0;
            overflow-x: auto;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        .button-container::-webkit-scrollbar {
            display: none;
        }
        .button {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 5px 10px;
            margin: 0 3px;
            font-size: 0.8em;
            cursor: pointer;
            text-decoration: none;
            display: flex;
            align-items: center;
            flex-shrink: 0;
            transition: background-color 0.3s ease;
        }
        .button i {
            margin-right: 2px;
        }
        .notification {
            text-align: center;
            margin-top: 10px;
            font-size: 0.8em;
            color: #0056b3;
            font-weight: bold;
            transition: color 0.3s ease;
            /* Reduced height of notification container */
            padding: 3px 0;
            max-height: 30px;
            overflow: hidden;
        }
        .share-icon {
            color: #007bff;
            cursor: pointer;
            font-size: 1.3em;
            border: 1px solid #007bff;
            border-radius: 7px;
            padding: 4px;
            background-color: white;
            transition: color 0.3s ease, border-color 0.3s ease;
        }
        footer {
            background-color: white;
            color: black;
            padding: 10px 15px;
            margin-top: auto;
            transition: background-color 0.3s ease, color 0.3s ease;
            position: relative; /* Assurer que le footer reste en bas */
            width: 100%;
            box-sizing: border-box;
        }
        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo-container {
            display: flex;
        }
        .logo {
            color: #007bff;
            font-size: 1.6em;
            margin-right: 10px;
            border: 1px solid #007bff;
            border-radius: 10px;
            padding: 5px;
            background-color: rgba(0, 119, 190, 0.1);
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
        }
        .logo:hover {
            background-color: #007bff;
            color: white;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .modal.show {
            opacity: 1;
        }
        .modal-content {
            background-color: white;
            margin: 50% auto;
            padding: 14px;
            border: 1px solid #007bff;
            border-radius: 60px;
            width: 280px;
            max-width: 70%;
            text-align: center;
            max-height: 60vh;
            overflow-y: auto;
            position: relative;
            transition: background-color 0.3s ease, border-color 0.3s ease, transform 0.3s ease;
            transform: scale(0.8);
        }
        .modal.show .modal-content {
            transform: scale(1);
        }
        .modal-header {
            font-size: 1.8em;
            font-family: 'Billabong', cursive;
            margin-bottom: 10px;
            font-weight: bold;
            color: #007bff;
            text-decoration: underline;
            transition: color 0.3s ease;
        }
        
        .modal-footer {
            margin-top: 15px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 6px;
        }
        .close-button {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 8px 10px;
            cursor: pointer;
            font-size: 0.9em;
            width: 120px;
            margin: 4px;
            transition: background-color 0.3s ease;
        }
        .close-button:hover {
            background-color: #0056b3;
        }
        
        @keyframes flowerRotate {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(15deg); }
            50% { transform: rotate(0deg); }
            75% { transform: rotate(-15deg); }
            100% { transform: rotate(0deg); }
        }
        
        .flower-icon {
            display: inline-block;
            animation: flowerRotate 2s infinite ease-in-out;
            color: #ff69b4;
        }
        
        .billabong-title {
            font-family: 'Billabong', cursive;
            font-size: 1.8em;
            margin-bottom: 8px;
            color: #007bff;
            transition: color 0.3s ease;
        }

        .monthly-motivation {
            margin: 15px 0;
            padding: 10px;
            border: 1px dashed #ff69b4;
            border-radius: 15px;
            background-color: white;
            font-style: italic;
            color: #333;
            font-size: 0.9em;
            line-height: 1.4;
            transition: border-color 0.3s ease, color 0.3s ease, background-color 0.3s ease;
            position: relative;
        }
        
        .flower-code {
            display: block;
            font-weight: bold;
            color: #ff69b4;
            font-size: 0.9em;
            margin-bottom: 8px;
            letter-spacing: 0.5px;
            background-color: #fff0f8;
            padding: 6px;
            border-radius: 8px;
            border: 1px solid #ff69b4;
            max-width: 220px;
            margin-left: auto;
            margin-right: auto;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            transition: color 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
        }
        
        .copy-icon {
            color: #007bff;
            cursor: pointer;
            margin-left: 10px;
            font-size: 1.2em;
            vertical-align: middle;
            transition: color 0.3s ease;
        }
        
        .header-controls {
            display: flex;
            align-items: center;
        }
        
        .celebrate-icon {
            font-size: 2em;
            color: gold;
            margin-bottom: 8px;
            animation: celebrate 2s infinite alternate;
        }
        
        @keyframes celebrate {
            0% { transform: scale(1); }
            50% { transform: scale(1.1) rotate(5deg); }
            100% { transform: scale(1) rotate(-5deg); }
        }
        
        .modal-close {
            position: absolute;
            top: 10px;
            right: 20px;
            color: #ff0000;
            font-size: 13px;
            cursor: pointer;
            background-color: transparent;
            border: none;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.2s;
        }
        
        .modal-close:hover {
            background-color: rgba(255, 0, 0, 0.1);
        }
        
        .share-flower-button {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 14px;
            padding: 8px 16px;
            font-size: 0.9em;
            margin: 290px auto;
            display: none;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
            max-width: 190px;
            position: relative;
            z-index: 1001;
            border: 1px solid #0056b3;
        }
        
        .share-flower-button:hover {
            background-color: #0056b3;
        }
        
        .share-flower-button i {
            margin-left: 8px;
        }
        
        #capturedFlower {
            position: fixed;
            z-index: 1003;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .captured-image-container {
            position: relative;
            max-width: 85%;
            max-height: 60vh;
            margin-bottom: 15px;
        }
        
        .captured-image {
            max-width: 100%;
            max-height: 60vh;
            border-radius: 15px;
            border: 2px solid white;
        }
        
        .share-message {
            background-color: white;
            color: #333;
            padding: 10px 15px;
            border-radius: 15px;
            font-size: 0.9em;
            margin: 10px auto;
            max-width: 90%;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        .share-message i {
            margin-left: 8px;
            color: #007bff;
            transition: color 0.3s ease;
        }
        
        .share-link {
            color: #007bff;
            font-weight: bold;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        .capture-controls {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }
        
        .capture-button {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 20px;
            padding: 8px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
            transition: background-color 0.3s ease;
        }
        
        .capture-button i {
            margin-right: 5px;
        }
        
        .close-capture {
            background-color: #f0f0f0;
            color: #333;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        #flowerCaptureContainer {
            position: fixed;
            z-index: -1;
            top: 0;
            left: -9999px;
            background-color: white;
            border: 2px solid #007bff;
            border-radius: 20px;
            padding: 15px;
            width: 300px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        
        .capture-flower-header {
            font-family: 'Billabong', cursive;
            color: #007bff;
            font-size: 1.8em;
            margin-bottom: 8px;
            text-align: center;
            font-weight: bold;
            text-shadow: 0px 1px 1px rgba(0, 123, 255, 0.2);
            transition: color 0.3s ease;
        }
        
        .capture-flower-code {
            font-weight: bold;
            color: #ff69b4;
            font-size: 0.8em;
            background-color: #fff0f8;
            padding: 6px;
            border-radius: 10px;
            border: 1px solid #ff69b4;
            margin: 6px auto;
            text-align: center;
            max-width: 80%;
            letter-spacing: 0.5px;
            transition: color 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
        }
        
        .capture-flower-motivation {
            font-style: italic;
            color: #333;
            font-size: 0.95em;
            line-height: 1.4;
            background-color: #f9f9f9;
            border: 1px dashed #ff69b4;
            border-radius: 12px;
            padding: 12px;
            margin: 12px 0;
            text-align: center;
            transition: color 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
            position: relative;
        }
        
        .capture-flower-icon {
            text-align: center;
            font-size: 2.5em;
            color: #ff69b4;
            margin: 10px 0;
            transition: color 0.3s ease;
        }
        
        .gz-logo {
            font-family: 'Billabong', cursive;
            color: #007bff;
            font-size: 1.4em;
            text-align: center;
            margin-top: 10px;
            border: 2px solid #007bff;
            border-radius: 12px;
            padding: 4px;
            width: 50px;
            margin-left: auto;
            margin-right: auto;
            font-weight: bold;
            transition: color 0.3s ease, border-color 0.3s ease;
        }
        
        .share-warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
            border-radius: 15px;
            padding: 10px 15px;
            font-size: 0.85em;
            margin: 5px auto 15px auto;
            max-width: 90%;
            text-align: center;
            display: none;
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }
        
        .capture-website-url {
            text-align: center;
            font-size: 0.85em;
            color: #007bff;
            font-weight: bold;
            margin-top: 8px;
            font-family: Arial, sans-serif;
            padding: 3px 0;
            border-top: 1px dashed #007bff;
            transition: color 0.3s ease, border-color 0.3s ease;
        }
        
        .terms-text {
            font-size: 0.8em;
            color: black;
            text-align: center;
            margin: 10px auto;
            width: 330px;
            transition: color 0.3s ease;
        }
        
        .billabong-title {
            margin-bottom: 3px;
        }

        /* Header styles */
        .header-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            padding: 0 1px;
        }

        .header-icon {
            font-size: 1.4em;
            color: #007bff;
            border: 2px solid #007bff;
            padding: 4px;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            transition: color 0.3s ease, border-color 0.3s ease;
        }

        .app-logo {
            font-family: 'Billabong', cursive;
            color: #007bff;
            border: 2px solid #007bff;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 1.4em;
            font-weight: bold;
            transition: color 0.3s ease, border-color 0.3s ease;
        }

        .header-flex {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
        }
        
        /* New header structure */
        .right-controls {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        /* Welcome toast notification */
        #welcomeToast {
            position: fixed;
            top: 160px;
            left: 0;
            right: 0;
            background-color: rgba(0,0,0,0.7);
            color: white;
            padding: 10px;
            border-radius: 20px;
            width: 80%;
            max-width: 300px;
            margin: 0 auto;
            text-align: center;
            z-index: 2000;
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease;
            font-family: , cursive;
            font-size: 1.1em;
            border: 2px solid #4CAF50; /* Bordure verte de 2px comme demandé */
        }

        /* Initial welcome modal */
        #welcomeModal {
            display: none;
            position: fixed;
            z-index: 10;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        #welcomeModal.show {
            opacity: 1;
        }

        /* Welcome modal content */
        #welcomeModal .modal-content {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            margin: 20px auto; /* Modifié pour être plus proche du haut */
            padding: 15px 10px;
            border: 2px solid #4CAF50;
            border-radius: 25px;
            width: 85%;
            max-width: 290px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            text-align: center;
            transition: transform 0.3s ease;
            transform: scale(0.8);
            max-height: calc(100vh - 40px); /* Limite la hauteur pour éviter le débordement */
            overflow-y: auto; /* Permet le défilement si le contenu est trop grand */
        }
        #welcomeModal.show .modal-content {
            transform: scale(1);
        }

        #welcomeModal .close {
            color: red;
            font-size: 18px;
            font-weight: bold;
            display: block;
            text-align: center;
            margin-bottom: 3px;
            cursor: pointer;
            position: absolute;
            top: 10px;
            right: 15px;
        }

        #welcomeModal .welcome-header {
            color: #007bff;
            font-family: 'Billabong', cursive;
            font-size: 1.8em;
            margin-bottom: 8px;
            text-align: center;
            font-weight: bold;
            padding-top: 10px; /* Espace pour le bouton de fermeture */
        }

        #welcomeModal .welcome-text {
            margin: 10px 0 15px 0;
            font-size: 0.8em;
            color: #333;
            line-height: 1.4;
            transition: color 0.3s ease;
        }

        /* Birthday selector */
        .dob-container {
            margin: 10px 0;
        }

        .dob-container label {
            display: block;
            font-size: 0.8em;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        .dob-input {
            width: 90%;
            padding: 8px;
            border-radius: 10px;
            border: 1px solid #ccc;
            font-size: 16px;
            box-sizing: border-box; /* S'assure que le padding est inclus dans la largeur */
        }

        /* Profession selector */
        .profession-container {
            margin: 12px 0;
            position: relative;
        }

        .profession-container label {
            display: block;
            font-size: 0.8em;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        .profession-search {
            width: 90%;
            padding: 8px;
            border-radius: 10px;
            border: 1px solid #ccc;
            font-size: 16px;
            box-sizing: border-box;
        }

        .profession-dropdown {
            display: none;
            position: absolute;
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 10px;
            width: 90%;
            max-height: 150px;
            overflow-y: auto;
            left: 5%;
            z-index: 10;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .profession-option {
            padding: 8px 10px;
            font-size: 0.8em;
            cursor: pointer;
            transition: background-color 0.2s;
            background-color: white;
            color: #333;
        }

        .profession-option:hover {
            background-color: #f5f5f5;
        }

        /* Name input */
        .name-container {
            margin: 10px 0;
        }

        .name-container label {
            display: block;
            font-size: 0.8em;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        .name-input {
            width: 90%;
            padding: 8px;
            border-radius: 10px;
            border: 1px solid #ccc;
            font-size: 16px;
            box-sizing: border-box;
        }

        /* Submit button */
        #createAccountButton {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 10px 25px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            margin: 10px auto 5px;
            display: block;
            width: 80%;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 123, 255, 0.3);
            box-sizing: border-box;
        }
        
        #createAccountButton:hover {
            background: linear-gradient(135deg, #0056b3 0%, #003d80 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 123, 255, 0.4);
        }
        
        #createAccountButton:active {
            transform: translateY(0);
            box-shadow: 0 1px 3px rgba(0, 123, 255, 0.3);
        }

        /* Loading spinner */
        .loading-spinner {
            display: none;
            text-align: center;
            margin: 10px 0;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        .loading-dots::after {
            content: '...';
            animation: dots 1.5s infinite;
            display: inline-block;
            width: 20px;
            text-align: left;
        }

        /* ID modal */
        #idModal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        #idModal.show {
            opacity: 1;
        }

        #idModal .modal-content {
            background-color: #fff;
            margin: 45% auto;
            padding: 15px;
            border: 1px solid #007BFF;
            border-radius: 25px;
            width: 65%;
            max-width: 250px;
            text-align: center;
            transition: transform 0.3s ease;
            transform: scale(0.8);
        }
        #idModal.show .modal-content {
            transform: scale(1);
        }

        .id-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }

        .id-title {
            font-size: 1em;
            color: #007bff;
            margin-bottom: 5px;
            transition: color 0.3s ease;
        }

        .id-display {
            font-weight: bold;
            font-size: 1.2em;
            color: #ff69b4;
            background-color: #fff0f8;
            padding: 6px;
            border-radius: 8px;
            border: 1px solid #ff69b4;
            margin: 5px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            max-width: 80%;
            transition: color 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
        }

        .delete-account {
            background-color: #ff4d4d;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 6px 10px;
            font-size: 0.7em;
            cursor: pointer;
            transition: background-color 0.3s;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .delete-account:hover {
            background-color: #e60000;
        }

        .copy-icon {
            margin-left: 6px;
        }

        .id-message {
            font-size: 0.7em;
            color: #333;
            margin: 5px 0;
            transition: color 0.3s ease;
        }

        #idModal .close-button {
            margin-top: 8px;
            width: auto;
            padding: 6px 15px;
            font-size: 0.7em;
            height: 28px;
        }

        /* Menu link without underline */
        .menu-link {
            text-decoration: none;
            color: #007bff;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.3s ease;
        }
        
        /* Style selector (themes) */
        .style-selector {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: white;
            padding: 10px 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 100;
            transition: background-color 0.3s ease;
        }
        
        .style-selector h3 {
            text-align: center;
            margin: 0 0 10px 0;
            font-size: 1em;
            color: #333;
            transition: color 0.3s ease;
        }
        
        .style-options {
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 0 5px;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        .style-options::-webkit-scrollbar {
            display: none;
        }
        
        .style-option {
            width: 60px;
            height: 40px;
            border-radius: 10px;
            cursor: pointer;
            flex-shrink: 0;
            position: relative;
            border: 1px solid #ddd;
            overflow: hidden;
        }
        
        .style-option.selected {
            border: 2px solid white;
            box-shadow: 0 0 0 2px #007bff;
        }
        
        /* Theme styles */
        .style-option.red-black {
            background: linear-gradient(to right, #FF4500, #8B0000, #121212, #121212);
        }
        
        .style-option.green-blue {
            background: linear-gradient(to right, #3EB489, #14532D, #0A2239, #1A2E4D);
        }
        
        .style-option.orange-pink {
            background: linear-gradient(to right, #FF7F50, #FF6F91, #C71585, #4B0082);
        }
        
        .style-option.yellow-purple {
            background: linear-gradient(to right, #FFD700, #FFA500, #8A2BE2, #4B0082);
        }
        
        .style-option.default {
            background: linear-gradient(to right, #007bff, #0056b3);
        }
        
        /* Main content with padding to avoid overlap with style selector */
        .main-content {
            padding-bottom: 80px;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            width: 100%;
            overflow-x: hidden; /* Empêche le défilement horizontal */
        }
        
        /* Default theme (blue) */
        body.theme-default {
            background-color: white;
            color: #333;
        }
        
        body.theme-default header, 
        body.theme-default footer,
        body.theme-default .style-selector {
            background-color: white;
        }
        
        body.theme-default .app-logo,
        body.theme-default .header-icon,
        body.theme-default .divider,
        body.theme-default .notification,
        body.theme-default .billabong-title,
        body.theme-default .gz-logo,
        body.theme-default .capture-website-url,
        body.theme-default .capture-flower-header,
        body.theme-default .id-title {
            color: #007bff;
            border-color: #007bff;
        }
        
        body.theme-default .notification .notification-text {
            color: #007bff;
        }
        
        body.theme-default .button {
            background-color: #007bff;
        }
        
        body.theme-default .share-flower-button {
            background-color: #007bff;
            color: white;
            border-color: #0056b3;
        }
        
        body.theme-default .flower-code,
        body.theme-default .id-display {
            color: #ff69b4;
            background-color: #fff0f8;
            border-color: #ff69b4;
        }
        
        body.theme-default .monthly-motivation,
        body.theme-default .capture-flower-motivation {
            border-color: #ff69b4;
            color: #333;
            background-color: white;
        }
        
        body.theme-default .modal-content {
            background-color: white;
            border-color: #007bff;
        }
        
        /* Red-Black Theme */
        body.theme-red-black {
            background: black;
            color: #E5E5E5;
        }
        
        body.theme-red-black header, 
        body.theme-red-black footer,
        body.theme-red-black .style-selector {
            background-color: black;
        }
        
        body.theme-red-black .app-logo,
        body.theme-red-black .header-icon,
        body.theme-red-black .gz-logo,
        body.theme-red-black .capture-flower-header,
        body.theme-red-black .capture-website-url,
        body.theme-red-black .id-title,
        body.theme-red-black .billabong-title {
            color: #FF4500;
            border-color: #FF4500;
        }
        
        body.theme-red-black .divider {
            background-color: #FF4500;
        }
        
        body.theme-red-black .notification .notification-text {
            color: #FF4500;
        }
        
        body.theme-red-black .notification,
        body.theme-red-black .welcome-text,
        body.theme-red-black .id-message {
            color: #CCCCCC;
        }
        
        body.theme-red-black .button {
            background-color: #8B0000;
        }
        
        body.theme-red-black .share-flower-button {
            background-color: #8B0000;
            color: white;
            border-color: #FF4500;
        }
        
        body.theme-red-black .flower-code,
        body.theme-red-black .id-display {
            color: #FF4500;
            background-color: black;
            border-color: #FF4500;
        }
        
        body.theme-red-black .monthly-motivation,
        body.theme-red-black .capture-flower-motivation {
            border-color: #FF4500;
            color: #E5E5E5;
            background-color: black;
        }
        
        body.theme-red-black .modal-content,
        body.theme-red-black #flowerCaptureContainer {
            background-color: black;
            border-color: #8B0000;
        }
        
        /* Green-Blue Theme */
        body.theme-green-blue {
            background: #1A2E4D;
            color: #F5F5F5;
        }
        
        body.theme-green-blue header, 
        body.theme-green-blue footer,
        body.theme-green-blue .style-selector {
            background-color: #1A2E4D;
        }
        
        body.theme-green-blue .app-logo,
        body.theme-green-blue .header-icon,
        body.theme-green-blue .gz-logo,
        body.theme-green-blue .capture-flower-header,
        body.theme-green-blue .capture-website-url,
        body.theme-green-blue .id-title,
        body.theme-green-blue .billabong-title {
            color: #3EB489;
            border-color: #3EB489;
        }
        
        body.theme-green-blue .divider {
            background-color: #3EB489;
        }
        
        body.theme-green-blue .notification .notification-text {
            color: #3EB489;
        }
        
        body.theme-green-blue .notification,
        body.theme-green-blue .welcome-text,
        body.theme-green-blue .id-message {
            color: #A0A0A0;
        }
        
        body.theme-green-blue .button {
            background-color: #14532D;
        }
        
        body.theme-green-blue .share-flower-button {
            background-color: #14532D;
            color: white;
            border-color: #3EB489;
        }
        
        body.theme-green-blue .flower-code,
        body.theme-green-blue .id-display {
            color: #3EB489;
            background-color: #36454F;
            border-color: #3EB489;
        }
        
        body.theme-green-blue .monthly-motivation,
        body.theme-green-blue .capture-flower-motivation {
            border-color: #3EB489;
            color: #F5F5F5;
            background-color: #1A2E4D;
        }
        
        body.theme-green-blue .modal-content,
        body.theme-green-blue #flowerCaptureContainer {
            background-color: #1A2E4D;
            border-color: #3EB489;
        }
        
        /* Orange-Pink Theme */
        body.theme-orange-pink {
            background: #4B0082;
            color: #FFFFFF;
        }
        
        body.theme-orange-pink header, 
        body.theme-orange-pink footer,
        body.theme-orange-pink .style-selector {
            background-color: #4B0082;
        }
        
        body.theme-orange-pink .app-logo,
        body.theme-orange-pink .header-icon,
        body.theme-orange-pink .gz-logo,
        body.theme-orange-pink .capture-flower-header,
        body.theme-orange-pink .capture-website-url,
        body.theme-orange-pink .id-title,
        body.theme-orange-pink .billabong-title {
            color: #FF7F50;
            border-color: #FF7F50;
        }
        
        body.theme-orange-pink .divider {
            background-color: #FF7F50;
        }
        
        body.theme-orange-pink .notification .notification-text {
            color: #FF7F50;
        }
        
        body.theme-orange-pink .notification,
        body.theme-orange-pink .welcome-text,
        body.theme-orange-pink .id-message {
            color: #D3D3D3;
        }
        
        body.theme-orange-pink .button {
            background-color: #C71585;
        }
        
        body.theme-orange-pink .share-flower-button {
            background-color: #C71585;
            color: white;
            border-color: #FF7F50;
        }
        
        body.theme-orange-pink .flower-code,
        body.theme-orange-pink .id-display {
            color: #FF7F50;
            background-color: #6A0DAD;
            border-color: #FF7F50;
        }
        
        body.theme-orange-pink .monthly-motivation,
        body.theme-orange-pink .capture-flower-motivation {
            border-color: #FF7F50;
            color: #FFFFFF;
            background-color: #4B0082;
        }
        
        body.theme-orange-pink .modal-content,
        body.theme-orange-pink #flowerCaptureContainer {
            background-color: #4B0082;
            border-color: #FF7F50;
        }

        /* Yellow-Purple Theme */
        body.theme-yellow-purple {
            background: #4B0082;
            color: #FFFFFF;
        }
        
        body.theme-yellow-purple header, 
        body.theme-yellow-purple footer,
        body.theme-yellow-purple .style-selector {
            background-color: #4B0082;
        }
        
        body.theme-yellow-purple .app-logo,
        body.theme-yellow-purple .header-icon,
        body.theme-yellow-purple .gz-logo,
        body.theme-yellow-purple .capture-flower-header,
        body.theme-yellow-purple .capture-website-url,
        body.theme-yellow-purple .id-title,
        body.theme-yellow-purple .billabong-title {
            color: #FFD700;
            border-color: #FFD700;
        }
        
        body.theme-yellow-purple .divider {
            background-color: #FFD700;
        }
        
        body.theme-yellow-purple .notification .notification-text {
            color: #FFD700;
        }
        
        body.theme-yellow-purple .notification,
        body.theme-yellow-purple .welcome-text,
        body.theme-yellow-purple .id-message {
            color: #D3D3D3;
        }
        
        body.theme-yellow-purple .button {
            background-color: #8A2BE2;
        }
        
        body.theme-yellow-purple .share-flower-button {
            background-color: #8A2BE2;
            color: white;
            border-color: #FFD700;
        }
        
        body.theme-yellow-purple .flower-code,
        body.theme-yellow-purple .id-display {
            color: #FFD700;
            background-color: #6A0DAD;
            border-color: #FFD700;
        }
        
        body.theme-yellow-purple .monthly-motivation,
        body.theme-yellow-purple .capture-flower-motivation {
            border-color: #FFD700;
            color: #FFFFFF;
            background-color: #4B0082;
        }
        
        body.theme-yellow-purple .modal-content,
        body.theme-yellow-purple #flowerCaptureContainer {
            background-color: #4B0082;
            border-color: #FFD700;
        }
        
        /* Refresh motivation icon */
        .refresh-motivation {
            position: absolute;
            right: 15px;
            top: 70px;
            color: #007bff;
            cursor: pointer;
            font-size: 1.2em;
            padding: 5px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transition: transform 0.3s ease, color 0.3s ease;
        }
        
        .refresh-motivation:hover {
            transform: rotate(180deg);
        }
        
        body.theme-red-black .refresh-motivation {
            color: #FF4500;
        }
        
        body.theme-green-blue .refresh-motivation {
            color: #3EB489;
        }
        
        body.theme-orange-pink .refresh-motivation {
            color: #FF7F50;
        }
        
        body.theme-yellow-purple .refresh-motivation {
            color: #FFD700;
        }

        /* User signature */
        .user-signature {
            display: block;
            font-size: 0.7em;
            text-align: right;
            margin-top: 5px;
            color: #666;
            font-style: italic;
        }

        .capture-signature {
            display: block;
            font-size: 0.7em;
            text-align: right;
            margin-top: 3px;
            color: #666;
            font-style: italic;
        }
  
        .user-signature {
            font-size: 14px;
        }
    </style>

</head>
<body class="theme-green-blue">

  <header>
   
    <div class="header-container">
      <!-- G-Z Logo on the left -->
      <div class="app-logo">G-Z</div>
      
      <!-- Elements grouped on the right with new order -->
      <div class="right-controls">
        <!-- ID Icon -->
        <div class="header-icon" id="showIdButton"><i class="fas fa-user"></i></div>
        
        <!-- Menu bars link - same color as other icons -->
        <a href="https://g-z.online/us.html" class="header-icon menu-link"><i class="fas fa-bars"></i></a>
      </div>
    </div>
  </header>

  <div class="divider"></div>

  <div class="main-content">
    <div class="button-container">
      <!-- Single centered flower of life button -->
      <a class="button" href="#" id="flowerButton"><i class="fas fa-spa flower-icon"></i><span>Flower of life</span></a>
    </div>

    <div class="divider"></div>
    <div class="notification">
      <span class="notification-text">💠 Flower -- The message the universe wrote just for you ¯\_(ツ)_/¯</span>
    </div>

    <div class="divider"></div>
  </div>

  <!-- Style selector at the bottom of the screen -->
  <div class="style-selector">
    <h3>Style</h3>
    <div class="style-options">
      <div class="style-option red-black" data-theme="red-black"></div>
      <div class="style-option green-blue selected" data-theme="green-blue"></div>
      <div class="style-option orange-pink" data-theme="orange-pink"></div>
      <div class="style-option yellow-purple" data-theme="yellow-purple"></div>
      <div class="style-option default" data-theme="default"></div>
    </div>
  </div>

  <!-- Welcome toast notification -->
  <div id="welcomeToast">
    Welcome to G-Z Flower ¯\_(ツ)_/¯
  </div>

  <!-- Initial welcome modal - improved -->
  <div id="welcomeModal" class="modal">
    <div class="modal-content">
      <div class="welcome-header">💠 Welcome 💠</div>
      <div class="welcome-text">
        Account creation only requires your date of birth and profession to create your unique flower.
      </div>
      
      <!-- Date of birth input -->
      <div class="dob-container">
        <label for="dobInput">Date of Birth:</label>
        <input type="date" id="dobInput" class="dob-input" max="">
      </div>
      
      <!-- Profession selector -->
      <div class="profession-container">
        <label for="professionInput">Your Profession:</label>
        <input type="text" id="professionInput" class="profession-search" placeholder="Type your profession...">
        <div id="professionDropdown" class="profession-dropdown"></div>
      </div>
      
      <!-- Name input for signature -->
      <div class="name-container">
        <label for="nameInput">Full Name (for signature):</label>
        <input type="text" id="nameInput" class="name-input" placeholder="e.g. John Smith">
      </div>
      
      <!-- Loading spinner -->
      <div class="loading-spinner" id="loadingSpinner">
        <span>Creating your unique flower</span>
        <span class="loading-dots"></span>
      </div>
      
      <button id="createAccountButton">Create Account</button>
    </div>
  </div>

  <!-- Modal to display unique ID -->
  <div id="idModal" class="modal">
    <div class="modal-content">
      <div class="id-title">Your User ID</div>
      <div class="id-display">
        <span id="userIdDisplay"></span>
        <i class="fas fa-copy copy-icon" id="copyIdButton"></i>
      </div>
      <div class="id-message">Keep this ID safe!</div>
      <div class="id-actions">
        <button class="delete-account" id="deleteAccountButton">Delete Account</button>
        <button class="close-button" id="closeIdModal">Close</button>
      </div>
    </div>
  </div>

  <div id="flowerModal" class="modal">
    <div class="modal-content">
      <button class="modal-close" id="closeFlowerModal"><i class="fas fa-times"></i></button>
      <div class="billabong-title"><strong id="flowerTypeTitle">Flower of Life</strong></div>
      
      <div id="flowerCodeDisplay" class="flower-code"></div>
      
      <!-- Add refresh icon for motivation -->
      <i class="fas fa-sync-alt refresh-motivation" id="refreshMotivation" title="Generate new motivation"></i>
      
      <div class="monthly-motivation" id="monthlyMotivation">
        <div class="user-signature" id="userSignature"></div>
      </div>
      
      <div style="margin: 10px auto; font-size: 3em; color: #ff69b4;" id="flowerIconContainer">
        <i class="fas fa-spa"></i>
      </div>
    </div>
  </div>
  
  <button class="share-flower-button" id="shareFlowerButton">
    <span>Share my Flower</span> <i class="fas fa-paper-plane"></i>
  </button>
  
  <div id="capturedFlower">
    <div class="captured-image-container">
      <img id="capturedImage" class="captured-image" src="" alt="Captured Flower">
    </div>

    <div class="share-warning" id="shareWarning">
      <i class="fas fa-exclamation-triangle" style="margin-right: 5px;"></i>
      <span>Perfect for sharing, just adjust.</span>
    </div>
    
    <div class="capture-controls">
      <button class="capture-button" id="shareCapture">
        <i class="fas fa-paper-plane"></i> <span>Share</span>
      </button>
      
      <button class="capture-button close-capture" id="closeCapture">
        <i class="fas fa-times"></i> <span>Close</span>
      </button>
    </div>
  </div>
  
  <div id="flowerCaptureContainer">
    <div class="capture-flower-header" id="captureFlowerHeader">Flower of Life</div>
    
    <div id="captureFlowerCode" class="capture-flower-code"></div>
    
    <div id="captureFlowerMotivation" class="capture-flower-motivation">
      <div class="capture-signature" id="captureSignature"></div>
    </div>
    
    <div class="capture-flower-icon" id="captureFlowerIcon">
      <i class="fas fa-spa"></i>
    </div>
    
    <div class="gz-logo">G-Z</div>
    
    <div class="capture-website-url">Discover yours at www.g-z.online</div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCrPKQOqw4zciASa_5PbI_etfkvrBaDPDI",
      authDomain: "genz-abb36.firebaseapp.com",
      databaseURL: "https://genz-abb36-default-rtdb.firebaseio.com",
      projectId: "genz-abb36",
      storageBucket: "genz-abb36.firebasestorage.app",
      messagingSenderId: "405021535683",
      appId: "1:405021535683:web:ee5a28fde27f5558046176",
      measurementId: "G-XZNQND2J00"
    };

    // Initialize Firebase with compat version
    firebase.initializeApp(firebaseConfig);
    
    // Get references to Firebase services
    const auth = firebase.auth();
    const database = firebase.database();
    const firestore = firebase.firestore();
    
    let userUid = null;
    let userFlowerCode = null;
    let currentMotivation = null;
    let currentCountry = null;
    let userCity = null;
    let userUniqueId = null; // Unique ID for user
    let isAuthenticated = false; // Track authentication status
    let isInstalled = false; // Installation indicator
    let currentTheme = "green-blue"; // Default theme modified to green-blue
    let userDateOfBirth = null; // User's date of birth
    let userProfession = null; // User's profession/activity
    let userSignature = null; // User's signature
    let seenSubjects = []; // Track seen subjects
    let shareCount = 0; // Track number of shares

    // List of professions for dropdown
    const professions = [
      "Musician", "Rapper", "Footballer", "Basketball Player", "Boxer", 
      "Student", "Teacher", "Doctor", "Nurse", "Engineer", 
      "Software Developer", "Designer", "Artist", "Writer", "Journalist", 
      "Chef", "Waiter/Waitress", "Housekeeper", "TikToker", "YouTuber", 
      "Influencer", "Photographer", "Videographer", "Dancer", "Actor/Actress", 
      "Model", "Architect", "Lawyer", "Accountant", "Financial Advisor", 
      "Banker", "Entrepreneur", "Business Owner", "Manager", "Executive", 
      "Salesperson", "Marketer", "Social Media Manager", "Driver", "Pilot", 
      "Flight Attendant", "Mechanic", "Electrician", "Plumber", "Construction Worker", 
      "Farmer", "Gardener", "Veterinarian", "Personal Trainer", "Fitness Instructor", 
      "Yoga Teacher", "Therapist", "Psychologist", "Counselor", "Pastor/Religious Leader",
      "Scientist", "Researcher", "Professor", "Police Officer", "Firefighter",
      "Military Personnel", "Security Guard", "Real Estate Agent", "Pharmacist", "Dentist",
      "Optometrist", "Physical Therapist", "Occupational Therapist", "Speech Therapist", "Dietitian",
      "Nutritionist", "Hairdresser", "Makeup Artist", "Esthetician", "Tailor",
      "Fashion Designer", "Retail Worker", "Cashier", "Customer Service Representative", "Call Center Agent",
      "Translator", "Interpreter", "Tour Guide", "Travel Agent", "Hotel Manager",
      "Receptionist", "Secretary", "Administrative Assistant", "Librarian", "Archivist",
      "Historian", "Archaeologist", "Anthropologist", "Sociologist", "Political Scientist",
      "Economist", "Statistician", "Data Analyst", "Data Scientist", "UX/UI Designer",
      "Game Developer", "App Developer", "Web Developer", "Network Administrator", "Cybersecurity Specialist",
      "IT Support", "Technician", "Repair Specialist", "Baker", "Butcher",
      "Fisherman", "Miner", "Forester", "Landscaper", "Interior Designer",
      "Event Planner", "Wedding Planner", "Florist", "Jeweler", "Craftsperson",
      "Programmer", "Web Designer", "Digital Marketer", "SEO Specialist", "Content Creator",
      "Product Manager", "Project Manager", "Quality Assurance", "Business Analyst", "Consultant",
      "Recruiter", "HR Manager", "Career Coach", "Life Coach", "Motivational Speaker",
      "Public Speaker", "Radio Host", "TV Host", "Broadcaster", "Podcaster",
      "Author", "Screenwriter", "Copywriter", "Technical Writer", "Editor",
      "Publisher", "Literary Agent", "Bookstore Owner", "Librarian", "Book Reviewer",
      "Graphic Designer", "Illustrator", "Animator", "3D Artist", "VFX Artist",
      "Film Director", "Producer", "Camera Operator", "Sound Engineer", "Lighting Technician",
      "Film Editor", "Production Assistant", "Set Designer", "Costume Designer", "Makeup Artist for Film",
      "Special Effects Artist", "Stunt Performer", "Voice Actor", "Talent Agent", "Casting Director"
    ];

    // Dictionary to map IDs to subjects
    const subjectDictionary = {
      // Success related
      "Success": "Success",
      "Achievement": "Achievement",
      "Victory": "Victory",
      "Triumph": "Triumph",
      "Accomplishment": "Accomplishment",
      
      // Wealth related
      "Richest": "Wealth",
      "Prosperity": "Prosperity",
      "Abundance": "Abundance",
      "Fortune": "Fortune",
      "Affluence": "Affluence",
      
      // Happiness related
      "Joy": "Joy",
      "Happiness": "Happiness",
      "Bliss": "Bliss",
      "Delight": "Delight",
      "Contentment": "Contentment",
      
      // Growth related
      "Growth": "Growth",
      "Progress": "Progress",
      "Advancement": "Advancement",
      "Development": "Development",
      "Improvement": "Improvement",
      
      // Strength related
      "Power": "Power",
      "Strength": "Strength",
      "Might": "Might",
      "Force": "Force",
      "Energy": "Energy",
      
      // Wisdom related
      "Wisdom": "Wisdom",
      "Intelligence": "Intelligence",
      "Knowledge": "Knowledge",
      "Insight": "Insight",
      "Understanding": "Understanding",
      
      // Creativity related
      "Creativity": "Creativity",
      "Innovation": "Innovation",
      "Imagination": "Imagination",
      "Invention": "Invention",
      "Originality": "Originality",
      
      // Leadership related
      "Leadership": "Leadership",
      "Authority": "Authority",
      "Influence": "Influence",
      "Command": "Command",
      "Direction": "Direction",
      
      // Peace related
      "Peace": "Peace",
      "Harmony": "Harmony",
      "Tranquility": "Tranquility",
      "Serenity": "Serenity",
      "Calm": "Calm",
      
      // Love related
      "Love": "Love",
      "Affection": "Affection",
      "Adoration": "Adoration",
      "Devotion": "Devotion",
      "Passion": "Passion",
      
      // Courage related
      "Courage": "Courage",
      "Bravery": "Bravery",
      "Valor": "Valor",
      "Heroism": "Heroism",
      "Fearlessness": "Fearlessness",
      
      // Health related
      "Health": "Health",
      "Vitality": "Vitality",
      "Wellness": "Wellness",
      "Vigor": "Vigor",
      "Fitness": "Fitness",
      
      // Freedom related
      "Freedom": "Freedom",
      "Liberty": "Liberty",
      "Independence": "Independence",
      "Autonomy": "Autonomy",
      "Self-determination": "Self-determination",
      
      // Purpose related
      "Purpose": "Purpose",
      "Meaning": "Meaning",
      "Mission": "Mission",
      "Calling": "Calling",
      "Destiny": "Destiny",
      
      // Resilience related
      "Resilience": "Resilience",
      "Tenacity": "Tenacity",
      "Perseverance": "Perseverance",
      "Endurance": "Endurance",
      "Grit": "Grit",
      
      // Authenticity related
      "Authenticity": "Authenticity",
      "Genuineness": "Genuineness",
      "Honesty": "Honesty",
      "Integrity": "Integrity",
      "Sincerity": "Sincerity",
      
      // Transformation related
      "Transformation": "Transformation",
      "Change": "Change",
      "Evolution": "Evolution",
      "Rebirth": "Rebirth",
      "Metamorphosis": "Metamorphosis",
      
      // Connection related
      "Connection": "Connection",
      "Relationship": "Relationship",
      "Community": "Community",
      "Belonging": "Belonging",
      "Unity": "Unity",
      
      // Gratitude related
      "Gratitude": "Gratitude",
      "Thankfulness": "Thankfulness",
      "Appreciation": "Appreciation",
      "Recognition": "Recognition",
      "Acknowledgment": "Acknowledgment",
      
      // Mindfulness related
      "Mindfulness": "Mindfulness",
      "Presence": "Presence",
      "Awareness": "Awareness",
      "Consciousness": "Consciousness",
      "Attentiveness": "Attentiveness",
      
      // Compassion related
      "Compassion": "Compassion",
      "Empathy": "Empathy",
      "Kindness": "Kindness",
      "Generosity": "Generosity",
      "Altruism": "Altruism",
      
      // Balance related
      "Balance": "Balance",
      "Equilibrium": "Equilibrium",
      "Harmony": "Harmony",
      "Proportion": "Proportion",
      "Symmetry": "Symmetry",
      
      // Inspiration related
      "Inspiration": "Inspiration",
      "Motivation": "Motivation",
      "Enthusiasm": "Enthusiasm",
      "Excitement": "Excitement",
      "Passion": "Passion",
      
      // Focus related
      "Focus": "Focus",
      "Concentration": "Concentration",
      "Attention": "Attention",
      "Discipline": "Discipline",
      "Dedication": "Dedication",
      
      // Humility related
      "Humility": "Humility",
      "Modesty": "Modesty",
      "Simplicity": "Simplicity",
      "Unpretentiousness": "Unpretentiousness",
      "Groundedness": "Groundedness",
      
      // Patience related
      "Patience": "Patience",
      "Tolerance": "Tolerance",
      "Forbearance": "Forbearance",
      "Endurance": "Endurance",
      "Persistence": "Persistence",
      
      // Joy related
      "Joy": "Joy",
      "Delight": "Delight",
      "Gladness": "Gladness",
      "Exultation": "Exultation",
      "Jubilation": "Jubilation",
      
      // Trust related
      "Trust": "Trust",
      "Faith": "Faith",
      "Confidence": "Confidence",
      "Reliance": "Reliance",
      "Dependability": "Dependability",
      
      // Self-confidence related
      "Self-confidence": "Self-confidence",
      "Self-esteem": "Self-esteem",
      "Self-belief": "Self-belief",
      "Self-assurance": "Self-assurance",
      "Self-trust": "Self-trust",
      
      // Enthusiasm related
      "Enthusiasm": "Enthusiasm",
      "Zeal": "Zeal",
      "Eagerness": "Eagerness",
      "Ardor": "Ardor",
      "Fervor": "Fervor",
      
      // Clarity related
      "Clarity": "Clarity",
      "Lucidity": "Lucidity",
      "Transparency": "Transparency",
      "Precision": "Precision",
      "Sharpness": "Sharpness",
      
      // Adaptability related
      "Adaptability": "Adaptability",
      "Flexibility": "Flexibility",
      "Versatility": "Versatility",
      "Adjustability": "Adjustability",
      "Malleability": "Malleability",
      
      // Communication related
      "Communication": "Communication",
      "Expression": "Expression",
      "Articulation": "Articulation",
      "Dialogue": "Dialogue",
      "Conversation": "Conversation",
      
      // Profession related
      "Career": "Career",
      "Profession": "Profession",
      "Vocation": "Vocation",
      "Occupation": "Occupation",
      "Calling": "Calling"
    };

    // Function to generate a unique ID (3 letters + 3 numbers)
    function generateUniqueId() {
      const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      const numbers = '0123456789';
      let id = '';
      
      // Generate 3 random letters
      for (let i = 0; i < 3; i++) {
        id += letters.charAt(Math.floor(Math.random() * letters.length));
      }
      
      // Generate 3 random numbers
      for (let i = 0; i < 3; i++) {
        id += numbers.charAt(Math.floor(Math.random() * numbers.length));
      }
      
      return id;
    }

    // Function to detect user's country and city
    async function detectUserLocation() {
      try {
        const response = await fetch('https://ipapi.co/json/');
        const data = await response.json();
        currentCountry = data.country_name;
        userCity = data.city;
        console.log("Detected user location:", currentCountry, userCity);
        return { country: currentCountry, city: userCity };
      } catch (error) {
        console.error("Error detecting user location:", error);
        return { country: "Unknown", city: "Unknown" };
      }
    }

    // Function to generate personalized motivations based on profession and DOB
    function generatePersonalizedMotivation(flowerCode, profession, dob) {
      if (!flowerCode || flowerCode.length < 8) {
        return "Your flower motivation is here to inspire and guide you.";
      }
      
      // Get month from date of birth if available
      let month = 0;
      if (dob) {
        const dobDate = new Date(dob);
        month = dobDate.getMonth();
      }
      
      // Collection of positive traits
      const lifeTraits = [
        "Your creativity brings fresh ideas to every challenge.",
        "Your kindness inspires others around you.",
        "Your persistence helps you overcome obstacles.",
        "Your unique perspective solves problems in new ways.",
        "Your energy brightens the day for everyone you meet.",
        "Your patience helps you see the bigger picture.",
        "Your courage allows you to face new challenges.",
        "Your wisdom guides you through difficult decisions.",
        "Your optimism helps you find opportunity in any situation.",
        "Your focus helps you achieve your goals step by step.",
        "Your adaptability is your greatest strength.",
        "Your intuition guides you to the right path.",
        "Your empathy connects you deeply with others.",
        "Your resilience helps you bounce back stronger.",
        "Your authenticity draws people to your true self.",
        "Your gratitude multiplies the joy in your life.",
        "Your curiosity leads to new discoveries.",
        "Your sense of humor lightens even difficult moments.",
        "Your generosity creates ripples of kindness.",
        "Your determination turns challenges into achievements.",
        "Your compassion heals those around you.",
        "Your clarity helps you make wise choices.",
        "Your confidence inspires trust in others.",
        "Your mindfulness keeps you centered in chaos.",
        "Your integrity earns respect wherever you go.",
        "Your enthusiasm ignites passion in others.",
        "Your warmth makes people feel instantly welcome.",
        "Your imagination opens doors to possibilities.",
        "Your balance helps you navigate life's complexities.",
        "Your vision enables you to see beyond the horizon.",
        "Your charisma draws people toward your energy.",
        "Your discipline builds the foundation for success.",
        "Your intuitive nature helps you understand subtle truths.",
        "Your playfulness keeps your spirit young and vibrant.",
        "Your analytical mind finds solutions others miss.",
        "Your thoughtfulness creates meaningful connections.",
        "Your sensitivity allows you to perceive what others need.",
        "Your decisiveness moves projects forward efficiently.",
        "Your consistency builds trust over time.",
        "Your expressiveness communicates your truth beautifully.",
        "Your resourcefulness turns limitations into opportunities.",
        "Your diligence ensures quality in everything you do.",
        "Your flexibility adapts to changing circumstances gracefully.",
        "Your pragmatism grounds your actions in reality.",
        "Your eloquence articulates complex ideas clearly.",
        "Your foresight helps you prepare for future challenges.",
        "Your gentleness heals wounds without leaving scars.",
        "Your assertiveness stands up for what's right.",
        "Your independence fosters self-reliance and strength.",
        "Your conscientiousness pays attention to important details.",
        "Your mental agility helps you adapt to new situations quickly.",
        "Your self-awareness illuminates your path to growth.",
        "Your inner strength shines brightest during difficult times.",
        "Your magnetic personality draws people into your orbit.",
        "Your emotional intelligence helps you navigate complex relationships.",
        "Your quick thinking finds solutions when others see only problems.",
        "Your quiet confidence speaks volumes without saying a word.",
        "Your natural leadership inspires others to follow their best instincts.",
        "Your unwavering ethics guide your decisions even when no one is watching.",
        "Your artistic sensibility finds beauty in unexpected places.",
        "Your strategic mind anticipates future developments with remarkable accuracy.",
        "Your spontaneity brings fresh energy to stale situations.",
        "Your meticulous attention to detail prevents future complications.",
        "Your peaceful presence calms even the most chaotic environments.",
        "Your innovative thinking breaks through conventional limitations.",
        "Your natural diplomacy resolves conflicts with grace and fairness.",
        "Your trustworthiness makes you a confidant for those who need one.",
        "Your infectious enthusiasm elevates everyone around you.",
        "Your open-mindedness welcomes new perspectives and possibilities."
      ];
      
      // Collection of encouragements
      const lifeEncouragements = [
        "Keep sharing your gifts with the world.",
        "Trust your instincts - they rarely lead you astray.",
        "Your natural talents are meant to be shared.",
        "The path ahead may have challenges, but you're ready for them.",
        "Small steps today lead to big achievements tomorrow.",
        "Remember to celebrate your progress along the way.",
        "Your unique journey is worth every step.",
        "Don't forget to enjoy the process, not just the results.",
        "Your best days are still ahead of you.",
        "Your efforts today are building your tomorrow.",
        "Stay true to yourself in all situations.",
        "Embrace change as an opportunity to grow.",
        "Listen to your inner wisdom more often.",
        "Allow yourself to rest when needed.",
        "Keep your focus on what truly matters.",
        "Your presence is a gift to those around you.",
        "Nurture your passions consistently.",
        "Be gentle with yourself during challenges.",
        "Your unique path is exactly right for you.",
        "Trust the timing of your life's unfolding.",
        "Find joy in the small moments each day.",
        "Your perspective is valuable - share it.",
        "Believe in your ability to create change.",
        "Remember why you started this journey.",
        "Each day offers a fresh beginning.",
        "Your resilience is inspiring to others.",
        "Take time to celebrate small victories.",
        "Every challenge you face strengthens you.",
        "The universe supports your authentic path.",
        "Your light shines brightest when you're being you.",
        "The world needs your unique contribution.",
        "Let your work speak for itself.",
        "Your consistent effort compounds over time.",
        "What seems impossible today will be your reality tomorrow.",
        "The strength within you is greater than the challenges ahead.",
        "Your journey inspires others more than you realize.",
        "Obstacles are redirections to a better path.",
        "The depth of your character shows in difficult moments.",
        "Your growth happens outside your comfort zone.",
        "Even small progress is still progress worth celebrating.",
        "Stay focused on your 'why' during difficult times.",
        "Your daily choices are creating your legacy.",
        "The lessons you're learning now will serve you forever.",
        "Never underestimate the impact of your kindness.",
        "Your authentic voice resonates with those who need to hear it.",
        "The challenges you overcome today build your strength for tomorrow.",
        "Your past doesn't define your future potential.",
        "Each step forward, no matter how small, is still forward movement.",
        "Your unique approach is your competitive advantage.",
        "Trust that you are exactly where you need to be right now.",
        "Your greatest achievements often come after your biggest challenges.",
        "Your story is still being written - make it remarkable.",
        "The universe conspires in favor of your authentic dreams.",
        "Your most powerful resource is your unwavering belief in yourself.",
        "The impact you have on others is greater than you know.",
        "Your current limitations are temporary, but your potential is permanent.",
        "The most important approval comes from within yourself.",
        "Your intuition is your inner compass - trust its direction.",
        "Today's discipline creates tomorrow's freedom.",
        "Each experience, good or challenging, adds depth to your character.",
        "Your life's purpose unfolds through both joy and difficulty.",
        "The way you handle adversity reveals your true strength.",
        "Your uniqueness is your greatest competitive advantage.",
        "Allow yourself to evolve as your dreams evolve.",
        "Your commitment to growth is already changing your future.",
        "Never underestimate how far consistency can take you.",
        "Your determination outweighs any temporary setbacks.",
        "The right path isn't always the easiest, but it's always worth taking.",
        "Your courage to begin inspires others to do the same.",
        "Each time you choose growth over comfort, you expand your potential.",
        "Your highest potential is waiting for you just beyond your comfort zone.",
        "Every challenge you face prepares you for something greater."
      ];
      
      // Profession-specific encouragements
      const professionMotivations = {
        "Musician": [
          "Your musical talent brings harmony to a chaotic world.",
          "Each note you play resonates with someone's soul.",
          "Your melodies have the power to heal and transform.",
          "Your artistic expression speaks universal truths.",
          "The music within you deserves to be heard."
        ],
        "Rapper": [
          "Your words paint powerful stories that need to be told.",
          "Your flow and rhythm capture emotions words alone cannot express.",
          "Your verses give voice to experiences many feel but cannot articulate.",
          "Your authentic voice resonates with truth-seekers.",
          "Your lyrical prowess opens minds and hearts."
        ],
        "Footballer": [
          "Your dedication on the field inspires teamwork off the field.",
          "Your athletic discipline translates to all areas of life.",
          "Your strategic thinking on the pitch shows your natural leadership.",
          "Your passion for the beautiful game elevates those around you.",
          "Your sportsmanship sets the standard for others to follow."
        ],
        "Basketball Player": [
          "Your court vision translates to seeing opportunities in life.",
          "Your ability to perform under pressure serves you in every challenge.",
          "Your team-first mentality creates success in all your relationships.",
          "Your vertical leap is matched by your ambition to reach new heights.",
          "Your hustle on defense shows your commitment to excellence."
        ],
        "Boxer": [
          "Your mental toughness is as impressive as your physical strength.",
          "Your discipline in training reflects your character in life.",
          "Your ability to take hits and keep moving forward is your superpower.",
          "Your footwork in the ring mirrors your ability to navigate life's challenges.",
          "Your fighting spirit never backs down from worthy challenges."
        ],
        "Student": [
          "Your curiosity opens doors to endless possibilities.",
          "Your commitment to learning will serve you throughout life.",
          "Your fresh perspective brings new insights to old problems.",
          "Your educational journey is preparing you for opportunities yet unseen.",
          "Your academic discipline builds habits for lifetime success."
        ],
        "Teacher": [
          "Your influence extends far beyond the classroom.",
          "Your patience nurtures potential that others might miss.",
          "Your guidance shapes futures in ways you may never fully see.",
          "Your wisdom plants seeds that will bloom for generations.",
          "Your dedication to knowledge creates ripples of positive change."
        ],
        "TikToker": [
          "Your creative content brings joy and connection in a digital world.",
          "Your authentic voice reaches those who need your message.",
          "Your ability to communicate concisely is a rare and valuable skill.",
          "Your cultural influence can be directed toward positive change.",
          "Your digital presence makes a real-world impact."
        ],
        "Entrepreneur": [
          "Your vision creates opportunities where others see obstacles.",
          "Your ability to take calculated risks sets you apart.",
          "Your innovative thinking solves problems at their root.",
          "Your leadership inspires others to join your mission.",
          "Your persistence through challenges defines your success."
        ],
        "Doctor": [
          "Your healing hands bring comfort in times of distress.",
          "Your commitment to healthcare changes lives every day.",
          "Your medical knowledge combined with empathy creates true healing.",
          "Your dedication to patient care exemplifies the highest calling.",
          "Your diagnostic skills are matched by your compassionate heart."
        ],
        "Engineer": [
          "Your problem-solving abilities create solutions that improve lives.",
          "Your technical expertise builds foundations for the future.",
          "Your analytical mind sees patterns others miss.",
          "Your precision and attention to detail ensure quality in everything you create.",
          "Your innovative approaches to challenges advance your entire field."
        ],
        "Software Developer": [
          "Your code creates possibilities that didn't exist before.",
          "Your technical solutions solve real human problems.",
          "Your logical thinking combines beautifully with creative innovation.",
          "Your digital creations impact countless lives daily.",
          "Your ability to learn new technologies keeps you at the cutting edge."
        ],
        "Artist": [
          "Your creative vision shows others new ways of seeing the world.",
          "Your artistic expression touches emotions words cannot reach.",
          "Your unique perspective adds beauty to everyday experiences.",
          "Your work sparks important conversations across boundaries.",
          "Your creative courage inspires others to express their truth."
        ],
        "Nurse": [
          "Your compassionate care heals more than physical ailments.",
          "Your attentiveness notices what others might miss.",
          "Your calm presence provides comfort in difficult moments.",
          "Your dedication to patient care makes a difference every shift.",
          "Your balance of technical skill and human warmth is invaluable."
        ],
        "Writer": [
          "Your words create worlds in the minds of your readers.",
          "Your storytelling connects people across different experiences.",
          "Your eloquence gives voice to what others struggle to express.",
          "Your written insights offer new perspectives on familiar challenges.",
          "Your literary craft preserves important truths for future generations."
        ],
        "Lawyer": [
          "Your advocacy brings justice to those who need a voice.",
          "Your analytical mind navigates complex legal challenges with precision.",
          "Your commitment to legal principles strengthens the foundations of society.",
          "Your ability to construct compelling arguments changes outcomes.",
          "Your ethical approach to law practice sets the standard for others."
        ],
        "Chef": [
          "Your culinary creations bring joy through all the senses.",
          "Your cooking connects people across tables and cultures.",
          "Your flavor combinations demonstrate your artistic intuition.",
          "Your dedication to quality ingredients honors both tradition and innovation.",
          "Your kitchen leadership brings out the best in your entire team."
        ],
        "Accountant": [
          "Your financial expertise provides security and peace of mind.",
          "Your attention to detail catches what others might miss.",
          "Your analytical skills bring clarity to complex financial situations.",
          "Your integrity ensures trust in all your professional relationships.",
          "Your organizational abilities create order from financial complexity."
        ],
        "Designer": [
          "Your visual solutions combine beauty with practical function.",
          "Your design thinking transforms user experiences for the better.",
          "Your aesthetic sensibility elevates everyday objects and interactions.",
          "Your creative process balances innovation with usability.",
          "Your design language communicates across barriers and boundaries."
        ],
        "Police Officer": [
          "Your commitment to public safety makes communities stronger.",
          "Your courage in challenging situations protects those who need it most.",
          "Your quick decision-making under pressure demonstrates remarkable composure.",
          "Your dedication to justice guides your professional conduct.",
          "Your presence brings security to tense situations."
        ],
        "Firefighter": [
          "Your bravery in dangerous situations saves lives and property.",
          "Your quick thinking under extreme pressure is extraordinary.",
          "Your physical and mental preparation enables your heroic response.",
          "Your teamwork in crisis situations exemplifies the best of human cooperation.",
          "Your commitment to community safety extends beyond emergency response."
        ],
        "Military Personnel": [
          "Your service demonstrates the highest form of commitment to others.",
          "Your discipline under challenging conditions sets you apart.",
          "Your strategic thinking balances mission objectives with team safety.",
          "Your adaptability to changing situations ensures mission success.",
          "Your loyalty to your unit creates bonds that transcend ordinary friendship."
        ],
        "Journalist": [
          "Your pursuit of truth brings clarity in confusing times.",
          "Your storytelling helps others understand complex issues.",
          "Your investigative skills uncover what needs to be seen.",
          "Your commitment to facts balances the information ecosystem.",
          "Your voice adds important perspective to public discourse."
        ],
        "Psychologist": [
          "Your empathetic listening creates space for healing.",
          "Your insights help others navigate their inner landscapes.",
          "Your therapeutic approach balances compassion with evidence-based practice.",
          "Your patience allows others to discover their own solutions.",
          "Your professional boundaries enable sustainable healing relationships."
        ],
        "Teacher": [
          "Your guidance shapes futures beyond what you may ever see.",
          "Your patience with the learning process allows growth to unfold naturally.",
          "Your ability to explain complex concepts makes knowledge accessible.",
          "Your classroom management creates safe spaces for intellectual exploration.",
          "Your recognition of different learning styles reaches every student."
        ],
        "Programmer": [
          "Your coding skills transform abstract ideas into functional reality.",
          "Your problem-solving approach breaks complex challenges into manageable parts.",
          "Your attention to detail prevents future complications in your code.",
          "Your continuous learning keeps your skills relevant in a changing field.",
          "Your technical creativity finds elegant solutions to difficult problems."
        ]
      };
      
      // Birth month traits (based on birth month if available)
      const monthTraits = [
        "Your January birth gives you natural leadership qualities and determined focus.",
        "Your February birth blesses you with intuitive understanding and humanitarian vision.",
        "Your March birth provides you with imaginative creativity and adaptable resilience.",
        "Your April birth endows you with determined persistence and courageous initiative.",
        "Your May birth grants you persuasive communication skills and practical sensibility.",
        "Your June birth offers you adaptable versatility and emotional intelligence.",
        "Your July birth gives you compassionate empathy and protective nurturing.",
        "Your August birth blesses you with magnetic charisma and generous confidence.",
        "Your September birth provides you with analytical precision and methodical organization.",
        "Your October birth endows you with balanced perspective and diplomatic harmony.",
        "Your November birth grants you penetrating insight and transformative intensity.",
        "Your December birth offers you visionary optimism and philosophical wisdom."
      ];
      
      // Select traits based on various factors
      let selectedTrait;
      
      // If we have profession and it's in our dictionary, use a profession-specific motivation 25% of the time
      if (profession && professionMotivations[profession] && Math.random() < 0.25) {
        const profMotivations = professionMotivations[profession];
        selectedTrait = profMotivations[Math.floor(Math.random() * profMotivations.length)];
      } 
      // If we have dob, use a month-based trait 20% of the time
      else if (dob && Math.random() < 0.2) {
        selectedTrait = monthTraits[month];
      }
      // Otherwise use a general trait
      else {
        selectedTrait = lifeTraits[Math.floor(Math.random() * lifeTraits.length)];
      }
      
      // Always select a random encouragement
      const encourageIndex = Math.floor(Math.random() * lifeEncouragements.length);
      
      return selectedTrait + " " + lifeEncouragements[encourageIndex];
    }

    function generateFlowerCode() {
      const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      let code = '';
      for (let i = 0; i < 8; i++) {
        const randomIndex = Math.floor(Math.random() * characters.length);
        code += characters.charAt(randomIndex);
      }
      return code;
    }

    // Function to get a random subject from the dictionary
    function getRandomSubject() {
      // Get all available subjects that haven't been seen yet
      let availableSubjects = Object.keys(subjectDictionary).filter(subject => !seenSubjects.includes(subject));
      
      // If all subjects have been seen, reset the seen subjects list
      if (availableSubjects.length === 0) {
        seenSubjects = [];
        availableSubjects = Object.keys(subjectDictionary);
      }
      
      // Select a random subject from available subjects
      const randomIndex = Math.floor(Math.random() * availableSubjects.length);
      const selectedSubject = availableSubjects[randomIndex];
      
      // Add the selected subject to the seen subjects list
      seenSubjects.push(selectedSubject);
      
      return selectedSubject;
    }

    // Update flower display with appropriate subject and enforce signature color
    function updateFlowerDisplay() {
      const flowerCodeElement = document.getElementById('flowerCodeDisplay');
      const motivationElement = document.getElementById('monthlyMotivation');
      const signatureElement = document.getElementById('userSignature');
      
      if (!flowerCodeElement || !motivationElement) {
        console.error("Required elements not found in the DOM");
        return;
      }
      
      // Generate a random subject for the flower if we don't already have one
      let subject = localStorage.getItem('flowerSubject');
      if (!subject) {
        subject = getRandomSubject();
        localStorage.setItem('flowerSubject', subject);
      }
      
      // Get user signature
      let signature = localStorage.getItem('userSignature') || userSignature;
      
      // Update code display with subject
      flowerCodeElement.textContent = "My Flower - " + subject;
      
      // Check if we already have a motivation (to keep the same motivation across all themes)
      if (!currentMotivation) {
        currentMotivation = generatePersonalizedMotivation(userFlowerCode, userProfession, userDateOfBirth);
      }
      
      // Use current motivation
      motivationElement.textContent = currentMotivation;
      
      // Add signature if available and FORCE the theme color
      if (signatureElement) {
        if (signature) {
          signatureElement.textContent = signature + " 🌟";
          
          // AMÉLIORATION: Force la couleur de la signature en fonction du thème actuel
          const themeSignatureColor = getComputedStyle(document.documentElement).getPropertyValue('--signature-color').trim();
          signatureElement.style.color = themeSignatureColor;
        } else {
          signatureElement.textContent = "";
        }
      }
      
      // Update capture elements with the same motivation
      const captureCode = document.getElementById('captureFlowerCode');
      const captureMotivation = document.getElementById('captureFlowerMotivation');
      const captureSignature = document.getElementById('captureSignature');
      
      if (captureCode) captureCode.textContent = "My Flower - " + subject;
      if (captureMotivation) captureMotivation.textContent = currentMotivation;
      
      // AMÉLIORATION: Force la couleur de la signature dans la capture aussi
      if (captureSignature && signature) {
        captureSignature.textContent = signature + " 🌟";
        const themeSignatureColor = getComputedStyle(document.documentElement).getPropertyValue('--signature-color').trim();
        captureSignature.style.color = themeSignatureColor;
      }
      
      return currentMotivation;
    }

    // Function to create a user signature from full name
    function formatSignature(fullName) {
      if (!fullName) return "";
      
      const nameParts = fullName.trim().split(' ');
      if (nameParts.length === 0) return "";
      
      // Get first name
      const firstName = nameParts[0];
      
      // If there's a last name, get first letter + .
      let lastInitial = "";
      if (nameParts.length > 1) {
        lastInitial = nameParts[nameParts.length - 1].charAt(0) + ".";
      }
      
      return firstName + " " + lastInitial;
    }

    // Function to set a cookie with expiration and specific path
    function setCookie(name, value, days) {
      let expires = "";
      if (days) {
        const date = new Date();
        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
        expires = "; expires=" + date.toUTCString();
      }
      document.cookie = name + "=" + (value || "") + expires + "; path=/; SameSite=Lax";
    }

    // Function to get a cookie
    function getCookie(name) {
      const nameEQ = name + "=";
      const ca = document.cookie.split(';');
      for (let i = 0; i < ca.length; i++) {
        let c = ca[i];
        while (c.charAt(0) === ' ') c = c.substring(1, c.length);
        if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
      }
      return null;
    }

    // Function to remove a cookie
    function removeCookie(name) {
      document.cookie = name + "=; Max-Age=-99999999; path=/";
    }

    // Function to set theme
    function setTheme(theme) {
      // Remove all theme classes
      document.body.classList.remove('theme-default', 'theme-red-black', 'theme-green-blue', 'theme-orange-pink', 'theme-yellow-purple');
      
      // Add the selected theme class
      document.body.classList.add('theme-' + theme);
      
      // Update current theme
      currentTheme = theme;
      
      // Save preference in localStorage and cookie
      localStorage.setItem('preferredTheme', theme);
      setCookie('preferredTheme', theme, 365); // Cookie valid for one year
      
      // Update visual selection
      const options = document.querySelectorAll('.style-option');
      options.forEach(option => {
        option.classList.remove('selected');
        if (option.dataset.theme === theme) {
          option.classList.add('selected');
        }
      });
      
      // Update capture styles based on theme
      updateCaptureStyles(theme);
      
      // AMÉLIORATION: Mettre à jour la couleur de la signature si elle existe déjà
      const signatureElement = document.getElementById('userSignature');
      if (signatureElement && signatureElement.textContent) {
        const themeSignatureColor = getComputedStyle(document.documentElement).getPropertyValue('--signature-color').trim();
        signatureElement.style.color = themeSignatureColor;
      }
      
      const captureSignature = document.getElementById('captureSignature');
      if (captureSignature && captureSignature.textContent) {
        const themeSignatureColor = getComputedStyle(document.documentElement).getPropertyValue('--signature-color').trim();
        captureSignature.style.color = themeSignatureColor;
      }
    }
    
    // Function to update capture styles based on theme
    function updateCaptureStyles(theme) {
      const captureContainer = document.getElementById('flowerCaptureContainer');
      const captureCode = document.getElementById('captureFlowerCode');
      const captureHeader = document.getElementById('captureFlowerHeader');
      const captureWebsiteUrl = document.querySelector('.capture-website-url');
      const captureLogo = document.querySelector('.gz-logo');
      const captureMotivation = document.getElementById('captureFlowerMotivation');
      const captureSignature = document.getElementById('captureSignature');
      
      if (!captureContainer || !captureCode || !captureHeader || !captureWebsiteUrl || 
          !captureLogo || !captureMotivation) {
        console.error("One or more capture elements not found");
        return;
      }
      
      // Reset styles
      captureContainer.style.borderColor = '';
      captureCode.style.borderColor = '';
      captureCode.style.color = '';
      captureCode.style.backgroundColor = '';
      captureHeader.style.color = '';
      captureWebsiteUrl.style.color = '';
      captureLogo.style.color = '';
      captureLogo.style.borderColor = '';
      captureMotivation.style.color = '';
      captureMotivation.style.backgroundColor = '';
      captureMotivation.style.borderColor = '';
      if (captureSignature) captureSignature.style.color = '';
      
      // Apply styles based on theme
      switch(theme) {
        case 'red-black':
          captureContainer.style.borderColor = '#8B0000';
          captureContainer.style.backgroundColor = 'black';
          captureCode.style.borderColor = '#FF4500';
          captureCode.style.color = '#FF4500';
          captureCode.style.backgroundColor = 'black';
          captureHeader.style.color = '#FF4500';
          captureWebsiteUrl.style.color = '#FF4500';
          captureLogo.style.color = '#FF4500';
          captureLogo.style.borderColor = '#FF4500';
          captureMotivation.style.color = '#E5E5E5';
          captureMotivation.style.backgroundColor = 'black';
          captureMotivation.style.borderColor = '#FF4500';
          if (captureSignature) captureSignature.style.color = '#FF4500';
          break;
          
        case 'green-blue':
          captureContainer.style.borderColor = '#3EB489';
          captureContainer.style.backgroundColor = '#1A2E4D';
          captureCode.style.borderColor = '#3EB489';
          captureCode.style.color = '#3EB489';
          captureCode.style.backgroundColor = '#36454F';
          captureHeader.style.color = '#3EB489';
          captureWebsiteUrl.style.color = '#3EB489';
          captureLogo.style.color = '#3EB489';
          captureLogo.style.borderColor = '#3EB489';
          captureMotivation.style.color = '#F5F5F5';
          captureMotivation.style.backgroundColor = '#1A2E4D';
          captureMotivation.style.borderColor = '#3EB489';
          if (captureSignature) captureSignature.style.color = '#3EB489';
          break;
          
        case 'orange-pink':
          captureContainer.style.borderColor = '#FF7F50';
          captureContainer.style.backgroundColor = '#4B0082';
          captureCode.style.borderColor = '#FF7F50';
          captureCode.style.color = '#FF7F50';
          captureCode.style.backgroundColor = '#6A0DAD';
          captureHeader.style.color = '#FF7F50';
          captureWebsiteUrl.style.color = '#FF7F50';
          captureLogo.style.color = '#FF7F50';
          captureLogo.style.borderColor = '#FF7F50';
          captureMotivation.style.color = '#FFFFFF';
          captureMotivation.style.backgroundColor = '#4B0082';
          captureMotivation.style.borderColor = '#FF7F50';
          if (captureSignature) captureSignature.style.color = '#FF7F50';
          break;
          
        case 'yellow-purple':
          captureContainer.style.borderColor = '#FFD700';
          captureContainer.style.backgroundColor = '#4B0082';
          captureCode.style.borderColor = '#FFD700';
          captureCode.style.color = '#FFD700';
          captureCode.style.backgroundColor = '#6A0DAD';
          captureHeader.style.color = '#FFD700';
          captureWebsiteUrl.style.color = '#FFD700';
          captureLogo.style.color = '#FFD700';
          captureLogo.style.borderColor = '#FFD700';
          captureMotivation.style.color = '#FFFFFF';
          captureMotivation.style.backgroundColor = '#4B0082';
          captureMotivation.style.borderColor = '#FFD700';
          if (captureSignature) captureSignature.style.color = '#FFD700';
          break;
          
        default: // theme-default
          captureContainer.style.borderColor = '#007bff';
          captureContainer.style.backgroundColor = 'white';
          captureCode.style.borderColor = '#ff69b4';
          captureCode.style.color = '#ff69b4';
          captureCode.style.backgroundColor = '#fff0f8';
          captureHeader.style.color = '#007bff';
          captureWebsiteUrl.style.color = '#007bff';
          captureLogo.style.color = '#007bff';
          captureLogo.style.borderColor = '#007bff';
          captureMotivation.style.color = '#333';
          captureMotivation.style.backgroundColor = 'white';
          captureMotivation.style.borderColor = '#ff69b4';
          if (captureSignature) captureSignature.style.color = '#666';
      }
    }

    // Authenticate to Firebase
    function authenticateAnonymously() {
      return new Promise((resolve, reject) => {
        auth.signInAnonymously()
          .then((userCredential) => {
            console.log("User authenticated anonymously:", userCredential.user.uid);
            userUid = userCredential.user.uid;
            isAuthenticated = true;
            resolve(userCredential.user);
          })
          .catch((error) => {
            console.error("Authentication error:", error);
            reject(error);
          });
      });
    }

    // Listen for authentication state changes
    auth.onAuthStateChanged((user) => {
      if (user) {
        // User is signed in
        userUid = user.uid;
        isAuthenticated = true;
        console.log("Auth state changed: user is signed in", user.uid);
      } else {
        // User is signed out
        isAuthenticated = false;
        console.log("Auth state changed: user is signed out");
      }
    });

    // Submit to Firebase (fixed to ensure data submission)
    async function submitToFirebase() {
      try {
        // Ensure user is authenticated before submitting
        if (!isAuthenticated) {
          console.log("User not authenticated, authenticating now...");
          await authenticateAnonymously();
        }
        
        // Get user location
        const location = await detectUserLocation();
        
        // Prepare user data (only requested data)
        const userData = {
          date: new Date().toISOString(), // Current date and time
          country: location.country || "Unknown",
          city: location.city || "Unknown",
          uid: userUid,
          uniqueId: userUniqueId,
          flowerCode: userFlowerCode,
          motivation: currentMotivation, // Save motivation with data
          dateOfBirth: userDateOfBirth, // Add date of birth
          profession: userProfession, // Add profession
          signature: userSignature, // Add signature
          timestamp: Date.now(),
          theme: currentTheme, // Save preferred theme
          subject: localStorage.getItem('flowerSubject') || getRandomSubject(), // Save flower subject
          shareCount: shareCount // Track shares
        };

        console.log("Submitting data to Firebase:", userData);
        
        // Submit to Realtime Database with error handling
        try {
          const newEntryRef = database.ref('birthdates').push(userData);
          console.log("Data submitted to Realtime Database:", newEntryRef.key);
        } catch (dbError) {
          console.error("Error with Realtime Database:", dbError);
          // Continue anyway to try Firestore
        }
        
        // Submit to Firestore as well
        try {
          const docRef = await firestore.collection('flowers').add(userData);
          console.log("Document written to Firestore with ID: ", docRef.id);
        } catch (firestoreError) {
          console.error("Error adding document to Firestore: ", firestoreError);
        }
        
        // Add to specific collection for codes
        try {
          await firestore.collection('flowerCodes').doc(userUniqueId).set({
            ...userData,
            createdAt: new Date()
          });
          console.log("Flower code added to specific collection");
        } catch (codeError) {
          console.error("Error adding flower code to collection: ", codeError);
        }
        
        // Save in localStorage and cookies for installation
        localStorage.setItem('userFlowerData', JSON.stringify(userData));
        localStorage.setItem('isInstalled', 'true');
        setCookie('userUniqueId', userUniqueId, 365);
        setCookie('userFlowerCode', userFlowerCode, 365);
        setCookie('userDateOfBirth', userDateOfBirth, 365);
        setCookie('userProfession', userProfession, 365);
        setCookie('userSignature', userSignature, 365);
        setCookie('isInstalled', 'true', 365);
        isInstalled = true;
        
        return true;
      } catch (error) {
        console.error("Firebase submission error:", error);
        // Keep data locally even if submission fails
        const userData = {
          date: new Date().toISOString(),
          uniqueId: userUniqueId,
          flowerCode: userFlowerCode,
          motivation: currentMotivation,
          dateOfBirth: userDateOfBirth,
          profession: userProfession,
          signature: userSignature,
          timestamp: Date.now(),
          theme: currentTheme,
          subject: localStorage.getItem('flowerSubject') || getRandomSubject(),
          shareCount: 0
        };
        
        localStorage.setItem('userFlowerData', JSON.stringify(userData));
        localStorage.setItem('isInstalled', 'true');
        setCookie('userUniqueId', userUniqueId, 365);
        setCookie('userFlowerCode', userFlowerCode, 365);
        setCookie('userDateOfBirth', userDateOfBirth, 365);
        setCookie('userProfession', userProfession, 365);
        setCookie('userSignature', userSignature, 365);
        setCookie('isInstalled', 'true', 365);
        isInstalled = true;
        
        return true; // Return true even on error to continue the user experience
      }
    }

    // Update share count in Firebase
    async function updateShareCount() {
      if (!isAuthenticated || !userUniqueId) return;
      
      try {
        // Increment local share count
        shareCount++;
        
        // Update in localStorage
        const savedData = localStorage.getItem('userFlowerData');
        if (savedData) {
          const userData = JSON.parse(savedData);
          userData.shareCount = shareCount;
          localStorage.setItem('userFlowerData', JSON.stringify(userData));
        }
        
        // Update in Firestore
        await firestore.collection('flowerCodes').doc(userUniqueId).set({
          shareCount: shareCount,
          lastShared: new Date().toISOString(),
          country: currentCountry || "Unknown",
          city: userCity || "Unknown",
          uid: userUid,
          uniqueId: userUniqueId
        }, { merge: true });
        
        console.log("Share count updated:", shareCount);
      } catch (error) {
        console.error("Error updating share count:", error);
      }
    }

    // Check if user already has saved data
    function checkSavedUserData() {
      // Check cookies first
      const cookieUniqueId = getCookie('userUniqueId');
      const cookieFlowerCode = getCookie('userFlowerCode');
      const cookieInstalled = getCookie('isInstalled');
      const cookieDOB = getCookie('userDateOfBirth');
      const cookieProfession = getCookie('userProfession');
      const cookieSignature = getCookie('userSignature');
      
      if (cookieUniqueId && cookieFlowerCode) {
        userUniqueId = cookieUniqueId;
        userFlowerCode = cookieFlowerCode;
        userDateOfBirth = cookieDOB || null;
        userProfession = cookieProfession || null;
        userSignature = cookieSignature || null;
        isInstalled = cookieInstalled === 'true';
        
        // Generate motivation based on saved code
        currentMotivation = generatePersonalizedMotivation(userFlowerCode, userProfession, userDateOfBirth);
        
        console.log("Found saved user data in cookies:", { userUniqueId, userFlowerCode, userDateOfBirth, userProfession, userSignature });
        return true;
      }
      
      // If not in cookies, try localStorage
      const savedData = localStorage.getItem('userFlowerData');
      if (savedData) {
        try {
          const userData = JSON.parse(savedData);
          userUniqueId = userData.uniqueId;
          userFlowerCode = userData.flowerCode;
          userDateOfBirth = userData.dateOfBirth || null;
          userProfession = userData.profession || null;
          userSignature = userData.signature || null;
          shareCount = userData.shareCount || 0;
          currentMotivation = userData.motivation || generatePersonalizedMotivation(userData.flowerCode, userData.profession, userData.dateOfBirth);
          userUid = userData.uid;
          isInstalled = localStorage.getItem('isInstalled') === 'true';
          
          // Save to cookies for increased persistence
          setCookie('userUniqueId', userUniqueId, 365);
          setCookie('userFlowerCode', userFlowerCode, 365);
          setCookie('userDateOfBirth', userDateOfBirth, 365);
          setCookie('userProfession', userProfession, 365);
          setCookie('userSignature', userSignature, 365);
          setCookie('isInstalled', 'true', 365);
          
          console.log("Found saved user data in localStorage:", userData);
          return true;
        } catch (e) {
          console.error("Error parsing saved user data:", e);
          return false;
        }
      }
      return false;
    }

    // AMÉLIORATION: Fonction améliorée pour supprimer complètement les données de l'utilisateur
    async function deleteUserAccount() {
      if (!userUniqueId) return false;
      
      try {
        // Afficher une confirmation supplémentaire pour être sûr
        if (!confirm("Êtes-vous vraiment sûr de vouloir supprimer TOUTES vos données ? Cette action est irréversible.")) {
          return false;
        }
        
        console.log("Suppression du compte utilisateur:", userUniqueId);
        
        // Supprimer de Firestore - collection flowerCodes
        try {
          await firestore.collection('flowerCodes').doc(userUniqueId).delete();
          console.log("Données supprimées de la collection flowerCodes");
        } catch (error) {
          console.error("Erreur lors de la suppression de flowerCodes:", error);
        }
        
        // Supprimer de Firestore - collection flowers
        try {
          // Rechercher tous les documents correspondant à cet uniqueId
          const flowersQuery = await firestore.collection('flowers').where('uniqueId', '==', userUniqueId).get();
          
          // Supprimer chaque document trouvé
          const batch = firestore.batch();
          let count = 0;
          
          flowersQuery.forEach((doc) => {
            batch.delete(doc.ref);
            count++;
          });
          
          if (count > 0) {
            await batch.commit();
            console.log(`${count} documents supprimés de la collection flowers`);
          }
        } catch (error) {
          console.error("Erreur lors de la suppression de flowers:", error);
        }
        
        // Supprimer de la base de données en temps réel
        try {
          const birthdatesRef = database.ref('birthdates');
          const query = birthdatesRef.orderByChild('uniqueId').equalTo(userUniqueId);
          
          query.once('value', (snapshot) => {
            snapshot.forEach((childSnapshot) => {
              birthdatesRef.child(childSnapshot.key).remove();
            });
          });
          
          console.log("Données supprimées de la base de données en temps réel");
        } catch (error) {
          console.error("Erreur lors de la suppression de la base de données en temps réel:", error);
        }
        
        // Supprimer les données locales
        localStorage.removeItem('userFlowerData');
        localStorage.removeItem('isInstalled');
        localStorage.removeItem('flowerSubject');
        localStorage.removeItem('userSignature');
        localStorage.removeItem('preferredTheme');
        
        // Supprimer les cookies
        removeCookie('userUniqueId');
        removeCookie('userFlowerCode');
        removeCookie('isInstalled');
        removeCookie('userDateOfBirth');
        removeCookie('userProfession');
        removeCookie('userSignature');
        removeCookie('preferredTheme');
        
        // Réinitialiser les variables
        userUniqueId = null;
        userFlowerCode = null;
        currentMotivation = null;
        userDateOfBirth = null;
        userProfession = null;
        userSignature = null;
        isInstalled = false;
        seenSubjects = [];
        shareCount = 0;
        
        // Supprimer l'authentification si possible
        try {
          if (auth.currentUser) {
            await auth.currentUser.delete();
            console.log("Utilisateur Firebase supprimé");
          }
        } catch (authError) {
          console.error("Erreur lors de la suppression de l'authentification:", authError);
        }
        
        console.log("Compte utilisateur complètement supprimé");
        return true;
      } catch (error) {
        console.error("Erreur lors de la suppression du compte:", error);
        return false;
      }
    }

    // Initialize application on load
    window.addEventListener('load', async () => {
      // Set max date for DOB input to today - 2 years
      const today = new Date();
      const twoYearsAgo = new Date(today.getFullYear() - 2, today.getMonth(), today.getDate());
      document.getElementById('dobInput').max = twoYearsAgo.toISOString().split('T')[0];
      
      // Check preferred theme
      const savedTheme = localStorage.getItem('preferredTheme') || getCookie('preferredTheme');
      if (savedTheme) {
        setTheme(savedTheme);
      } else {
        // Set default theme to green-blue if no saved theme
        setTheme('green-blue');
      }
      
      // Check if user already has data
      if (checkSavedUserData()) {
        console.log("User already has data, hiding welcome modal");
        // Show welcome toast
        const welcomeToast = document.getElementById('welcomeToast');
        welcomeToast.style.display = 'block';
        setTimeout(() => {
          welcomeToast.style.opacity = '1';
        }, 100);
        setTimeout(() => {
          welcomeToast.style.opacity = '0';
          setTimeout(() => {
            welcomeToast.style.display = 'none';
          }, 500);
        }, 2000);
        
        // Authenticate user if needed
        if (!isAuthenticated) {
          try {
            await authenticateAnonymously();
          } catch (error) {
            console.error("Error during authentication:", error);
          }
        }
      } else {
        console.log("No saved user data found, showing welcome modal");
        const welcomeModal = document.getElementById('welcomeModal');
        welcomeModal.style.display = 'block';
        setTimeout(() => {
          welcomeModal.classList.add('show');
        }, 100);
      }
      
      // Setup profession dropdown
      setupProfessionDropdown();
    });

    // Setup profession dropdown functionality
    function setupProfessionDropdown() {
      const professionInput = document.getElementById('professionInput');
      const professionDropdown = document.getElementById('professionDropdown');
      
      if (!professionInput || !professionDropdown) {
        console.error("Profession dropdown elements not found");
        return;
      }
      
      // Function to filter professions based on input
      function filterProfessions(input) {
        if (!input) return [];
        
        input = input.toLowerCase();
        return professions.filter(profession => 
          profession.toLowerCase().includes(input)
        );
      }
      
      // Function to render dropdown options
      function renderDropdownOptions(filteredProfessions) {
        professionDropdown.innerHTML = '';
        
        if (filteredProfessions.length === 0) {
          const option = document.createElement('div');
          option.className = 'profession-option';
          option.textContent = 'No matches found';
          professionDropdown.appendChild(option);
        } else {
          filteredProfessions.forEach(profession => {
            const option = document.createElement('div');
            option.className = 'profession-option';
            option.textContent = profession;
            option.addEventListener('click', () => {
              professionInput.value = profession;
              professionDropdown.style.display = 'none';
            });
            professionDropdown.appendChild(option);
          });
        }
      }
      
      // Input event listener
      professionInput.addEventListener('input', () => {
        const filtered = filterProfessions(professionInput.value);
        renderDropdownOptions(filtered);
        
        if (filtered.length > 0) {
          professionDropdown.style.display = 'block';
        } else {
          professionDropdown.style.display = 'none';
        }
      });
      
      // Focus event listener
      professionInput.addEventListener('focus', () => {
        if (professionInput.value) {
          const filtered = filterProfessions(professionInput.value);
          renderDropdownOptions(filtered);
          professionDropdown.style.display = 'block';
        }
      });
      
      // Click outside to close dropdown
      document.addEventListener('click', (e) => {
        if (!professionInput.contains(e.target) && !professionDropdown.contains(e.target)) {
          professionDropdown.style.display = 'none';
        }
      });
    }

    // Flower button event handler
    document.getElementById('flowerButton').addEventListener('click', function() {
      if (!userUniqueId) {
        alert("Please create your flower account first.");
        return;
      }
      
      // Use same motivation for all themes
      updateFlowerDisplay();
      const flowerModal = document.getElementById('flowerModal');
      flowerModal.style.display = 'block';
      setTimeout(() => {
        flowerModal.classList.add('show');
      }, 10);
      document.getElementById('shareFlowerButton').style.display = 'flex';
    });

    document.getElementById('shareFlowerButton').addEventListener('click', function() {
      captureFlower();
    });
    
    // Show ID modal when clicking ID icon
    document.getElementById('showIdButton').addEventListener('click', function() {
      if (userUniqueId) {
        document.getElementById('userIdDisplay').textContent = userUniqueId;
        const idModal = document.getElementById('idModal');
        idModal.style.display = 'block';
        setTimeout(() => {
          idModal.classList.add('show');
        }, 10);
      } else {
        alert("Please create your flower account first to get your unique ID.");
      }
    });
    
    // Copy ID when clicking copy icon
    document.getElementById('copyIdButton').addEventListener('click', function() {
      const idText = document.getElementById('userIdDisplay').textContent;
      navigator.clipboard.writeText(idText).then(function() {
        alert('ID copied to clipboard!');
      }).catch(function() {
        alert('Could not copy ID. Please select and copy manually.');
      });
    });
    
    // Close ID modal
    document.getElementById('closeIdModal').addEventListener('click', function() {
      const idModal = document.getElementById('idModal');
      idModal.classList.remove('show');
      setTimeout(() => {
        idModal.style.display = 'none';
      }, 300);
    });
    
    // Delete account button handler - AMÉLIORATION: gérer la suppression complète
    document.getElementById('deleteAccountButton').addEventListener('click', function() {
      deleteUserAccount().then(success => {
        if (success) {
          alert("Compte supprimé avec succès. Vous devrez créer un nouveau compte pour utiliser cette application.");
          const idModal = document.getElementById('idModal');
          idModal.classList.remove('show');
          setTimeout(() => {
            idModal.style.display = 'none';
            // Afficher à nouveau l'écran de bienvenue
            const welcomeModal = document.getElementById('welcomeModal');
            welcomeModal.style.display = 'block';
            setTimeout(() => {
              welcomeModal.classList.add('show');
            }, 100);
          }, 300);
        } else {
          alert("Un problème est survenu lors de la suppression de votre compte. Veuillez réessayer.");
        }
      });
    });
    
    // Refresh motivation button handler
    document.getElementById('refreshMotivation').addEventListener('click', function() {
      // Generate new motivation
      const newMotivation = generatePersonalizedMotivation(userFlowerCode, userProfession, userDateOfBirth);
      currentMotivation = newMotivation;
      
      // Generate new subject
      const newSubject = getRandomSubject();
      localStorage.setItem('flowerSubject', newSubject);
      
      // Update display
      document.getElementById('flowerCodeDisplay').textContent = "My Flower - " + newSubject;
      document.getElementById('monthlyMotivation').textContent = newMotivation;
      
      // Update signature if available - AMÉLIORATION: Forcer la couleur du thème
      if (userSignature) {
        const signatureElement = document.getElementById('userSignature');
        if (signatureElement) {
          signatureElement.textContent = userSignature + " 🌟";
          const themeSignatureColor = getComputedStyle(document.documentElement).getPropertyValue('--signature-color').trim();
          signatureElement.style.color = themeSignatureColor;
        }
      }
      
      // Update capture elements
      const captureCode = document.getElementById('captureFlowerCode');
      const captureMotivation = document.getElementById('captureFlowerMotivation');
      const captureSignature = document.getElementById('captureSignature');
      
      if (captureCode) captureCode.textContent = "My Flower - " + newSubject;
      if (captureMotivation) captureMotivation.textContent = newMotivation;
      if (captureSignature && userSignature) {
        captureSignature.textContent = userSignature + " 🌟";
        const themeSignatureColor = getComputedStyle(document.documentElement).getPropertyValue('--signature-color').trim();
        captureSignature.style.color = themeSignatureColor;
      }
      
      // Rotation animation for icon
      this.style.transition = 'transform 0.5s ease';
      this.style.transform = 'rotate(360deg)';
      
      // Reset animation after complete rotation
      setTimeout(() => {
        this.style.transition = 'none';
        this.style.transform = 'rotate(0deg)';
      }, 500);
    });
    
    // Create account button handler
    document.getElementById('createAccountButton').addEventListener('click', async function() {
      // Validate inputs
      const dobInput = document.getElementById('dobInput');
      const professionInput = document.getElementById('professionInput');
      const nameInput = document.getElementById('nameInput');
      
      if (!dobInput.value) {
        alert("Please enter your date of birth.");
        return;
      }
      
      if (!professionInput.value) {
        alert("Please enter your profession.");
        return;
      }
      
      if (!nameInput.value) {
        alert("Please enter your name for the signature.");
        return;
      }
      
      // Show loading spinner
      document.getElementById('loadingSpinner').style.display = 'block';
      document.getElementById('createAccountButton').disabled = true;
      
      try {
        // Authenticate user first
        await authenticateAnonymously();
        
        // Save user inputs
        userDateOfBirth = dobInput.value;
        userProfession = professionInput.value;
        userSignature = formatSignature(nameInput.value);
        
        // Generate unique ID
        userUniqueId = generateUniqueId();
        console.log("Generated unique ID:", userUniqueId);
        
        // Generate flower code
        userFlowerCode = generateFlowerCode();
        
        // Generate subject for flower
        const subject = getRandomSubject();
        localStorage.setItem('flowerSubject', subject);
        localStorage.setItem('userSignature', userSignature);
        
        // Generate motivation
        currentMotivation = generatePersonalizedMotivation(userFlowerCode, userProfession, userDateOfBirth);
        
        // Change button text to Done with check icon
        const createButton = document.getElementById('createAccountButton');
        createButton.innerHTML = '<i class="fas fa-check"></i> Done';
        createButton.style.backgroundColor = '#4CAF50'; // Green color
        
        // Create user data object
        const userData = {
          date: new Date().toISOString(),
          uid: userUid,
          uniqueId: userUniqueId,
          flowerCode: userFlowerCode,
          motivation: currentMotivation,
          dateOfBirth: userDateOfBirth,
          profession: userProfession,
          signature: userSignature,
          timestamp: Date.now(),
          theme: currentTheme,
          subject: subject,
          shareCount: 0
        };
        
        // Save data locally
        localStorage.setItem('userFlowerData', JSON.stringify(userData));
        localStorage.setItem('isInstalled', 'true');
        setCookie('userUniqueId', userUniqueId, 365);
        setCookie('userFlowerCode', userFlowerCode, 365);
        setCookie('userDateOfBirth', userDateOfBirth, 365);
        setCookie('userProfession', userProfession, 365);
        setCookie('userSignature', userSignature, 365);
        setCookie('isInstalled', 'true', 365);
        isInstalled = true;
        
        // Hide welcome modal after a brief delay to show the Done state
        setTimeout(() => {
          const welcomeModal = document.getElementById('welcomeModal');
          welcomeModal.classList.remove('show');
          
          setTimeout(() => {
            welcomeModal.style.display = 'none';
            document.getElementById('loadingSpinner').style.display = 'none';
            createButton.innerHTML = 'Create Account'; // Reset button text
            createButton.style.backgroundColor = ''; // Reset button color
            createButton.disabled = false;
            
            // Submit to Firebase
            submitToFirebase().then(submitted => {
              console.log("Firebase submission result:", submitted);
              
              // Show welcome toast
              const welcomeToast = document.getElementById('welcomeToast');
              welcomeToast.style.display = 'block';
              setTimeout(() => {
                welcomeToast.style.opacity = '1';
              }, 100);
              setTimeout(() => {
                welcomeToast.style.opacity = '0';
                setTimeout(() => {
                  welcomeToast.style.display = 'none';
                }, 500);
              }, 2000);
              
              // Show flower automatically after creation
              updateFlowerDisplay();
              const flowerModal = document.getElementById('flowerModal');
              flowerModal.style.display = 'block';
              setTimeout(() => {
                flowerModal.classList.add('show');
              }, 10);
              document.getElementById('shareFlowerButton').style.display = 'flex';
            });
          }, 300);
        }, 2000); // Wait 2 seconds to show the Done state
        
        console.log("Setup complete and data stored locally and in cookies");
      } catch (error) {
        console.error("Error during setup:", error);
        document.getElementById('loadingSpinner').style.display = 'none';
        document.getElementById('createAccountButton').disabled = false;
        alert("There was a problem setting up your flower. Please try again.");
      }
    });
    
    async function captureFlower() {
      try {
        const captureContainer = document.getElementById('flowerCaptureContainer');
        
        // Update capture styles based on current theme
        updateCaptureStyles(currentTheme);
        
        // Ensure html2canvas is loaded
        if (typeof html2canvas !== 'function') {
          console.error("html2canvas not loaded or not available as a function");
          alert("Cannot capture flower. The capture library is not loaded.");
          return;
        }
        
        // Set background color based on theme
        let bgColor = 'white';
        if (currentTheme === 'red-black') bgColor = 'black';
        else if (currentTheme === 'green-blue') bgColor = '#1A2E4D';
        else if (currentTheme === 'orange-pink' || currentTheme === 'yellow-purple') bgColor = '#4B0082';
        
        // Capture the container
        const canvas = await html2canvas(captureContainer, {
          backgroundColor: bgColor,
          scale: 5,
          logging: true,
          useCORS: true,
          allowTaint: true,
          letterRendering: true
        });
        
        const imageUrl = canvas.toDataURL('image/png');
        
        // Set the image and show capture UI
        const capturedImage = document.getElementById('capturedImage');
        if (capturedImage) {
          capturedImage.src = imageUrl;
          document.getElementById('capturedFlower').style.display = 'flex';
          document.getElementById('shareWarning').style.display = 'block';
          
          // Update share count
          updateShareCount();
        } else {
          console.error("capturedImage element not found");
        }
      } catch (error) {
        console.error('Error capturing flower:', error);
        alert('Could not capture your flower. Please try again.');
      }
    }
    
    document.getElementById('shareCapture').addEventListener('click', function() {
      const imageUrl = document.getElementById('capturedImage').src;
      
      if (navigator.share) {
        fetch(imageUrl)
          .then(res => res.blob())
          .then(blob => {
            const file = new File([blob], 'my-gz-flower.png', { type: 'image/png' });
            navigator.share({
              title: 'My G-Z Flower',
              text: 'Discover yours at g-z.online',
              files: [file]
            }).catch(err => {
              console.log('Error sharing:', err);
              fallbackShare();
            });
          })
          .catch(err => {
            console.log('Error preparing image:', err);
            fallbackShare();
          });
      } else {
        fallbackShare();
      }
    });
    
    function fallbackShare() {
      try {
        const shareText = `
Check out my Flower of Life from G-Z: ${userUniqueId}. Discover yours at g-z.online`;
        
        navigator.clipboard.writeText(shareText).then(function() {
          alert('Share text copied to clipboard!');
        }).catch(function() {
          alert('Could not copy share text.');
        });
      } catch (error) {
        console.error('Fallback share error:', error);
        alert('An error occurred.');
      }
    }
    
    document.getElementById('closeCapture').addEventListener('click', function() {
      document.getElementById('capturedFlower').style.display = 'none';
    });
    
    document.getElementById('closeFlowerModal').addEventListener('click', function() {
      const flowerModal = document.getElementById('flowerModal');
      flowerModal.classList.remove('show');
      setTimeout(() => {
        flowerModal.style.display = 'none';
        document.getElementById('shareFlowerButton').style.display = 'none';
      }, 300);
    });

    window.onclick = function(event) {
      const flowerModal = document.getElementById('flowerModal');
      const capturedFlower = document.getElementById('capturedFlower');
      const idModal = document.getElementById('idModal');
      const welcomeModal = document.getElementById('welcomeModal');
      
      if (event.target == flowerModal) {
        flowerModal.classList.remove('show');
        setTimeout(() => {
          flowerModal.style.display = "none";
          document.getElementById('shareFlowerButton').style.display = 'none';
        }, 300);
      }
      
      if (event.target == capturedFlower) {
        capturedFlower.style.display = "none";
      }
      
      if (event.target == idModal) {
        idModal.classList.remove('show');
        setTimeout(() => {
          idModal.style.display = "none";
        }, 300);
      }
      
      if (event.target == welcomeModal && isInstalled) {
        welcomeModal.classList.remove('show');
        setTimeout(() => {
          welcomeModal.style.display = "none";
        }, 300);
      }
    };
    
    // Initialize UI elements
    document.getElementById('shareFlowerButton').style.display = 'none';
    document.getElementById('shareWarning').style.display = 'none';
    
    // Theme selector handlers
    document.querySelectorAll('.style-option').forEach(option => {
      option.addEventListener('click', function() {
        const theme = this.dataset.theme;
        setTheme(theme);
      });
    });
  </script>
</body>
</html>
