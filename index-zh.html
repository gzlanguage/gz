
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>G-Z</title>
    <link rel="icon" href="https://firebasestorage.googleapis.com/v0/b/genz-abb36.firebasestorage.app/o/file_00000000182461f694cccea0b9e89e1f.png?alt=media&token=3fda1ca9-1d47-4b35-9b07-af86c3098c41">
    <link href="https://fonts.googleapis.com/css2?family=Billabong&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#000000">
    <link rel="apple-touch-icon" href="https://firebasestorage.googleapis.com/v0/b/genz-abb36.firebasestorage.app/o/file_00000000182461f694cccea0b9e89e1f.png?alt=media&token=3fda1ca9-1d47-4b35-9b07-af86c3098c41">
    <link rel="manifest" id="manifest-placeholder">
    <style>
        /* Style pour l'écran de chargement en noir */
        body {
            background-color: #000000;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }
        
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000000;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease-out;
        }
        
        .splash-icon {
            width: 100px;
            height: 100px;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(0.8); opacity: 0.7; }
            50% { transform: scale(1); opacity: 1; }
            100% { transform: scale(0.8); opacity: 0.7; }
        }
    </style>
</head>
<body>
    <!-- Écran de chargement -->
    <div class="splash-screen" id="splash-screen">
        <img src="https://firebasestorage.googleapis.com/v0/b/genz-abb36.firebasestorage.app/o/file_00000000182461f694cccea0b9e89e1f.png?alt=media&token=3fda1ca9-1d47-4b35-9b07-af86c3098c41" alt="Logo" class="splash-icon">
    </div>
    
    <!-- Contenu principal de la page (qui sera affiché après le chargement) -->
    <div id="main-content" style="display: none;">
        <!-- Votre contenu principal ici -->
    </div>
    
    <script>
        // Création dynamique du fichier manifest
        const manifestData = {
            "name": "Flower of life",
            "short_name": "Flower",
            "description": "G-Z Application",
            "start_url": "/",
            "display": "standalone",
            "background_color": "#000000",
            "theme_color": "#000000",
            "icons": [
                {
                    "src": "https://firebasestorage.googleapis.com/v0/b/genz-abb36.firebasestorage.app/o/file_00000000182461f694cccea0b9e89e1f.png?alt=media&token=3fda1ca9-1d47-4b35-9b07-af86c3098c41",
                    "sizes": "192x192",
                    "type": "image/png"
                },
                {
                    "src": "https://firebasestorage.googleapis.com/v0/b/genz-abb36.firebasestorage.app/o/file_00000000182461f694cccea0b9e89e1f.png?alt=media&token=3fda1ca9-1d47-4b35-9b07-af86c3098c41",
                    "sizes": "512x512",
                    "type": "image/png"
                }
            ]
        };
        
        const blob = new Blob([JSON.stringify(manifestData)], {type: 'application/json'});
        const manifestURL = URL.createObjectURL(blob);
        document.querySelector('#manifest-placeholder').setAttribute('href', manifestURL);
        
        // Simulation de chargement et affichage du contenu principal
        window.addEventListener('load', function() {
            // Simuler un temps de chargement (peut être ajusté ou remplacé par votre vrai logique)
            setTimeout(function() {
                // Masquer l'écran de chargement
                const splashScreen = document.getElementById('splash-screen');
                splashScreen.style.opacity = '0';
                
                // Afficher le contenu principal
                setTimeout(function() {
                    splashScreen.style.display = 'none';
                    document.getElementById('main-content').style.display = 'block';
                }, 500); // Attendre que l'animation de fondu soit terminée
            }, 1500); // 2 secondes de chargement simulé
        });
    </script>
</body>
</html>
    <style>
        input, textarea, select, button {
            font-size: 16px;
            touch-action: manipulation;
        }
        
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: white;
            position: relative;
            transition: background-color 0.3s ease;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            -webkit-text-size-adjust: 100%;
        }
        header {
            background-color: white;
            padding: 6px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: background-color 0.3s ease;
        }
        
        h1 {
            margin: 0;
            font-size: 1.4em;
            font-family: 'Billabong', cursive;
            color: #007bff;
            border: 2px solid #007bff;
            padding: 4px;
            border-radius: 12px;
            font-weight: bold;
            transition: color 0.3s ease, border-color 0.3s ease;
        }
        .divider {
            height: 0.6px;
            background-color: #007bff;
            width: 100%;
            margin-top: 5px;
            transition: background-color 0.3s ease;
        }
        .button-container {
            display: flex;
            justify-content: center;
            margin-top: 5px;
            padding: 5px 0;
            overflow-x: auto;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        .button-container::-webkit-scrollbar {
            display: none;
        }
        .button {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 5px 10px;
            margin: 0 3px;
            font-size: 0.8em;
            cursor: pointer;
            text-decoration: none;
            display: flex;
            align-items: center;
            flex-shrink: 0;
            transition: background-color 0.3s ease;
        }
        .button i {
            margin-right: 2px;
        }
        .notification {
            text-align: center;
            margin-top: 10px;
            font-size: 0.8em;
            color: #0056b3;
            font-weight: bold;
            transition: color 0.3s ease;
            padding: 3px 0;
            max-height: 30px;
            overflow: hidden;
        }
        .share-icon {
            color: #007bff;
            cursor: pointer;
            font-size: 1.3em;
            border: 1px solid #007bff;
            border-radius: 7px;
            padding: 4px;
            background-color: white;
            transition: color 0.3s ease, border-color 0.3s ease;
        }
        footer {
            background-color: white;
            color: black;
            padding: 10px 15px;
            margin-top: auto;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo-container {
            display: flex;
        }
        .logo {
            color: #007bff;
            font-size: 1.6em;
            margin-right: 10px;
            border: 1px solid #007bff;
            border-radius: 10px;
            padding: 5px;
            background-color: rgba(0, 119, 190, 0.1);
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
        }
        .logo:hover {
            background-color: #007bff;
            color: white;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .modal.show {
            opacity: 1;
        }
        .modal-content {
            background-color: white;
            margin: 50% auto;
            padding: 14px;
            border: 1px solid #007bff;
            border-radius: 60px;
            width: 280px;
            max-width: 70%;
            text-align: center;
            max-height: 60vh;
            overflow-y: auto;
            position: relative;
            transition: background-color 0.3s ease, border-color 0.3s ease, transform 0.3s ease;
            transform: scale(0.8);
        }
        .modal.show .modal-content {
            transform: scale(1);
        }
        .modal-header {
            font-size: 1.8em;
            font-family: 'Billabong', cursive;
            margin-bottom: 10px;
            font-weight: bold;
            color: #007bff;
            text-decoration: underline;
            transition: color 0.3s ease;
        }
        
        .modal-footer {
            margin-top: 15px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 6px;
        }
        .close-button {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 8px 10px;
            cursor: pointer;
            font-size: 0.9em;
            width: 120px;
            margin: 4px;
            transition: background-color 0.3s ease;
        }
        .close-button:hover {
            background-color: #0056b3;
        }
        
        @keyframes flowerRotate {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(15deg); }
            50% { transform: rotate(0deg); }
            75% { transform: rotate(-15deg); }
            100% { transform: rotate(0deg); }
        }
        
        .flower-icon {
            display: inline-block;
            animation: flowerRotate 2s infinite ease-in-out;
            color: #ff69b4;
        }
        
        .billabong-title {
            font-family: 'Billabong', cursive;
            font-size: 1.8em;
            margin-bottom: 8px;
            color: #007bff;
            transition: color 0.3s ease;
        }

        .monthly-motivation {
            margin: 15px 0;
            padding: 10px;
            border: 1px dashed #ff69b4;
            border-radius: 15px;
            background-color: white;
            font-style: italic;
            color: #333;
            font-size: 0.9em;
            line-height: 1.4;
            transition: border-color 0.3s ease, color 0.3s ease, background-color 0.3s ease;
            position: relative;
        }
        
        .flower-code {
            display: block;
            font-weight: bold;
            color: #ff69b4;
            font-size: 0.9em;
            margin-bottom: 8px;
            letter-spacing: 0.5px;
            background-color: #fff0f8;
            padding: 6px;
            border-radius: 8px;
            border: 1px solid #ff69b4;
            max-width: 220px;
            margin-left: auto;
            margin-right: auto;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            transition: color 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
        }
        
        .copy-icon {
            color: #007bff;
            cursor: pointer;
            margin-left: 10px;
            font-size: 1.2em;
            vertical-align: middle;
            transition: color 0.3s ease;
        }
        
        .header-controls {
            display: flex;
            align-items: center;
        }
        
        .celebrate-icon {
            font-size: 2em;
            color: gold;
            margin-bottom: 8px;
            animation: celebrate 2s infinite alternate;
        }
        
        @keyframes celebrate {
            0% { transform: scale(1); }
            50% { transform: scale(1.1) rotate(5deg); }
            100% { transform: scale(1) rotate(-5deg); }
        }
        
        .modal-close {
            position: absolute;
            top: 10px;
            right: 20px;
            color: #ff0000;
            font-size: 13px;
            cursor: pointer;
            background-color: transparent;
            border: none;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.2s;
        }
        
        .modal-close:hover {
            background-color: rgba(255, 0, 0, 0.1);
        }
        
        .share-flower-button {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 14px;
            padding: 8px 16px;
            font-size: 0.9em;
            margin: 290px auto;
            display: none;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
            max-width: 190px;
            position: relative;
            z-index: 1001;
            border: 1px solid #0056b3;
        }
        
        .share-flower-button:hover {
            background-color: #0056b3;
        }
        
        .share-flower-button i {
            margin-left: 8px;
        }
        
        #capturedFlower {
            position: fixed;
            z-index: 1003;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .captured-image-container {
            position: relative;
            max-width: 85%;
            max-height: 60vh;
            margin-bottom: 15px;
        }
        
        .captured-image {
            max-width: 100%;
            max-height: 60vh;
            border-radius: 15px;
            border: 2px solid white;
        }
        
        .share-message {
            background-color: white;
            color: #333;
            padding: 10px 15px;
            border-radius: 15px;
            font-size: 0.9em;
            margin: 10px auto;
            max-width: 90%;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        .share-message i {
            margin-left: 8px;
            color: #007bff;
            transition: color 0.3s ease;
        }
        
        .share-link {
            color: #007bff;
            font-weight: bold;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        .capture-controls {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }
        
        .capture-button {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 20px;
            padding: 8px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
            transition: background-color 0.3s ease;
        }
        
        .capture-button i {
            margin-right: 5px;
        }
        
        .close-capture {
            background-color: #f0f0f0;
            color: #333;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        #flowerCaptureContainer {
            position: fixed;
            z-index: -1;
            top: 0;
            left: -9999px;
            background-color: white;
            border: 2px solid #007bff;
            border-radius: 20px;
            padding: 15px;
            width: 300px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        
        .capture-flower-header {
            font-family: 'Billabong', cursive;
            color: #007bff;
            font-size: 1.8em;
            margin-bottom: 8px;
            text-align: center;
            font-weight: bold;
            text-shadow: 0px 1px 1px rgba(0, 123, 255, 0.2);
            transition: color 0.3s ease;
        }
        
        .capture-flower-code {
            font-weight: bold;
            color: #ff69b4;
            font-size: 0.8em;
            background-color: #fff0f8;
            padding: 6px;
            border-radius: 10px;
            border: 1px solid #ff69b4;
            margin: 6px auto;
            text-align: center;
            max-width: 80%;
            letter-spacing: 0.5px;
            transition: color 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
        }
        
        .capture-flower-motivation {
            font-style: italic;
            color: #333;
            font-size: 0.95em;
            line-height: 1.4;
            background-color: #f9f9f9;
            border: 1px dashed #ff69b4;
            border-radius: 12px;
            padding: 12px;
            margin: 12px 0;
            text-align: center;
            transition: color 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
            position: relative;
        }
        
        .capture-flower-icon {
            text-align: center;
            font-size: 2.5em;
            color: #ff69b4;
            margin: 10px 0;
            transition: color 0.3s ease;
        }
        
        .gz-logo {
            font-family: 'Billabong', cursive;
            color: #007bff;
            font-size: 1.4em;
            text-align: center;
            margin-top: 10px;
            border: 2px solid #007bff;
            border-radius: 12px;
            padding: 4px;
            width: 50px;
            margin-left: auto;
            margin-right: auto;
            font-weight: bold;
            transition: color 0.3s ease, border-color 0.3s ease;
        }
        
        .share-warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
            border-radius: 15px;
            padding: 10px 15px;
            font-size: 0.85em;
            margin: 5px auto 15px auto;
            max-width: 90%;
            text-align: center;
            display: none;
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }
        
        .capture-website-url {
            text-align: center;
            font-size: 0.85em;
            color: #007bff;
            font-weight: bold;
            margin-top: 8px;
            font-family: Arial, sans-serif;
            padding: 3px 0;
            border-top: 1px dashed #007bff;
            transition: color 0.3s ease, border-color 0.3s ease;
        }
        
        .terms-text {
            font-size: 0.8em;
            color: black;
            text-align: center;
            margin: 10px auto;
            width: 330px;
            transition: color 0.3s ease;
        }
        
        .billabong-title {
            margin-bottom: 3px;
        }

        .header-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            padding: 0 1px;
        }

        .header-icon {
            font-size: 1.4em;
            color: #007bff;
            border: 2px solid #007bff;
            padding: 4px;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            transition: color 0.3s ease, border-color 0.3s ease;
        }

        .app-logo {
            font-family: 'Billabong', cursive;
            color: #007bff;
            border: 2px solid #007bff;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 1.4em;
            font-weight: bold;
            transition: color 0.3s ease, border-color 0.3s ease;
        }

        .header-flex {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
        }
        
        .right-controls {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        #welcomeToast {
            position: fixed;
            top: 160px;
            left: 0;
            right: 0;
            background-color: rgba(0,0,0,0.7);
            color: white;
            padding: 10px;
            border-radius: 20px;
            width: 80%;
            max-width: 300px;
            margin: 0 auto;
            text-align: center;
            z-index: 2000;
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease;
            font-family: , cursive;
            font-size: 1.1em;
            border: 2px solid #4CAF50;
        }

        #welcomeModal {
            display: none;
            position: fixed;
            z-index: 10;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        #welcomeModal.show {
            opacity: 1;
        }

        #welcomeModal .modal-content {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            margin: 40% auto;
            padding: 15px 10px;
            border: 2px solid #4CAF50;
            border-radius: 25px;
            width: 85%;
            max-width: 290px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            text-align: center;
            transition: transform 0.3s ease;
            transform: scale(0.8);
        }
        #welcomeModal.show .modal-content {
            transform: scale(1);
        }

        #welcomeModal .close {
            color: red;
            font-size: 18px;
            font-weight: bold;
            display: block;
            text-align: center;
            margin-bottom: 3px;
            cursor: pointer;
        }

        #welcomeModal .welcome-header {
            color: #007bff;
            font-family: 'Billabong', cursive;
            font-size: 1.8em;
            margin-bottom: 8px;
            text-align: center;
            font-weight: bold;
        }

        #welcomeModal .welcome-text {
            margin: 10px 0 15px 0;
            font-size: 0.8em;
            color: #333;
            line-height: 1.4;
            transition: color 0.3s ease;
        }

        .dob-container {
            margin: 10px 0;
        }

        .dob-container label {
            display: block;
            font-size: 0.8em;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        .dob-input {
            width: 90%;
            padding: 8px;
            border-radius: 10px;
            border: 1px solid #ccc;
            font-size: 16px;
        }

        .profession-container {
            margin: 12px 0;
            position: relative;
        }

        .profession-container label {
            display: block;
            font-size: 0.8em;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        .profession-search {
            width: 90%;
            padding: 8px;
            border-radius: 10px;
            border: 1px solid #ccc;
            font-size: 16px;
        }

        .profession-dropdown {
            display: none;
            position: absolute;
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 10px;
            width: 90%;
            max-height: 150px;
            overflow-y: auto;
            left: 5%;
            z-index: 10;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .profession-option {
            padding: 8px 10px;
            font-size: 0.8em;
            cursor: pointer;
            transition: background-color 0.2s;
            background-color: white;
            color: #333;
        }

        .profession-option:hover {
            background-color: #f5f5f5;
        }

        .name-container {
            margin: 10px 0;
        }

        .name-container label {
            display: block;
            font-size: 0.8em;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        .name-input {
            width: 90%;
            padding: 8px;
            border-radius: 10px;
            border: 1px solid #ccc;
            font-size: 16px;
        }

        #createAccountButton {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 10px 25px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            margin: 10px auto 5px;
            display: block;
            width: 80%;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 123, 255, 0.3);
        }
        
        #createAccountButton:hover {
            background: linear-gradient(135deg, #0056b3 0%, #003d80 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 123, 255, 0.4);
        }
        
        #createAccountButton:active {
            transform: translateY(0);
            box-shadow: 0 1px 3px rgba(0, 123, 255, 0.3);
        }

        .loading-spinner {
            display: none;
            text-align: center;
            margin: 10px 0;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        .loading-dots::after {
            content: '...';
            animation: dots 1.5s infinite;
            display: inline-block;
            width: 20px;
            text-align: left;
        }

        #idModal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        #idModal.show {
            opacity: 1;
        }

        #idModal .modal-content {
            background-color: #fff;
            margin: 45% auto;
            padding: 15px;
            border: 1px solid #007BFF;
            border-radius: 25px;
            width: 65%;
            max-width: 250px;
            text-align: center;
            transition: transform 0.3s ease;
            transform: scale(0.8);
        }
        #idModal.show .modal-content {
            transform: scale(1);
        }

        .id-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }

        .id-title {
            font-size: 1em;
            color: #007bff;
            margin-bottom: 5px;
            transition: color 0.3s ease;
        }

        .id-display {
            font-weight: bold;
            font-size: 1.2em;
            color: #ff69b4;
            background-color: #fff0f8;
            padding: 6px;
            border-radius: 8px;
            border: 1px solid #ff69b4;
            margin: 5px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            max-width: 80%;
            transition: color 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
        }

        .delete-account {
            background-color: #ff4d4d;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 6px 10px;
            font-size: 0.7em;
            cursor: pointer;
            transition: background-color 0.3s;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .delete-account:hover {
            background-color: #e60000;
        }

        .copy-icon {
            margin-left: 6px;
        }

        .id-message {
            font-size: 0.7em;
            color: #333;
            margin: 5px 0;
            transition: color 0.3s ease;
        }

        #idModal .close-button {
            margin-top: 8px;
            width: auto;
            padding: 6px 15px;
            font-size: 0.7em;
            height: 28px;
        }

        .menu-link {
            text-decoration: none;
            color: #007bff;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.3s ease;
        }
        
        .style-selector {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: white;
            padding: 10px 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 100;
            transition: background-color 0.3s ease;
        }
        
        .style-selector h3 {
            text-align: center;
            margin: 0 0 10px 0;
            font-size: 1em;
            color: #333;
            transition: color 0.3s ease;
        }
        
        .style-options {
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 0 5px;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        .style-options::-webkit-scrollbar {
            display: none;
        }
        
        .style-option {
            width: 60px;
            height: 40px;
            border-radius: 10px;
            cursor: pointer;
            flex-shrink: 0;
            position: relative;
            border: 1px solid #ddd;
            overflow: hidden;
        }
        
        .style-option.selected {
            border: 2px solid white;
            box-shadow: 0 0 0 2px #007bff;
        }
        
        .style-option.red-black {
            background: linear-gradient(to right, #FF4500, #8B0000, #121212, #121212);
        }
        
        .style-option.green-blue {
            background: linear-gradient(to right, #3EB489, #14532D, #0A2239, #1A2E4D);
        }
        
        .style-option.orange-pink {
            background: linear-gradient(to right, #FF7F50, #FF6F91, #C71585, #4B0082);
        }
        
        .style-option.yellow-purple {
            background: linear-gradient(to right, #FFD700, #FFA500, #8A2BE2, #4B0082);
        }
        
        .style-option.default {
            background: linear-gradient(to right, #007bff, #0056b3);
        }
        
        .main-content {
            padding-bottom: 80px;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
        }
        
        body.theme-default {
            background-color: white;
            color: #333;
        }
        
        body.theme-default header, 
        body.theme-default footer,
        body.theme-default .style-selector {
            background-color: white;
        }
        
        body.theme-default .app-logo,
        body.theme-default .header-icon,
        body.theme-default .divider,
        body.theme-default .notification,
        body.theme-default .billabong-title,
        body.theme-default .gz-logo,
        body.theme-default .capture-website-url,
        body.theme-default .capture-flower-header,
        body.theme-default .id-title {
            color: #007bff;
            border-color: #007bff;
        }
        
        body.theme-default .notification .notification-text {
            color: #007bff;
        }
        
        body.theme-default .button {
            background-color: #007bff;
        }
        
        body.theme-default .share-flower-button {
            background-color: #007bff;
            color: white;
            border-color: #0056b3;
        }
        
        body.theme-default .flower-code,
        body.theme-default .id-display {
            color: #ff69b4;
            background-color: #fff0f8;
            border-color: #ff69b4;
        }
        
        body.theme-default .monthly-motivation,
        body.theme-default .capture-flower-motivation {
            border-color: #ff69b4;
            color: #333;
            background-color: white;
        }
        
        body.theme-default .modal-content {
            background-color: white;
            border-color: #007bff;
        }
        
        body.theme-red-black {
            background: black;
            color: #E5E5E5;
        }
        
        body.theme-red-black header, 
        body.theme-red-black footer,
        body.theme-red-black .style-selector {
            background-color: black;
        }
        
        body.theme-red-black .app-logo,
        body.theme-red-black .header-icon,
        body.theme-red-black .gz-logo,
        body.theme-red-black .capture-flower-header,
        body.theme-red-black .capture-website-url,
        body.theme-red-black .id-title,
        body.theme-red-black .billabong-title {
            color: #FF4500;
            border-color: #FF4500;
        }
        
        body.theme-red-black .divider {
            background-color: #FF4500;
        }
        
        body.theme-red-black .notification .notification-text {
            color: #FF4500;
        }
        
        body.theme-red-black .notification,
        body.theme-red-black .welcome-text,
        body.theme-red-black .id-message {
            color: #CCCCCC;
        }
        
        body.theme-red-black .button {
            background-color: #8B0000;
        }
        
        body.theme-red-black .share-flower-button {
            background-color: #8B0000;
            color: white;
            border-color: #FF4500;
        }
        
        body.theme-red-black .flower-code,
        body.theme-red-black .id-display {
            color: #FF4500;
            background-color: black;
            border-color: #FF4500;
        }
        
        body.theme-red-black .monthly-motivation,
        body.theme-red-black .capture-flower-motivation {
            border-color: #FF4500;
            color: #E5E5E5;
            background-color: black;
        }
        
        body.theme-red-black .modal-content,
        body.theme-red-black #flowerCaptureContainer {
            background-color: black;
            border-color: #8B0000;
        }
        
        body.theme-green-blue {
            background: #1A2E4D;
            color: #F5F5F5;
        }
        
        body.theme-green-blue header, 
        body.theme-green-blue footer,
        body.theme-green-blue .style-selector {
            background-color: #1A2E4D;
        }
        
        body.theme-green-blue .app-logo,
        body.theme-green-blue .header-icon,
        body.theme-green-blue .gz-logo,
        body.theme-green-blue .capture-flower-header,
        body.theme-green-blue .capture-website-url,
        body.theme-green-blue .id-title,
        body.theme-green-blue .billabong-title {
            color: #3EB489;
            border-color: #3EB489;
        }
        
        body.theme-green-blue .divider {
            background-color: #3EB489;
        }
        
        body.theme-green-blue .notification .notification-text {
            color: #3EB489;
        }
        
        body.theme-green-blue .notification,
        body.theme-green-blue .welcome-text,
        body.theme-green-blue .id-message {
            color: #A0A0A0;
        }
        
        body.theme-green-blue .button {
            background-color: #14532D;
        }
        
        body.theme-green-blue .share-flower-button {
            background-color: #14532D;
            color: white;
            border-color: #3EB489;
        }
        
        body.theme-green-blue .flower-code,
        body.theme-green-blue .id-display {
            color: #3EB489;
            background-color: #36454F;
            border-color: #3EB489;
        }
        
        body.theme-green-blue .monthly-motivation,
        body.theme-green-blue .capture-flower-motivation {
            border-color: #3EB489;
            color: #F5F5F5;
            background-color: #1A2E4D;
        }
        
        body.theme-green-blue .modal-content,
        body.theme-green-blue #flowerCaptureContainer {
            background-color: #1A2E4D;
            border-color: #3EB489;
        }
        
        body.theme-orange-pink {
            background: #4B0082;
            color: #FFFFFF;
        }
        
        body.theme-orange-pink header, 
        body.theme-orange-pink footer,
        body.theme-orange-pink .style-selector {
            background-color: #4B0082;
        }
        
        body.theme-orange-pink .app-logo,
        body.theme-orange-pink .header-icon,
        body.theme-orange-pink .gz-logo,
        body.theme-orange-pink .capture-flower-header,
        body.theme-orange-pink .capture-website-url,
        body.theme-orange-pink .id-title,
        body.theme-orange-pink .billabong-title {
            color: #FF7F50;
            border-color: #FF7F50;
        }
        
        body.theme-orange-pink .divider {
            background-color: #FF7F50;
        }
        
        body.theme-orange-pink .notification .notification-text {
            color: #FF7F50;
        }
        
        body.theme-orange-pink .notification,
        body.theme-orange-pink .welcome-text,
        body.theme-orange-pink .id-message {
            color: #D3D3D3;
        }
        
        body.theme-orange-pink .button {
            background-color: #C71585;
        }
        
        body.theme-orange-pink .share-flower-button {
            background-color: #C71585;
            color: white;
            border-color: #FF7F50;
        }
        
        body.theme-orange-pink .flower-code,
        body.theme-orange-pink .id-display {
            color: #FF7F50;
            background-color: #6A0DAD;
            border-color: #FF7F50;
        }
        
        body.theme-orange-pink .monthly-motivation,
        body.theme-orange-pink .capture-flower-motivation {
            border-color: #FF7F50;
            color: #FFFFFF;
            background-color: #4B0082;
        }
        
        body.theme-orange-pink .modal-content,
        body.theme-orange-pink #flowerCaptureContainer {
            background-color: #4B0082;
            border-color: #FF7F50;
        }

        body.theme-yellow-purple {
            background: #4B0082;
            color: #FFFFFF;
        }
        
        body.theme-yellow-purple header, 
        body.theme-yellow-purple footer,
        body.theme-yellow-purple .style-selector {
            background-color: #4B0082;
        }
        
        body.theme-yellow-purple .app-logo,
        body.theme-yellow-purple .header-icon,
        body.theme-yellow-purple .gz-logo,
        body.theme-yellow-purple .capture-flower-header,
        body.theme-yellow-purple .capture-website-url,
        body.theme-yellow-purple .id-title,
        body.theme-yellow-purple .billabong-title {
            color: #FFD700;
            border-color: #FFD700;
        }
        
        body.theme-yellow-purple .divider {
            background-color: #FFD700;
        }
        
        body.theme-yellow-purple .notification .notification-text {
            color: #FFD700;
        }
        
        body.theme-yellow-purple .notification,
        body.theme-yellow-purple .welcome-text,
        body.theme-yellow-purple .id-message {
            color: #D3D3D3;
        }
        
        body.theme-yellow-purple .button {
            background-color: #8A2BE2;
        }
        
        body.theme-yellow-purple .share-flower-button {
            background-color: #8A2BE2;
            color: white;
            border-color: #FFD700;
        }
        
        body.theme-yellow-purple .flower-code,
        body.theme-yellow-purple .id-display {
            color: #FFD700;
            background-color: #6A0DAD;
            border-color: #FFD700;
        }
        
        body.theme-yellow-purple .monthly-motivation,
        body.theme-yellow-purple .capture-flower-motivation {
            border-color: #FFD700;
            color: #FFFFFF;
            background-color: #4B0082;
        }
        
        body.theme-yellow-purple .modal-content,
        body.theme-yellow-purple #flowerCaptureContainer {
            background-color: #4B0082;
            border-color: #FFD700;
        }
        
        .refresh-motivation {
            position: absolute;
            right: 15px;
            top: 70px;
            color: #007bff;
            cursor: pointer;
            font-size: 1.2em;
            padding: 5px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transition: transform 0.3s ease, color 0.3s ease;
        }
        
        .refresh-motivation:hover {
            transform: rotate(180deg);
        }
        
        body.theme-red-black .refresh-motivation {
            color: #FF4500;
        }
        
        body.theme-green-blue .refresh-motivation {
            color: #3EB489;
        }
        
        body.theme-orange-pink .refresh-motivation {
            color: #FF7F50;
        }
        
        body.theme-yellow-purple .refresh-motivation {
            color: #FFD700;
        }
        
        .user-name {
            font-size: 0.75em;
            font-weight: bold;
        }

        .install-prompt {
            display: none;
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 0.9em;
            z-index: 1000;
            width: 80%;
            max-width: 300px;
            text-align: center;
        }
        
        .install-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .install-btn {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            font-size: 0.8em;
            cursor: pointer;
        }
        
        .dismiss-btn {
            background-color: transparent;
            color: #ccc;
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 5px 10px;
            font-size: 0.8em;
            cursor: pointer;
        }
    </style>
</head>
<body class="theme-green-blue">

  <header>
   
    <div class="header-container">
      <div class="app-logo">G-Z</div>
      
      <div class="right-controls">
        
   
        <div class="header-icon" id="showIdButton"><i class="fas fa-user"></i></div>
        
         <a href="https://g-z.online/translate.html" class="header-icon menu-link"><i class="fas fa-globe"></i></a>
        
        <a href="https://g-z.online/us.html" class="header-icon menu-link"><i class="fas fa-bars"></i></a>
      </div>
    </div>
  </header>

  <div class="divider"></div>

  <div class="main-content">
    <div class="button-container">
      <a class="button" href="#" id="flowerButton"><i class="fas fa-spa flower-icon"></i><span>生命之花</span></a>
      
    

    </div>

    <div class="divider"></div>
    <div class="notification">
      <span class="notification-text">💠 花朵 -- 宇宙为你写的信息 ¯\_(ツ)_/¯</span>
    </div>

    <div class="divider"></div>
  </div>

  <div class="style-selector">
    <h3>风格</h3>
    <div class="style-options">
      <div class="style-option red-black" data-theme="red-black"></div>
      <div class="style-option green-blue selected" data-theme="green-blue"></div>
      <div class="style-option orange-pink" data-theme="orange-pink"></div>
      <div class="style-option yellow-purple" data-theme="yellow-purple"></div>
      <div class="style-option default" data-theme="default"></div>
    </div>
  </div>

  <div id="welcomeToast">
    
    欢迎回来    ¯\_(ツ)_/¯
  </div>

  <div id="welcomeModal" class="modal">
    <div class="modal-content">
      <div class="welcome-header">💠 欢迎 💠</div>
      <div class="welcome-text">
        创建账户需要您的出生日期、职业和姓名来创建您独特的花朵。
      </div>
      
      <div class="name-container">
        <label for="fullNameInput">您的全名：</label>
        <input type="text" id="fullNameInput" class="name-input" placeholder="输入您的全名...">
      </div>
      
      <div class="dob-container">
        <label for="dobInput">出生日期：</label>
        <input type="date" id="dobInput" class="dob-input" max="">
      </div>
      
      <div class="profession-container">
        <label for="professionInput">您的职业：</label>
        <input type="text" id="professionInput" class="profession-search" placeholder="输入您的职业...">
        <div id="professionDropdown" class="profession-dropdown"></div>
      </div>
      
      <div class="loading-spinner" id="loadingSpinner">
        <span>正在创建您独特的花朵</span>
        <span class="loading-dots"></span>
      </div>
      
      <button id="createAccountButton">创建账户</button>
    </div>
  </div>

  <div id="idModal" class="modal">
    <div class="modal-content">
      <div class="id-title">您的用户ID</div>
      <div class="id-display">
        <span id="userIdDisplay"></span>
        <i class="fas fa-copy copy-icon" id="copyIdButton"></i>
      </div>
      <div class="id-message">请保管好此ID！</div>
      <div class="id-actions">
        <button class="delete-account" id="deleteAccountButton">删除账户</button>
        <button class="close-button" id="closeIdModal">关闭</button>
      </div>
    </div>
  </div>

  <div id="flowerModal" class="modal">
    <div class="modal-content">
      <button class="modal-close" id="closeFlowerModal"><i class="fas fa-times"></i></button>
      <div class="billabong-title"><strong id="flowerTypeTitle">生命之花</strong></div>
      
      <div id="flowerCodeDisplay" class="flower-code"></div>
      
      <i class="fas fa-sync-alt refresh-motivation" id="refreshMotivation" title="生成新的激励语"></i>
      
      <div class="monthly-motivation" id="monthlyMotivation">
      </div>
      
      <div style="margin: 10px auto; font-size: 3em; color: #ff69b4;" id="flowerIconContainer">
        <i class="fas fa-spa"></i>
      </div>
    </div>
  </div>
  
  <button class="share-flower-button" id="shareFlowerButton">
    <span>分享我的花朵</span> <i class="fas fa-arrow-right send-icon"></i>
  </button>
  
  <div id="capturedFlower">
    <div class="captured-image-container">
      <img id="capturedImage" class="captured-image" src="" alt="捕获的花朵">
    </div>

    <div class="share-warning" id="shareWarning">
      <i class="fas fa-exclamation-triangle" style="margin-right: 5px;"></i>
      <span>从Google/Safari分享最佳效果。</span>
    </div>
    
    <div class="capture-controls">
      <button class="capture-button" id="shareCapture">
        <i class="fas fa-share"></i> <span>分享</span>
      </button>
      
      <button class="capture-button close-capture" id="closeCapture">
        <i class="fas fa-download"></i> <span>保存</span>
      </button>
    </div>
  </div>
  
  <div id="flowerCaptureContainer">
    <div class="capture-flower-header" id="captureFlowerHeader">生命之花</div>
    
    <div id="captureFlowerCode" class="capture-flower-code"></div>
    
    <div id="captureFlowerMotivation" class="capture-flower-motivation">
    </div>
    
    <div class="capture-flower-icon" id="captureFlowerIcon">
      <i class="fas fa-spa"></i>
    </div>
    
    <div class="gz-logo">G-Z</div>
    
    <div class="capture-website-url">在 www.g-z.online 发现属于您的花朵</div>
  </div>

  <div class="install-prompt" id="installPrompt">
    <p>将 G-Z 添加到您的主屏幕，获得更好的体验！</p>
    <div class="install-buttons">
      <button class="install-btn" id="installBtn">安装</button>
      <button class="dismiss-btn" id="dismissBtn">稍后</button>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCrPKQOqw4zciASa_5PbI_etfkvrBaDPDI",
      authDomain: "genz-abb36.firebaseapp.com",
      databaseURL: "https://genz-abb36-default-rtdb.firebaseio.com",
      projectId: "genz-abb36",
      storageBucket: "genz-abb36.firebasestorage.app",
      messagingSenderId: "405021535683",
      appId: "1:405021535683:web:ee5a28fde27f5558046176",
      measurementId: "G-XZNQND2J00"
    };

    firebase.initializeApp(firebaseConfig);
    
    const auth = firebase.auth();
    const database = firebase.database();
    const firestore = firebase.firestore();
    
    let userUid = null;
    let userFlowerCode = null;
    let currentMotivation = null;
    let currentCountry = null;
    let userCity = null;
    let userUniqueId = null;
    let isAuthenticated = false;
    let isInstalled = false;
    let currentTheme = "green-blue";
    let userDateOfBirth = null;
    let userProfession = null;
    let userFullName = null;
    let seenSubjects = [];
    let shareCount = 0;
    let deferredPrompt = null;

    const professions = [
      "音乐家", "说唱歌手", "足球运动员", "篮球运动员", "拳击手", 
      "学生", "教师", "医生", "护士", "工程师", 
      "软件开发者", "设计师", "艺术家", "作家", "记者", 
      "厨师", "服务员", "家政人员", "抖音博主", "YouTube博主", 
      "网络红人", "摄影师", "视频制作人", "舞蹈家", "演员", 
      "模特", "建筑师", "律师", "会计", "财务顾问", 
      "银行家", "企业家", "企业主", "经理", "高管", 
      "销售人员", "营销人员", "社交媒体经理", "司机", "飞行员", 
      "空乘人员", "机械师", "电工", "水管工", "建筑工人", 
      "农民", "园丁", "兽医", "私人教练", "健身教练", 
      "瑜伽老师", "治疗师", "心理学家", "顾问", "牧师/宗教领袖",
      "科学家", "研究员", "教授", "警察", "消防员",
      "军人", "保安", "房地产经纪人", "药剂师", "牙医",
      "验光师", "物理治疗师", "职业治疗师", "语言治疗师", "营养师",
      "营养学家", "美发师", "化妆师", "美容师", "裁缝",
      "时装设计师", "零售工作者", "收银员", "客服代表", "呼叫中心代理",
      "翻译", "口译员", "导游", "旅行社代理", "酒店经理",
      "接待员", "秘书", "行政助理", "图书管理员", "档案管理员",
      "历史学家", "考古学家", "人类学家", "社会学家", "政治科学家",
      "经济学家", "统计学家", "数据分析师", "数据科学家", "用户体验设计师",
      "游戏开发者", "应用开发者", "网页开发者", "网络管理员", "网络安全专家",
      "IT支持", "技术员", "维修专家", "面包师", "屠夫",
      "渔民", "矿工", "林务员", "景观设计师", "室内设计师",
      "活动策划师", "婚礼策划师", "花艺师", "珠宝商", "工艺师",
      "程序员", "网页设计师", "数字营销师", "搜索引擎优化专家", "内容创作者",
      "产品经理", "项目经理", "质量保证", "业务分析师", "顾问",
      "招聘专员", "人力资源经理", "职业教练", "生活教练", "励志演讲者",
      "公共演讲者", "电台主持人", "电视主持人", "广播员", "播客主持人",
      "作者", "编剧", "文案撰稿人", "技术写作者", "编辑",
      "出版商", "文学代理人", "书店老板", "图书管理员", "书评人",
      "平面设计师", "插画师", "动画师", "3D艺术家", "视觉特效艺术家",
      "电影导演", "制片人", "摄像师", "音响工程师", "灯光技术员",
      "电影编辑", "制作助理", "舞台设计师", "服装设计师", "电影化妆师",
      "特效艺术家", "特技演员", "配音演员", "星探", "选角导演"
    ];

    const subjectDictionary = {
      "成功": "成功",
      "成就": "成就",
      "胜利": "胜利",
      "凯旋": "凯旋",
      "功绩": "功绩",
      
      "最富有": "财富",
      "繁荣": "繁荣",
      "丰富": "丰富",
      "财富": "财富",
      "富裕": "富裕",
      
      "喜悦": "喜悦",
      "幸福": "幸福",
      "极乐": "极乐",
      "愉悦": "愉悦",
      "满足": "满足",
      
      "成长": "成长",
      "进步": "进步",
      "前进": "前进",
      "发展": "发展",
      "改进": "改进",
      
      "力量": "力量",
      "实力": "实力",
      "威力": "威力",
      "能力": "能力",
      "能量": "能量",
      
      "智慧": "智慧",
      "智能": "智能",
      "知识": "知识",
      "洞察力": "洞察力",
      "理解力": "理解力",
      
      "创造力": "创造力",
      "创新": "创新",
      "想象力": "想象力",
      "发明": "发明",
      "独创性": "独创性",
      
      "领导力": "领导力",
      "权威": "权威",
      "影响力": "影响力",
      "指挥": "指挥",
      "方向": "方向",
      
      "和平": "和平",
      "和谐": "和谐",
      "宁静": "宁静",
      "平静": "平静",
      "安宁": "安宁",
      
      "爱": "爱",
      "深情": "深情",
      "崇拜": "崇拜",
      "奉献": "奉献",
      "热情": "热情",
      
      "勇气": "勇气",
      "勇敢": "勇敢",
      "英勇": "英勇",
      "英雄主义": "英雄主义",
      "无畏": "无畏",
      
      "健康": "健康",
      "活力": "活力",
      "健康": "健康",
      "活力": "活力",
      "健身": "健身",
      
      "自由": "自由",
      "解放": "解放",
      "独立": "独立",
      "自主": "自主",
      "自决": "自决",
      
      "目的": "目的",
      "意义": "意义",
      "使命": "使命",
      "召唤": "召唤",
      "命运": "命运",
      
      "韧性": "韧性",
      "坚韧": "坚韧",
      "毅力": "毅力",
      "耐力": "耐力",
      "坚毅": "坚毅",
      
      "真实性": "真实性",
      "真诚": "真诚",
      "诚实": "诚实",
      "正直": "正直",
      "真挚": "真挚",
      
      "转变": "转变",
      "变化": "变化",
      "进化": "进化",
      "重生": "重生",
      "蜕变": "蜕变",
      
      "联系": "联系",
      "关系": "关系",
      "社区": "社区",
      "归属感": "归属感",
      "团结": "团结",
      
      "感恩": "感恩",
      "感谢": "感谢",
      "欣赏": "欣赏",
      "认可": "认可",
      "承认": "承认",
      
      "正念": "正念",
      "存在感": "存在感",
      "意识": "意识",
      "觉知": "觉知",
      "专注": "专注",
      
      "同情心": "同情心",
      "共情": "共情",
      "善良": "善良",
      "慷慨": "慷慨",
      "利他主义": "利他主义",
      
      "平衡": "平衡",
      "均衡": "均衡",
      "和谐": "和谐",
      "比例": "比例",
      "对称": "对称",
      
      "灵感": "灵感",
      "动力": "动力",
      "热忱": "热忱",
      "兴奋": "兴奋",
      "激情": "激情",
      
      "专注": "专注",
      "集中": "集中",
      "注意力": "注意力",
      "纪律": "纪律",
      "奉献": "奉献",
      
      "谦逊": "谦逊",
      "谦虚": "谦虚",
      "简朴": "简朴",
      "不矫饰": "不矫饰",
      "踏实": "踏实",
      
      "耐心": "耐心",
      "宽容": "宽容",
      "忍耐": "忍耐",
      "持久": "持久",
      "坚持": "坚持",
      
      "喜悦": "喜悦",
      "欢乐": "欢乐",
      "欣喜": "欣喜",
      "欢欣": "欢欣",
      "庆祝": "庆祝",
      
      "信任": "信任",
      "信心": "信心",
      "自信": "自信",
      "依赖": "依赖",
      "可靠性": "可靠性",
      
      "自信心": "自信心",
      "自尊": "自尊",
      "自信": "自信",
      "自我肯定": "自我肯定",
      "自我信任": "自我信任",
      
      "热情": "热情",
      "热忱": "热忱",
      "渴望": "渴望",
      "热诚": "热诚",
      "热枕": "热枕",
      
      "清晰": "清晰",
      "明晰": "明晰",
      "透明": "透明",
      "精准": "精准",
      "敏锐": "敏锐",
      
      "适应性": "适应性",
      "灵活性": "灵活性",
      "多功能性": "多功能性",
      "适应能力": "适应能力",
      "可塑性": "可塑性",
      
      "沟通": "沟通",
      "表达": "表达",
      "表述": "表述",
      "对话": "对话",
      "交谈": "交谈",
      
      "职业": "职业",
      "专业": "专业",
      "天职": "天职",
      "工作": "工作",
      "召唤": "召唤"
    };

    function formatUserName(fullName) {
      if (!fullName) return "";
      
      const nameParts = fullName.trim().split(' ');
      
      if (nameParts.length === 1) {
        return nameParts[0];
      }
      
      const firstName = nameParts[0];
      const lastNameInitial = nameParts[nameParts.length - 1].charAt(0).toUpperCase();
      
      return `👑 ${firstName} ${lastNameInitial}.`;
    }

    function generateUniqueId() {
      const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      const numbers = '0123456789';
      let id = '';
      
      for (let i = 0; i < 3; i++) {
        id += letters.charAt(Math.floor(Math.random() * letters.length));
      }
      
      for (let i = 0; i < 3; i++) {
        id += numbers.charAt(Math.floor(Math.random() * numbers.length));
      }
      
      return id;
    }

    async function detectUserLocation() {
      try {
        const response = await fetch('https://ipapi.co/json/');
        const data = await response.json();
        currentCountry = data.country_name;
        userCity = data.city;
        console.log("检测到用户位置:", currentCountry, userCity);
        return { country: currentCountry, city: userCity };
      } catch (error) {
        console.error("检测用户位置时出错:", error);
        return { country: "未知", city: "未知" };
      }
    }

    function generatePersonalizedMotivation(flowerCode, profession, dob) {
      if (!flowerCode || flowerCode.length < 8) {
        return "这朵花的灵感将激励和指引您。";
      }
      
      let month = 0;
      if (dob) {
        const dobDate = new Date(dob);
        month = dobDate.getMonth();
      }
      
      const lifeTraits = [
        "创造力为您面对的每个挑战带来新的想法。",
        "心中的善良每天激励着您周围的人。",
        "坚持不懈帮助您克服别人认为不可能的障碍。",
        "独特的视角让您以创新的方式解决问题。",
        "充满活力的存在为您遇见的每个人照亮了一天。",
        "耐心使您能够在别人看不到时看到更大的图景。",
        "勇气让您以决心面对新的挑战。",
        "智慧引导您以清晰的思维做出困难的决定。",
        "乐观帮助您在遇到的任何情况中找到机会。",
        "专注驱使您一步一步精确地实现目标。",
        "适应能力在变化的时代成为您最大的优势。",
        "直觉在选择看似不明确时引导您走向正确的道路。",
        "同理心使您与他人建立有意义的深层连接。",
        "韧性帮助您从任何挫折中更强大地反弹。",
        "真实性吸引人们无需伪装就接受您的真实自我。",
        "感恩每天倍增您生活中的快乐。",
        "好奇心引领您发现他人可能错过的新发现。",
        "幽默感缓解了最困难的时刻。",
        "慷慨在您的社区中创造善良的涟漪。",
        "决心将挑战转变为值得庆祝的成就。",
        "同情心以微妙而强大的方式治愈您周围的人。",
        "清晰度帮助您在混乱中做出明智的选择。",
        "自信激发了跟随您领导的人的信任。",
        "正念即使在混乱和不确定性中也能让您保持专注。",
        "正直在同行和领导者中赢得尊重。",
        "热情点燃了见证您能量的他人的激情。",
        "温暖使人在您的存在中立即感到受欢迎。",
        "想象力为他人看不到的可能性打开大门。",
        "平衡帮助您优雅地驾驭生活的复杂性。",
        "愿景使您能够在他人止步不前时看到地平线之外。",
        "魅力自然地吸引人们靠近您的磁性能量。",
        "纪律为所有努力建立成功的基础。",
        "直觉本质帮助您理解他人错过的微妙真理。",
        "嬉戏精神使您的精神在挑战中保持年轻和充满活力。",
        "分析思维找到他人完全忽视的解决方案。",
        "体贴创造持续一生的有意义的连接。",
        "敏感性使您能够不问而感知他人的需要。",
        "果断力在他人犹豫时推动项目前进。",
        "一致性随着时间的推移在所有关系中建立信任。",
        "表达力将您的真理美丽地传达给世界。",
        "足智多谋将限制转化为成长的机会。",
        "勤奋确保您接触或创造的一切都有品质。",
        "灵活性以非凡的优雅适应不断变化的环境。",
        "务实性在梦想远大的同时将您的行动扎根于现实。",
        "口才清晰地表达复杂的想法，让他人理解。",
        "远见帮助您在挑战到来之前做好准备。",
        "温柔治愈伤口而不在柔软的心灵上留下疤痕。",
        "果断性毫不犹豫地为正确的事情而站起来。",
        "独立性在逆境中培养自力更生和力量。",
        "认真负责注意他人错过的重要细节。",
        "心智敏捷性帮助您轻松适应新情况。",
        "自我意识照亮您通往成长和满足的道路。",
        "内在力量在困难的考验时刻最为闪耀。",
        "磁性人格毫不费力地吸引人们进入您的轨道。",
        "情商帮助您驾驭复杂的人际关系。",
        "快速思考在他人只看到问题时找到解决方案。",
        "沉着的自信不言而喻。",
        "天生的领导力激励他人遵循自己最好的本能。",
        "坚定不移的道德在黑暗中引导您的决定。",
        "艺术感性在意想不到的地方和时刻找到美。",
        "战略思维准确地预见未来发展。",
        "自发性为陈旧的情况带来新的能量。",
        "一丝不苟的注意细节防止未来的复杂情况。",
        "平静的存在使最混乱的环境也能平静下来。",
        "创新思维突破传统限制。",
        "天生的外交手腕以优雅和公平解决冲突。",
        "值得信赖使您成为需要帮助者的知己。",
        "富有感染力的热情提升您周围的每个人。"
      ];
      
      const lifeEncouragements = [
        "继续与周围的世界分享这些礼物。",
        "相信这些本能 - 它们很少会误导您。",
        "这些天赋是为了广泛分享而存在的。",
        "前方的道路可能有挑战，但您已完全准备好。",
        "今天的小步骤引领明天的大成就。",
        "记得在前进的过程中庆祝进步。",
        "这独特的旅程值得您走的每一步。",
        "不要忘记享受过程，而不仅仅是结果。",
        "最好的日子还在这场冒险的前方。",
        "今天的努力正在构建明天的成功故事。",
        "在所有情况和挑战中保持真实。",
        "将变化视为成长更强大的机会。",
        "更经常倾听内在智慧 - 它知道方向。",
        "需要时允许自己无愧地休息。",
        "保持专注于更大图景中真正重要的事情。",
        "您的存在是那些有幸认识您的人的礼物。",
        "尽管日程繁忙，但要坚持培养激情。",
        "在挑战和挫折时对自己温柔。",
        "这独特的路径正是您需要去的地方。",
        "相信生命展开奥秘的时机。",
        "每天在小时刻中寻找快乐。",
        "这种观点很有价值 - 更频繁地分享它。",
        "相信创造有意义变化的能力。",
        "记住这段旅程最初为何开始。",
        "每一天都提供一个全新的开始。",
        "这种韧性比您意识到的更能激励他人。",
        "花时间庆祝一路上的小胜利。",
        "每个面对的挑战都深刻地增强了性格。",
        "宇宙完全支持这条真实的道路。",
        "当真实性引领时，光芒最为璀璨。",
        "世界需要只有您能给予的独特贡献。",
        "让有意义的工作自己说话，无需解释。",
        "持续的努力随着时间的推移转化为伟大。",
        "今天看似不可能的事明天将成为现实。",
        "内在的力量远远超过前方的任何挑战。",
        "这段旅程激励着比您所知道的更多的人。",
        "障碍仅仅是通向更好道路的重定向。",
        "性格深度在困难时刻最为明显。",
        "成长发生在舒适区之外，而不是其中。",
        "即使是小进步也值得庆祝和承认。",
        "在困难时期保持专注于个人'为什么'。",
        "日常选择创造值得记住的持久遗产。",
        "现在学到的教训将在无数方面永远服务于您。",
        "永远不要低估善良对他人的影响。",
        "真实的声音与需要听到它的人产生共鸣。",
        "今天克服的挑战为明天的考验建立力量。",
        "过去不定义未来的潜力或可能性。",
        "每一步前进，无论多么微小，都创造动力。",
        "独特的方法成为他人所缺乏的竞争优势。",
        "相信当前位置正是成长需要发生的地方。",
        "最伟大的成就往往跟随克服最大的挑战。",
        "这个故事继续书写着前方精彩的篇章。",
        "宇宙支持真实追求的梦想。",
        "最强大的资源仍然是坚定不移的自信。",
        "对他人的影响远超可测量的范围。",
        "当前的限制是暂时的，而潜力仍然是无限的。",
        "最重要的认可来自内心，而非外部。",
        "直觉是指向真北的内在指南针。",
        "今天的纪律创造明天的自由和机会。",
        "每一次经历都为性格和智慧增添深度。",
        "生命的目的通过喜悦和困难平等地展开。",
        "如何处理逆境揭示了真正的性格力量。",
        "独特性成为生活中最大的竞争优势。",
        "随着梦想和目标自然演变，允许个人成长。",
        "对成长的承诺已经积极地改变未来结果。",
        "永远不要低估一致性能带领有价值的目标走多远。",
        "决心超越任何暂时的挫折。",
        "正确的道路并不总是最容易的，但仍然最有价值。",
        "开始的勇气激励他人开始自己的旅程。",
        "选择成长而非舒适会成倍地扩大潜力。",
        "最高潜力就在舒适区边缘之外等待着。",
        "每个挑战都为地平线上更伟大的事物做准备。"
      ];
      
      const professionMotivations = {
        "音乐家": [
          "音乐天赋为寻求和平的混乱世界带来和谐。",
          "每一个演奏的音符都与需要安慰的灵魂产生共鸣。",
          "这些旋律有力量治愈和转化破碎的心灵。",
          "艺术表达传达着言语无法表达的普遍真理。",
          "内心的音乐值得被等待的听众听到。"
        ],
        "说唱歌手": [
          "诗意的话语描绘需要大胆讲述的有力故事。",
          "这种流动和节奏捕捉到单纯的词语无法表达的情感。",
          "这些诗句为许多人感受但无法表达的经历发声。",
          "真实的声音与每个社区中的真理寻求者产生共鸣。",
          "词语的技巧打开心灵和思想，接受新的观点。"
        ],
        "足球运动员": [
          "场上的奉献精神激发了超越比赛本身的团队合作。",
          "运动纪律无缝地转化为生活的所有领域。",
          "在球场上的战略思考展示了天生的领导能力。",
          "对这美丽游戏的热情提升了观看和参与的人。",
          "体育精神为他人树立了跟随和尊重的标准。"
        ],
        "篮球运动员": [
          "场上视野转化为看到生活中所有游戏的机会。",
          "在压力下的表现在面对的每个挑战中都很有用。",
          "团队优先的心态在所有形成的关系中创造成功。",
          "垂直跳跃匹配着达到令人印象深刻的新高度的野心。",
          "防守拼劲展示了对所有事物的卓越承诺。"
        ],
        "拳击手": [
          "精神韧性与展示的身体力量一样令人印象深刻。",
          "训练纪律反映了所有生活环境中的性格。",
          "承受打击并向前移动成为生活的超能力。",
          "擂台上的步法反映了驾驭生活挑战的能力。",
          "斗志永不退缩于面临的有价值挑战。"
        ],
        "学生": [
          "好奇心为无尽的可能性和发现打开大门。",
          "对学习的承诺贯穿生活的许多章节。",
          "新鲜的视角为需要解决的旧问题带来新的见解。",
          "教育旅程为尚未可见的机会做准备。",
          "学术纪律培养确保终身成功的习惯。"
        ],
        "教师": [
          "影响力延伸超越教室墙壁，深入看不见的未来。",
          "耐心培养他人可能错过或忽视的潜力。",
          "指导塑造未来的方式从未被充分欣赏或衡量。",
          "智慧播下的种子在今天课程之后几代人中绽放。",
          "对知识的奉献在各处创造积极变化的涟漪。"
        ],
        "抖音博主": [
          "创意内容在我们的数字景观中带来欢乐和联系。",
          "真实的声音触及那些现在正需要这信息的人。",
          "简洁沟通展示了罕见且有价值的技能掌握。",
          "文化影响力引导全球观众走向积极变化。",
          "数字存在超越屏幕限制产生现实世界的影响。"
        ],
        "企业家": [
          "远见思考在他人只看到障碍的地方创造机会。",
          "承担计算风险使真正的创新者与追随者区分开来。",
          "创新解决方案有效地解决问题的根本原因。",
          "领导力激励他人加入值得追求的有意义使命。",
          "面对挑战的坚持定义了创业成功故事。"
        ],
        "医生": [
          "治愈的双手在病人最需要时带来安慰。",
          "对医疗保健的承诺每天以深刻的方式改变生活。",
          "医学知识与同理心相结合创造真正的治愈时刻。",
          "对病人护理的奉献体现了最高的职业召唤。",
          "诊断技能与慈悲之心完美平衡。"
        ],
        "工程师": [
          "解决问题的能力创造改善无数生命的解决方案。",
          "技术专长为未来创新奠定基础。",
          "分析思维在复杂系统中看到他人完全错过的模式。",
          "精确和对细节的关注确保每个创造的质量。",
          "创新方法推动整个领域前进。"
        ],
        "软件开发者": [
          "代码创造实施前不存在的可能性。",
          "技术解决方案解决社会面临的真实人类问题。",
          "逻辑思维与创意创新完美结合。",
          "数字创作每天影响各平台上无数用户。",
          "学习新技术保持领先的专业地位。"
        ],
        "艺术家": [
          "创意视野向他人展示熟悉世界的新方式。",
          "艺术表达触动语言无法触及的情感。",
          "独特的视角为观众的日常体验增添美感。",
          "创意作品跨越界限引发重要对话。",
          "艺术勇气激励他人真实地表达自己的真理。"
        ],
        "护士": [
          "富有同情心的照顾治愈的不仅仅是身体疾病。",
          "专注注意到患者护理中他人可能错过的细节。",
          "平静的存在在困难的医疗时刻提供安慰。",
          "奉献在每次值班中为无数患者带来不同。",
          "技术技能和人性温暖的平衡证明是无价的。"
        ],
        "作家": [
          "文字在读者心中创造等待探索的世界。",
          "讲故事将跨越截然不同经历的人们联系起来。",
          "雄辩给予他人难以清晰表达的声音。",
          "书面见解对熟悉的挑战提供新的视角。",
          "文学工艺为未来几代保存重要真理。"
        ],
        "律师": [
          "倡导为那些在复杂系统中需要声音的人带来正义。",
          "分析思维以令人印象深刻的精确度驾驭法律挑战。",
          "对法律原则的承诺加强社会基础。",
          "有说服力的论点为寻求正义的客户改变结果。",
          "法律实践的道德方法为专业设定标准。"
        ],
        "厨师": [
          "烹饪创作通过所有感官为赞赏的食客带来欢乐。",
          "烹饪连接不同餐桌和不同文化背景的人们。",
          "风味组合展示艺术直觉和技术技能。",
          "对优质食材的奉献尊重传统和创新。",
          "厨房领导力引出整个烹饪团队的最佳表现。"
        ],
        "会计": [
          "财务专业知识为客户提供安全感和心灵平静。",
          "对细节的关注捕捉到他人肯定会错过的东西。",
          "分析技能为复杂的财务状况带来清晰。",
          "职业诚信确保所有商业关系中的信任。",
          "组织能力从财务复杂性中创造秩序。"
        ],
        "设计师": [
          "视觉解决方案无缝结合美感与实用功能。",
          "设计思维以有意义的方式改变用户体验。",
          "美学感性提升日常物品和互动。",
          "创意过程平衡创新与基本可用性。",
          "设计语言有效地跨越障碍进行沟通。"
        ],
        "警察": [
          "对公共安全的承诺使社区明显更强大。",
          "在挑战情况下的勇气保护弱势公民。",
          "在压力下的快速决策展示了非凡的沉着。",
          "对正义的奉献一贯指导职业行为。",
          "存在给需要干预的紧张局势带来安全感。"
        ],
        "消防员": [
          "危险情况下的勇敢拯救生命和宝贵财产。",
          "极端压力下的快速思考展示非凡技能。",
          "身体和心理准备使英勇的紧急响应成为可能。",
          "危机情况下的团队合作体现人类合作。",
          "对社区安全的承诺延伸超越紧急情况。"
        ],
        "军人": [
          "服务展示了保护他人的最高承诺。",
          "在挑战条件下的纪律设定了卓越标准。",
          "战略思维平衡任务目标与团队安全。",
          "对变化情况的适应能力确保任务始终成功。",
          "对部队的忠诚创造超越普通友谊的纽带。"
        ],
        "记者": [
          "追求真相在混乱复杂的时代带来清晰。",
          "讲故事帮助受众理解重要的复杂问题。",
          "调查技能揭示迫切需要可见度的事情。",
          "对事实的承诺负责任地平衡信息生态系统。",
          "新闻声音为公共话语增添重要视角。"
        ],
        "心理学家": [
          "同理心倾听为必要的治愈创造安全空间。",
          "见解帮助客户有效导航他们的内心景观。",
          "治疗方法平衡同情与循证实践。",
          "耐心指导使他人能够发现自己的解决方案。",
          "专业界限使持续治愈关系成为可能。"
        ],
        "教师": [
          "指导塑造超越可立即看到的未来。",
          "对学习过程的耐心使成长自然展开。",
          "解释复杂概念的能力使知识变得可及。",
          "课堂管理为智力探索创造安全空间。",
          "对不同学习风格的认识独特地触及每个学生。"
        ],
        "程序员": [
          "编码技能将抽象想法转化为功能现实。",
          "解决问题的方法将复杂挑战分解为可管理的部分。",
          "对细节的关注防止复杂代码中的未来并发症。",
          "持续学习在快速变化的领域保持技能相关性。",
          "技术创意为困难问题找到优雅的解决方案。"
        ]
      };
      
      const monthTraits = [
        "一月出生赋予天生的领导品质和专注的决心。",
        "二月出生赐予直觉理解和人道主义视野。",
        "三月出生提供富有想象力的创造力和适应性韧性。",
        "四月出生赋予坚定的毅力和勇敢的主动性。",
        "五月出生赐予有说服力的沟通技巧和实用的感性。",
        "六月出生提供适应性的多才多艺和情感智力。",
        "七月出生赋予富有同情心的共情和保护性的养育本能。",
        "八月出生赐予磁性魅力和慷慨的自信。",
        "九月出生提供分析精确度和有条理的组织能力。",
        "十月出生赋予平衡的视角和外交和谐。",
        "十一月出生赐予洞察力和变革性强度。",
        "十二月出生提供远见卓识的乐观主义和哲学智慧。"
      ];
      
      let selectedTrait;
      
      if (profession && professionMotivations[profession] && Math.random() < 0.25) {
        const profMotivations = professionMotivations[profession];
        selectedTrait = profMotivations[Math.floor(Math.random() * profMotivations.length)];
      } 
      else if (dob && Math.random() < 0.2) {
        selectedTrait = monthTraits[month];
      }
      else {
        selectedTrait = lifeTraits[Math.floor(Math.random() * lifeTraits.length)];
      }
      
      const encourageIndex = Math.floor(Math.random() * lifeEncouragements.length);
      
      return selectedTrait + " " + lifeEncouragements[encourageIndex];
    }

    function generateFlowerCode() {
      const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      let code = '';
      for (let i = 0; i < 8; i++) {
        const randomIndex = Math.floor(Math.random() * characters.length);
        code += characters.charAt(randomIndex);
      }
      return code;
    }

    function getRandomSubject() {
      let availableSubjects = Object.keys(subjectDictionary).filter(subject => !seenSubjects.includes(subject));
      
      if (availableSubjects.length === 0) {
        seenSubjects = [];
        availableSubjects = Object.keys(subjectDictionary);
      }
      
      const randomIndex = Math.floor(Math.random() * availableSubjects.length);
      const selectedSubject = availableSubjects[randomIndex];
      
      seenSubjects.push(selectedSubject);
      
      return selectedSubject;
    }

    function updateFlowerDisplay() {
      const flowerCodeElement = document.getElementById('flowerCodeDisplay');
      const motivationElement = document.getElementById('monthlyMotivation');
      
      if (!flowerCodeElement || !motivationElement) {
        console.error("DOM中未找到所需元素");
        return;
      }
      
      let subject = localStorage.getItem('flowerSubject');
      if (!subject) {
        subject = getRandomSubject();
        localStorage.setItem('flowerSubject', subject);
      }
      
      const formattedName = formatUserName(userFullName);
      
      if (formattedName) {
        flowerCodeElement.innerHTML = `我的花朵 - ${subject} / ${formattedName}`;
      } else {
        flowerCodeElement.textContent = "我的花朵 - " + subject;
      }
      
      if (!currentMotivation) {
        currentMotivation = generatePersonalizedMotivation(userFlowerCode, userProfession, userDateOfBirth);
      }
      
      motivationElement.textContent = currentMotivation;
      
      const captureCode = document.getElementById('captureFlowerCode');
      const captureMotivation = document.getElementById('captureFlowerMotivation');
      
      if (captureCode) {
        if (formattedName) {
          captureCode.innerHTML = `我的花朵 - ${subject} / ${formattedName}`;
        } else {
          captureCode.textContent = "我的花朵 - " + subject;
        }
      }
      
      if (captureMotivation) captureMotivation.textContent = currentMotivation;
      
      return currentMotivation;
    }

    function setCookie(name, value, days) {
      let expires = "";
      if (days) {
        const date = new Date();
        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
        expires = "; expires=" + date.toUTCString();
      }
      document.cookie = name + "=" + (value || "") + expires + "; path=/; SameSite=Lax";
    }

    function getCookie(name) {
      const nameEQ = name + "=";
      const ca = document.cookie.split(';');
      for (let i = 0; i < ca.length; i++) {
        let c = ca[i];
        while (c.charAt(0) === ' ') c = c.substring(1, c.length);
        if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
      }
      return null;
    }

    function removeCookie(name) {
      document.cookie = name + "=; Max-Age=-99999999; path=/";
    }

    function setTheme(theme) {
      document.body.classList.remove('theme-default', 'theme-red-black', 'theme-green-blue', 'theme-orange-pink', 'theme-yellow-purple');
      
      document.body.classList.add('theme-' + theme);
      
      currentTheme = theme;
      
      localStorage.setItem('preferredTheme', theme);
      setCookie('preferredTheme', theme, 365);
      
      const options = document.querySelectorAll('.style-option');
      options.forEach(option => {
        option.classList.remove('selected');
        if (option.dataset.theme === theme) {
          option.classList.add('selected');
        }
      });
      
      updateCaptureStyles(theme);
      
      let themeColor = '#1A2E4D';
      switch(theme) {
        case 'red-black':
          themeColor = '#000000';
          break;
        case 'green-blue':
          themeColor = '#1A2E4D';
          break;
        case 'orange-pink':
        case 'yellow-purple':
          themeColor = '#4B0082';
          break;
        case 'default':
          themeColor = '#FFFFFF';
          break;
      }
      
      const metaTheme = document.querySelector('meta[name="theme-color"]');
      if (metaTheme) {
        metaTheme.setAttribute('content', themeColor);
      }
      
      const metaApple = document.querySelector('meta[name="apple-mobile-web-app-status-bar-style"]');
      if (metaApple) {
        metaApple.setAttribute('content', theme === 'default' ? 'default' : 'black-translucent');
      }
    }
    
    function updateCaptureStyles(theme) {
      const captureContainer = document.getElementById('flowerCaptureContainer');
      const captureCode = document.getElementById('captureFlowerCode');
      const captureHeader = document.getElementById('captureFlowerHeader');
      const captureWebsiteUrl = document.querySelector('.capture-website-url');
      const captureLogo = document.querySelector('.gz-logo');
      const captureMotivation = document.getElementById('captureFlowerMotivation');
      
      if (!captureContainer || !captureCode || !captureHeader || !captureWebsiteUrl || 
          !captureLogo || !captureMotivation) {
        console.error("未找到一个或多个捕获元素");
        return;
      }
      
      captureContainer.style.borderColor = '';
      captureCode.style.borderColor = '';
      captureCode.style.color = '';
      captureCode.style.backgroundColor = '';
      captureHeader.style.color = '';
      captureWebsiteUrl.style.color = '';
      captureLogo.style.color = '';
      captureLogo.style.borderColor = '';
      captureMotivation.style.color = '';
      captureMotivation.style.backgroundColor = '';
      captureMotivation.style.borderColor = '';
      
      switch(theme) {
        case 'red-black':
          captureContainer.style.borderColor = '#8B0000';
          captureContainer.style.backgroundColor = 'black';
          captureCode.style.borderColor = '#FF4500';
          captureCode.style.color = '#FF4500';
          captureCode.style.backgroundColor = 'black';
          captureHeader.style.color = '#FF4500';
          captureWebsiteUrl.style.color = '#FF4500';
          captureLogo.style.color = '#FF4500';
          captureLogo.style.borderColor = '#FF4500';
          captureMotivation.style.color = '#E5E5E5';
          captureMotivation.style.backgroundColor = 'black';
          captureMotivation.style.borderColor = '#FF4500';
          break;
          
        case 'green-blue':
          captureContainer.style.borderColor = '#3EB489';
          captureContainer.style.backgroundColor = '#1A2E4D';
          captureCode.style.borderColor = '#3EB489';
          captureCode.style.color = '#3EB489';
          captureCode.style.backgroundColor = '#36454F';
          captureHeader.style.color = '#3EB489';
          captureWebsiteUrl.style.color = '#3EB489';
          captureLogo.style.color = '#3EB489';
          captureLogo.style.borderColor = '#3EB489';
          captureMotivation.style.color = '#F5F5F5';
          captureMotivation.style.backgroundColor = '#1A2E4D';
          captureMotivation.style.borderColor = '#3EB489';
          break;
          
        case 'orange-pink':
          captureContainer.style.borderColor = '#FF7F50';
          captureContainer.style.backgroundColor = '#4B0082';
          captureCode.style.borderColor = '#FF7F50';
          captureCode.style.color = '#FF7F50';
          captureCode.style.backgroundColor = '#6A0DAD';
          captureHeader.style.color = '#FF7F50';
          captureWebsiteUrl.style.color = '#FF7F50';
          captureLogo.style.color = '#FF7F50';
          captureLogo.style.borderColor = '#FF7F50';
          captureMotivation.style.color = '#FFFFFF';
          captureMotivation.style.backgroundColor = '#4B0082';
          captureMotivation.style.borderColor = '#FF7F50';
          break;
          
        case 'yellow-purple':
          captureContainer.style.borderColor = '#FFD700';
          captureContainer.style.backgroundColor = '#4B0082';
          captureCode.style.borderColor = '#FFD700';
          captureCode.style.color = '#FFD700';
          captureCode.style.backgroundColor = '#6A0DAD';
          captureHeader.style.color = '#FFD700';
          captureWebsiteUrl.style.color = '#FFD700';
          captureLogo.style.color = '#FFD700';
          captureLogo.style.borderColor = '#FFD700';
          captureMotivation.style.color = '#FFFFFF';
          captureMotivation.style.backgroundColor = '#4B0082';
          captureMotivation.style.borderColor = '#FFD700';
          break;
          
        default:
          captureContainer.style.borderColor = '#007bff';
          captureContainer.style.backgroundColor = 'white';
          captureCode.style.borderColor = '#ff69b4';
          captureCode.style.color = '#ff69b4';
          captureCode.style.backgroundColor = '#fff0f8';
          captureHeader.style.color = '#007bff';
          captureWebsiteUrl.style.color = '#007bff';
          captureLogo.style.color = '#007bff';
          captureLogo.style.borderColor = '#007bff';
          captureMotivation.style.color = '#333';
          captureMotivation.style.backgroundColor = 'white';
          captureMotivation.style.borderColor = '#ff69b4';
      }
    }

    function authenticateAnonymously() {
      return new Promise((resolve, reject) => {
        auth.signInAnonymously()
          .then((userCredential) => {
            console.log("用户匿名认证:", userCredential.user.uid);
            userUid = userCredential.user.uid;
            isAuthenticated = true;
            resolve(userCredential.user);
          })
          .catch((error) => {
            console.error("认证错误:", error);
            reject(error);
          });
      });
    }

    auth.onAuthStateChanged((user) => {
      if (user) {
        userUid = user.uid;
        isAuthenticated = true;
        console.log("认证状态已改变: 用户已登录", user.uid);
      } else {
        isAuthenticated = false;
        console.log("认证状态已改变: 用户已登出");
      }
    });

    async function submitToFirebase() {
      try {
        if (!isAuthenticated) {
          console.log("用户未认证，现在认证...");
          await authenticateAnonymously();
        }
        
        const location = await detectUserLocation();
        
        const userData = {
          date: new Date().toISOString(),
          country: location.country || "未知",
          city: location.city || "未知",
          uid: userUid,
          uniqueId: userUniqueId,
          flowerCode: userFlowerCode,
          motivation: currentMotivation,
          dateOfBirth: userDateOfBirth,
          profession: userProfession,
          fullName: userFullName,
          formattedName: formatUserName(userFullName),
          timestamp: Date.now(),
          theme: currentTheme,
          subject: localStorage.getItem('flowerSubject') || getRandomSubject(),
          shareCount: shareCount
        };

        console.log("提交数据到Firebase:", userData);
        
        try {
          const newEntryRef = database.ref('birthdates').push(userData);
          console.log("数据提交到实时数据库:", newEntryRef.key);
        } catch (dbError) {
          console.error("实时数据库错误:", dbError);
        }
        
        try {
          const docRef = await firestore.collection('flowers').add(userData);
          console.log("文档写入Firestore，ID: ", docRef.id);
        } catch (firestoreError) {
          console.error("添加文档到Firestore错误: ", firestoreError);
        }
        
        try {
          await firestore.collection('flowerCodes').doc(userUniqueId).set({
            ...userData,
            createdAt: new Date()
          });
          console.log("花朵代码添加到特定集合");
        } catch (codeError) {
          console.error("添加花朵代码到集合错误: ", codeError);
        }
        
        localStorage.setItem('userFlowerData', JSON.stringify(userData));
        localStorage.setItem('isInstalled', 'true');
        setCookie('userUniqueId', userUniqueId, 365);
        setCookie('userFlowerCode', userFlowerCode, 365);
        setCookie('userDateOfBirth', userDateOfBirth, 365);
        setCookie('userProfession', userProfession, 365);
        setCookie('userFullName', userFullName, 365);
        setCookie('isInstalled', 'true', 365);
        isInstalled = true;
        
        return true;
      } catch (error) {
        console.error("Firebase提交错误:", error);
        const userData = {
          date: new Date().toISOString(),
          uniqueId: userUniqueId,
          flowerCode: userFlowerCode,
          motivation: currentMotivation,
          dateOfBirth: userDateOfBirth,
          profession: userProfession,
          fullName: userFullName,
          formattedName: formatUserName(userFullName),
          timestamp: Date.now(),
          theme: currentTheme,
          subject: localStorage.getItem('flowerSubject') || getRandomSubject(),
          shareCount: 0
        };
        
        localStorage.setItem('userFlowerData', JSON.stringify(userData));
        localStorage.setItem('isInstalled', 'true');
        setCookie('userUniqueId', userUniqueId, 365);
        setCookie('userFlowerCode', userFlowerCode, 365);
        setCookie('userDateOfBirth', userDateOfBirth, 365);
        setCookie('userProfession', userProfession, 365);
        setCookie('userFullName', userFullName, 365);
        setCookie('isInstalled', 'true', 365);
        isInstalled = true;
        
        return true;
      }
    }

    async function updateShareCount() {
      if (!isAuthenticated || !userUniqueId) return;
      
      try {
        shareCount++;
        
        const savedData = localStorage.getItem('userFlowerData');
        if (savedData) {
          const userData = JSON.parse(savedData);
          userData.shareCount = shareCount;
          localStorage.setItem('userFlowerData', JSON.stringify(userData));
        }
        
        await firestore.collection('flowerCodes').doc(userUniqueId).set({
          shareCount: shareCount,
          lastShared: new Date().toISOString(),
          country: currentCountry || "未知",
          city: userCity || "未知",
          uid: userUid,
          uniqueId: userUniqueId
        }, { merge: true });
        
        console.log("分享计数已更新:", shareCount);
      } catch (error) {
        console.error("更新分享计数错误:", error);
      }
    }

    function checkSavedUserData() {
      const cookieUniqueId = getCookie('userUniqueId');
      const cookieFlowerCode = getCookie('userFlowerCode');
      const cookieInstalled = getCookie('isInstalled');
      const cookieDOB = getCookie('userDateOfBirth');
      const cookieProfession = getCookie('userProfession');
      const cookieFullName = getCookie('userFullName');
      
      if (cookieUniqueId && cookieFlowerCode) {
        userUniqueId = cookieUniqueId;
        userFlowerCode = cookieFlowerCode;
        userDateOfBirth = cookieDOB || null;
        userProfession = cookieProfession || null;
        userFullName = cookieFullName || null;
        isInstalled = cookieInstalled === 'true';
        
        currentMotivation = generatePersonalizedMotivation(userFlowerCode, userProfession, userDateOfBirth);
        
        console.log("在cookie中找到已保存的用户数据:", { userUniqueId, userFlowerCode, userDateOfBirth, userProfession, userFullName });
        return true;
      }
      
      const savedData = localStorage.getItem('userFlowerData');
      if (savedData) {
        try {
          const userData = JSON.parse(savedData);
          userUniqueId = userData.uniqueId;
          userFlowerCode = userData.flowerCode;
          userDateOfBirth = userData.dateOfBirth || null;
          userProfession = userData.profession || null;
          userFullName = userData.fullName || null;
          shareCount = userData.shareCount || 0;
          currentMotivation = userData.motivation || generatePersonalizedMotivation(userData.flowerCode, userData.profession, userData.dateOfBirth);
          userUid = userData.uid;
          isInstalled = localStorage.getItem('isInstalled') === 'true';
          
          setCookie('userUniqueId', userUniqueId, 365);
          setCookie('userFlowerCode', userFlowerCode, 365);
          setCookie('userDateOfBirth', userDateOfBirth, 365);
          setCookie('userProfession', userProfession, 365);
          setCookie('userFullName', userFullName, 365);
          setCookie('isInstalled', 'true', 365);
          
          console.log("在localStorage中找到已保存的用户数据:", userData);
          return true;
        } catch (e) {
          console.error("解析已保存的用户数据错误:", e);
          return false;
        }
      }
      return false;
    }

    async function deleteUserAccount() {
      if (!userUniqueId) return false;
      
      try {
        if (!confirm("您确定要删除所有数据吗？此操作不可逆。")) {
          return false;
        }
        
        console.log("删除用户账户:", userUniqueId);
        
        try {
          await firestore.collection('flowerCodes').doc(userUniqueId).delete();
          console.log("数据已从flowerCodes集合中删除");
        } catch (error) {
          console.error("删除flowerCodes时出错:", error);
        }
        
        try {
          const flowersQuery = await firestore.collection('flowers').where('uniqueId', '==', userUniqueId).get();
          
          const batch = firestore.batch();
          let count = 0;
          
          flowersQuery.forEach((doc) => {
            batch.delete(doc.ref);
            count++;
          });
          
          if (count > 0) {
            await batch.commit();
            console.log(`${count}个文档已从flowers集合中删除`);
          }
        } catch (error) {
          console.error("删除flowers时出错:", error);
        }
        
        try {
          const birthdatesRef = database.ref('birthdates');
          const query = birthdatesRef.orderByChild('uniqueId').equalTo(userUniqueId);
          
          query.once('value', (snapshot) => {
            snapshot.forEach((childSnapshot) => {
              birthdatesRef.child(childSnapshot.key).remove();
            });
          });
          
          console.log("数据已从实时数据库中删除");
        } catch (error) {
          console.error("从实时数据库删除时出错:", error);
        }
        
        localStorage.removeItem('userFlowerData');
        localStorage.removeItem('isInstalled');
        localStorage.removeItem('flowerSubject');
        localStorage.removeItem('preferredTheme');
        
        removeCookie('userUniqueId');
        removeCookie('userFlowerCode');
        removeCookie('isInstalled');
        removeCookie('userDateOfBirth');
        removeCookie('userProfession');
        removeCookie('userFullName');
        removeCookie('preferredTheme');
        
        userUniqueId = null;
        userFlowerCode = null;
        currentMotivation = null;
        userDateOfBirth = null;
        userProfession = null;
        userFullName = null;
        isInstalled = false;
        seenSubjects = [];
        shareCount = 0;
        
        try {
          if (auth.currentUser) {
            await auth.currentUser.delete();
            console.log("Firebase用户已删除");
          }
        } catch (authError) {
          console.error("删除认证时出错:", authError);
        }
        
        console.log("用户账户已完全删除");
        return true;
      } catch (error) {
        console.error("删除账户时出错:", error);
        return false;
      }
    }
    
    function createWebAppManifest() {
      const manifestData = {
        name: "G-Z 花朵",
        short_name: "G-Z",
        description: "发现您独特的生命之花",
        start_url: window.location.href,
        display: "standalone",
        background_color: "#1A2E4D",
        theme_color: "#1A2E4D",
        icons: [
          {
            src: "https://firebasestorage.googleapis.com/v0/b/genz-abb36.firebasestorage.app/o/IMG_20250723_083736_652.webp?alt=media&token=0919c124-8818-4376-854c-7e95719e6e76",
            sizes: "192x192",
            type: "image/webp"
          },
          {
            src: "https://firebasestorage.googleapis.com/v0/b/genz-abb36.firebasestorage.app/o/IMG_20250723_083736_652.webp?alt=media&token=0919c124-8818-4376-854c-7e95719e6e76",
            sizes: "512x512",
            type: "image/webp"
          }
        ]
      };
      
      const manifestStr = JSON.stringify(manifestData);
      const manifestBlob = new Blob([manifestStr], {type: 'application/json'});
      const manifestURL = URL.createObjectURL(manifestBlob);
      
      const manifestLink = document.getElementById('manifest-placeholder') || document.createElement('link');
      if (!manifestLink.id) {
        manifestLink.id = 'manifest-placeholder';
        document.head.appendChild(manifestLink);
      }
      manifestLink.setAttribute('href', manifestURL);
      manifestLink.setAttribute('rel', 'manifest');
    }
    
    function setupInstallPrompt() {
      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        
        const isInstallPromptShownBefore = localStorage.getItem('installPromptShown');
        if (!isInstallPromptShownBefore) {
          setTimeout(() => {
            document.getElementById('installPrompt').style.display = 'block';
          }, 3000);
        }
      });
      
      document.getElementById('installBtn').addEventListener('click', async () => {
        if (!deferredPrompt) {
          window.location.href = "https://g-z.online/install.html";
          return;
        }
        
        deferredPrompt.prompt();
        const choiceResult = await deferredPrompt.userChoice;
        
        if (choiceResult.outcome === 'accepted') {
          console.log('用户接受了安装提示');
        } else {
          console.log('用户拒绝了安装提示');
        }
        
        deferredPrompt = null;
        document.getElementById('installPrompt').style.display = 'none';
        localStorage.setItem('installPromptShown', 'true');
      });
      
      document.getElementById('dismissBtn').addEventListener('click', () => {
        document.getElementById('installPrompt').style.display = 'none';
        localStorage.setItem('installPromptShown', 'true');
      });
      
      window.addEventListener('appinstalled', (evt) => {
        console.log('应用已安装');
        document.getElementById('installPrompt').style.display = 'none';
      });
    }

    window.addEventListener('load', async () => {
      // 添加主题颜色和苹果状态栏样式元标签
      if (!document.querySelector('meta[name="theme-color"]')) {
        const themeColorMeta = document.createElement('meta');
        themeColorMeta.setAttribute('name', 'theme-color');
        themeColorMeta.setAttribute('content', '#1A2E4D');
        document.head.appendChild(themeColorMeta);
      }
      
      if (!document.querySelector('meta[name="apple-mobile-web-app-status-bar-style"]')) {
        const appleMeta = document.createElement('meta');
        appleMeta.setAttribute('name', 'apple-mobile-web-app-status-bar-style');
        appleMeta.setAttribute('content', 'black-translucent');
        document.head.appendChild(appleMeta);
      }
      
      createWebAppManifest();
      setupInstallPrompt();
      
      const today = new Date();
      const twoYearsAgo = new Date(today.getFullYear() - 5, today.getMonth(), today.getDate());
      document.getElementById('dobInput').max = twoYearsAgo.toISOString().split('T')[0];
      
      const savedTheme = localStorage.getItem('preferredTheme') || getCookie('preferredTheme');
      if (savedTheme) {
        setTheme(savedTheme);
      } else {
        setTheme('green-blue');
      }
      
      const hasUserData = checkSavedUserData();
      
      if (hasUserData) {
        console.log("用户已有数据，隐藏欢迎模态框");
        const welcomeToast = document.getElementById('welcomeToast');
        welcomeToast.style.display = 'block';
        setTimeout(() => {
          welcomeToast.style.opacity = '1';
        }, 100);
        setTimeout(() => {
          welcomeToast.style.opacity = '0';
          setTimeout(() => {
            welcomeToast.style.display = 'none';
          }, 500);
        }, 6500);
        
        if (!isAuthenticated) {
          try {
            await authenticateAnonymously();
          } catch (error) {
            console.error("认证期间出错:", error);
          }
        }
      } else {
        console.log("未找到已保存的用户数据，显示欢迎模态框");
        const welcomeModal = document.getElementById('welcomeModal');
        welcomeModal.style.display = 'block';
        setTimeout(() => {
          welcomeModal.classList.add('show');
        }, 100);
      }
      
      setupProfessionDropdown();
    });

    function setupProfessionDropdown() {
      const professionInput = document.getElementById('professionInput');
      const professionDropdown = document.getElementById('professionDropdown');
      
      if (!professionInput || !professionDropdown) {
        console.error("未找到职业下拉元素");
        return;
      }
      
      function filterProfessions(input) {
        if (!input) return [];
        
        input = input.toLowerCase();
        return professions.filter(profession => 
          profession.toLowerCase().includes(input)
        );
      }
      
      function renderDropdownOptions(filteredProfessions) {
        professionDropdown.innerHTML = '';
        
        if (filteredProfessions.length === 0) {
          const option = document.createElement('div');
          option.className = 'profession-option';
          option.textContent = '未找到匹配项';
          professionDropdown.appendChild(option);
        } else {
          filteredProfessions.forEach(profession => {
            const option = document.createElement('div');
            option.className = 'profession-option';
            option.textContent = profession;
            option.addEventListener('click', () => {
              professionInput.value = profession;
              professionDropdown.style.display = 'none';
            });
            professionDropdown.appendChild(option);
          });
        }
      }
      
      professionInput.addEventListener('input', () => {
        const filtered = filterProfessions(professionInput.value);
        renderDropdownOptions(filtered);
        
        if (filtered.length > 0) {
          professionDropdown.style.display = 'block';
        } else {
          professionDropdown.style.display = 'none';
        }
      });
      
      professionInput.addEventListener('focus', () => {
        if (professionInput.value) {
          const filtered = filterProfessions(professionInput.value);
          renderDropdownOptions(filtered);
          professionDropdown.style.display = 'block';
        }
      });
      
      document.addEventListener('click', (e) => {
        if (!professionInput.contains(e.target) && !professionDropdown.contains(e.target)) {
          professionDropdown.style.display = 'none';
        }
      });
    }

    document.getElementById('flowerButton').addEventListener('click', function() {
      if (!userUniqueId) {
        alert("请先创建您的花朵账户。");
        // 修复：如果用户没有账户，显示欢迎模态框
        const welcomeModal = document.getElementById('welcomeModal');
        welcomeModal.style.display = 'block';
        setTimeout(() => {
          welcomeModal.classList.add('show');
        }, 100);
        return;
      }
      
      updateFlowerDisplay();
      const flowerModal = document.getElementById('flowerModal');
      flowerModal.style.display = 'block';
      setTimeout(() => {
        flowerModal.classList.add('show');
      }, 10);
      document.getElementById('shareFlowerButton').style.display = 'flex';
    });

    document.getElementById('shareFlowerButton').addEventListener('click', function() {
      captureFlower();
    });
    
    document.getElementById('showIdButton').addEventListener('click', function() {
      if (userUniqueId) {
        document.getElementById('userIdDisplay').textContent = userUniqueId;
        const idModal = document.getElementById('idModal');
        idModal.style.display = 'block';
        setTimeout(() => {
          idModal.classList.add('show');
        }, 10);
      } else {
        alert("请先创建您的花朵账户以获取您的唯一ID。");
        // 修复：如果用户没有账户，显示欢迎模态框
        const welcomeModal = document.getElementById('welcomeModal');
        welcomeModal.style.display = 'block';
        setTimeout(() => {
          welcomeModal.classList.add('show');
        }, 100);
      }
    });
    
    document.getElementById('copyIdButton').addEventListener('click', function() {
      const idText = document.getElementById('userIdDisplay').textContent;
      navigator.clipboard.writeText(idText).then(function() {
        alert('ID已复制到剪贴板！');
      }).catch(function() {
        alert('无法复制ID。请手动选择并复制。');
      });
    });
    
    document.getElementById('closeIdModal').addEventListener('click', function() {
      const idModal = document.getElementById('idModal');
      idModal.classList.remove('show');
      setTimeout(() => {
        idModal.style.display = 'none';
      }, 300);
    });
    
    document.getElementById('deleteAccountButton').addEventListener('click', function() {
      deleteUserAccount().then(success => {
        if (success) {
          alert("账户已成功删除。您需要创建一个新账户才能使用此应用程序。");
          const idModal = document.getElementById('idModal');
          idModal.classList.remove('show');
          setTimeout(() => {
            idModal.style.display = 'none';
            const welcomeModal = document.getElementById('welcomeModal');
            welcomeModal.style.display = 'block';
            setTimeout(() => {
              welcomeModal.classList.add('show');
            }, 100);
          }, 300);
        } else {
          alert("错误，请稍后再试");
        }
      });
    });
    
    document.getElementById('refreshMotivation').addEventListener('click', function() {
      const newMotivation = generatePersonalizedMotivation(userFlowerCode, userProfession, userDateOfBirth);
      currentMotivation = newMotivation;
      
      const newSubject = getRandomSubject();
      localStorage.setItem('flowerSubject', newSubject);
      
      const formattedName = formatUserName(userFullName);
      
      const flowerCodeElement = document.getElementById('flowerCodeDisplay');
      if (formattedName) {
        flowerCodeElement.innerHTML = `我的花朵 - ${newSubject} / ${formattedName}`;
      } else {
        flowerCodeElement.textContent = "我的花朵 - " + newSubject;
      }
      
      document.getElementById('monthlyMotivation').textContent = newMotivation;
      
      const captureCode = document.getElementById('captureFlowerCode');
      const captureMotivation = document.getElementById('captureFlowerMotivation');
      
      if (captureCode) {
        if (formattedName) {
          captureCode.innerHTML = `我的花朵 - ${newSubject} / ${formattedName}`;
        } else {
          captureCode.textContent = "我的花朵 - " + newSubject;
        }
      }
      
      if (captureMotivation) captureMotivation.textContent = newMotivation;
      
      this.style.transition = 'transform 0.5s ease';
      this.style.transform = 'rotate(360deg)';
      
      setTimeout(() => {
        this.style.transition = 'none';
        this.style.transform = 'rotate(0deg)';
      }, 500);
    });
    
    document.getElementById('createAccountButton').addEventListener('click', async function() {
      const dobInput = document.getElementById('dobInput');
      const professionInput = document.getElementById('professionInput');
      const fullNameInput = document.getElementById('fullNameInput');
      
      if (!fullNameInput.value) {
        alert("请输入您的全名。");
        return;
      }
      
      if (!dobInput.value) {
        alert("请输入您的出生日期。");
        return;
      }
      
      if (!professionInput.value) {
        alert("请输入您的职业。");
        return;
      }
      
      document.getElementById('loadingSpinner').style.display = 'block';
      document.getElementById('createAccountButton').disabled = true;
      
      try {
        await authenticateAnonymously();
        
        userFullName = fullNameInput.value;
        userDateOfBirth = dobInput.value;
        userProfession = professionInput.value;
        
        userUniqueId = generateUniqueId();
        console.log("已生成唯一ID:", userUniqueId);
        
        userFlowerCode = generateFlowerCode();
        
        const subject = getRandomSubject();
        localStorage.setItem('flowerSubject', subject);
        
        currentMotivation = generatePersonalizedMotivation(userFlowerCode, userProfession, userDateOfBirth);
        
        const createButton = document.getElementById('createAccountButton');
        createButton.innerHTML = '<i class="fas fa-check"></i> 完成';
        createButton.style.backgroundColor = '#4CAF50';
        
        const userData = {
          date: new Date().toISOString(),
          uid: userUid,
          uniqueId: userUniqueId,
          flowerCode: userFlowerCode,
          motivation: currentMotivation,
          dateOfBirth: userDateOfBirth,
          profession: userProfession,
          fullName: userFullName,
          formattedName: formatUserName(userFullName),
          timestamp: Date.now(),
          theme: currentTheme,
          subject: subject,
          shareCount: 0
        };
        
        localStorage.setItem('userFlowerData', JSON.stringify(userData));
        localStorage.setItem('isInstalled', 'true');
        setCookie('userUniqueId', userUniqueId, 365);
        setCookie('userFlowerCode', userFlowerCode, 365);
        setCookie('userDateOfBirth', userDateOfBirth, 365);
        setCookie('userProfession', userProfession, 365);
        setCookie('userFullName', userFullName, 365);
        setCookie('isInstalled', 'true', 365);
        isInstalled = true;
        
        setTimeout(() => {
          const welcomeModal = document.getElementById('welcomeModal');
          welcomeModal.classList.remove('show');
          
          setTimeout(() => {
            welcomeModal.style.display = 'none';
            document.getElementById('loadingSpinner').style.display = 'none';
            createButton.innerHTML = '创建账户';
            createButton.style.backgroundColor = '';
            createButton.disabled = false;
            
            submitToFirebase().then(submitted => {
              console.log("Firebase提交结果:", submitted);
              
              const welcomeToast = document.getElementById('welcomeToast');
              welcomeToast.style.display = 'block';
              setTimeout(() => {
                welcomeToast.style.opacity = '1';
              }, 100);
              setTimeout(() => {
                welcomeToast.style.opacity = '0';
                setTimeout(() => {
                  welcomeToast.style.display = 'none';
                }, 500);
              }, 2000);
              
              updateFlowerDisplay();
              const flowerModal = document.getElementById('flowerModal');
              flowerModal.style.display = 'block';
              setTimeout(() => {
                flowerModal.classList.add('show');
              }, 10);
              document.getElementById('shareFlowerButton').style.display = 'flex';
            });
          }, 300);
        }, 2000);
        
        console.log("设置完成，数据已本地存储和保存在cookie中");
      } catch (error) {
        console.error("设置期间出错:", error);
        document.getElementById('loadingSpinner').style.display = 'none';
        document.getElementById('createAccountButton').disabled = false;
        alert("设置您的花朵时出现问题。请重试。");
      }
    });
    
    async function captureFlower() {
      try {
        const captureContainer = document.getElementById('flowerCaptureContainer');
        
        updateCaptureStyles(currentTheme);
        
        if (typeof html2canvas !== 'function') {
          console.error("html2canvas未加载或不可用作函数");
          alert("无法捕获花朵。捕获库未加载。");
          return;
        }
        
        let bgColor = 'white';
        if (currentTheme === 'red-black') bgColor = 'black';
        else if (currentTheme === 'green-blue') bgColor = '#1A2E4D';
        else if (currentTheme === 'orange-pink' || currentTheme === 'yellow-purple') bgColor = '#4B0082';
        
        const canvas = await html2canvas(captureContainer, {
          backgroundColor: bgColor,
          scale: 7,
          logging: true,
          useCORS: true,
          allowTaint: true,
          letterRendering: true
        });
        
        const imageUrl = canvas.toDataURL('image/png');
        
        const capturedImage = document.getElementById('capturedImage');
        if (capturedImage) {
          capturedImage.src = imageUrl;
          document.getElementById('capturedFlower').style.display = 'flex';
          document.getElementById('shareWarning').style.display = 'block';
          
          updateShareCount();
        } else {
          console.error("未找到capturedImage元素");
        }
      } catch (error) {
        console.error('捕获花朵时出错:', error);
        alert('无法捕获您的花朵。请重试。');
      }
    }
    
    document.getElementById('shareCapture').addEventListener('click', function() {
      const imageUrl = document.getElementById('capturedImage').src;
      if (navigator.share) {
        fetch(imageUrl)
          .then(res => res.blob())
          .then(blob => {
            const file = new File([blob], 'my-gz-flower.png', { type: 'image/png' });
            navigator.share({
              title: '我的 G-Z 花朵',
              text: '在 g-z.online 发现属于您的花朵',
              files: [file]
            }).catch(err => {
              console.log('分享错误:', err);
              fallbackShare();
            });
          })
          .catch(err => {
            console.log('准备图片时出错:', err);
            fallbackShare();
          });
      } else {
        fallbackShare();
      }
    });
    
    function fallbackShare() {
      try {
        const shareText = `
查看我来自 G-Z 的生命之花: ${userUniqueId}。在 g-z.online 发现属于您的花朵`;
        
        navigator.clipboard.writeText(shareText).then(function() {
          alert('分享文本已复制到剪贴板！');
        }).catch(function() {
          alert('无法复制分享文本。');
        });
      } catch (error) {
        console.error('后备分享错误:', error);
        alert('发生错误。');
      }
    }
    
    document.getElementById('closeCapture').addEventListener('click', function() {
      // 保存图像到设备而不是关闭
      const imageUrl = document.getElementById('capturedImage').src;
      const link = document.createElement('a');
      link.href = imageUrl;
      link.download = 'my-gz-flower.png';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    });
    
    document.getElementById('closeFlowerModal').addEventListener('click', function() {
      const flowerModal = document.getElementById('flowerModal');
      flowerModal.classList.remove('show');
      setTimeout(() => {
        flowerModal.style.display = 'none';
        document.getElementById('shareFlowerButton').style.display = 'none';
      }, 300);
    });

    window.onclick = function(event) {
      const flowerModal = document.getElementById('flowerModal');
      const capturedFlower = document.getElementById('capturedFlower');
      const idModal = document.getElementById('idModal');
      const welcomeModal = document.getElementById('welcomeModal');
      
      if (event.target == flowerModal) {
        flowerModal.classList.remove('show');
        setTimeout(() => {
          flowerModal.style.display = "none";
          document.getElementById('shareFlowerButton').style.display = 'none';
        }, 300);
      }
      
      if (event.target == capturedFlower) {
        capturedFlower.style.display = "none";
      }
      
      if (event.target == idModal) {
        idModal.classList.remove('show');
        setTimeout(() => {
          idModal.style.display = "none";
        }, 300);
      }
      
      // 修改：只有当已安装时才允许点击外部关闭欢迎模态框
      if (event.target == welcomeModal && isInstalled) {
        welcomeModal.classList.remove('show');
        setTimeout(() => {
          welcomeModal.style.display = "none";
        }, 300);
      }
    };
    
    document.getElementById('shareFlowerButton').style.display = 'none';
    document.getElementById('shareWarning').style.display = 'none';
    
    document.querySelectorAll('.style-option').forEach(option => {
      option.addEventListener('click', function() {
        const theme = this.dataset.theme;
        setTheme(theme);
      });
    });
  </script>
</body>
