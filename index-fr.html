<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>G-Z</title>
    <link rel="icon" href="https://firebasestorage.googleapis.com/v0/b/genz-abb36.appspot.com/o/photo_2025-03-09_13-00-43.jpg?alt=media&token=e3d3c543-164c-4c79-8cd1-0a9c710fb002">
    <link href="https://fonts.googleapis.com/css2?family=Billabong&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
    <style>
        input, textarea, select, button {
            font-size: 16px;
            touch-action: manipulation;
        }
        
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: white;
            position: relative;
            transition: background-color 0.3s ease;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            -webkit-text-size-adjust: 100%;
        }
        header {
            background-color: white;
            padding: 6px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: background-color 0.3s ease;
        }
        
        h1 {
            margin: 0;
            font-size: 1.4em;
            font-family: 'Billabong', cursive;
            color: #007bff;
            border: 2px solid #007bff;
            padding: 4px;
            border-radius: 12px;
            font-weight: bold;
            transition: color 0.3s ease, border-color 0.3s ease;
        }
        .divider {
            height: 0.6px;
            background-color: #007bff;
            width: 100%;
            margin-top: 5px;
            transition: background-color 0.3s ease;
        }
        .button-container {
            display: flex;
            justify-content: center;
            margin-top: 5px;
            padding: 5px 0;
            overflow-x: auto;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        .button-container::-webkit-scrollbar {
            display: none;
        }
        .button {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 5px 10px;
            margin: 0 3px;
            font-size: 0.8em;
            cursor: pointer;
            text-decoration: none;
            display: flex;
            align-items: center;
            flex-shrink: 0;
            transition: background-color 0.3s ease;
        }
        .button i {
            margin-right: 2px;
        }
        .notification {
            text-align: center;
            margin-top: 10px;
            font-size: 0.8em;
            color: #0056b3;
            font-weight: bold;
            transition: color 0.3s ease;
            padding: 3px 0;
            max-height: 30px;
            overflow: hidden;
        }
        .share-icon {
            color: #007bff;
            cursor: pointer;
            font-size: 1.3em;
            border: 1px solid #007bff;
            border-radius: 7px;
            padding: 4px;
            background-color: white;
            transition: color 0.3s ease, border-color 0.3s ease;
        }
        footer {
            background-color: white;
            color: black;
            padding: 10px 15px;
            margin-top: auto;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo-container {
            display: flex;
        }
        .logo {
            color: #007bff;
            font-size: 1.6em;
            margin-right: 10px;
            border: 1px solid #007bff;
            border-radius: 10px;
            padding: 5px;
            background-color: rgba(0, 119, 190, 0.1);
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
        }
        .logo:hover {
            background-color: #007bff;
            color: white;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .modal.show {
            opacity: 1;
        }
        .modal-content {
            background-color: white;
            margin: 50% auto;
            padding: 14px;
            border: 1px solid #007bff;
            border-radius: 60px;
            width: 280px;
            max-width: 70%;
            text-align: center;
            max-height: 60vh;
            overflow-y: auto;
            position: relative;
            transition: background-color 0.3s ease, border-color 0.3s ease, transform 0.3s ease;
            transform: scale(0.8);
        }
        .modal.show .modal-content {
            transform: scale(1);
        }
        .modal-header {
            font-size: 1.8em;
            font-family: 'Billabong', cursive;
            margin-bottom: 10px;
            font-weight: bold;
            color: #007bff;
            text-decoration: underline;
            transition: color 0.3s ease;
        }
        
        .modal-footer {
            margin-top: 15px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 6px;
        }
        .close-button {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 8px 10px;
            cursor: pointer;
            font-size: 0.9em;
            width: 120px;
            margin: 4px;
            transition: background-color 0.3s ease;
        }
        .close-button:hover {
            background-color: #0056b3;
        }
        
        @keyframes flowerRotate {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(15deg); }
            50% { transform: rotate(0deg); }
            75% { transform: rotate(-15deg); }
            100% { transform: rotate(0deg); }
        }
        
        .flower-icon {
            display: inline-block;
            animation: flowerRotate 2s infinite ease-in-out;
            color: #ff69b4;
        }
        
        .billabong-title {
            font-family: 'Billabong', cursive;
            font-size: 1.8em;
            margin-bottom: 8px;
            color: #007bff;
            transition: color 0.3s ease;
        }

        .monthly-motivation {
            margin: 15px 0;
            padding: 10px;
            border: 1px dashed #ff69b4;
            border-radius: 15px;
            background-color: white;
            font-style: italic;
            color: #333;
            font-size: 0.9em;
            line-height: 1.4;
            transition: border-color 0.3s ease, color 0.3s ease, background-color 0.3s ease;
            position: relative;
        }
        
        .flower-code {
            display: block;
            font-weight: bold;
            color: #ff69b4;
            font-size: 0.9em;
            margin-bottom: 8px;
            letter-spacing: 0.5px;
            background-color: #fff0f8;
            padding: 6px;
            border-radius: 8px;
            border: 1px solid #ff69b4;
            max-width: 220px;
            margin-left: auto;
            margin-right: auto;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            transition: color 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
        }
        
        .copy-icon {
            color: #007bff;
            cursor: pointer;
            margin-left: 10px;
            font-size: 1.2em;
            vertical-align: middle;
            transition: color 0.3s ease;
        }
        
        .header-controls {
            display: flex;
            align-items: center;
        }
        
        .celebrate-icon {
            font-size: 2em;
            color: gold;
            margin-bottom: 8px;
            animation: celebrate 2s infinite alternate;
        }
        
        @keyframes celebrate {
            0% { transform: scale(1); }
            50% { transform: scale(1.1) rotate(5deg); }
            100% { transform: scale(1) rotate(-5deg); }
        }
        
        .modal-close {
            position: absolute;
            top: 10px;
            right: 20px;
            color: #ff0000;
            font-size: 13px;
            cursor: pointer;
            background-color: transparent;
            border: none;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.2s;
        }
        
        .modal-close:hover {
            background-color: rgba(255, 0, 0, 0.1);
        }
        
        .share-flower-button {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 14px;
            padding: 8px 16px;
            font-size: 0.9em;
            margin: 290px auto;
            display: none;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
            max-width: 190px;
            position: relative;
            z-index: 1001;
            border: 1px solid #0056b3;
        }
        
        .share-flower-button:hover {
            background-color: #0056b3;
        }
        
        .share-flower-button i {
            margin-left: 8px;
        }
        
        #capturedFlower {
            position: fixed;
            z-index: 1003;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .captured-image-container {
            position: relative;
            max-width: 85%;
            max-height: 60vh;
            margin-bottom: 15px;
        }
        
        .captured-image {
            max-width: 100%;
            max-height: 60vh;
            border-radius: 15px;
            border: 2px solid white;
        }
        
        .share-message {
            background-color: white;
            color: #333;
            padding: 10px 15px;
            border-radius: 15px;
            font-size: 0.9em;
            margin: 10px auto;
            max-width: 90%;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        .share-message i {
            margin-left: 8px;
            color: #007bff;
            transition: color 0.3s ease;
        }
        
        .share-link {
            color: #007bff;
            font-weight: bold;
            text-decoration: none;
            transition: color 0.3s ease;
        }
        
        .capture-controls {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }
        
        .capture-button {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 20px;
            padding: 8px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
            transition: background-color 0.3s ease;
        }
        
        .capture-button i {
            margin-right: 5px;
        }
        
        .close-capture {
            background-color: #f0f0f0;
            color: #333;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        #flowerCaptureContainer {
            position: fixed;
            z-index: -1;
            top: 0;
            left: -9999px;
            background-color: white;
            border: 2px solid #007bff;
            border-radius: 20px;
            padding: 15px;
            width: 300px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        
        .capture-flower-header {
            font-family: 'Billabong', cursive;
            color: #007bff;
            font-size: 1.8em;
            margin-bottom: 8px;
            text-align: center;
            font-weight: bold;
            text-shadow: 0px 1px 1px rgba(0, 123, 255, 0.2);
            transition: color 0.3s ease;
        }
        
        .capture-flower-code {
            font-weight: bold;
            color: #ff69b4;
            font-size: 0.8em;
            background-color: #fff0f8;
            padding: 6px;
            border-radius: 10px;
            border: 1px solid #ff69b4;
            margin: 6px auto;
            text-align: center;
            max-width: 80%;
            letter-spacing: 0.5px;
            transition: color 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
        }
        
        .capture-flower-motivation {
            font-style: italic;
            color: #333;
            font-size: 0.95em;
            line-height: 1.4;
            background-color: #f9f9f9;
            border: 1px dashed #ff69b4;
            border-radius: 12px;
            padding: 12px;
            margin: 12px 0;
            text-align: center;
            transition: color 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
            position: relative;
        }
        
        .capture-flower-icon {
            text-align: center;
            font-size: 2.5em;
            color: #ff69b4;
            margin: 10px 0;
            transition: color 0.3s ease;
        }
        
        .gz-logo {
            font-family: 'Billabong', cursive;
            color: #007bff;
            font-size: 1.4em;
            text-align: center;
            margin-top: 10px;
            border: 2px solid #007bff;
            border-radius: 12px;
            padding: 4px;
            width: 50px;
            margin-left: auto;
            margin-right: auto;
            font-weight: bold;
            transition: color 0.3s ease, border-color 0.3s ease;
        }
        
        .share-warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
            border-radius: 15px;
            padding: 10px 15px;
            font-size: 0.85em;
            margin: 5px auto 15px auto;
            max-width: 90%;
            text-align: center;
            display: none;
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }
        
        .capture-website-url {
            text-align: center;
            font-size: 0.85em;
            color: #007bff;
            font-weight: bold;
            margin-top: 8px;
            font-family: Arial, sans-serif;
            padding: 3px 0;
            border-top: 1px dashed #007bff;
            transition: color 0.3s ease, border-color 0.3s ease;
        }
        
        .terms-text {
            font-size: 0.8em;
            color: black;
            text-align: center;
            margin: 10px auto;
            width: 330px;
            transition: color 0.3s ease;
        }
        
        .billabong-title {
            margin-bottom: 3px;
        }

        .header-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            padding: 0 1px;
        }

        .header-icon {
            font-size: 1.4em;
            color: #007bff;
            border: 2px solid #007bff;
            padding: 4px;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            transition: color 0.3s ease, border-color 0.3s ease;
        }

        .app-logo {
            font-family: 'Billabong', cursive;
            color: #007bff;
            border: 2px solid #007bff;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 1.4em;
            font-weight: bold;
            transition: color 0.3s ease, border-color 0.3s ease;
        }

        .header-flex {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
        }
        
        .right-controls {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        #welcomeToast {
            position: fixed;
            top: 160px;
            left: 0;
            right: 0;
            background-color: rgba(0,0,0,0.7);
            color: white;
            padding: 10px;
            border-radius: 20px;
            width: 80%;
            max-width: 300px;
            margin: 0 auto;
            text-align: center;
            z-index: 2000;
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease;
            font-family: , cursive;
            font-size: 1.1em;
            border: 2px solid #4CAF50;
        }

        #welcomeModal {
            display: none;
            position: fixed;
            z-index: 10;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        #welcomeModal.show {
            opacity: 1;
        }

        #welcomeModal .modal-content {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            margin: 40% auto;
            padding: 15px 10px;
            border: 2px solid #4CAF50;
            border-radius: 25px;
            width: 85%;
            max-width: 290px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            text-align: center;
            transition: transform 0.3s ease;
            transform: scale(0.8);
        }
        #welcomeModal.show .modal-content {
            transform: scale(1);
        }

        #welcomeModal .close {
            color: red;
            font-size: 18px;
            font-weight: bold;
            display: block;
            text-align: center;
            margin-bottom: 3px;
            cursor: pointer;
        }

        #welcomeModal .welcome-header {
            color: #007bff;
            font-family: 'Billabong', cursive;
            font-size: 1.8em;
            margin-bottom: 8px;
            text-align: center;
            font-weight: bold;
        }

        #welcomeModal .welcome-text {
            margin: 10px 0 15px 0;
            font-size: 0.8em;
            color: #333;
            line-height: 1.4;
            transition: color 0.3s ease;
        }

        .dob-container {
            margin: 10px 0;
        }

        .dob-container label {
            display: block;
            font-size: 0.8em;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        .dob-input {
            width: 90%;
            padding: 8px;
            border-radius: 10px;
            border: 1px solid #ccc;
            font-size: 16px;
        }

        .profession-container {
            margin: 12px 0;
            position: relative;
        }

        .profession-container label {
            display: block;
            font-size: 0.8em;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        .profession-search {
            width: 90%;
            padding: 8px;
            border-radius: 10px;
            border: 1px solid #ccc;
            font-size: 16px;
        }

        .profession-dropdown {
            display: none;
            position: absolute;
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 10px;
            width: 90%;
            max-height: 150px;
            overflow-y: auto;
            left: 5%;
            z-index: 10;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .profession-option {
            padding: 8px 10px;
            font-size: 0.8em;
            cursor: pointer;
            transition: background-color 0.2s;
            background-color: white;
            color: #333;
        }

        .profession-option:hover {
            background-color: #f5f5f5;
        }

        .name-container {
            margin: 10px 0;
        }

        .name-container label {
            display: block;
            font-size: 0.8em;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        .name-input {
            width: 90%;
            padding: 8px;
            border-radius: 10px;
            border: 1px solid #ccc;
            font-size: 16px;
        }

        #createAccountButton {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 10px 25px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            margin: 10px auto 5px;
            display: block;
            width: 80%;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 123, 255, 0.3);
        }
        
        #createAccountButton:hover {
            background: linear-gradient(135deg, #0056b3 0%, #003d80 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 123, 255, 0.4);
        }
        
        #createAccountButton:active {
            transform: translateY(0);
            box-shadow: 0 1px 3px rgba(0, 123, 255, 0.3);
        }

        .loading-spinner {
            display: none;
            text-align: center;
            margin: 10px 0;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        .loading-dots::after {
            content: '...';
            animation: dots 1.5s infinite;
            display: inline-block;
            width: 20px;
            text-align: left;
        }

        #idModal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        #idModal.show {
            opacity: 1;
        }

        #idModal .modal-content {
            background-color: #fff;
            margin: 45% auto;
            padding: 15px;
            border: 1px solid #007BFF;
            border-radius: 25px;
            width: 65%;
            max-width: 250px;
            text-align: center;
            transition: transform 0.3s ease;
            transform: scale(0.8);
        }
        #idModal.show .modal-content {
            transform: scale(1);
        }

        .id-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }

        .id-title {
            font-size: 1em;
            color: #007bff;
            margin-bottom: 5px;
            transition: color 0.3s ease;
        }

        .id-display {
            font-weight: bold;
            font-size: 1.2em;
            color: #ff69b4;
            background-color: #fff0f8;
            padding: 6px;
            border-radius: 8px;
            border: 1px solid #ff69b4;
            margin: 5px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            max-width: 80%;
            transition: color 0.3s ease, background-color 0.3s ease, border-color 0.3s ease;
        }

        .delete-account {
            background-color: #ff4d4d;
            color: white;
            border: none;
            border-radius: 12px;
            padding: 6px 10px;
            font-size: 0.7em;
            cursor: pointer;
            transition: background-color 0.3s;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .delete-account:hover {
            background-color: #e60000;
        }

        .copy-icon {
            margin-left: 6px;
        }

        .id-message {
            font-size: 0.7em;
            color: #333;
            margin: 5px 0;
            transition: color 0.3s ease;
        }

        #idModal .close-button {
            margin-top: 8px;
            width: auto;
            padding: 6px 15px;
            font-size: 0.7em;
            height: 28px;
        }

        .menu-link {
            text-decoration: none;
            color: #007bff;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.3s ease;
        }
        
        .style-selector {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: white;
            padding: 10px 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 100;
            transition: background-color 0.3s ease;
        }
        
        .style-selector h3 {
            text-align: center;
            margin: 0 0 10px 0;
            font-size: 1em;
            color: #333;
            transition: color 0.3s ease;
        }
        
        .style-options {
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 0 5px;
            overflow-x: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        .style-options::-webkit-scrollbar {
            display: none;
        }
        
        .style-option {
            width: 60px;
            height: 40px;
            border-radius: 10px;
            cursor: pointer;
            flex-shrink: 0;
            position: relative;
            border: 1px solid #ddd;
            overflow: hidden;
        }
        
        .style-option.selected {
            border: 2px solid white;
            box-shadow: 0 0 0 2px #007bff;
        }
        
        .style-option.red-black {
            background: linear-gradient(to right, #FF4500, #8B0000, #121212, #121212);
        }
        
        .style-option.green-blue {
            background: linear-gradient(to right, #3EB489, #14532D, #0A2239, #1A2E4D);
        }
        
        .style-option.orange-pink {
            background: linear-gradient(to right, #FF7F50, #FF6F91, #C71585, #4B0082);
        }
        
        .style-option.yellow-purple {
            background: linear-gradient(to right, #FFD700, #FFA500, #8A2BE2, #4B0082);
        }
        
        .style-option.default {
            background: linear-gradient(to right, #007bff, #0056b3);
        }
        
        .main-content {
            padding-bottom: 80px;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
        }
        
        body.theme-default {
            background-color: white;
            color: #333;
        }
        
        body.theme-default header, 
        body.theme-default footer,
        body.theme-default .style-selector {
            background-color: white;
        }
        
        body.theme-default .app-logo,
        body.theme-default .header-icon,
        body.theme-default .divider,
        body.theme-default .notification,
        body.theme-default .billabong-title,
        body.theme-default .gz-logo,
        body.theme-default .capture-website-url,
        body.theme-default .capture-flower-header,
        body.theme-default .id-title {
            color: #007bff;
            border-color: #007bff;
        }
        
        body.theme-default .notification .notification-text {
            color: #007bff;
        }
        
        body.theme-default .button {
            background-color: #007bff;
        }
        
        body.theme-default .share-flower-button {
            background-color: #007bff;
            color: white;
            border-color: #0056b3;
        }
        
        body.theme-default .flower-code,
        body.theme-default .id-display {
            color: #ff69b4;
            background-color: #fff0f8;
            border-color: #ff69b4;
        }
        
        body.theme-default .monthly-motivation,
        body.theme-default .capture-flower-motivation {
            border-color: #ff69b4;
            color: #333;
            background-color: white;
        }
        
        body.theme-default .modal-content {
            background-color: white;
            border-color: #007bff;
        }
        
        body.theme-red-black {
            background: black;
            color: #E5E5E5;
        }
        
        body.theme-red-black header, 
        body.theme-red-black footer,
        body.theme-red-black .style-selector {
            background-color: black;
        }
        
        body.theme-red-black .app-logo,
        body.theme-red-black .header-icon,
        body.theme-red-black .gz-logo,
        body.theme-red-black .capture-flower-header,
        body.theme-red-black .capture-website-url,
        body.theme-red-black .id-title,
        body.theme-red-black .billabong-title {
            color: #FF4500;
            border-color: #FF4500;
        }
        
        body.theme-red-black .divider {
            background-color: #FF4500;
        }
        
        body.theme-red-black .notification .notification-text {
            color: #FF4500;
        }
        
        body.theme-red-black .notification,
        body.theme-red-black .welcome-text,
        body.theme-red-black .id-message {
            color: #CCCCCC;
        }
        
        body.theme-red-black .button {
            background-color: #8B0000;
        }
        
        body.theme-red-black .share-flower-button {
            background-color: #8B0000;
            color: white;
            border-color: #FF4500;
        }
        
        body.theme-red-black .flower-code,
        body.theme-red-black .id-display {
            color: #FF4500;
            background-color: black;
            border-color: #FF4500;
        }
        
        body.theme-red-black .monthly-motivation,
        body.theme-red-black .capture-flower-motivation {
            border-color: #FF4500;
            color: #E5E5E5;
            background-color: black;
        }
        
        body.theme-red-black .modal-content,
        body.theme-red-black #flowerCaptureContainer {
            background-color: black;
            border-color: #8B0000;
        }
        
        body.theme-green-blue {
            background: #1A2E4D;
            color: #F5F5F5;
        }
        
        body.theme-green-blue header, 
        body.theme-green-blue footer,
        body.theme-green-blue .style-selector {
            background-color: #1A2E4D;
        }
        
        body.theme-green-blue .app-logo,
        body.theme-green-blue .header-icon,
        body.theme-green-blue .gz-logo,
        body.theme-green-blue .capture-flower-header,
        body.theme-green-blue .capture-website-url,
        body.theme-green-blue .id-title,
        body.theme-green-blue .billabong-title {
            color: #3EB489;
            border-color: #3EB489;
        }
        
        body.theme-green-blue .divider {
            background-color: #3EB489;
        }
        
        body.theme-green-blue .notification .notification-text {
            color: #3EB489;
        }
        
        body.theme-green-blue .notification,
        body.theme-green-blue .welcome-text,
        body.theme-green-blue .id-message {
            color: #A0A0A0;
        }
        
        body.theme-green-blue .button {
            background-color: #14532D;
        }
        
        body.theme-green-blue .share-flower-button {
            background-color: #14532D;
            color: white;
            border-color: #3EB489;
        }
        
        body.theme-green-blue .flower-code,
        body.theme-green-blue .id-display {
            color: #3EB489;
            background-color: #36454F;
            border-color: #3EB489;
        }
        
        body.theme-green-blue .monthly-motivation,
        body.theme-green-blue .capture-flower-motivation {
            border-color: #3EB489;
            color: #F5F5F5;
            background-color: #1A2E4D;
        }
        
        body.theme-green-blue .modal-content,
        body.theme-green-blue #flowerCaptureContainer {
            background-color: #1A2E4D;
            border-color: #3EB489;
        }
        
        body.theme-orange-pink {
            background: #4B0082;
            color: #FFFFFF;
        }
        
        body.theme-orange-pink header, 
        body.theme-orange-pink footer,
        body.theme-orange-pink .style-selector {
            background-color: #4B0082;
        }
        
        body.theme-orange-pink .app-logo,
        body.theme-orange-pink .header-icon,
        body.theme-orange-pink .gz-logo,
        body.theme-orange-pink .capture-flower-header,
        body.theme-orange-pink .capture-website-url,
        body.theme-orange-pink .id-title,
        body.theme-orange-pink .billabong-title {
            color: #FF7F50;
            border-color: #FF7F50;
        }
        
        body.theme-orange-pink .divider {
            background-color: #FF7F50;
        }
        
        body.theme-orange-pink .notification .notification-text {
            color: #FF7F50;
        }
        
        body.theme-orange-pink .notification,
        body.theme-orange-pink .welcome-text,
        body.theme-orange-pink .id-message {
            color: #D3D3D3;
        }
        
        body.theme-orange-pink .button {
            background-color: #C71585;
        }
        
        body.theme-orange-pink .share-flower-button {
            background-color: #C71585;
            color: white;
            border-color: #FF7F50;
        }
        
        body.theme-orange-pink .flower-code,
        body.theme-orange-pink .id-display {
            color: #FF7F50;
            background-color: #6A0DAD;
            border-color: #FF7F50;
        }
        
        body.theme-orange-pink .monthly-motivation,
        body.theme-orange-pink .capture-flower-motivation {
            border-color: #FF7F50;
            color: #FFFFFF;
            background-color: #4B0082;
        }
        
        body.theme-orange-pink .modal-content,
        body.theme-orange-pink #flowerCaptureContainer {
            background-color: #4B0082;
            border-color: #FF7F50;
        }

        body.theme-yellow-purple {
            background: #4B0082;
            color: #FFFFFF;
        }
        
        body.theme-yellow-purple header, 
        body.theme-yellow-purple footer,
        body.theme-yellow-purple .style-selector {
            background-color: #4B0082;
        }
        
        body.theme-yellow-purple .app-logo,
        body.theme-yellow-purple .header-icon,
        body.theme-yellow-purple .gz-logo,
        body.theme-yellow-purple .capture-flower-header,
        body.theme-yellow-purple .capture-website-url,
        body.theme-yellow-purple .id-title,
        body.theme-yellow-purple .billabong-title {
            color: #FFD700;
            border-color: #FFD700;
        }
        
        body.theme-yellow-purple .divider {
            background-color: #FFD700;
        }
        
        body.theme-yellow-purple .notification .notification-text {
            color: #FFD700;
        }
        
        body.theme-yellow-purple .notification,
        body.theme-yellow-purple .welcome-text,
        body.theme-yellow-purple .id-message {
            color: #D3D3D3;
        }
        
        body.theme-yellow-purple .button {
            background-color: #8A2BE2;
        }
        
        body.theme-yellow-purple .share-flower-button {
            background-color: #8A2BE2;
            color: white;
            border-color: #FFD700;
        }
        
        body.theme-yellow-purple .flower-code,
        body.theme-yellow-purple .id-display {
            color: #FFD700;
            background-color: #6A0DAD;
            border-color: #FFD700;
        }
        
        body.theme-yellow-purple .monthly-motivation,
        body.theme-yellow-purple .capture-flower-motivation {
            border-color: #FFD700;
            color: #FFFFFF;
            background-color: #4B0082;
        }
        
        body.theme-yellow-purple .modal-content,
        body.theme-yellow-purple #flowerCaptureContainer {
            background-color: #4B0082;
            border-color: #FFD700;
        }
        
        .refresh-motivation {
            position: absolute;
            right: 15px;
            top: 70px;
            color: #007bff;
            cursor: pointer;
            font-size: 1.2em;
            padding: 5px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transition: transform 0.3s ease, color 0.3s ease;
        }
        
        .refresh-motivation:hover {
            transform: rotate(180deg);
        }
        
        body.theme-red-black .refresh-motivation {
            color: #FF4500;
        }
        
        body.theme-green-blue .refresh-motivation {
            color: #3EB489;
        }
        
        body.theme-orange-pink .refresh-motivation {
            color: #FF7F50;
        }
        
        body.theme-yellow-purple .refresh-motivation {
            color: #FFD700;
        }
        
        .user-name {
            font-size: 0.75em;
            font-weight: bold;
        }
    </style>
</head>
<body class="theme-green-blue">

  <header>
   
    <div class="header-container">
      <div class="app-logo" translate="no">G-Z</div>
      
      <div class="right-controls">
      
        <a href="https://g-z.online/language.html" class="header-icon menu-link"><i class="fas fa-language"></i></a>
        
      <div class="right-controls">
        <div class="header-icon" id="showIdButton"><i class="fas fa-user"></i></div>
  
        
        <a href="https://g-z.online/us.html" class="header-icon menu-link"><i class="fas fa-bars"></i></a>
      </div>
    </div>
  </header>

  <div class="divider"></div>

  <div class="main-content">
    <div class="button-container">
      <a class="button" href="#" id="flowerButton"><i class="fas fa-spa flower-icon"></i><span>Fleur de vie</span></a>
    </div>

    <div class="divider"></div>
    <div class="notification">
      <span class="notification-text">üí† Fleur -- Le message que l'univers a √©crit juste pour vous ¬Ø\_(„ÉÑ)_/¬Ø</span>
    </div>

    <div class="divider"></div>
  </div>

  <div class="style-selector">
    <h3>Style</h3>
    <div class="style-options">
      <div class="style-option red-black" data-theme="red-black"></div>
      <div class="style-option green-blue selected" data-theme="green-blue"></div>
      <div class="style-option orange-pink" data-theme="orange-pink"></div>
      <div class="style-option yellow-purple" data-theme="yellow-purple"></div>
      <div class="style-option default" data-theme="default"></div>
    </div>
  </div>

  <div id="welcomeToast" translate="no">
    Bienvenue ¬Ø\_(„ÉÑ)_/¬Ø
  </div>

  <div id="welcomeModal" class="modal">
    <div class="modal-content">
      <div class="welcome-header">üí† Bienvenue üí†</div>
      <div class="welcome-text">
        La cr√©ation d'un compte n√©cessite votre date de naissance, profession et nom pour cr√©er votre fleur unique.
      </div>
      
      <div class="name-container">
        <label for="fullNameInput">Votre Nom Complet:</label>
        <input type="text" id="fullNameInput" class="name-input" placeholder="Entrez votre nom complet...">
      </div>
      
      <div class="dob-container">
        <label for="dobInput">Date de Naissance:</label>
        <input type="date" id="dobInput" class="dob-input" max="">
      </div>
      
      <div class="profession-container">
        <label for="professionInput">Votre Profession:</label>
        <input type="text" id="professionInput" class="profession-search" placeholder="Tapez votre profession...">
        <div id="professionDropdown" class="profession-dropdown"></div>
      </div>
      
      <div class="loading-spinner" id="loadingSpinner">
        <span>Cr√©ation de votre fleur unique</span>
        <span class="loading-dots"></span>
      </div>
      
      <button id="createAccountButton">Cr√©er un Compte</button>
    </div>
  </div>

  <div id="idModal" class="modal">
    <div class="modal-content">
      <div class="id-title">Votre ID Utilisateur</div>
      <div class="id-display">
        <span id="userIdDisplay"></span>
        <i class="fas fa-copy copy-icon" id="copyIdButton"></i>
      </div>
      <div class="id-message">Gardez cet ID en s√©curit√© !</div>
      <div class="id-actions">
        <button class="delete-account" id="deleteAccountButton">Supprimer Compte</button>
        <button class="close-button" id="closeIdModal">Fermer</button>
      </div>
    </div>
  </div>

  <div id="flowerModal" class="modal">
    <div class="modal-content">
      <button class="modal-close" id="closeFlowerModal"><i class="fas fa-times"></i></button>
      <div class="billabong-title"><strong id="flowerTypeTitle">Fleur de Vie</strong></div>
      
      <div id="flowerCodeDisplay" class="flower-code"></div>
      
      <i class="fas fa-sync-alt refresh-motivation" id="refreshMotivation" title="G√©n√©rer une nouvelle motivation"></i>
      
      <div class="monthly-motivation" id="monthlyMotivation">
      </div>
      
      <div style="margin: 10px auto; font-size: 3em; color: #ff69b4;" id="flowerIconContainer">
        <i class="fas fa-spa"></i>
      </div>
    </div>
  </div>
  
  <button class="share-flower-button" id="shareFlowerButton">
    <span>Partager ma Fleur</span> <i class="fas fa-paper-plane"></i>
  </button>
  
  <div id="capturedFlower">
    <div class="captured-image-container">
      <img id="capturedImage" class="captured-image" src="" alt="Fleur Captur√©e">
    </div>

    <div class="share-warning" id="shareWarning">
      <i class="fas fa-exclamation-triangle" style="margin-right: 5px;"></i>
      <span>Parfait pour partager, ajustez simplement.</span>
    </div>
    
    <div class="capture-controls">
      <button class="capture-button" id="shareCapture">
        <i class="fas fa-paper-plane"></i> <span>Partager</span>
      </button>
      
      <button class="capture-button close-capture" id="closeCapture">
        <i class="fas fa-times"></i> <span>Fermer</span>
      </button>
    </div>
  </div>
  
  <div id="flowerCaptureContainer">
    <div class="capture-flower-header" id="captureFlowerHeader">Fleur de Vie</div>
    
    <div id="captureFlowerCode" class="capture-flower-code"></div>
    
    <div id="captureFlowerMotivation" class="capture-flower-motivation">
    </div>
    
    <div class="capture-flower-icon" id="captureFlowerIcon">
      <i class="fas fa-spa"></i>
    </div>
    
    <div class="gz-logo" translate="no">G-Z</div>
  <div class="capture-website-url">
  D√©couvrez la v√¥tre sur <span translate="no">www.g-z.online</span>
</div>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCrPKQOqw4zciASa_5PbI_etfkvrBaDPDI",
      authDomain: "genz-abb36.firebaseapp.com",
      databaseURL: "https://genz-abb36-default-rtdb.firebaseio.com",
      projectId: "genz-abb36",
      storageBucket: "genz-abb36.firebasestorage.app",
      messagingSenderId: "405021535683",
      appId: "1:405021535683:web:ee5a28fde27f5558046176",
      measurementId: "G-XZNQND2J00"
    };

    firebase.initializeApp(firebaseConfig);
    
    const auth = firebase.auth();
    const database = firebase.database();
    const firestore = firebase.firestore();
    
    let userUid = null;
    let userFlowerCode = null;
    let currentMotivation = null;
    let currentCountry = null;
    let userCity = null;
    let userUniqueId = null;
    let isAuthenticated = false;
    let isInstalled = false;
    let currentTheme = "green-blue";
    let userDateOfBirth = null;
    let userProfession = null;
    let userFullName = null;
    let seenSubjects = [];
    let shareCount = 0;
    let userRank = 0;
    let userEmoji = "üëë";

    const rankEmojis = ["üëë", "üåü", "üî•", "‚ö°Ô∏è", "‚≠êÔ∏è", "‚ùÑÔ∏è", "‚ú®Ô∏è", "üéñ", "üóø"];

    const professions = [
      "Musicien", "Rappeur", "Footballeur", "Basketteur", "Boxeur", 
      "√âtudiant", "Enseignant", "M√©decin", "Infirmier", "Ing√©nieur", 
      "D√©veloppeur", "Designer", "Artiste", "√âcrivain", "Journaliste", 
      "Chef cuisinier", "Serveur/Serveuse", "Femme de m√©nage", "TikTokeur", "YouTubeur", 
      "Influenceur", "Photographe", "Vid√©aste", "Danseur", "Acteur/Actrice", 
      "Mannequin", "Architecte", "Avocat", "Comptable", "Conseiller financier", 
      "Banquier", "Entrepreneur", "Propri√©taire d'entreprise", "Manager", "Cadre", 
      "Vendeur", "Marketeur", "Gestionnaire de m√©dias sociaux", "Chauffeur", "Pilote", 
      "Agent de bord", "M√©canicien", "√âlectricien", "Plombier", "Ouvrier du b√¢timent", 
      "Agriculteur", "Jardinier", "V√©t√©rinaire", "Coach sportif", "Instructeur de fitness", 
      "Professeur de yoga", "Th√©rapeute", "Psychologue", "Conseiller", "Pasteur/Leader religieux",
      "Scientifique", "Chercheur", "Professeur", "Policier", "Pompier",
      "Personnel militaire", "Agent de s√©curit√©", "Agent immobilier", "Pharmacien", "Dentiste",
      "Optom√©triste", "Kin√©sith√©rapeute", "Ergoth√©rapeute", "Orthophoniste", "Di√©t√©ticien",
      "Nutritionniste", "Coiffeur", "Maquilleur", "Esth√©ticienne", "Tailleur",
      "Cr√©ateur de mode", "Employ√© de commerce", "Caissier", "Service client", "Agent de centre d'appel",
      "Traducteur", "Interpr√®te", "Guide touristique", "Agent de voyage", "Directeur d'h√¥tel",
      "R√©ceptionniste", "Secr√©taire", "Assistant administratif", "Biblioth√©caire", "Archiviste",
      "Historien", "Arch√©ologue", "Anthropologue", "Sociologue", "Politologue",
      "√âconomiste", "Statisticien", "Analyste de donn√©es", "Data scientist", "Designer UX/UI",
      "D√©veloppeur de jeux", "D√©veloppeur d'applications", "D√©veloppeur web", "Administrateur r√©seau", "Sp√©cialiste en cybers√©curit√©",
      "Support informatique", "Technicien", "Sp√©cialiste en r√©paration", "Boulanger", "Boucher",
      "P√™cheur", "Mineur", "Forestier", "Paysagiste", "D√©corateur d'int√©rieur",
      "Organisateur d'√©v√©nements", "Organisateur de mariages", "Fleuriste", "Bijoutier", "Artisan",
      "Programmeur", "Webdesigner", "Sp√©cialiste en marketing digital", "Sp√©cialiste SEO", "Cr√©ateur de contenu",
      "Chef de produit", "Chef de projet", "Contr√¥le qualit√©", "Analyste d'affaires", "Consultant",
      "Recruteur", "DRH", "Coach de carri√®re", "Coach de vie", "Conf√©rencier motivateur",
      "Conf√©rencier", "Animateur radio", "Pr√©sentateur TV", "Journaliste TV", "Podcasteur",
      "Auteur", "Sc√©nariste", "R√©dacteur", "R√©dacteur technique", "√âditeur",
      "√âditeur de livres", "Agent litt√©raire", "Libraire", "Biblioth√©caire", "Critique litt√©raire",
      "Graphiste", "Illustrateur", "Animateur", "Artiste 3D", "Artiste VFX",
      "R√©alisateur", "Producteur", "Op√©rateur cam√©ra", "Ing√©nieur du son", "Technicien d'√©clairage",
      "Monteur", "Assistant de production", "D√©corateur de plateau", "Costumier", "Maquilleur cin√©ma",
      "Artiste effets sp√©ciaux", "Cascadeur", "Doubleur", "Agent artistique", "Directeur de casting"
    ];

    const subjectDictionary = {
      "Success": "Succ√®s",
      "Achievement": "R√©ussite",
      "Victory": "Victoire",
      "Triumph": "Triomphe",
      "Accomplishment": "Accomplissement",
      
      "Richest": "Richesse",
      "Prosperity": "Prosp√©rit√©",
      "Abundance": "Abondance",
      "Fortune": "Fortune",
      "Affluence": "Aisance",
      
      "Joy": "Joie",
      "Happiness": "Bonheur",
      "Bliss": "F√©licit√©",
      "Delight": "D√©lice",
      "Contentment": "Contentement",
      
      "Growth": "Croissance",
      "Progress": "Progr√®s",
      "Advancement": "Avancement",
      "Development": "D√©veloppement",
      "Improvement": "Am√©lioration",
      
      "Power": "Pouvoir",
      "Strength": "Force",
      "Might": "Puissance",
      "Force": "Force",
      "Energy": "√ânergie",
      
      "Wisdom": "Sagesse",
      "Intelligence": "Intelligence",
      "Knowledge": "Connaissance",
      "Insight": "Perspicacit√©",
      "Understanding": "Compr√©hension",
      
      "Creativity": "Cr√©ativit√©",
      "Innovation": "Innovation",
      "Imagination": "Imagination",
      "Invention": "Invention",
      "Originality": "Originalit√©",
      
      "Leadership": "Leadership",
      "Authority": "Autorit√©",
      "Influence": "Influence",
      "Command": "Commandement",
      "Direction": "Direction",
      
      "Peace": "Paix",
      "Harmony": "Harmonie",
      "Tranquility": "Tranquillit√©",
      "Serenity": "S√©r√©nit√©",
      "Calm": "Calme",
      
      "Love": "Amour",
      "Affection": "Affection",
      "Adoration": "Adoration",
      "Devotion": "D√©votion",
      "Passion": "Passion",
      
      "Courage": "Courage",
      "Bravery": "Bravoure",
      "Valor": "Vaillance",
      "Heroism": "H√©ro√Øsme",
      "Fearlessness": "Intr√©pidit√©",
      
      "Health": "Sant√©",
      "Vitality": "Vitalit√©",
      "Wellness": "Bien-√™tre",
      "Vigor": "Vigueur",
      "Fitness": "Forme",
      
      "Freedom": "Libert√©",
      "Liberty": "Libert√©",
      "Independence": "Ind√©pendance",
      "Autonomy": "Autonomie",
      "Self-determination": "Autod√©termination",
      
      "Purpose": "But",
      "Meaning": "Sens",
      "Mission": "Mission",
      "Calling": "Vocation",
      "Destiny": "Destin",
      
      "Resilience": "R√©silience",
      "Tenacity": "T√©nacit√©",
      "Perseverance": "Pers√©v√©rance",
      "Endurance": "Endurance",
      "Grit": "D√©termination",
      
      "Authenticity": "Authenticit√©",
      "Genuineness": "Sinc√©rit√©",
      "Honesty": "Honn√™tet√©",
      "Integrity": "Int√©grit√©",
      "Sincerity": "Sinc√©rit√©",
      
      "Transformation": "Transformation",
      "Change": "Changement",
      "Evolution": "√âvolution",
      "Rebirth": "Renaissance",
      "Metamorphosis": "M√©tamorphose",
      
      "Connection": "Connexion",
      "Relationship": "Relation",
      "Community": "Communaut√©",
      "Belonging": "Appartenance",
      "Unity": "Unit√©",
      
      "Gratitude": "Gratitude",
      "Thankfulness": "Reconnaissance",
      "Appreciation": "Appr√©ciation",
      "Recognition": "Reconnaissance",
      "Acknowledgment": "Reconnaissance",
      
      "Mindfulness": "Pleine conscience",
      "Presence": "Pr√©sence",
      "Awareness": "Conscience",
      "Consciousness": "Conscience",
      "Attentiveness": "Attention",
      
      "Compassion": "Compassion",
      "Empathy": "Empathie",
      "Kindness": "Gentillesse",
      "Generosity": "G√©n√©rosit√©",
      "Altruism": "Altruisme",
      
      "Balance": "√âquilibre",
      "Equilibrium": "√âquilibre",
      "Harmony": "Harmonie",
      "Proportion": "Proportion",
      "Symmetry": "Sym√©trie",
      
      "Inspiration": "Inspiration",
      "Motivation": "Motivation",
      "Enthusiasm": "Enthousiasme",
      "Excitement": "Excitation",
      "Passion": "Passion",
      
      "Focus": "Focus",
      "Concentration": "Concentration",
      "Attention": "Attention",
      "Discipline": "Discipline",
      "Dedication": "D√©vouement",
      
      "Humility": "Humilit√©",
      "Modesty": "Modestie",
      "Simplicity": "Simplicit√©",
      "Unpretentiousness": "Simplicit√©",
      "Groundedness": "Ancrage",
      
      "Patience": "Patience",
      "Tolerance": "Tol√©rance",
      "Forbearance": "Patience",
      "Endurance": "Endurance",
      "Persistence": "Persistance",
      
      "Joy": "Joie",
      "Delight": "D√©lice",
      "Gladness": "All√©gresse",
      "Exultation": "Exultation",
      "Jubilation": "Jubilation",
      
      "Trust": "Confiance",
      "Faith": "Foi",
      "Confidence": "Confiance",
      "Reliance": "Fiabilit√©",
      "Dependability": "Fiabilit√©",
      
      "Self-confidence": "Confiance en soi",
      "Self-esteem": "Estime de soi",
      "Self-belief": "Croyance en soi",
      "Self-assurance": "Assurance",
      "Self-trust": "Confiance en soi",
      
      "Enthusiasm": "Enthousiasme",
      "Zeal": "Z√®le",
      "Eagerness": "Empressement",
      "Ardor": "Ardeur",
      "Fervor": "Ferveur",
      
      "Clarity": "Clart√©",
      "Lucidity": "Lucidit√©",
      "Transparency": "Transparence",
      "Precision": "Pr√©cision",
      "Sharpness": "Nettet√©",
      
      "Adaptability": "Adaptabilit√©",
      "Flexibility": "Flexibilit√©",
      "Versatility": "Polyvalence",
      "Adjustability": "Adaptabilit√©",
      "Malleability": "Mall√©abilit√©",
      
      "Communication": "Communication",
      "Expression": "Expression",
      "Articulation": "Articulation",
      "Dialogue": "Dialogue",
      "Conversation": "Conversation",
      
      "Career": "Carri√®re",
      "Profession": "Profession",
      "Vocation": "Vocation",
      "Occupation": "Occupation",
      "Calling": "Vocation"
    };

    async function getUserRankAndEmoji() {
      try {
        const userCount = await getUserCount();
        userRank = userCount % rankEmojis.length;
        userEmoji = rankEmojis[userRank];
        console.log(`User rank: ${userRank}, emoji: ${userEmoji}`);
        return userEmoji;
      } catch (error) {
        console.error("Erreur d'obtention du rang utilisateur:", error);
        return "üëë";
      }
    }

    async function getUserCount() {
      try {
        const snapshot = await firestore.collection('flowerCodes').get();
        return snapshot.size;
      } catch (error) {
        console.error("Erreur de comptage des utilisateurs:", error);
        return 0;
      }
    }

    function formatUserName(fullName) {
      if (!fullName) return "";
      
      const nameParts = fullName.trim().split(' ');
      
      if (nameParts.length === 1) {
        return nameParts[0];
      }
      
      const firstName = nameParts[0];
      const lastNameInitial = nameParts[nameParts.length - 1].charAt(0).toUpperCase();
      
      return `${firstName} ${lastNameInitial}.`;
    }

    function generateUniqueId() {
      const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      const numbers = '0123456789';
      let id = '';
      
      for (let i = 0; i < 3; i++) {
        id += letters.charAt(Math.floor(Math.random() * letters.length));
      }
      
      for (let i = 0; i < 3; i++) {
        id += numbers.charAt(Math.floor(Math.random() * numbers.length));
      }
      
      return id;
    }

    async function detectUserLocation() {
      try {
        const response = await fetch('https://ipapi.co/json/');
        const data = await response.json();
        currentCountry = data.country_name;
        userCity = data.city;
        console.log("Localisation utilisateur d√©tect√©e:", currentCountry, userCity);
        return { country: currentCountry, city: userCity };
      } catch (error) {
        console.error("Erreur de d√©tection de localisation:", error);
        return { country: "Inconnu", city: "Inconnu" };
      }
    }

    function generatePersonalizedMotivation(flowerCode, profession, dob) {
      if (!flowerCode || flowerCode.length < 8) {
        return "Votre motivation florale est l√† pour vous inspirer et vous guider.";
      }
      
      let month = 0;
      if (dob) {
        const dobDate = new Date(dob);
        month = dobDate.getMonth();
      }
      
      const lifeTraits = [
        "Votre cr√©ativit√© apporte des id√©es fra√Æches √† chaque d√©fi.",
        "Votre gentillesse inspire les autres autour de vous.",
        "Votre pers√©v√©rance vous aide √† surmonter les obstacles.",
        "Votre perspective unique r√©sout les probl√®mes de nouvelles fa√ßons.",
        "Votre √©nergie illumine la journ√©e de tous ceux que vous rencontrez.",
        "Votre patience vous aide √† voir le tableau d'ensemble.",
        "Votre courage vous permet de faire face √† de nouveaux d√©fis.",
        "Votre sagesse vous guide √† travers des d√©cisions difficiles.",
        "Votre optimisme vous aide √† trouver des opportunit√©s dans toutes les situations.",
        "Votre concentration vous aide √† atteindre vos objectifs √©tape par √©tape.",
        "Votre adaptabilit√© est votre plus grande force.",
        "Votre intuition vous guide vers le bon chemin.",
        "Votre empathie vous connecte profond√©ment avec les autres.",
        "Votre r√©silience vous aide √† rebondir plus fort.",
        "Votre authenticit√© attire les gens vers votre vrai moi.",
        "Votre gratitude multiplie la joie dans votre vie.",
        "Votre curiosit√© m√®ne √† de nouvelles d√©couvertes.",
        "Votre sens de l'humour all√®ge m√™me les moments difficiles.",
        "Votre g√©n√©rosit√© cr√©e des ondulations de gentillesse.",
        "Votre d√©termination transforme les d√©fis en r√©ussites.",
        "Votre compassion gu√©rit ceux qui vous entourent.",
        "Votre clart√© vous aide √† faire des choix judicieux.",
        "Votre confiance inspire la confiance chez les autres.",
        "Votre pleine conscience vous maintient centr√© dans le chaos.",
        "Votre int√©grit√© vous fait gagner le respect partout o√π vous allez.",
        "Votre enthousiasme enflamme la passion chez les autres.",
        "Votre chaleur fait que les gens se sentent instantan√©ment bienvenus.",
        "Votre imagination ouvre des portes aux possibilit√©s.",
        "Votre √©quilibre vous aide √† naviguer dans les complexit√©s de la vie.",
        "Votre vision vous permet de voir au-del√† de l'horizon.",
        "Votre charisme attire les gens vers votre √©nergie.",
        "Votre discipline construit la fondation pour le succ√®s.",
        "Votre nature intuitive vous aide √† comprendre des v√©rit√©s subtiles.",
        "Votre caract√®re ludique garde votre esprit jeune et vibrant.",
        "Votre esprit analytique trouve des solutions que d'autres manquent.",
        "Votre pr√©venance cr√©e des connexions significatives.",
        "Votre sensibilit√© vous permet de percevoir ce dont les autres ont besoin.",
        "Votre esprit d√©cisif fait avancer les projets efficacement.",
        "Votre constance b√¢tit la confiance au fil du temps.",
        "Votre expressivit√© communique votre v√©rit√© magnifiquement.",
        "Votre ing√©niosit√© transforme les limitations en opportunit√©s.",
        "Votre diligence assure la qualit√© dans tout ce que vous faites.",
        "Votre flexibilit√© s'adapte aux circonstances changeantes avec gr√¢ce.",
        "Votre pragmatisme ancre vos actions dans la r√©alit√©.",
        "Votre √©loquence articule des id√©es complexes clairement.",
        "Votre pr√©voyance vous aide √† vous pr√©parer aux d√©fis futurs.",
        "Votre douceur gu√©rit les blessures sans laisser de cicatrices.",
        "Votre assertivit√© d√©fend ce qui est juste.",
        "Votre ind√©pendance favorise l'autonomie et la force.",
        "Votre conscience pr√™te attention aux d√©tails importants.",
        "Votre agilit√© mentale vous aide √† vous adapter rapidement aux nouvelles situations.",
        "Votre conscience de soi illumine votre chemin vers la croissance.",
        "Votre force int√©rieure brille le plus intens√©ment pendant les moments difficiles.",
        "Votre personnalit√© magn√©tique attire les gens dans votre orbite.",
        "Votre intelligence √©motionnelle vous aide √† naviguer dans des relations complexes.",
        "Votre rapidit√© d'esprit trouve des solutions quand d'autres ne voient que des probl√®mes.",
        "Votre confiance tranquille parle volumes sans dire un mot.",
        "Votre leadership naturel inspire les autres √† suivre leurs meilleurs instincts.",
        "Votre √©thique in√©branlable guide vos d√©cisions m√™me quand personne ne regarde.",
        "Votre sensibilit√© artistique trouve la beaut√© dans des endroits inattendus.",
        "Votre esprit strat√©gique anticipe les d√©veloppements futurs avec une pr√©cision remarquable.",
        "Votre spontan√©it√© apporte une √©nergie fra√Æche aux situations stagnantes.",
        "Votre attention m√©ticuleuse aux d√©tails pr√©vient les complications futures.",
        "Votre pr√©sence paisible calme m√™me les environnements les plus chaotiques.",
        "Votre pens√©e innovante brise les limitations conventionnelles.",
        "Votre diplomatie naturelle r√©sout les conflits avec gr√¢ce et √©quit√©.",
        "Votre fiabilit√© fait de vous un confident pour ceux qui en ont besoin.",
        "Votre enthousiasme contagieux √©l√®ve tout le monde autour de vous.",
        "Votre ouverture d'esprit accueille de nouvelles perspectives et possibilit√©s."
      ];
      
      const lifeEncouragements = [
        "Continuez √† partager vos dons avec le monde.",
        "Faites confiance √† vos instincts - ils vous m√®nent rarement dans la mauvaise direction.",
        "Vos talents naturels sont faits pour √™tre partag√©s.",
        "Le chemin devant vous peut avoir des d√©fis, mais vous √™tes pr√™t √† les affronter.",
        "De petits pas aujourd'hui m√®nent √† de grandes r√©alisations demain.",
        "N'oubliez pas de c√©l√©brer vos progr√®s en cours de route.",
        "Votre parcours unique vaut chaque pas.",
        "N'oubliez pas de profiter du processus, pas seulement des r√©sultats.",
        "Vos meilleurs jours sont encore devant vous.",
        "Vos efforts d'aujourd'hui construisent votre demain.",
        "Restez fid√®le √† vous-m√™me dans toutes les situations.",
        "Embrassez le changement comme une opportunit√© de grandir.",
        "√âcoutez plus souvent votre sagesse int√©rieure.",
        "Permettez-vous de vous reposer quand c'est n√©cessaire.",
        "Gardez votre concentration sur ce qui compte vraiment.",
        "Votre pr√©sence est un cadeau pour ceux qui vous entourent.",
        "Nourrissez vos passions constamment.",
        "Soyez doux avec vous-m√™me pendant les d√©fis.",
        "Votre chemin unique est exactement ce qu'il vous faut.",
        "Faites confiance au timing du d√©roulement de votre vie.",
        "Trouvez de la joie dans les petits moments chaque jour.",
        "Votre perspective est pr√©cieuse - partagez-la.",
        "Croyez en votre capacit√© √† cr√©er du changement.",
        "Rappelez-vous pourquoi vous avez commenc√© ce voyage.",
        "Chaque jour offre un nouveau d√©part.",
        "Votre r√©silience est inspirante pour les autres.",
        "Prenez le temps de c√©l√©brer les petites victoires.",
        "Chaque d√©fi que vous affrontez vous renforce.",
        "L'univers soutient votre chemin authentique.",
        "Votre lumi√®re brille le plus intens√©ment quand vous √™tes vous-m√™me.",
        "Le monde a besoin de votre contribution unique.",
        "Laissez votre travail parler de lui-m√™me.",
        "Votre effort constant se multiplie avec le temps.",
        "Ce qui semble impossible aujourd'hui sera votre r√©alit√© demain.",
        "La force en vous est plus grande que les d√©fis devant vous.",
        "Votre voyage inspire les autres plus que vous ne le r√©alisez.",
        "Les obstacles sont des redirections vers un meilleur chemin.",
        "La profondeur de votre caract√®re se montre dans les moments difficiles.",
        "Votre croissance se produit en dehors de votre zone de confort.",
        "M√™me un petit progr√®s est toujours un progr√®s qui m√©rite d'√™tre c√©l√©br√©.",
        "Restez concentr√© sur votre 'pourquoi' pendant les moments difficiles.",
        "Vos choix quotidiens cr√©ent votre h√©ritage.",
        "Les le√ßons que vous apprenez maintenant vous serviront pour toujours.",
        "Ne sous-estimez jamais l'impact de votre gentillesse.",
        "Votre voix authentique r√©sonne avec ceux qui ont besoin de l'entendre.",
        "Les d√©fis que vous surmontez aujourd'hui construisent votre force pour demain.",
        "Votre pass√© ne d√©finit pas votre potentiel futur.",
        "Chaque pas en avant, aussi petit soit-il, est toujours un mouvement vers l'avant.",
        "Votre approche unique est votre avantage comp√©titif.",
        "Ayez confiance que vous √™tes exactement l√† o√π vous devez √™tre en ce moment.",
        "Vos plus grandes r√©alisations viennent souvent apr√®s vos plus grands d√©fis.",
        "Votre histoire est encore en train d'√™tre √©crite - rendez-la remarquable.",
        "L'univers conspire en faveur de vos r√™ves authentiques.",
        "Votre ressource la plus puissante est votre croyance in√©branlable en vous-m√™me.",
        "L'impact que vous avez sur les autres est plus grand que vous ne le savez.",
        "Vos limitations actuelles sont temporaires, mais votre potentiel est permanent.",
        "L'approbation la plus importante vient de l'int√©rieur de vous-m√™me.",
        "Votre intuition est votre boussole int√©rieure - faites confiance √† sa direction.",
        "La discipline d'aujourd'hui cr√©e la libert√© de demain.",
        "Chaque exp√©rience, bonne ou difficile, ajoute de la profondeur √† votre caract√®re.",
        "Le but de votre vie se d√©voile √† travers la joie et la difficult√©.",
        "La fa√ßon dont vous g√©rez l'adversit√© r√©v√®le votre vraie force.",
        "Votre singularit√© est votre plus grand avantage comp√©titif.",
        "Permettez-vous d'√©voluer √† mesure que vos r√™ves √©voluent.",
        "Votre engagement envers la croissance change d√©j√† votre avenir.",
        "Ne sous-estimez jamais jusqu'o√π la constance peut vous mener.",
        "Votre d√©termination l'emporte sur tout revers temporaire.",
        "Le bon chemin n'est pas toujours le plus facile, mais il vaut toujours la peine d'√™tre pris.",
        "Votre courage de commencer inspire les autres √† faire de m√™me.",
        "Chaque fois que vous choisissez la croissance plut√¥t que le confort, vous √©largissez votre potentiel.",
        "Votre plus haut potentiel vous attend juste au-del√† de votre zone de confort.",
        "Chaque d√©fi que vous affrontez vous pr√©pare √† quelque chose de plus grand."
      ];
      
      const professionMotivations = {
        "Musicien": [
          "Votre talent musical apporte de l'harmonie √† un monde chaotique.",
          "Chaque note que vous jouez r√©sonne avec l'√¢me de quelqu'un.",
          "Vos m√©lodies ont le pouvoir de gu√©rir et de transformer.",
          "Votre expression artistique exprime des v√©rit√©s universelles.",
          "La musique en vous m√©rite d'√™tre entendue."
        ],
        "Rappeur": [
          "Vos mots peignent des histoires puissantes qui doivent √™tre racont√©es.",
          "Votre flow et votre rythme capturent des √©motions que les mots seuls ne peuvent exprimer.",
          "Vos vers donnent une voix aux exp√©riences que beaucoup ressentent mais ne peuvent articuler.",
          "Votre voix authentique r√©sonne avec les chercheurs de v√©rit√©.",
          "Votre prouesse lyrique ouvre les esprits et les c≈ìurs."
        ],
        "Footballeur": [
          "Votre d√©vouement sur le terrain inspire le travail d'√©quipe en dehors du terrain.",
          "Votre discipline athl√©tique se traduit dans tous les domaines de la vie.",
          "Votre pens√©e strat√©gique sur le terrain montre votre leadership naturel.",
          "Votre passion pour le beau jeu √©l√®ve ceux qui vous entourent.",
          "Votre esprit sportif √©tablit la norme pour les autres."
        ],
        "Basketteur": [
          "Votre vision du jeu se traduit par la capacit√© de voir les opportunit√©s dans la vie.",
          "Votre capacit√© √† performer sous pression vous sert dans chaque d√©fi.",
          "Votre mentalit√© d'√©quipe cr√©e du succ√®s dans toutes vos relations.",
          "Votre d√©tente verticale est √©gal√©e par votre ambition d'atteindre de nouveaux sommets.",
          "Votre combativit√© en d√©fense montre votre engagement envers l'excellence."
        ],
        "Boxeur": [
          "Votre force mentale est aussi impressionnante que votre force physique.",
          "Votre discipline √† l'entra√Ænement refl√®te votre caract√®re dans la vie.",
          "Votre capacit√© √† encaisser les coups et √† continuer d'avancer est votre superpouvoir.",
          "Votre jeu de jambes sur le ring refl√®te votre capacit√© √† naviguer dans les d√©fis de la vie.",
          "Votre esprit combatif ne recule jamais devant les d√©fis qui en valent la peine."
        ],
        "√âtudiant": [
          "Votre curiosit√© ouvre des portes √† des possibilit√©s infinies.",
          "Votre engagement envers l'apprentissage vous servira tout au long de la vie.",
          "Votre perspective fra√Æche apporte de nouvelles id√©es √† de vieux probl√®mes.",
          "Votre parcours √©ducatif vous pr√©pare √† des opportunit√©s encore invisibles.",
          "Votre discipline acad√©mique construit des habitudes pour un succ√®s √† vie."
        ],
        "Enseignant": [
          "Votre influence s'√©tend bien au-del√† de la salle de classe.",
          "Votre patience nourrit un potentiel que d'autres pourraient manquer.",
          "Votre guidance fa√ßonne des avenirs d'une mani√®re que vous ne verrez peut-√™tre jamais pleinement.",
          "Votre sagesse plante des graines qui fleuriront pour des g√©n√©rations.",
          "Votre d√©vouement √† la connaissance cr√©e des ondulations de changement positif."
        ],
        "TikTokeur": [
          "Votre contenu cr√©atif apporte de la joie et de la connexion dans un monde num√©rique.",
          "Votre voix authentique atteint ceux qui ont besoin de votre message.",
          "Votre capacit√© √† communiquer de fa√ßon concise est une comp√©tence rare et pr√©cieuse.",
          "Votre influence culturelle peut √™tre dirig√©e vers un changement positif.",
          "Votre pr√©sence num√©rique a un impact dans le monde r√©el."
        ],
        "Entrepreneur": [
          "Votre vision cr√©e des opportunit√©s l√† o√π d'autres voient des obstacles.",
          "Votre capacit√© √† prendre des risques calcul√©s vous distingue.",
          "Votre pens√©e innovante r√©sout les probl√®mes √† leur racine.",
          "Votre leadership inspire les autres √† rejoindre votre mission.",
          "Votre persistance √† travers les d√©fis d√©finit votre succ√®s."
        ],
        "M√©decin": [
          "Vos mains gu√©risseuses apportent du r√©confort dans les moments de d√©tresse.",
          "Votre engagement envers les soins de sant√© change des vies chaque jour.",
          "Vos connaissances m√©dicales combin√©es √† l'empathie cr√©ent une v√©ritable gu√©rison.",
          "Votre d√©vouement aux soins des patients exemplifie la plus haute vocation.",
          "Vos comp√©tences diagnostiques sont √©gal√©es par votre c≈ìur compatissant."
        ],
        "Ing√©nieur": [
          "Vos capacit√©s de r√©solution de probl√®mes cr√©ent des solutions qui am√©liorent des vies.",
          "Votre expertise technique construit des fondations pour l'avenir.",
          "Votre esprit analytique voit des mod√®les que d'autres manquent.",
          "Votre pr√©cision et attention aux d√©tails assurent la qualit√© dans tout ce que vous cr√©ez.",
          "Vos approches innovantes aux d√©fis font avancer tout votre domaine."
        ],
        "D√©veloppeur": [
          "Votre code cr√©e des possibilit√©s qui n'existaient pas auparavant.",
          "Vos solutions techniques r√©solvent de vrais probl√®mes humains.",
          "Votre pens√©e logique se combine magnifiquement avec l'innovation cr√©ative.",
          "Vos cr√©ations num√©riques impactent d'innombrables vies quotidiennement.",
          "Votre capacit√© √† apprendre de nouvelles technologies vous maintient √† la pointe."
        ],
        "Artiste": [
          "Votre vision cr√©ative montre aux autres de nouvelles fa√ßons de voir le monde.",
          "Votre expression artistique touche des √©motions que les mots ne peuvent atteindre.",
          "Votre perspective unique ajoute de la beaut√© aux exp√©riences quotidiennes.",
          "Votre travail suscite d'importantes conversations au-del√† des fronti√®res.",
          "Votre courage cr√©atif inspire les autres √† exprimer leur v√©rit√©."
        ],
        "Infirmier": [
          "Vos soins compatissants gu√©rissent plus que les maux physiques.",
          "Votre attention remarque ce que d'autres pourraient manquer.",
          "Votre pr√©sence calme apporte du r√©confort dans les moments difficiles.",
          "Votre d√©vouement aux soins des patients fait une diff√©rence √† chaque service.",
          "Votre √©quilibre entre comp√©tence technique et chaleur humaine est inestimable."
        ],
        "√âcrivain": [
          "Vos mots cr√©ent des mondes dans l'esprit de vos lecteurs.",
          "Votre narration connecte les gens √† travers diff√©rentes exp√©riences.",
          "Votre √©loquence donne une voix √† ce que d'autres peinent √† exprimer.",
          "Vos id√©es √©crites offrent de nouvelles perspectives sur des d√©fis familiers.",
          "Votre art litt√©raire pr√©serve des v√©rit√©s importantes pour les g√©n√©rations futures."
        ],
        "Avocat": [
          "Votre plaidoyer apporte justice √† ceux qui ont besoin d'une voix.",
          "Votre esprit analytique navigue dans des d√©fis juridiques complexes avec pr√©cision.",
          "Votre engagement envers les principes juridiques renforce les fondements de la soci√©t√©.",
          "Votre capacit√© √† construire des arguments convaincants change les r√©sultats.",
          "Votre approche √©thique de la pratique du droit √©tablit la norme pour les autres."
        ],
        "Chef cuisinier": [
          "Vos cr√©ations culinaires apportent de la joie √† travers tous les sens.",
          "Votre cuisine connecte les gens √† travers les tables et les cultures.",
          "Vos combinaisons de saveurs d√©montrent votre intuition artistique.",
          "Votre d√©dication aux ingr√©dients de qualit√© honore √† la fois tradition et innovation.",
          "Votre leadership en cuisine fait ressortir le meilleur de toute votre √©quipe."
        ],
        "Comptable": [
          "Votre expertise financi√®re fournit s√©curit√© et tranquillit√© d'esprit.",
          "Votre attention aux d√©tails attrape ce que d'autres pourraient manquer.",
          "Vos comp√©tences analytiques apportent de la clart√© aux situations financi√®res complexes.",
          "Votre int√©grit√© assure la confiance dans toutes vos relations professionnelles.",
          "Vos capacit√©s organisationnelles cr√©ent de l'ordre √† partir de la complexit√© financi√®re."
        ],
        "Designer": [
          "Vos solutions visuelles combinent beaut√© et fonction pratique.",
          "Votre pens√©e design transforme les exp√©riences utilisateur pour le mieux.",
          "Votre sensibilit√© esth√©tique √©l√®ve les objets et interactions quotidiens.",
          "Votre processus cr√©atif √©quilibre innovation et utilisabilit√©.",
          "Votre langage design communique √† travers les barri√®res et fronti√®res."
        ],
        "Policier": [
          "Votre engagement envers la s√©curit√© publique rend les communaut√©s plus fortes.",
          "Votre courage dans des situations difficiles prot√®ge ceux qui en ont le plus besoin.",
          "Votre prise de d√©cision rapide sous pression d√©montre un sang-froid remarquable.",
          "Votre d√©vouement √† la justice guide votre conduite professionnelle.",
          "Votre pr√©sence apporte de la s√©curit√© dans des situations tendues."
        ],
        "Pompier": [
          "Votre bravoure dans des situations dangereuses sauve des vies et des biens.",
          "Votre r√©flexion rapide sous pression extr√™me est extraordinaire.",
          "Votre pr√©paration physique et mentale permet votre r√©ponse h√©ro√Øque.",
          "Votre travail d'√©quipe en situation de crise exemplifie le meilleur de la coop√©ration humaine.",
          "Votre engagement envers la s√©curit√© communautaire s'√©tend au-del√† de la r√©ponse d'urgence."
        ],
        "Personnel militaire": [
          "Votre service d√©montre la plus haute forme d'engagement envers les autres.",
          "Votre discipline dans des conditions difficiles vous distingue.",
          "Votre pens√©e strat√©gique √©quilibre les objectifs de mission avec la s√©curit√© de l'√©quipe.",
          "Votre adaptabilit√© aux situations changeantes assure le succ√®s de la mission.",
          "Votre loyaut√© envers votre unit√© cr√©e des liens qui transcendent l'amiti√© ordinaire."
        ],
        "Journaliste": [
          "Votre qu√™te de v√©rit√© apporte de la clart√© dans des temps confus.",
          "Votre narration aide les autres √† comprendre des questions complexes.",
          "Vos comp√©tences d'investigation d√©couvrent ce qui doit √™tre vu.",
          "Votre engagement envers les faits √©quilibre l'√©cosyst√®me d'information.",
          "Votre voix ajoute une perspective importante au discours public."
        ],
        "Psychologue": [
          "Votre √©coute empathique cr√©e un espace pour la gu√©rison.",
          "Vos id√©es aident les autres √† naviguer dans leurs paysages int√©rieurs.",
          "Votre approche th√©rapeutique √©quilibre compassion et pratique fond√©e sur des preuves.",
          "Votre patience permet aux autres de d√©couvrir leurs propres solutions.",
          "Vos limites professionnelles permettent des relations de gu√©rison durables."
        ],
        "Enseignant": [
          "Votre guidance fa√ßonne des avenirs au-del√† de ce que vous pourrez jamais voir.",
          "Votre patience avec le processus d'apprentissage permet √† la croissance de se d√©ployer naturellement.",
          "Votre capacit√© √† expliquer des concepts complexes rend la connaissance accessible.",
          "Votre gestion de classe cr√©e des espaces s√ªrs pour l'exploration intellectuelle.",
          "Votre reconnaissance des diff√©rents styles d'apprentissage atteint chaque √©l√®ve."
        ],
        "Programmeur": [
          "Vos comp√©tences de codage transforment des id√©es abstraites en r√©alit√© fonctionnelle.",
          "Votre approche de r√©solution de probl√®mes d√©compose des d√©fis complexes en parties g√©rables.",
          "Votre attention aux d√©tails pr√©vient les complications futures dans votre code.",
          "Votre apprentissage continu maintient vos comp√©tences pertinentes dans un domaine changeant.",
          "Votre cr√©ativit√© technique trouve des solutions √©l√©gantes √† des probl√®mes difficiles."
        ]
      };
      
      const monthTraits = [
        "Votre naissance en janvier vous donne des qualit√©s de leadership naturel et une concentration d√©termin√©e.",
        "Votre naissance en f√©vrier vous b√©nit avec une compr√©hension intuitive et une vision humanitaire.",
        "Votre naissance en mars vous procure une cr√©ativit√© imaginative et une r√©silience adaptable.",
        "Votre naissance en avril vous dote d'une persistance d√©termin√©e et d'une initiative courageuse.",
        "Votre naissance en mai vous accorde des comp√©tences de communication persuasives et une sensibilit√© pratique.",
        "Votre naissance en juin vous offre une versatilit√© adaptable et une intelligence √©motionnelle.",
        "Votre naissance en juillet vous donne une empathie compatissante et un instinct protecteur.",
        "Votre naissance en ao√ªt vous b√©nit avec un charisme magn√©tique et une confiance g√©n√©reuse.",
        "Votre naissance en septembre vous procure une pr√©cision analytique et une organisation m√©thodique.",
        "Votre naissance en octobre vous dote d'une perspective √©quilibr√©e et d'une harmonie diplomatique.",
        "Votre naissance en novembre vous accorde une perspicacit√© p√©n√©trante et une intensit√© transformative.",
        "Votre naissance en d√©cembre vous offre un optimisme visionnaire et une sagesse philosophique."
      ];
      
      let selectedTrait;
      
      if (profession && professionMotivations[profession] && Math.random() < 0.25) {
        const profMotivations = professionMotivations[profession];
        selectedTrait = profMotivations[Math.floor(Math.random() * profMotivations.length)];
      } 
      else if (dob && Math.random() < 0.2) {
        selectedTrait = monthTraits[month];
      }
      else {
        selectedTrait = lifeTraits[Math.floor(Math.random() * lifeTraits.length)];
      }
      
      const encourageIndex = Math.floor(Math.random() * lifeEncouragements.length);
      
      return selectedTrait + " " + lifeEncouragements[encourageIndex];
    }

    function generateFlowerCode() {
      const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      let code = '';
      for (let i = 0; i < 8; i++) {
        const randomIndex = Math.floor(Math.random() * characters.length);
        code += characters.charAt(randomIndex);
      }
      return code;
    }

    function getRandomSubject() {
      let availableSubjects = Object.keys(subjectDictionary).filter(subject => !seenSubjects.includes(subject));
      
      if (availableSubjects.length === 0) {
        seenSubjects = [];
        availableSubjects = Object.keys(subjectDictionary);
      }
      
      const randomIndex = Math.floor(Math.random() * availableSubjects.length);
      const selectedSubject = availableSubjects[randomIndex];
      
      seenSubjects.push(selectedSubject);
      
      return selectedSubject;
    }

    async function updateFlowerDisplay() {
      const flowerCodeElement = document.getElementById('flowerCodeDisplay');
      const motivationElement = document.getElementById('monthlyMotivation');
      
      if (!flowerCodeElement || !motivationElement) {
        console.error("√âl√©ments requis non trouv√©s dans le DOM");
        return;
      }
      
      let subject = localStorage.getItem('flowerSubject');
      if (!subject) {
        subject = getRandomSubject();
        localStorage.setItem('flowerSubject', subject);
      }
      
      let translatedSubject = subjectDictionary[subject] || subject;
      
      const formattedName = formatUserName(userFullName);
      
      if (formattedName) {
        flowerCodeElement.innerHTML = `Ma Fleur - ${translatedSubject} / ${formattedName} ${userEmoji}`;
      } else {
        flowerCodeElement.textContent = "Ma Fleur - " + translatedSubject;
      }
      
      if (!currentMotivation) {
        currentMotivation = generatePersonalizedMotivation(userFlowerCode, userProfession, userDateOfBirth);
      }
      
      motivationElement.textContent = currentMotivation;
      
      const captureCode = document.getElementById('captureFlowerCode');
      const captureMotivation = document.getElementById('captureFlowerMotivation');
      
      if (captureCode) {
        if (formattedName) {
          captureCode.innerHTML = `Ma Fleur - ${translatedSubject} / ${formattedName} ${userEmoji}`;
        } else {
          captureCode.textContent = "Ma Fleur - " + translatedSubject;
        }
      }
      
      if (captureMotivation) captureMotivation.textContent = currentMotivation;
      
      return currentMotivation;
    }

    function setCookie(name, value, days) {
      let expires = "";
      if (days) {
        const date = new Date();
        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
        expires = "; expires=" + date.toUTCString();
      }
      document.cookie = name + "=" + (value || "") + expires + "; path=/; SameSite=Lax";
    }

    function getCookie(name) {
      const nameEQ = name + "=";
      const ca = document.cookie.split(';');
      for (let i = 0; i < ca.length; i++) {
        let c = ca[i];
        while (c.charAt(0) === ' ') c = c.substring(1, c.length);
        if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
      }
      return null;
    }

    function removeCookie(name) {
      document.cookie = name + "=; Max-Age=-99999999; path=/";
    }

    function setTheme(theme) {
      document.body.classList.remove('theme-default', 'theme-red-black', 'theme-green-blue', 'theme-orange-pink', 'theme-yellow-purple');
      
      document.body.classList.add('theme-' + theme);
      
      currentTheme = theme;
      
      localStorage.setItem('preferredTheme', theme);
      setCookie('preferredTheme', theme, 365);
      
      const options = document.querySelectorAll('.style-option');
      options.forEach(option => {
        option.classList.remove('selected');
        if (option.dataset.theme === theme) {
          option.classList.add('selected');
        }
      });
      
      updateCaptureStyles(theme);
    }
    
    function updateCaptureStyles(theme) {
      const captureContainer = document.getElementById('flowerCaptureContainer');
      const captureCode = document.getElementById('captureFlowerCode');
      const captureHeader = document.getElementById('captureFlowerHeader');
      const captureWebsiteUrl = document.querySelector('.capture-website-url');
      const captureLogo = document.querySelector('.gz-logo');
      const captureMotivation = document.getElementById('captureFlowerMotivation');
      
      if (!captureContainer || !captureCode || !captureHeader || !captureWebsiteUrl || 
          !captureLogo || !captureMotivation) {
        console.error("Un ou plusieurs √©l√©ments de capture non trouv√©s");
        return;
      }
      
      captureContainer.style.borderColor = '';
      captureCode.style.borderColor = '';
      captureCode.style.color = '';
      captureCode.style.backgroundColor = '';
      captureHeader.style.color = '';
      captureWebsiteUrl.style.color = '';
      captureLogo.style.color = '';
      captureLogo.style.borderColor = '';
      captureMotivation.style.color = '';
      captureMotivation.style.backgroundColor = '';
      captureMotivation.style.borderColor = '';
      
      switch(theme) {
        case 'red-black':
          captureContainer.style.borderColor = '#8B0000';
          captureContainer.style.backgroundColor = 'black';
          captureCode.style.borderColor = '#FF4500';
          captureCode.style.color = '#FF4500';
          captureCode.style.backgroundColor = 'black';
          captureHeader.style.color = '#FF4500';
          captureWebsiteUrl.style.color = '#FF4500';
          captureLogo.style.color = '#FF4500';
          captureLogo.style.borderColor = '#FF4500';
          captureMotivation.style.color = '#E5E5E5';
          captureMotivation.style.backgroundColor = 'black';
          captureMotivation.style.borderColor = '#FF4500';
          break;
          
        case 'green-blue':
          captureContainer.style.borderColor = '#3EB489';
          captureContainer.style.backgroundColor = '#1A2E4D';
          captureCode.style.borderColor = '#3EB489';
          captureCode.style.color = '#3EB489';
          captureCode.style.backgroundColor = '#36454F';
          captureHeader.style.color = '#3EB489';
          captureWebsiteUrl.style.color = '#3EB489';
          captureLogo.style.color = '#3EB489';
          captureLogo.style.borderColor = '#3EB489';
          captureMotivation.style.color = '#F5F5F5';
          captureMotivation.style.backgroundColor = '#1A2E4D';
          captureMotivation.style.borderColor = '#3EB489';
          break;
          
        case 'orange-pink':
          captureContainer.style.borderColor = '#FF7F50';
          captureContainer.style.backgroundColor = '#4B0082';
          captureCode.style.borderColor = '#FF7F50';
          captureCode.style.color = '#FF7F50';
          captureCode.style.backgroundColor = '#6A0DAD';
          captureHeader.style.color = '#FF7F50';
          captureWebsiteUrl.style.color = '#FF7F50';
          captureLogo.style.color = '#FF7F50';
          captureLogo.style.borderColor = '#FF7F50';
          captureMotivation.style.color = '#FFFFFF';
          captureMotivation.style.backgroundColor = '#4B0082';
          captureMotivation.style.borderColor = '#FF7F50';
          break;
          
        case 'yellow-purple':
          captureContainer.style.borderColor = '#FFD700';
          captureContainer.style.backgroundColor = '#4B0082';
          captureCode.style.borderColor = '#FFD700';
          captureCode.style.color = '#FFD700';
          captureCode.style.backgroundColor = '#6A0DAD';
          captureHeader.style.color = '#FFD700';
          captureWebsiteUrl.style.color = '#FFD700';
          captureLogo.style.color = '#FFD700';
          captureLogo.style.borderColor = '#FFD700';
          captureMotivation.style.color = '#FFFFFF';
          captureMotivation.style.backgroundColor = '#4B0082';
          captureMotivation.style.borderColor = '#FFD700';
          break;
          
        default:
          captureContainer.style.borderColor = '#007bff';
          captureContainer.style.backgroundColor = 'white';
          captureCode.style.borderColor = '#ff69b4';
          captureCode.style.color = '#ff69b4';
          captureCode.style.backgroundColor = '#fff0f8';
          captureHeader.style.color = '#007bff';
          captureWebsiteUrl.style.color = '#007bff';
          captureLogo.style.color = '#007bff';
          captureLogo.style.borderColor = '#007bff';
          captureMotivation.style.color = '#333';
          captureMotivation.style.backgroundColor = 'white';
          captureMotivation.style.borderColor = '#ff69b4';
      }
    }

    function authenticateAnonymously() {
      return new Promise((resolve, reject) => {
        auth.signInAnonymously()
          .then((userCredential) => {
            console.log("Utilisateur authentifi√© anonymement:", userCredential.user.uid);
            userUid = userCredential.user.uid;
            isAuthenticated = true;
            resolve(userCredential.user);
          })
          .catch((error) => {
            console.error("Erreur d'authentification:", error);
            reject(error);
          });
      });
    }

    auth.onAuthStateChanged((user) => {
      if (user) {
        userUid = user.uid;
        isAuthenticated = true;
        console.log("√âtat d'authentification chang√©: utilisateur connect√©", user.uid);
      } else {
        isAuthenticated = false;
        console.log("√âtat d'authentification chang√©: utilisateur d√©connect√©");
      }
    });

    async function submitToFirebase() {
      try {
        if (!isAuthenticated) {
          console.log("Utilisateur non authentifi√©, authentification en cours...");
          await authenticateAnonymously();
        }
        
        const location = await detectUserLocation();
        
        await getUserRankAndEmoji();
        
        const userData = {
          date: new Date().toISOString(),
          country: location.country || "Inconnu",
          city: location.city || "Inconnu",
          uid: userUid,
          uniqueId: userUniqueId,
          flowerCode: userFlowerCode,
          motivation: currentMotivation,
          dateOfBirth: userDateOfBirth,
          profession: userProfession,
          fullName: userFullName,
          formattedName: formatUserName(userFullName),
          timestamp: Date.now(),
          theme: currentTheme,
          subject: localStorage.getItem('flowerSubject') || getRandomSubject(),
          shareCount: shareCount,
          rank: userRank,
          emoji: userEmoji
        };

        console.log("Soumission de donn√©es √† Firebase:", userData);
        
        try {
          const newEntryRef = database.ref('birthdates').push(userData);
          console.log("Donn√©es soumises √† la base de donn√©es en temps r√©el:", newEntryRef.key);
        } catch (dbError) {
          console.error("Erreur avec la base de donn√©es en temps r√©el:", dbError);
        }
        
        try {
          const docRef = await firestore.collection('flowers').add(userData);
          console.log("Document √©crit dans Firestore avec ID: ", docRef.id);
        } catch (firestoreError) {
          console.error("Erreur d'ajout de document √† Firestore: ", firestoreError);
        }
        
        try {
          await firestore.collection('flowerCodes').doc(userUniqueId).set({
            ...userData,
            createdAt: new Date()
          });
          console.log("Code fleur ajout√© √† la collection sp√©cifique");
        } catch (codeError) {
          console.error("Erreur d'ajout de code fleur √† la collection: ", codeError);
        }
        
        localStorage.setItem('userFlowerData', JSON.stringify(userData));
        localStorage.setItem('isInstalled', 'true');
        setCookie('userUniqueId', userUniqueId, 365);
        setCookie('userFlowerCode', userFlowerCode, 365);
        setCookie('userDateOfBirth', userDateOfBirth, 365);
        setCookie('userProfession', userProfession, 365);
        setCookie('userFullName', userFullName, 365);
        setCookie('userEmoji', userEmoji, 365);
        setCookie('userRank', userRank.toString(), 365);
        setCookie('isInstalled', 'true', 365);
        isInstalled = true;
        
        return true;
      } catch (error) {
        console.error("Erreur de soumission Firebase:", error);
        await getUserRankAndEmoji();
        
        const userData = {
          date: new Date().toISOString(),
          uniqueId: userUniqueId,
          flowerCode: userFlowerCode,
          motivation: currentMotivation,
          dateOfBirth: userDateOfBirth,
          profession: userProfession,
          fullName: userFullName,
          formattedName: formatUserName(userFullName),
          timestamp: Date.now(),
          theme: currentTheme,
          subject: localStorage.getItem('flowerSubject') || getRandomSubject(),
          shareCount: 0,
          rank: userRank,
          emoji: userEmoji
        };
        
        localStorage.setItem('userFlowerData', JSON.stringify(userData));
        localStorage.setItem('isInstalled', 'true');
        setCookie('userUniqueId', userUniqueId, 365);
        setCookie('userFlowerCode', userFlowerCode, 365);
        setCookie('userDateOfBirth', userDateOfBirth, 365);
        setCookie('userProfession', userProfession, 365);
        setCookie('userFullName', userFullName, 365);
        setCookie('userEmoji', userEmoji, 365);
        setCookie('userRank', userRank.toString(), 365);
        setCookie('isInstalled', 'true', 365);
        isInstalled = true;
        
        return true;
      }
    }

    async function updateShareCount() {
      if (!isAuthenticated || !userUniqueId) return;
      
      try {
        shareCount++;
        
        const savedData = localStorage.getItem('userFlowerData');
        if (savedData) {
          const userData = JSON.parse(savedData);
          userData.shareCount = shareCount;
          localStorage.setItem('userFlowerData', JSON.stringify(userData));
        }
        
        await firestore.collection('flowerCodes').doc(userUniqueId).set({
          shareCount: shareCount,
          lastShared: new Date().toISOString(),
          country: currentCountry || "Inconnu",
          city: userCity || "Inconnu",
          uid: userUid,
          uniqueId: userUniqueId
        }, { merge: true });
        
        console.log("Compteur de partages mis √† jour:", shareCount);
      } catch (error) {
        console.error("Erreur de mise √† jour du compteur de partages:", error);
      }
    }

    function checkSavedUserData() {
      const cookieUniqueId = getCookie('userUniqueId');
      const cookieFlowerCode = getCookie('userFlowerCode');
      const cookieInstalled = getCookie('isInstalled');
      const cookieDOB = getCookie('userDateOfBirth');
      const cookieProfession = getCookie('userProfession');
      const cookieFullName = getCookie('userFullName');
      const cookieEmoji = getCookie('userEmoji');
      const cookieRank = getCookie('userRank');
      
      if (cookieUniqueId && cookieFlowerCode) {
        userUniqueId = cookieUniqueId;
        userFlowerCode = cookieFlowerCode;
        userDateOfBirth = cookieDOB || null;
        userProfession = cookieProfession || null;
        userFullName = cookieFullName || null;
        userEmoji = cookieEmoji || "üëë";
        userRank = cookieRank ? parseInt(cookieRank) : 0;
        isInstalled = cookieInstalled === 'true';
        
        currentMotivation = generatePersonalizedMotivation(userFlowerCode, userProfession, userDateOfBirth);
        
        console.log("Donn√©es utilisateur trouv√©es dans les cookies:", { userUniqueId, userFlowerCode, userDateOfBirth, userProfession, userFullName, userEmoji, userRank });
        return true;
      }
      
      const savedData = localStorage.getItem('userFlowerData');
      if (savedData) {
        try {
          const userData = JSON.parse(savedData);
          userUniqueId = userData.uniqueId;
          userFlowerCode = userData.flowerCode;
          userDateOfBirth = userData.dateOfBirth || null;
          userProfession = userData.profession || null;
          userFullName = userData.fullName || null;
          shareCount = userData.shareCount || 0;
          userEmoji = userData.emoji || "üëë";
          userRank = userData.rank || 0;
          currentMotivation = userData.motivation || generatePersonalizedMotivation(userData.flowerCode, userData.profession, userData.dateOfBirth);
          userUid = userData.uid;
          isInstalled = localStorage.getItem('isInstalled') === 'true';
          
          setCookie('userUniqueId', userUniqueId, 365);
          setCookie('userFlowerCode', userFlowerCode, 365);
          setCookie('userDateOfBirth', userDateOfBirth, 365);
          setCookie('userProfession', userProfession, 365);
          setCookie('userFullName', userFullName, 365);
          setCookie('userEmoji', userEmoji, 365);
          setCookie('userRank', userRank.toString(), 365);
          setCookie('isInstalled', 'true', 365);
          
          console.log("Donn√©es utilisateur trouv√©es dans localStorage:", userData);
          return true;
        } catch (e) {
          console.error("Erreur d'analyse des donn√©es utilisateur sauvegard√©es:", e);
          return false;
        }
      }
      return false;
    }

    async function deleteUserAccount() {
      if (!userUniqueId) return false;
      
      try {
        if (!confirm("√ätes-vous s√ªr de vouloir supprimer TOUTES vos donn√©es ? Cette action est irr√©versible.")) {
          return false;
        }
        
        console.log("Suppression du compte utilisateur:", userUniqueId);
        
        try {
          await firestore.collection('flowerCodes').doc(userUniqueId).delete();
          console.log("Donn√©es supprim√©es de la collection flowerCodes");
        } catch (error) {
          console.error("Erreur lors de la suppression de flowerCodes:", error);
        }
        
        try {
          const flowersQuery = await firestore.collection('flowers').where('uniqueId', '==', userUniqueId).get();
          
          const batch = firestore.batch();
          let count = 0;
          
          flowersQuery.forEach((doc) => {
            batch.delete(doc.ref);
            count++;
          });
          
          if (count > 0) {
            await batch.commit();
            console.log(`${count} documents supprim√©s de la collection flowers`);
          }
        } catch (error) {
          console.error("Erreur lors de la suppression de flowers:", error);
        }
        
        try {
          const birthdatesRef = database.ref('birthdates');
          const query = birthdatesRef.orderByChild('uniqueId').equalTo(userUniqueId);
          
          query.once('value', (snapshot) => {
            snapshot.forEach((childSnapshot) => {
              birthdatesRef.child(childSnapshot.key).remove();
            });
          });
          
          console.log("Donn√©es supprim√©es de la base de donn√©es en temps r√©el");
        } catch (error) {
          console.error("Erreur lors de la suppression de la base de donn√©es en temps r√©el:", error);
        }
        
        localStorage.removeItem('userFlowerData');
        localStorage.removeItem('isInstalled');
        localStorage.removeItem('flowerSubject');
        localStorage.removeItem('preferredTheme');
        
        removeCookie('userUniqueId');
        removeCookie('userFlowerCode');
        removeCookie('isInstalled');
        removeCookie('userDateOfBirth');
        removeCookie('userProfession');
        removeCookie('userFullName');
        removeCookie('userEmoji');
        removeCookie('userRank');
        removeCookie('preferredTheme');
        
        userUniqueId = null;
        userFlowerCode = null;
        currentMotivation = null;
        userDateOfBirth = null;
        userProfession = null;
        userFullName = null;
        userEmoji = null;
        userRank = null;
        isInstalled = false;
        seenSubjects = [];
        shareCount = 0;
        
        try {
          if (auth.currentUser) {
            await auth.currentUser.delete();
            console.log("Utilisateur Firebase supprim√©");
          }
        } catch (authError) {
          console.error("Erreur lors de la suppression de l'authentification:", authError);
        }
        
        console.log("Compte utilisateur compl√®tement supprim√©");
        return true;
      } catch (error) {
        console.error("Erreur lors de la suppression du compte:", error);
        return false;
      }
    }

    window.addEventListener('load', async () => {
      const today = new Date();
      const twoYearsAgo = new Date(today.getFullYear() - 5, today.getMonth(), today.getDate());
      document.getElementById('dobInput').max = twoYearsAgo.toISOString().split('T')[0];
      
      const savedTheme = localStorage.getItem('preferredTheme') || getCookie('preferredTheme');
      if (savedTheme) {
        setTheme(savedTheme);
      } else {
        setTheme('green-blue');
      }
      
      if (checkSavedUserData()) {
        console.log("L'utilisateur a d√©j√† des donn√©es, masquage de la fen√™tre de bienvenue");
        const welcomeToast = document.getElementById('welcomeToast');
        welcomeToast.style.display = 'block';
        setTimeout(() => {
          welcomeToast.style.opacity = '1';
        }, 100);
        setTimeout(() => {
          welcomeToast.style.opacity = '0';
          setTimeout(() => {
            welcomeToast.style.display = 'none';
          }, 500);
        }, 2000);
        
        if (!isAuthenticated) {
          try {
            await authenticateAnonymously();
          } catch (error) {
            console.error("Erreur lors de l'authentification:", error);
          }
        }
      } else {
        console.log("Aucune donn√©e utilisateur sauvegard√©e trouv√©e, affichage de la fen√™tre de bienvenue");
        const welcomeModal = document.getElementById('welcomeModal');
        welcomeModal.style.display = 'block';
        setTimeout(() => {
          welcomeModal.classList.add('show');
        }, 100);
      }
      
      setupProfessionDropdown();
    });

    function setupProfessionDropdown() {
      const professionInput = document.getElementById('professionInput');
      const professionDropdown = document.getElementById('professionDropdown');
      
      if (!professionInput || !professionDropdown) {
        console.error("√âl√©ments de la liste d√©roulante des professions non trouv√©s");
        return;
      }
      
      function filterProfessions(input) {
        if (!input) return [];
        
        input = input.toLowerCase();
        return professions.filter(profession => 
          profession.toLowerCase().includes(input)
        );
      }
      
      function renderDropdownOptions(filteredProfessions) {
        professionDropdown.innerHTML = '';
        
        if (filteredProfessions.length === 0) {
          const option = document.createElement('div');
          option.className = 'profession-option';
          option.textContent = 'Aucune correspondance trouv√©e';
          professionDropdown.appendChild(option);
        } else {
          filteredProfessions.forEach(profession => {
            const option = document.createElement('div');
            option.className = 'profession-option';
            option.textContent = profession;
            option.addEventListener('click', () => {
              professionInput.value = profession;
              professionDropdown.style.display = 'none';
            });
            professionDropdown.appendChild(option);
          });
        }
      }
      
      professionInput.addEventListener('input', () => {
        const filtered = filterProfessions(professionInput.value);
        renderDropdownOptions(filtered);
        
        if (filtered.length > 0) {
          professionDropdown.style.display = 'block';
        } else {
          professionDropdown.style.display = 'none';
        }
      });
      
      professionInput.addEventListener('focus', () => {
        if (professionInput.value) {
          const filtered = filterProfessions(professionInput.value);
          renderDropdownOptions(filtered);
          professionDropdown.style.display = 'block';
        }
      });
      
      document.addEventListener('click', (e) => {
        if (!professionInput.contains(e.target) && !professionDropdown.contains(e.target)) {
          professionDropdown.style.display = 'none';
        }
      });
    }

    document.getElementById('flowerButton').addEventListener('click', function() {
      if (!userUniqueId) {
        alert("Veuillez d'abord cr√©er votre compte fleur.");
        return;
      }
      
      updateFlowerDisplay();
      const flowerModal = document.getElementById('flowerModal');
      flowerModal.style.display = 'block';
      setTimeout(() => {
        flowerModal.classList.add('show');
      }, 10);
      document.getElementById('shareFlowerButton').style.display = 'flex';
    });

    document.getElementById('shareFlowerButton').addEventListener('click', function() {
      captureFlower();
    });
    
    document.getElementById('showIdButton').addEventListener('click', function() {
      if (userUniqueId) {
        document.getElementById('userIdDisplay').textContent = userUniqueId;
        const idModal = document.getElementById('idModal');
        idModal.style.display = 'block';
        setTimeout(() => {
          idModal.classList.add('show');
        }, 10);
      } else {
        alert("Veuillez d'abord cr√©er votre compte fleur pour obtenir votre ID unique.");
      }
    });
    
    document.getElementById('copyIdButton').addEventListener('click', function() {
      const idText = document.getElementById('userIdDisplay').textContent;
      navigator.clipboard.writeText(idText).then(function() {
        alert('ID copi√© dans le presse-papiers !');
      }).catch(function() {
        alert('Impossible de copier l\'ID. Veuillez s√©lectionner et copier manuellement.');
      });
    });
    
    document.getElementById('closeIdModal').addEventListener('click', function() {
      const idModal = document.getElementById('idModal');
      idModal.classList.remove('show');
      setTimeout(() => {
        idModal.style.display = 'none';
      }, 300);
    });
    
    document.getElementById('deleteAccountButton').addEventListener('click', function() {

      deleteUserAccount().then(success => {
        if (success) {
          alert("Compte supprim√© avec succ√®s. Vous devrez cr√©er un nouveau compte pour utiliser cette application.");
          const idModal = document.getElementById('idModal');
          idModal.classList.remove('show');
          setTimeout(() => {
            idModal.style.display = 'none';
            const welcomeModal = document.getElementById('welcomeModal');
            welcomeModal.style.display = 'block';
            setTimeout(() => {
              welcomeModal.classList.add('show');
            }, 100);
          }, 300);
        } else {
          alert("Error,  try later");
        }
      });
    });
    
    document.getElementById('refreshMotivation').addEventListener('click', function() {
      const newMotivation = generatePersonalizedMotivation(userFlowerCode, userProfession, userDateOfBirth);
      currentMotivation = newMotivation;
      
      const newSubject = getRandomSubject();
      localStorage.setItem('flowerSubject', newSubject);
      
      const formattedName = formatUserName(userFullName);
      
      const flowerCodeElement = document.getElementById('flowerCodeDisplay');
      if (formattedName) {
        flowerCodeElement.innerHTML = `My Flower - ${newSubject} / ${formattedName} ${userEmoji}`;
      } else {
        flowerCodeElement.textContent = "My Flower - " + newSubject;
      }
      
      document.getElementById('monthlyMotivation').textContent = newMotivation;
      
      const captureCode = document.getElementById('captureFlowerCode');
      const captureMotivation = document.getElementById('captureFlowerMotivation');
      
      if (captureCode) {
        if (formattedName) {
          captureCode.innerHTML = `My Flower - ${newSubject} / ${formattedName} ${userEmoji}`;
        } else {
          captureCode.textContent = "My Flower - " + newSubject;
        }
      }
      
      if (captureMotivation) captureMotivation.textContent = newMotivation;
      
      this.style.transition = 'transform 0.5s ease';
      this.style.transform = 'rotate(360deg)';
      
      setTimeout(() => {
        this.style.transition = 'none';
        this.style.transform = 'rotate(0deg)';
      }, 500);
    });
    
    document.getElementById('createAccountButton').addEventListener('click', async function() {
      const dobInput = document.getElementById('dobInput');
      const professionInput = document.getElementById('professionInput');
      const fullNameInput = document.getElementById('fullNameInput');
      
      if (!fullNameInput.value) {
        alert("Please enter your full name.");
        return;
      }
      
      if (!dobInput.value) {
        alert("Please enter your date of birth.");
        return;
      }
      
      if (!professionInput.value) {
        alert("Please enter your profession.");
        return;
      }
      
      document.getElementById('loadingSpinner').style.display = 'block';
      document.getElementById('createAccountButton').disabled = true;
      
      try {
        await authenticateAnonymously();
        
        userFullName = fullNameInput.value;
        userDateOfBirth = dobInput.value;
        userProfession = professionInput.value;
        
        userUniqueId = generateUniqueId();
        console.log("Generated unique ID:", userUniqueId);
        
        userFlowerCode = generateFlowerCode();
        
        userEmoji = await getUserRankAndEmoji();
        
        const subject = getRandomSubject();
        localStorage.setItem('flowerSubject', subject);
        
        currentMotivation = generatePersonalizedMotivation(userFlowerCode, userProfession, userDateOfBirth);
        
        const createButton = document.getElementById('createAccountButton');
        createButton.innerHTML = '<i class="fas fa-check"></i> Done';
        createButton.style.backgroundColor = '#4CAF50';
        
        const userData = {
          date: new Date().toISOString(),
          uid: userUid,
          uniqueId: userUniqueId,
          flowerCode: userFlowerCode,
          motivation: currentMotivation,
          dateOfBirth: userDateOfBirth,
          profession: userProfession,
          fullName: userFullName,
          formattedName: formatUserName(userFullName),
          timestamp: Date.now(),
          theme: currentTheme,
          subject: subject,
          shareCount: 0,
          rank: userRank,
          emoji: userEmoji
        };
        
        localStorage.setItem('userFlowerData', JSON.stringify(userData));
        localStorage.setItem('isInstalled', 'true');
        setCookie('userUniqueId', userUniqueId, 365);
        setCookie('userFlowerCode', userFlowerCode, 365);
        setCookie('userDateOfBirth', userDateOfBirth, 365);
        setCookie('userProfession', userProfession, 365);
        setCookie('userFullName', userFullName, 365);
        setCookie('userEmoji', userEmoji, 365);
        setCookie('userRank', userRank.toString(), 365);
        setCookie('isInstalled', 'true', 365);
        isInstalled = true;
        
        setTimeout(() => {
          const welcomeModal = document.getElementById('welcomeModal');
          welcomeModal.classList.remove('show');
          
          setTimeout(() => {
            welcomeModal.style.display = 'none';
            document.getElementById('loadingSpinner').style.display = 'none';
            createButton.innerHTML = 'Create Account';
            createButton.style.backgroundColor = '';
            createButton.disabled = false;
            
            submitToFirebase().then(submitted => {
              console.log("Firebase submission result:", submitted);
              
              const welcomeToast = document.getElementById('welcomeToast');
              welcomeToast.style.display = 'block';
              setTimeout(() => {
                welcomeToast.style.opacity = '1';
              }, 100);
              setTimeout(() => {
                welcomeToast.style.opacity = '0';
                setTimeout(() => {
                  welcomeToast.style.display = 'none';
                }, 500);
              }, 2000);
              
              updateFlowerDisplay();
              const flowerModal = document.getElementById('flowerModal');
              flowerModal.style.display = 'block';
              setTimeout(() => {
                flowerModal.classList.add('show');
              }, 10);
              document.getElementById('shareFlowerButton').style.display = 'flex';
            });
          }, 300);
        }, 2000);
        
        console.log("Setup complete and data stored locally and in cookies");
      } catch (error) {
        console.error("Error during setup:", error);
        document.getElementById('loadingSpinner').style.display = 'none';
        document.getElementById('createAccountButton').disabled = false;
        alert("There was a problem setting up your flower. Please try again.");
      }
    });
    
    async function captureFlower() {
      try {
        const captureContainer = document.getElementById('flowerCaptureContainer');
        
        updateCaptureStyles(currentTheme);
        
        if (typeof html2canvas !== 'function') {
          console.error("html2canvas not loaded or not available as a function");
          alert("Cannot capture flower. The capture library is not loaded.");
          return;
        }
        
        let bgColor = 'white';
        if (currentTheme === 'red-black') bgColor = 'black';
        else if (currentTheme === 'green-blue') bgColor = '#1A2E4D';
        else if (currentTheme === 'orange-pink' || currentTheme === 'yellow-purple') bgColor = '#4B0082';
        
        const canvas = await html2canvas(captureContainer, {
          backgroundColor: bgColor,
          scale: 7,
          logging: true,
          useCORS: true,
          allowTaint: true,
          letterRendering: true
        });
        
        const imageUrl = canvas.toDataURL('image/png');
        
        const capturedImage = document.getElementById('capturedImage');
        if (capturedImage) {
          capturedImage.src = imageUrl;
          document.getElementById('capturedFlower').style.display = 'flex';
          document.getElementById('shareWarning').style.display = 'block';
          
          updateShareCount();
        } else {
          console.error("capturedImage element not found");
        }
      } catch (error) {
        console.error('Error capturing flower:', error);
        alert('Could not capture your flower. Please try again.');
      }
    }
    
    document.getElementById('shareCapture').addEventListener('click', function() {
      const imageUrl = document.getElementById('capturedImage').src;
      
      if (navigator.share) {
        fetch(imageUrl)
          .then(res => res.blob())
          .then(blob => {
            const file = new File([blob], 'my-gz-flower.png', { type: 'image/png' });
            navigator.share({
              title: 'My G-Z Flower',
              text: 'Discover yours at g-z.online',
              files: [file]
            }).catch(err => {
              console.log('Error sharing:', err);
              fallbackShare();
            });
          })
          .catch(err => {
            console.log('Error preparing image:', err);
            fallbackShare();
          });
      } else {
        fallbackShare();
      }
    });
    
    function fallbackShare() {
      try {
        const shareText = `
Check out my Flower of Life from G-Z: ${userUniqueId}. Discover yours at g-z.online`;
        
        navigator.clipboard.writeText(shareText).then(function() {
          alert('Share text copied to clipboard!');
        }).catch(function() {
          alert('Could not copy share text.');
        });
      } catch (error) {
        console.error('Fallback share error:', error);
        alert('An error occurred.');
      }
    }
    
    document.getElementById('closeCapture').addEventListener('click', function() {
      document.getElementById('capturedFlower').style.display = 'none';
    });
    
    document.getElementById('closeFlowerModal').addEventListener('click', function() {
      const flowerModal = document.getElementById('flowerModal');
      flowerModal.classList.remove('show');
      setTimeout(() => {
        flowerModal.style.display = 'none';
        document.getElementById('shareFlowerButton').style.display = 'none';
      }, 300);
    });

    window.onclick = function(event) {
      const flowerModal = document.getElementById('flowerModal');
      const capturedFlower = document.getElementById('capturedFlower');
      const idModal = document.getElementById('idModal');
      const welcomeModal = document.getElementById('welcomeModal');
      
      if (event.target == flowerModal) {
        flowerModal.classList.remove('show');
        setTimeout(() => {
          flowerModal.style.display = "none";
          document.getElementById('shareFlowerButton').style.display = 'none';
        }, 300);
      }
      
      if (event.target == capturedFlower) {
        capturedFlower.style.display = "none";
      }
      
      if (event.target == idModal) {
        idModal.classList.remove('show');
        setTimeout(() => {
          idModal.style.display = "none";
        }, 300);
      }
      
      if (event.target == welcomeModal && isInstalled) {
        welcomeModal.classList.remove('show');
        setTimeout(() => {
          welcomeModal.style.display = "none";
        }, 300);
      }
    };
    
    document.getElementById('shareFlowerButton').style.display = 'none';
    document.getElementById('shareWarning').style.display = 'none';
    
    document.querySelectorAll('.style-option').forEach(option => {
      option.addEventListener('click', function() {
        const theme = this.dataset.theme;
        setTheme(theme);
      });
    });
  </script>
</body>
</html>
